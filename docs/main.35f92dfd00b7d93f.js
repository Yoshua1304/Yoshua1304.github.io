(self.webpackChunkAppfarmacia=self.webpackChunkAppfarmacia||[]).push([[179],{620:(np,Hc,jl)=>{"use strict";function dn(e){return"function"==typeof e}function Yu(e){const n=e(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const rp=Yu(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,l)=>`${l+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function f(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class er{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const d of n)d.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(dn(i))try{i()}catch(d){t=d instanceof rp?d.errors:[d]}const{_finalizers:l}=this;if(l){this._finalizers=null;for(const d of l)try{Oe(d)}catch(y){t=null!=t?t:[],y instanceof rp?t=[...t,...y.errors]:t.push(y)}}if(t)throw new rp(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Oe(t);else{if(t instanceof er){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&f(n,t)}remove(t){const{_finalizers:n}=this;n&&f(n,t),t instanceof er&&t._removeParent(this)}}er.EMPTY=(()=>{const e=new er;return e.closed=!0,e})();const $o=er.EMPTY;function fi(e){return e instanceof er||e&&"closed"in e&&dn(e.remove)&&dn(e.add)&&dn(e.unsubscribe)}function Oe(e){dn(e)?e():e.unsubscribe()}const Pt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ft={setTimeout(e,t,...n){const{delegate:i}=ft;return(null==i?void 0:i.setTimeout)?i.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=ft;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function co(e){ft.setTimeout(()=>{const{onUnhandledError:t}=Pt;if(!t)throw e;t(e)})}function Mo(){}const nn=Go("C",void 0,void 0);function Go(e,t,n){return{kind:e,value:t,error:n}}let Di=null;function Ti(e){if(Pt.useDeprecatedSynchronousErrorHandling){const t=!Di;if(t&&(Di={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:i}=Di;if(Di=null,n)throw i}}else e()}class Js extends er{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,fi(t)&&t.add(this)):this.destination=Zc}static create(t,n,i){return new or(t,n,i)}next(t){this.isStopped?$a(function qc(e){return Go("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?$a(function pi(e){return Go("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?$a(nn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const So=Function.prototype.bind;function fs(e,t){return So.call(e,t)}class $l{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(i){ps(i)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(i){ps(i)}else ps(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){ps(n)}}}class or extends Js{constructor(t,n,i){let l;if(super(),dn(t)||!t)l={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=i?i:void 0};else{let d;this&&Pt.useDeprecatedNextContext?(d=Object.create(t),d.unsubscribe=()=>this.unsubscribe(),l={next:t.next&&fs(t.next,d),error:t.error&&fs(t.error,d),complete:t.complete&&fs(t.complete,d)}):l=t}this.destination=new $l(l)}}function ps(e){Pt.useDeprecatedSynchronousErrorHandling?function tn(e){Pt.useDeprecatedSynchronousErrorHandling&&Di&&(Di.errorThrown=!0,Di.error=e)}(e):co(e)}function $a(e,t){const{onStoppedNotification:n}=Pt;n&&ft.setTimeout(()=>n(e,t))}const Zc={closed:!0,next:Mo,error:function ja(e){throw e},complete:Mo},Ho="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ni(e){return e}let Dn=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new e;return i.source=this,i.operator=n,i}subscribe(n,i,l){const d=function Tn(e){return e&&e instanceof Js||function Wc(e){return e&&dn(e.next)&&dn(e.error)&&dn(e.complete)}(e)&&fi(e)}(n)?n:new or(n,i,l);return Ti(()=>{const{operator:y,source:w}=this;d.add(y?y.call(d,w):w?this._subscribe(d):this._trySubscribe(d))}),d}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=Mi(i))((l,d)=>{const y=new or({next:w=>{try{n(w)}catch(T){d(T),y.unsubscribe()}},error:d,complete:l});this.subscribe(y)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[Ho](){return this}pipe(...n){return function Zo(e){return 0===e.length?Ni:1===e.length?e[0]:function(n){return e.reduce((i,l)=>l(i),n)}}(n)(this)}toPromise(n){return new(n=Mi(n))((i,l)=>{let d;this.subscribe(y=>d=y,y=>l(y),()=>i(d))})}}return e.create=t=>new e(t),e})();function Mi(e){var t;return null!==(t=null!=e?e:Pt.Promise)&&void 0!==t?t:Promise}const Gr=Yu(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let br=(()=>{class e extends Dn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new Vi(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new Gr}next(n){Ti(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(n)}})}error(n){Ti(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){Ti(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:l,observers:d}=this;return i||l?$o:(this.currentObservers=null,d.push(n),new er(()=>{this.currentObservers=null,f(d,n)}))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:l,isStopped:d}=this;i?n.error(l):d&&n.complete()}asObservable(){const n=new Dn;return n.source=this,n}}return e.create=(t,n)=>new Vi(t,n),e})();class Vi extends br{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,t)}error(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==i?i:$o}}function Qs(e){return dn(null==e?void 0:e.lift)}function $n(e){return t=>{if(Qs(t))return t.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function tr(e,t,n,i,l){return new ea(e,t,n,i,l)}class ea extends Js{constructor(t,n,i,l,d,y){super(t),this.onFinalize=d,this.shouldUnsubscribe=y,this._next=n?function(w){try{n(w)}catch(T){t.error(T)}}:super._next,this._error=l?function(w){try{l(w)}catch(T){t.error(T)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(w){t.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Ot(e,t){return $n((n,i)=>{let l=0;n.subscribe(tr(i,d=>{i.next(e.call(t,d,l++))}))})}function Or(e){return this instanceof Or?(this.v=e,this):new Or(e)}function ho(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,i=n.apply(e,t||[]),d=[];return l={},y("next"),y("throw"),y("return"),l[Symbol.asyncIterator]=function(){return this},l;function y(Y){i[Y]&&(l[Y]=function(ie){return new Promise(function(ve,Fe){d.push([Y,ie,ve,Fe])>1||w(Y,ie)})})}function w(Y,ie){try{!function T(Y){Y.value instanceof Or?Promise.resolve(Y.value.v).then(k,L):U(d[0][2],Y)}(i[Y](ie))}catch(ve){U(d[0][3],ve)}}function k(Y){w("next",Y)}function L(Y){w("throw",Y)}function U(Y,ie){Y(ie),d.shift(),d.length&&w(d[0][0],d[0][1])}}function ql(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Ha(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(d){n[d]=e[d]&&function(y){return new Promise(function(w,T){!function l(d,y,w,T){Promise.resolve(T).then(function(k){d({value:k,done:w})},y)}(w,T,(y=e[d](y)).done,y.value)})}}}const Wo=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Wl(e){return dn(null==e?void 0:e.then)}function Ui(e){return dn(e[Ho])}function Xo(e){return Symbol.asyncIterator&&dn(null==e?void 0:e[Symbol.asyncIterator])}function gs(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const sa=function oa(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ya(e){return dn(null==e?void 0:e[sa])}function aa(e){return ho(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:i,done:l}=yield Or(n.read());if(l)return yield Or(void 0);yield yield Or(i)}}finally{n.releaseLock()}})}function J(e){return dn(null==e?void 0:e.getReader)}function z(e){if(e instanceof Dn)return e;if(null!=e){if(Ui(e))return function V(e){return new Dn(t=>{const n=e[Ho]();if(dn(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Wo(e))return function W(e){return new Dn(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Wl(e))return function re(e){return new Dn(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,co)})}(e);if(Xo(e))return ge(e);if(Ya(e))return function ce(e){return new Dn(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(J(e))return function _e(e){return ge(aa(e))}(e)}throw gs(e)}function ge(e){return new Dn(t=>{(function ue(e,t){var n,i,l,d;return function ra(e,t,n,i){return new(n||(n=Promise))(function(d,y){function w(L){try{k(i.next(L))}catch(U){y(U)}}function T(L){try{k(i.throw(L))}catch(U){y(U)}}function k(L){L.done?d(L.value):function l(d){return d instanceof n?d:new n(function(y){y(d)})}(L.value).then(w,T)}k((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=ql(e);!(i=yield n.next()).done;)if(t.next(i.value),t.closed)return}catch(y){l={error:y}}finally{try{i&&!i.done&&(d=n.return)&&(yield d.call(n))}finally{if(l)throw l.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function ye(e,t,n,i=0,l=!1){const d=t.schedule(function(){n(),l?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(d),!l)return d}function Ue(e,t,n=1/0){return dn(t)?Ue((i,l)=>Ot((d,y)=>t(i,d,l,y))(z(e(i,l))),n):("number"==typeof t&&(n=t),$n((i,l)=>function Re(e,t,n,i,l,d,y,w){const T=[];let k=0,L=0,U=!1;const Y=()=>{U&&!T.length&&!k&&t.complete()},ie=Fe=>k<i?ve(Fe):T.push(Fe),ve=Fe=>{d&&t.next(Fe),k++;let Ke=!1;z(n(Fe,L++)).subscribe(tr(t,Xe=>{null==l||l(Xe),d?ie(Xe):t.next(Xe)},()=>{Ke=!0},void 0,()=>{if(Ke)try{for(k--;T.length&&k<i;){const Xe=T.shift();y?ye(t,y,()=>ve(Xe)):ve(Xe)}Y()}catch(Xe){t.error(Xe)}}))};return e.subscribe(tr(t,ie,()=>{U=!0,Y()})),()=>{null==w||w()}}(i,l,e,n)))}function Le(e=1/0){return Ue(Ni,e)}const ut=new Dn(e=>e.complete());function xt(e){return e&&dn(e.schedule)}function xe(e){return e[e.length-1]}function sn(e){return dn(xe(e))?e.pop():void 0}function rt(e){return xt(xe(e))?e.pop():void 0}function ln(e,t=0){return $n((n,i)=>{n.subscribe(tr(i,l=>ye(i,e,()=>i.next(l),t),()=>ye(i,e,()=>i.complete(),t),l=>ye(i,e,()=>i.error(l),t)))})}function _s(e,t=0){return $n((n,i)=>{i.add(e.schedule(()=>n.subscribe(i),t))})}function fo(e,t){if(!e)throw new Error("Iterable cannot be null");return new Dn(n=>{ye(n,t,()=>{const i=e[Symbol.asyncIterator]();ye(n,t,()=>{i.next().then(l=>{l.done?n.complete():n.next(l.value)})},0,!0)})})}function qn(e,t){return t?function $t(e,t){if(null!=e){if(Ui(e))return function Ko(e,t){return z(e).pipe(_s(t),ln(t))}(e,t);if(Wo(e))return function Wt(e,t){return new Dn(n=>{let i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if(Wl(e))return function Qe(e,t){return z(e).pipe(_s(t),ln(t))}(e,t);if(Xo(e))return fo(e,t);if(Ya(e))return function Ut(e,t){return new Dn(n=>{let i;return ye(n,t,()=>{i=e[sa](),ye(n,t,()=>{let l,d;try{({value:l,done:d}=i.next())}catch(y){return void n.error(y)}d?n.complete():n.next(l)},0,!0)}),()=>dn(null==i?void 0:i.return)&&i.return()})}(e,t);if(J(e))return function la(e,t){return fo(aa(e),t)}(e,t)}throw gs(e)}(e,t):z(e)}function ys(...e){const t=rt(e),n=function an(e,t){return"number"==typeof xe(e)?e.pop():t}(e,1/0),i=e;return i.length?1===i.length?z(i[0]):Le(n)(qn(i,t)):ut}function Gn(e){return e<=0?()=>ut:$n((t,n)=>{let i=0;t.subscribe(tr(n,l=>{++i<=e&&(n.next(l),e<=i&&n.complete())}))})}function Fn(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(Gn(1)).subscribe(()=>e())}function Ln(e){for(let t in e)if(e[t]===Ln)return t;throw Error("Could not find renamed property on target object.")}function ca(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function _n(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(_n).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function vs(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Xc=Ln({__forward_ref__:Ln});function In(e){return e.__forward_ref__=In,e.toString=function(){return _n(this())},e}function lt(e){return ua(e)?e():e}function ua(e){return"function"==typeof e&&e.hasOwnProperty(Xc)&&e.__forward_ref__===In}class Tt extends Error{constructor(t,n){super(function Qr(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function Dt(e){return"string"==typeof e?e:null==e?"":String(e)}function fr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Dt(e)}function pr(e,t){const n=t?` in ${t}`:"";throw new Tt(-201,`No provider for ${fr(e)} found${n}`)}function mi(e,t){null==e&&function Cn(e,t,n,i){throw new Error(`ASSERTION ERROR: ${e}`+(null==i?"":` [Expected=> ${n} ${i} ${t} <=Actual]`))}(t,e,null,"!=")}function zt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ti(e){return{providers:e.providers||[],imports:e.imports||[]}}function Qa(e){return el(e,ko)||el(e,tl)}function el(e,t){return e.hasOwnProperty(t)?e[t]:null}function rh(e){return e&&(e.hasOwnProperty(Hr)||e.hasOwnProperty(Kl))?e[Hr]:null}const ko=Ln({\u0275prov:Ln}),Hr=Ln({\u0275inj:Ln}),tl=Ln({ngInjectableDef:Ln}),Kl=Ln({ngInjectorDef:Ln});var St=(()=>((St=St||{})[St.Default=0]="Default",St[St.Host=1]="Host",St[St.Self=2]="Self",St[St.SkipSelf=4]="SkipSelf",St[St.Optional=8]="Optional",St))();let Ro;function Gi(e){const t=Ro;return Ro=e,t}function nl(e,t,n){const i=Qa(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&St.Optional?null:void 0!==t?t:void pr(_n(e),"Injector")}function po(e){return{toString:e}.toString()}var Hi=(()=>((Hi=Hi||{})[Hi.OnPush=0]="OnPush",Hi[Hi.Default=1]="Default",Hi))(),qi=(()=>{return(e=qi||(qi={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",qi;var e})();const ih="undefined"!=typeof globalThis&&globalThis,Ad="undefined"!=typeof window&&window,Pd="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,un=ih||"undefined"!=typeof global&&global||Ad||Pd,Jo={},Mn=[],Jc=Ln({\u0275cmp:Ln}),da=Ln({\u0275dir:Ln}),fa=Ln({\u0275pipe:Ln}),Qc=Ln({\u0275mod:Ln}),cr=Ln({\u0275fac:Ln}),ws=Ln({__NG_ELEMENT_ID__:Ln});let Jl=0;function zn(e){return po(()=>{const n={},i={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Hi.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Mn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||qi.Emulated,id:"c",styles:e.styles||Mn,_:null,setInput:null,schemas:e.schemas||null,tView:null},l=e.directives,d=e.features,y=e.pipes;return i.id+=Jl++,i.inputs=ah(e.inputs,n),i.outputs=ah(e.outputs),d&&d.forEach(w=>w(i)),i.directiveDefs=l?()=>("function"==typeof l?l():l).map(Ql):null,i.pipeDefs=y?()=>("function"==typeof y?y():y).map(ec):null,i})}function Ql(e){return qr(e)||function Cs(e){return e[da]||null}(e)}function ec(e){return function Es(e){return e[fa]||null}(e)}const tc={};function Fr(e){return po(()=>{const t={type:e.type,bootstrap:e.bootstrap||Mn,declarations:e.declarations||Mn,imports:e.imports||Mn,exports:e.exports||Mn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(tc[e.id]=e.type),t})}function ah(e,t){if(null==e)return Jo;const n={};for(const i in e)if(e.hasOwnProperty(i)){let l=e[i],d=l;Array.isArray(l)&&(d=l[1],l=l[0]),n[l]=i,t&&(t[l]=d)}return n}const It=zn;function qr(e){return e[Jc]||null}function Zi(e,t){const n=e[Qc]||null;if(!n&&!0===t)throw new Error(`Type ${_n(e)} does not have '\u0275mod' property.`);return n}function Pi(e){return Array.isArray(e)&&"object"==typeof e[1]}function Ye(e){return Array.isArray(e)&&!0===e[1]}function _i(e){return 0!=(8&e.flags)}function Ms(e){return 2==(2&e.flags)}function rc(e){return 1==(1&e.flags)}function Wi(e){return null!==e.template}function ol(e){return 0!=(512&e[2])}function Ps(e,t){return e.hasOwnProperty(cr)?e[cr]:null}class Ud{constructor(t,n,i){this.previousValue=t,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function ki(){return uh}function uh(e){return e.type.prototype.ngOnChanges&&(e.setInput=oc),jd}function jd(){const e=yi(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===Jo)e.previous=t;else for(let i in t)n[i]=t[i];e.current=null,this.ngOnChanges(t)}}function oc(e,t,n,i){const l=yi(e)||function sc(e,t){return e[gr]=t}(e,{previous:Jo,current:null}),d=l.current||(l.current={}),y=l.previous,w=this.declaredInputs[n],T=y[w];d[w]=new Ud(T&&T.currentValue,t,y===Jo),e[i]=t}ki.ngInherit=!0;const gr="__ngSimpleChanges__";function yi(e){return e[gr]||null}let cu;function Yn(e){return!!e.listen}const dh={createRenderer:(e,t)=>function xa(){return void 0!==cu?cu:"undefined"!=typeof document?document:void 0}()};function Jn(e){for(;Array.isArray(e);)e=e[0];return e}function ni(e,t){return Jn(t[e.index])}function cl(e,t){return e.data[t]}function vi(e,t){const n=t[e];return Pi(n)?n:n[0]}function ph(e){return 4==(4&e[2])}function cc(e){return 128==(128&e[2])}function Qo(e,t){return null==t?null:e[t]}function mh(e){e[18]=0}function uc(e,t){e[5]+=t;let n=e,i=e[3];for(;null!==i&&(1===t&&1===n[5]||-1===t&&0===n[5]);)i[5]+=t,n=i,i=i[3]}const Nt={lFrame:E(null),bindingsEnabled:!0};function wa(){return Nt.bindingsEnabled}function je(){return Nt.lFrame.lView}function rn(){return Nt.lFrame.tView}function yr(){let e=dc();for(;null!==e&&64===e.type;)e=e.parent;return e}function dc(){return Nt.lFrame.currentTNode}function Ri(e,t){const n=Nt.lFrame;n.currentTNode=e,n.isParent=t}function vh(){return Nt.lFrame.isParent}function Ki(){return Nt.lFrame.bindingIndex++}function Yi(e,t){const n=Nt.lFrame;n.bindingIndex=n.bindingRootIndex=e,Ea(t)}function Ea(e){Nt.lFrame.currentDirectiveIndex=e}function p(){return Nt.lFrame.currentQueryIndex}function o(e){Nt.lFrame.currentQueryIndex=e}function u(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function g(e,t,n){if(n&St.SkipSelf){let l=t,d=e;for(;!(l=l.parent,null!==l||n&St.Host||(l=u(d),null===l||(d=d[15],10&l.type))););if(null===l)return!1;t=l,e=d}const i=Nt.lFrame=b();return i.currentTNode=t,i.lView=e,!0}function x(e){const t=b(),n=e[1];Nt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function b(){const e=Nt.lFrame,t=null===e?null:e.child;return null===t?E(e):t}function E(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function M(){const e=Nt.lFrame;return Nt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const A=M;function R(){const e=M();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function j(){return Nt.lFrame.selectedIndex}function q(e){Nt.lFrame.selectedIndex=e}function H(){const e=Nt.lFrame;return cl(e.tView,e.selectedIndex)}function Q(e,t){for(let n=t.directiveStart,i=t.directiveEnd;n<i;n++){const d=e.data[n].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:T,ngAfterViewChecked:k,ngOnDestroy:L}=d;y&&(e.contentHooks||(e.contentHooks=[])).push(-n,y),w&&((e.contentHooks||(e.contentHooks=[])).push(n,w),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,w)),T&&(e.viewHooks||(e.viewHooks=[])).push(-n,T),k&&((e.viewHooks||(e.viewHooks=[])).push(n,k),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,k)),null!=L&&(e.destroyHooks||(e.destroyHooks=[])).push(n,L)}}function ae(e,t,n){Se(e,t,3,n)}function me(e,t,n,i){(3&e[2])===n&&Se(e,t,n,i)}function be(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Se(e,t,n,i){const d=null!=i?i:-1,y=t.length-1;let w=0;for(let T=void 0!==i?65535&e[18]:0;T<y;T++)if("number"==typeof t[T+1]){if(w=t[T],null!=i&&w>=i)break}else t[T]<0&&(e[18]+=65536),(w<d||-1==d)&&(Te(e,n,t,T),e[18]=(4294901760&e[18])+T+2),T++}function Te(e,t,n,i){const l=n[i]<0,d=n[i+1],w=e[l?-n[i]:n[i]];if(l){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{d.call(w)}finally{}}}else try{d.call(w)}finally{}}class pe{constructor(t,n,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function _t(e,t,n){const i=Yn(e);let l=0;for(;l<n.length;){const d=n[l];if("number"==typeof d){if(0!==d)break;l++;const y=n[l++],w=n[l++],T=n[l++];i?e.setAttribute(t,w,T,y):t.setAttributeNS(y,w,T)}else{const y=d,w=n[++l];ht(y)?i&&e.setProperty(t,y,w):i?e.setAttribute(t,y,w):t.setAttribute(y,w),l++}}return l}function At(e){return 3===e||4===e||6===e}function ht(e){return 64===e.charCodeAt(0)}function vt(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let i=0;i<t.length;i++){const l=t[i];"number"==typeof l?n=l:0===n||Yt(e,n,l,null,-1===n||2===n?t[++i]:null)}}return e}function Yt(e,t,n,i,l){let d=0,y=e.length;if(-1===t)y=-1;else for(;d<e.length;){const w=e[d++];if("number"==typeof w){if(w===t){y=-1;break}if(w>t){y=d-1;break}}}for(;d<e.length;){const w=e[d];if("number"==typeof w)break;if(w===n){if(null===i)return void(null!==l&&(e[d+1]=l));if(i===e[d+1])return void(e[d+2]=l)}d++,null!==i&&d++,null!==l&&d++}-1!==y&&(e.splice(y,0,t),d=y+1),e.splice(d++,0,n),null!==i&&e.splice(d++,0,i),null!==l&&e.splice(d++,0,l)}function Hn(e){return-1!==e}function hr(e){return 32767&e}function Ar(e,t){let n=function Zr(e){return e>>16}(e),i=t;for(;n>0;)i=i[15],n--;return i}let Oi=!0;function Ji(e){const t=Oi;return Oi=e,t}let nr=0;function Wn(e,t){const n=Nn(e,t);if(-1!==n)return n;const i=t[1];i.firstCreatePass&&(e.injectorIndex=t.length,ri(i.data,e),ri(t,null),ri(i.blueprint,null));const l=ii(e,t),d=e.injectorIndex;if(Hn(l)){const y=hr(l),w=Ar(l,t),T=w[1].data;for(let k=0;k<8;k++)t[d+k]=w[y+k]|T[y+k]}return t[d+8]=l,d}function ri(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Nn(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function ii(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,i=null,l=t;for(;null!==l;){const d=l[1],y=d.type;if(i=2===y?d.declTNode:1===y?l[6]:null,null===i)return-1;if(n++,l=l[15],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return-1}function Fs(e,t,n){!function hn(e,t,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(ws)&&(i=n[ws]),null==i&&(i=n[ws]=nr++);const l=255&i;t.data[e+(l>>5)]|=1<<l}(e,t,n)}function Ls(e,t,n){if(n&St.Optional)return e;pr(t,"NodeInjector")}function bh(e,t,n,i){if(n&St.Optional&&void 0===i&&(i=null),0==(n&(St.Self|St.Host))){const l=e[9],d=Gi(void 0);try{return l?l.get(t,i,n&St.Optional):nl(t,i,n&St.Optional)}finally{Gi(d)}}return Ls(i,t,n)}function pu(e,t,n,i=St.Default,l){if(null!==e){const d=function og(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ws)?e[ws]:void 0;return"number"==typeof t?t>=0?255&t:pp:t}(n);if("function"==typeof d){if(!g(t,e,i))return i&St.Host?Ls(l,n,i):bh(t,n,i,l);try{const y=d(i);if(null!=y||i&St.Optional)return y;pr(n)}finally{A()}}else if("number"==typeof d){let y=null,w=Nn(e,t),T=-1,k=i&St.Host?t[16][6]:null;for((-1===w||i&St.SkipSelf)&&(T=-1===w?ii(e,t):t[w+8],-1!==T&&wh(i,!1)?(y=t[1],w=hr(T),t=Ar(T,t)):w=-1);-1!==w;){const L=t[1];if(Wd(d,w,L.data)){const U=zs(w,t,n,y,i,k);if(U!==Ta)return U}T=t[w+8],-1!==T&&wh(i,t[1].data[w+8]===k)&&Wd(d,w,t)?(y=L,w=hr(T),t=Ar(T,t)):w=-1}}}return bh(t,n,i,l)}const Ta={};function pp(){return new Qi(yr(),je())}function zs(e,t,n,i,l,d){const y=t[1],w=y.data[e+8],L=dl(w,y,n,null==i?Ms(w)&&Oi:i!=y&&0!=(3&w.type),l&St.Host&&d===w);return null!==L?fl(t,y,L,w):Ta}function dl(e,t,n,i,l){const d=e.providerIndexes,y=t.data,w=1048575&d,T=e.directiveStart,L=d>>20,Y=l?w+L:e.directiveEnd;for(let ie=i?w:w+L;ie<Y;ie++){const ve=y[ie];if(ie<T&&n===ve||ie>=T&&ve.type===n)return ie}if(l){const ie=y[T];if(ie&&Wi(ie)&&ie.type===n)return T}return null}function fl(e,t,n,i){let l=e[n];const d=t.data;if(function He(e){return e instanceof pe}(l)){const y=l;y.resolving&&function lr(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Tt(-200,`Circular dependency in DI detected for ${e}${n}`)}(fr(d[n]));const w=Ji(y.canSeeViewProviders);y.resolving=!0;const T=y.injectImpl?Gi(y.injectImpl):null;g(e,i,St.Default);try{l=e[n]=y.factory(void 0,d,e,i),t.firstCreatePass&&n>=i.directiveStart&&function oe(e,t,n){const{ngOnChanges:i,ngOnInit:l,ngDoCheck:d}=t.type.prototype;if(i){const y=uh(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,y),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,y)}l&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,l),d&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,d),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,d))}(n,d[n],t)}finally{null!==T&&Gi(T),Ji(w),y.resolving=!1,A()}}return l}function Wd(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function wh(e,t){return!(e&St.Self||e&St.Host&&t)}class Qi{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,i){return pu(this._tNode,this._lView,t,i,n)}}function zr(e){return po(()=>{const t=e.prototype.constructor,n=t[cr]||Xd(t),i=Object.prototype;let l=Object.getPrototypeOf(e.prototype).constructor;for(;l&&l!==i;){const d=l[cr]||Xd(l);if(d&&d!==n)return d;l=Object.getPrototypeOf(l)}return d=>new d})}function Xd(e){return ua(e)?()=>{const t=Xd(lt(e));return t&&t()}:Ps(e)}function mu(e){return function Fi(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const i=n.length;let l=0;for(;l<i;){const d=n[l];if(At(d))break;if(0===d)l+=2;else if("number"==typeof d)for(l++;l<i&&"string"==typeof n[l];)l++;else{if(d===t)return n[l+1];l+=2}}}return null}(yr(),e)}const _u="__parameters__";function es(e,t,n){return po(()=>{const i=function pc(e){return function(...n){if(e){const i=e(...n);for(const l in i)this[l]=i[l]}}}(t);function l(...d){if(this instanceof l)return i.apply(this,d),this;const y=new l(...d);return w.annotation=y,w;function w(T,k,L){const U=T.hasOwnProperty(_u)?T[_u]:Object.defineProperty(T,_u,{value:[]})[_u];for(;U.length<=L;)U.push(null);return(U[L]=U[L]||[]).push(y),T}}return n&&(l.prototype=Object.create(n.prototype)),l.prototype.ngMetadataName=e,l.annotationCls=l,l})}class Ft{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=zt({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ml=new Ft("AnalyzeForEntryComponents");function eo(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)?(t===e&&(t=e.slice(0,n)),eo(i,t)):t!==e&&t.push(i)}return t}function Jt(e,t){e.forEach(n=>Array.isArray(n)?Jt(n,t):t(n))}function gp(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function xu(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function xi(e,t,n){let i=wu(e,t);return i>=0?e[1|i]=n:(i=~i,function zo(e,t,n,i){let l=e.length;if(l==t)e.push(n,i);else if(1===l)e.push(i,e[0]),e[0]=n;else{for(l--,e.push(e[l-1],e[l]);l>t;)e[l]=e[l-2],l--;e[t]=n,e[t+1]=i}}(e,i,t,n)),i}function Ch(e,t){const n=wu(e,t);if(n>=0)return e[1|n]}function wu(e,t){return function _p(e,t,n){let i=0,l=e.length>>n;for(;l!==i;){const d=i+(l-i>>1),y=e[d<<n];if(t===y)return d<<n;y>t?l=d:i=d+1}return~(l<<n)}(e,t,1)}const Eh={},Dh="__NG_DI_FLAG__",nf="ngTempTokenPath",ag=/\n/gm,_c="__source",cg=Ln({provide:String,useValue:Ln});let Th;function yc(e){const t=Th;return Th=e,t}function rf(e,t=St.Default){if(void 0===Th)throw new Tt(203,"");return null===Th?nl(e,void 0,t):Th.get(e,t&St.Optional?null:void 0,t)}function bt(e,t=St.Default){return(function Yc(){return Ro}()||rf)(lt(e),t)}const Uy=bt;function xp(e){const t=[];for(let n=0;n<e.length;n++){const i=lt(e[n]);if(Array.isArray(i)){if(0===i.length)throw new Tt(900,"");let l,d=St.Default;for(let y=0;y<i.length;y++){const w=i[y],T=to(w);"number"==typeof T?-1===T?l=w.token:d|=T:l=w}t.push(bt(l,d))}else t.push(bt(i))}return t}function vc(e,t){return e[Dh]=t,e.prototype[Dh]=t,e}function to(e){return e[Dh]}const Cu=vc(es("Inject",e=>({token:e})),-1),no=vc(es("Optional"),8),xc=vc(es("SkipSelf"),4);class Tp{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Aa(e){return e instanceof Tp?e.changingThisBreaksApplicationSecurity:e}const cf=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,vl=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var sr=(()=>((sr=sr||{})[sr.NONE=0]="NONE",sr[sr.HTML=1]="HTML",sr[sr.STYLE=2]="STYLE",sr[sr.SCRIPT=3]="SCRIPT",sr[sr.URL=4]="URL",sr[sr.RESOURCE_URL=5]="RESOURCE_URL",sr))();function Rp(e){const t=function zh(){const e=je();return e&&e[12]}();return t?t.sanitize(sr.URL,e)||"":function Tu(e,t){const n=function Mp(e){return e instanceof Tp&&e.getTypeName()||null}(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}(e,"URL")?Aa(e):function xl(e){return(e=String(e)).match(cf)||e.match(vl)?e:"unsafe:"+e}(Dt(e))}const Sg="__ngContext__";function si(e,t){e[Sg]=t}function Fp(e){const t=function Iu(e){return e[Sg]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function ff(e){return e.ngOriginalError}function iv(e,...t){e.error(...t)}class jh{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t),i=function Pg(e){return e&&e.ngErrorLogger||iv}(t);i(this._console,"ERROR",t),n&&i(this._console,"ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&ff(t);for(;n&&ff(n);)n=ff(n);return n||null}}const hv=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(un))();function Us(e){return e instanceof Function?e():e}var Wr=(()=>((Wr=Wr||{})[Wr.Important=1]="Important",Wr[Wr.DashCase=2]="DashCase",Wr))();function Np(e,t){return undefined(e,t)}function Hh(e){const t=e[3];return Ye(t)?t[3]:t}function Tc(e){return mf(e[13])}function vn(e){return mf(e[4])}function mf(e){for(;null!==e&&!Ye(e);)e=e[4];return e}function Mc(e,t,n,i,l){if(null!=i){let d,y=!1;Ye(i)?d=i:Pi(i)&&(y=!0,i=i[0]);const w=Jn(i);0===e&&null!==n?null==l?gf(t,n,w):ka(t,n,w,l||null,!0):1===e&&null!==n?ka(t,n,w,l||null,!0):2===e?function xf(e,t,n){const i=El(e,t);i&&function _o(e,t,n,i){Yn(e)?e.removeChild(t,n,i):t.removeChild(n)}(e,i,t,n)}(t,w,y):3===e&&t.destroyNode(w),null!=d&&function $g(e,t,n,i,l){const d=n[7];d!==Jn(n)&&Mc(t,e,i,d,l);for(let w=10;w<n.length;w++){const T=n[w];Kh(T[1],T,e,t,i,d)}}(t,e,d,n,l)}}function jp(e,t,n){if(Yn(e))return e.createElement(t,n);{const i=null!==n?function tt(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(n):null;return null===i?e.createElement(t):e.createElementNS(i,t)}}function zg(e,t){const n=e[9],i=n.indexOf(t),l=t[3];1024&t[2]&&(t[2]&=-1025,uc(l,-1)),n.splice(i,1)}function $p(e,t){if(e.length<=10)return;const n=10+t,i=e[n];if(i){const l=i[17];null!==l&&l!==e&&zg(l,i),t>0&&(e[n-1][4]=i[4]);const d=xu(e,10+t);!function gv(e,t){Kh(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const y=d[19];null!==y&&y.detachView(d[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function qh(e,t){if(!(256&t[2])){const n=t[11];Yn(n)&&n.destroyNode&&Kh(e,t,n,3,null,null),function vv(e){let t=e[13];if(!t)return Cl(e[1],e);for(;t;){let n=null;if(Pi(t))n=t[13];else{const i=t[10];i&&(n=i)}if(!n){for(;t&&!t[4]&&t!==e;)Pi(t)&&Cl(t[1],t),t=t[3];null===t&&(t=e),Pi(t)&&Cl(t[1],t),n=t&&t[4]}t=n}}(t)}}function Cl(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function wv(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let i=0;i<n.length;i+=2){const l=t[n[i]];if(!(l instanceof pe)){const d=n[i+1];if(Array.isArray(d))for(let y=0;y<d.length;y+=2){const w=l[d[y]],T=d[y+1];try{T.call(w)}finally{}}else try{d.call(l)}finally{}}}}(e,t),function Bg(e,t){const n=e.cleanup,i=t[7];let l=-1;if(null!==n)for(let d=0;d<n.length-1;d+=2)if("string"==typeof n[d]){const y=n[d+1],w="function"==typeof y?y(t):Jn(t[y]),T=i[l=n[d+2]],k=n[d+3];"boolean"==typeof k?w.removeEventListener(n[d],T,k):k>=0?i[l=k]():i[l=-k].unsubscribe(),d+=2}else{const y=i[l=n[d+1]];n[d].call(y)}if(null!==i){for(let d=l+1;d<i.length;d++)i[d]();t[7]=null}}(e,t),1===t[1].type&&Yn(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&Ye(t[3])){n!==t[3]&&zg(n,t);const i=t[19];null!==i&&i.detachView(e)}}}function Ng(e,t,n){return function Vg(e,t,n){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return n[0];if(2&i.flags){const l=e.data[i.directiveStart].encapsulation;if(l===qi.None||l===qi.Emulated)return null}return ni(i,n)}(e,t.parent,n)}function ka(e,t,n,i,l){Yn(e)?e.insertBefore(t,n,i,l):t.insertBefore(n,i,l)}function gf(e,t,n){Yn(e)?e.appendChild(t,n):t.appendChild(n)}function Gp(e,t,n,i,l){null!==i?ka(e,t,n,i,l):gf(e,t,n)}function El(e,t){return Yn(e)?e.parentNode(t):t.parentNode}let Ug=function Zh(e,t,n){return 40&e.type?ni(e,n):null};function vf(e,t,n,i){const l=Ng(e,i,t),d=t[11],w=function _f(e,t,n){return Ug(e,t,n)}(i.parent||t[6],i,t);if(null!=l)if(Array.isArray(n))for(let T=0;T<n.length;T++)Gp(d,l,n[T],w,!1);else Gp(d,l,n,w,!1)}function Wh(e,t){if(null!==t){const n=t.type;if(3&n)return ni(t,e);if(4&n)return Xh(-1,e[t.index]);if(8&n){const i=t.child;if(null!==i)return Wh(e,i);{const l=e[t.index];return Ye(l)?Xh(-1,l):Jn(l)}}if(32&n)return Np(t,e)()||Jn(e[t.index]);{const i=qp(e,t);return null!==i?Array.isArray(i)?i[0]:Wh(Hh(e[16]),i):Wh(e,t.next)}}return null}function qp(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Xh(e,t){const n=10+e+1;if(n<t.length){const i=t[n],l=i[1].firstChild;if(null!==l)return Wh(i,l)}return t[7]}function bf(e,t,n,i,l,d,y){for(;null!=n;){const w=i[n.index],T=n.type;if(y&&0===t&&(w&&si(Jn(w),i),n.flags|=4),64!=(64&n.flags))if(8&T)bf(e,t,n.child,i,l,d,!1),Mc(t,e,l,w,d);else if(32&T){const k=Np(n,i);let L;for(;L=k();)Mc(t,e,l,L,d);Mc(t,e,l,w,d)}else 16&T?js(e,t,i,n,l,d):Mc(t,e,l,w,d);n=y?n.projectionNext:n.next}}function Kh(e,t,n,i,l,d){bf(n,i,e.firstChild,t,l,d,!1)}function js(e,t,n,i,l,d){const y=n[16],T=y[6].projection[i.projection];if(Array.isArray(T))for(let k=0;k<T.length;k++)Mc(t,e,l,T[k],d);else bf(e,t,T,y[3],l,d,!0)}function Zp(e,t,n){Yn(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function wf(e,t,n){Yn(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function Hg(e,t,n){let i=e.length;for(;;){const l=e.indexOf(t,n);if(-1===l)return l;if(0===l||e.charCodeAt(l-1)<=32){const d=t.length;if(l+d===i||e.charCodeAt(l+d)<=32)return l}n=l+1}}const Wp="ng-template";function qg(e,t,n){let i=0;for(;i<e.length;){let l=e[i++];if(n&&"class"===l){if(l=e[i],-1!==Hg(l.toLowerCase(),t,0))return!0}else if(1===l){for(;i<e.length&&"string"==typeof(l=e[i++]);)if(l.toLowerCase()===t)return!0;return!1}}return!1}function ku(e){return 4===e.type&&e.value!==Wp}function Zg(e,t,n){return t===(4!==e.type||n?e.value:Wp)}function Wg(e,t,n){let i=4;const l=e.attrs||[],d=function Xg(e){for(let t=0;t<e.length;t++)if(At(e[t]))return t;return e.length}(l);let y=!1;for(let w=0;w<t.length;w++){const T=t[w];if("number"!=typeof T){if(!y)if(4&i){if(i=2|1&i,""!==T&&!Zg(e,T,n)||""===T&&1===t.length){if(yo(i))return!1;y=!0}}else{const k=8&i?T:t[++w];if(8&i&&null!==e.attrs){if(!qg(e.attrs,k,n)){if(yo(i))return!1;y=!0}continue}const U=Ru(8&i?"class":T,l,ku(e),n);if(-1===U){if(yo(i))return!1;y=!0;continue}if(""!==k){let Y;Y=U>d?"":l[U+1].toLowerCase();const ie=8&i?Y:null;if(ie&&-1!==Hg(ie,k,0)||2&i&&k!==Y){if(yo(i))return!1;y=!0}}}}else{if(!y&&!yo(i)&&!yo(T))return!1;if(y&&yo(T))continue;y=!1,i=T|1&i}}return yo(i)||y}function yo(e){return 0==(1&e)}function Ru(e,t,n,i){if(null===t)return-1;let l=0;if(i||!n){let d=!1;for(;l<t.length;){const y=t[l];if(y===e)return l;if(3===y||6===y)d=!0;else{if(1===y||2===y){let w=t[++l];for(;"string"==typeof w;)w=t[++l];continue}if(4===y)break;if(0===y){l+=4;continue}}l+=d?1:2}return-1}return function Ef(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const i=e[n];if("number"==typeof i)return-1;if(i===t)return n;n++}return-1}(t,e)}function Xp(e,t,n=!1){for(let i=0;i<t.length;i++)if(Wg(e,t[i],n))return!0;return!1}function Kg(e,t){return e?":not("+t.trim()+")":t}function Cv(e){let t=e[0],n=1,i=2,l="",d=!1;for(;n<e.length;){let y=e[n];if("string"==typeof y)if(2&i){const w=e[++n];l+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&i?l+="."+y:4&i&&(l+=" "+y);else""!==l&&!yo(y)&&(t+=Kg(d,l),l=""),i=y,d=d||!yo(i);n++}return""!==l&&(t+=Kg(d,l)),t}const Gt={};function xn(e){Tf(rn(),je(),j()+e,!1)}function Tf(e,t,n,i){if(!i)if(3==(3&t[2])){const d=e.preOrderCheckHooks;null!==d&&ae(t,d,n)}else{const d=e.preOrderHooks;null!==d&&me(t,d,0,n)}q(n)}function Yh(e,t){return e<<17|t<<2}function os(e){return e>>17&32767}function $s(e){return 2|e}function Gs(e){return(131068&e)>>2}function Sf(e,t){return-131069&e|t<<2}function Qh(e){return 1|e}function em(e,t){const n=e.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const l=n[i],d=n[i+1];if(-1!==d){const y=e.data[d];o(l),y.contentQueries(2,t[d],d)}}}function ad(e,t,n,i,l,d,y,w,T,k){const L=t.blueprint.slice();return L[0]=l,L[2]=140|i,mh(L),L[3]=L[15]=e,L[8]=n,L[10]=y||e&&e[10],L[11]=w||e&&e[11],L[12]=T||e&&e[12]||null,L[9]=k||e&&e[9]||null,L[6]=d,L[16]=2==t.type?e[16]:L,L}function Lu(e,t,n,i,l){let d=e.data[t];if(null===d)d=function kf(e,t,n,i,l){const d=dc(),y=vh(),T=e.data[t]=function a_(e,t,n,i,l,d){return{type:n,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:l,attrs:d,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?d:d&&d.parent,n,t,i,l);return null===e.firstChild&&(e.firstChild=T),null!==d&&(y?null==d.child&&null!==T.parent&&(d.child=T):null===d.next&&(d.next=T)),T}(e,t,n,i,l),function fu(){return Nt.lFrame.inI18n}()&&(d.flags|=64);else if(64&d.type){d.type=n,d.value=i,d.attrs=l;const y=function Rs(){const e=Nt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();d.injectorIndex=null===y?-1:y.injectorIndex}return Ri(d,!0),d}function Oa(e,t,n,i){if(0===n)return-1;const l=t.length;for(let d=0;d<n;d++)t.push(i),e.blueprint.push(i),e.data.push(null);return l}function zu(e,t,n){x(t);try{const i=e.viewQuery;null!==i&&Al(1,i,n);const l=e.template;null!==l&&Dl(e,t,l,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&em(e,t),e.staticViewQueries&&Al(2,e.viewQuery,n);const d=e.components;null!==d&&function s_(e,t){for(let n=0;n<t.length;n++)Il(e,t[n])}(t,d)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{t[2]&=-5,R()}}function Er(e,t,n,i){const l=t[2];if(256!=(256&l)){x(t);try{mh(t),function hl(e){return Nt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Dl(e,t,n,2,i);const y=3==(3&l);if(y){const k=e.preOrderCheckHooks;null!==k&&ae(t,k,null)}else{const k=e.preOrderHooks;null!==k&&me(t,k,0,null),be(t,0)}if(function f_(e){for(let t=Tc(e);null!==t;t=vn(t)){if(!t[2])continue;const n=t[9];for(let i=0;i<n.length;i++){const l=n[i],d=l[3];0==(1024&l[2])&&uc(d,1),l[2]|=1024}}}(t),function um(e){for(let t=Tc(e);null!==t;t=vn(t))for(let n=10;n<t.length;n++){const i=t[n],l=i[1];cc(i)&&Er(l,i,l.template,i[8])}}(t),null!==e.contentQueries&&em(e,t),y){const k=e.contentCheckHooks;null!==k&&ae(t,k)}else{const k=e.contentHooks;null!==k&&me(t,k,1),be(t,1)}!function i_(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const l=n[i];if(l<0)q(~l);else{const d=l,y=n[++i],w=n[++i];Yi(y,d),w(2,t[d])}}}finally{q(-1)}}(e,t);const w=e.components;null!==w&&function o_(e,t){for(let n=0;n<t.length;n++)p_(e,t[n])}(t,w);const T=e.viewQuery;if(null!==T&&Al(2,T,i),y){const k=e.viewCheckHooks;null!==k&&ae(t,k)}else{const k=e.viewHooks;null!==k&&me(t,k,2),be(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[2]&=-73,1024&t[2]&&(t[2]&=-1025,uc(t[3],-1))}finally{R()}}}function ld(e,t,n,i){const l=t[10],y=ph(t);try{!y&&l.begin&&l.begin(),y&&zu(e,t,i),Er(e,t,n,i)}finally{!y&&l.end&&l.end()}}function Dl(e,t,n,i,l){const d=j(),y=2&i;try{q(-1),y&&t.length>20&&Tf(e,t,20,!1),n(i,l)}finally{q(d)}}function nm(e,t,n){!wa()||(function Bu(e,t,n,i){const l=n.directiveStart,d=n.directiveEnd;e.firstCreatePass||Wn(n,t),si(i,t);const y=n.initialInputs;for(let w=l;w<d;w++){const T=e.data[w],k=Wi(T);k&&u_(t,n,T);const L=fl(t,e,w,n);si(L,t),null!==y&&h_(0,w-l,L,T,0,y),k&&(vi(n.index,t)[8]=L)}}(e,t,n,ni(n,t)),128==(128&n.flags)&&function am(e,t,n){const i=n.directiveStart,l=n.directiveEnd,y=n.index,w=function kn(){return Nt.lFrame.currentDirectiveIndex}();try{q(y);for(let T=i;T<l;T++){const k=e.data[T],L=t[T];Ea(T),(null!==k.hostBindings||0!==k.hostVars||null!==k.hostAttrs)&&Ff(k,L)}}finally{q(-1),Ea(w)}}(e,t,n))}function Rf(e,t,n=ni){const i=t.localNames;if(null!==i){let l=t.index+1;for(let d=0;d<i.length;d+=2){const y=i[d+1],w=-1===y?n(t,e):e[y];e[l++]=w}}}function vo(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=xo(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function xo(e,t,n,i,l,d,y,w,T,k){const L=20+i,U=L+l,Y=function Tl(e,t){const n=[];for(let i=0;i<t;i++)n.push(i<e?null:Gt);return n}(L,U),ie="function"==typeof k?k():k;return Y[1]={type:e,blueprint:Y,template:n,queries:null,viewQuery:w,declTNode:t,data:Y.slice().fill(null,L),bindingStartIndex:L,expandoStartIndex:U,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof d?d():d,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:T,consts:ie,incompleteFirstPass:!1}}function rm(e,t,n,i){const l=fm(t);null===n?l.push(i):(l.push(n),e.firstCreatePass&&m_(e).push(i,l.length-1))}function im(e,t,n){for(let i in e)if(e.hasOwnProperty(i)){const l=e[i];(n=null===n?{}:n).hasOwnProperty(i)?n[i].push(t,l):n[i]=[t,l]}return n}function Of(e,t,n,i){let l=!1;if(wa()){const d=function qs(e,t,n){const i=e.directiveRegistry;let l=null;if(i)for(let d=0;d<i.length;d++){const y=i[d];Xp(n,y.selectors,!1)&&(l||(l=[]),Fs(Wn(n,t),e,y.type),Wi(y)?(Lf(e,n),l.unshift(y)):l.push(y))}return l}(e,t,n),y=null===i?null:{"":-1};if(null!==d){l=!0,Sl(n,e.data.length,d.length);for(let L=0;L<d.length;L++){const U=d[L];U.providersResolver&&U.providersResolver(U)}let w=!1,T=!1,k=Oa(e,t,d.length,null);for(let L=0;L<d.length;L++){const U=d[L];n.mergedAttrs=vt(n.mergedAttrs,U.hostAttrs),cm(e,n,t,k,U),as(k,U,y),null!==U.contentQueries&&(n.flags|=8),(null!==U.hostBindings||null!==U.hostAttrs||0!==U.hostVars)&&(n.flags|=128);const Y=U.type.prototype;!w&&(Y.ngOnChanges||Y.ngOnInit||Y.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),w=!0),!T&&(Y.ngOnChanges||Y.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),T=!0),k++}!function om(e,t){const i=t.directiveEnd,l=e.data,d=t.attrs,y=[];let w=null,T=null;for(let k=t.directiveStart;k<i;k++){const L=l[k],U=L.inputs,Y=null===d||ku(t)?null:Bv(U,d);y.push(Y),w=im(U,k,w),T=im(L.outputs,k,T)}null!==w&&(w.hasOwnProperty("class")&&(t.flags|=16),w.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=y,t.inputs=w,t.outputs=T}(e,n)}y&&function lm(e,t,n){if(t){const i=e.localNames=[];for(let l=0;l<t.length;l+=2){const d=n[t[l+1]];if(null==d)throw new Tt(-301,!1);i.push(t[l],d)}}}(n,i,y)}return n.mergedAttrs=vt(n.mergedAttrs,n.attrs),l}function ud(e,t,n,i,l,d){const y=d.hostBindings;if(y){let w=e.hostBindingOpCodes;null===w&&(w=e.hostBindingOpCodes=[]);const T=~t.index;(function zv(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(w)!=T&&w.push(T),w.push(i,l,y)}}function Ff(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Lf(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function as(e,t,n){if(n){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)n[t.exportAs[i]]=e;Wi(t)&&(n[""]=e)}}function Sl(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function cm(e,t,n,i,l){e.data[i]=l;const d=l.factory||(l.factory=Ps(l.type)),y=new pe(d,Wi(l),null);e.blueprint[i]=y,n[i]=y,ud(e,t,0,i,Oa(e,n,l.hostVars,Gt),l)}function u_(e,t,n){const i=ni(t,e),l=vo(n),d=e[10],y=Bf(e,ad(e,l,null,n.onPush?64:16,i,t,d,d.createRenderer(i,n),null,null));e[t.index]=y}function bo(e,t,n,i,l,d){const y=ni(e,t);!function zf(e,t,n,i,l,d,y){if(null==d)Yn(e)?e.removeAttribute(t,l,n):t.removeAttribute(l);else{const w=null==y?Dt(d):y(d,i||"",l);Yn(e)?e.setAttribute(t,l,w,n):n?t.setAttributeNS(n,l,w):t.setAttribute(l,w)}}(t[11],y,d,e.value,n,i,l)}function h_(e,t,n,i,l,d){const y=d[t];if(null!==y){const w=i.setInput;for(let T=0;T<y.length;){const k=y[T++],L=y[T++],U=y[T++];null!==w?i.setInput(n,U,k,L):n[L]=U}}}function Bv(e,t){let n=null,i=0;for(;i<t.length;){const l=t[i];if(0!==l)if(5!==l){if("number"==typeof l)break;e.hasOwnProperty(l)&&(null===n&&(n=[]),n.push(l,e[l],t[i+1])),i+=2}else i+=2;else i+=4}return n}function d_(e,t,n,i){return new Array(e,!0,!1,t,null,0,i,n,null,null)}function p_(e,t){const n=vi(t,e);if(cc(n)){const i=n[1];80&n[2]?Er(i,n,i.template,n[8]):n[5]>0&&hm(n)}}function hm(e){for(let i=Tc(e);null!==i;i=vn(i))for(let l=10;l<i.length;l++){const d=i[l];if(1024&d[2]){const y=d[1];Er(y,d,y.template,d[8])}else d[5]>0&&hm(d)}const n=e[1].components;if(null!==n)for(let i=0;i<n.length;i++){const l=vi(n[i],e);cc(l)&&l[5]>0&&hm(l)}}function Il(e,t){const n=vi(t,e),i=n[1];(function Vv(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(i,n),zu(i,n,n[8])}function Bf(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function kc(e){for(;e;){e[2]|=64;const t=Hh(e);if(ol(e)&&!t)return e;e=t}return null}function dd(e){!function Rc(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],i=Fp(n),l=i[1];ld(l,i,l.template,n)}}(e[8])}function Al(e,t,n){o(0),t(e,n)}const Uv=(()=>Promise.resolve(null))();function fm(e){return e[7]||(e[7]=[])}function m_(e){return e.cleanup||(e.cleanup=[])}function g_(e,t){const n=e[9],i=n?n.get(jh,null):null;i&&i.handleError(t)}function mm(e,t,n,i,l){for(let d=0;d<n.length;){const y=n[d++],w=n[d++],T=t[y],k=e.data[y];null!==k.setInput?k.setInput(T,l,i,w):T[w]=l}}function r(e,t,n){let i=n?e.styles:null,l=n?e.classes:null,d=0;if(null!==t)for(let y=0;y<t.length;y++){const w=t[y];"number"==typeof w?d=w:1==d?l=vs(l,w):2==d&&(i=vs(i,w+": "+t[++y]+";"))}n?e.styles=i:e.stylesWithoutHost=i,n?e.classes=l:e.classesWithoutHost=l}const m=new Ft("INJECTOR",-1);class _{get(t,n=Eh){if(n===Eh){const i=new Error(`NullInjectorError: No provider for ${_n(t)}!`);throw i.name="NullInjectorError",i}return n}}const v=new Ft("Set Injector scope."),C={},D={};let S;function I(){return void 0===S&&(S=new _),S}function P(e,t=null,n=null,i){const l=F(e,t,n,i);return l._resolveInjectorDefTypes(),l}function F(e,t=null,n=null,i){return new N(e,n,t||I(),i)}class N{constructor(t,n,i,l=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const d=[];n&&Jt(n,w=>this.processProvider(w,t,n)),Jt([t],w=>this.processInjectorType(w,[],d)),this.records.set(m,le(void 0,this));const y=this.records.get(v);this.scope=null!=y?y.value:null,this.source=l||("object"==typeof t?null:_n(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,n=Eh,i=St.Default){this.assertNotDestroyed();const l=yc(this),d=Gi(void 0);try{if(!(i&St.SkipSelf)){let w=this.records.get(t);if(void 0===w){const T=function Ce(e){return"function"==typeof e||"object"==typeof e&&e instanceof Ft}(t)&&Qa(t);w=T&&this.injectableDefInScope(T)?le(G(t),C):null,this.records.set(t,w)}if(null!=w)return this.hydrate(t,w)}return(i&St.Self?I():this.parent).get(t,n=i&St.Optional&&n===Eh?null:n)}catch(y){if("NullInjectorError"===y.name){if((y[nf]=y[nf]||[]).unshift(_n(t)),l)throw y;return function ug(e,t,n,i){const l=e[nf];throw t[_c]&&l.unshift(t[_c]),e.message=function Ns(e,t,n,i=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let l=_n(t);if(Array.isArray(t))l=t.map(_n).join(" -> ");else if("object"==typeof t){let d=[];for(let y in t)if(t.hasOwnProperty(y)){let w=t[y];d.push(y+":"+("string"==typeof w?JSON.stringify(w):_n(w)))}l=`{${d.join(", ")}}`}return`${n}${i?"("+i+")":""}[${l}]: ${e.replace(ag,"\n  ")}`}("\n"+e.message,l,n,i),e.ngTokenPath=l,e[nf]=null,e}(y,t,"R3InjectorError",this.source)}throw y}finally{Gi(d),yc(l)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((i,l)=>t.push(_n(l))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Tt(205,!1)}processInjectorType(t,n,i){if(!(t=lt(t)))return!1;let l=rh(t);const d=null==l&&t.ngModule||void 0,y=void 0===d?t:d,w=-1!==i.indexOf(y);if(void 0!==d&&(l=rh(d)),null==l)return!1;if(null!=l.imports&&!w){let L;i.push(y);try{Jt(l.imports,U=>{this.processInjectorType(U,n,i)&&(void 0===L&&(L=[]),L.push(U))})}finally{}if(void 0!==L)for(let U=0;U<L.length;U++){const{ngModule:Y,providers:ie}=L[U];Jt(ie,ve=>this.processProvider(ve,Y,ie||Mn))}}this.injectorDefTypes.add(y);const T=Ps(y)||(()=>new y);this.records.set(y,le(T,C));const k=l.providers;if(null!=k&&!w){const L=t;Jt(k,U=>this.processProvider(U,L,k))}return void 0!==d&&void 0!==t.providers}processProvider(t,n,i){let l=we(t=lt(t))?t:lt(t&&t.provide);const d=function K(e,t,n){return he(e)?le(void 0,e.useValue):le(se(e),C)}(t);if(we(t)||!0!==t.multi)this.records.get(l);else{let y=this.records.get(l);y||(y=le(void 0,C,!0),y.factory=()=>xp(y.multi),this.records.set(l,y)),l=t,y.multi.push(t)}this.records.set(l,d)}hydrate(t,n){return n.value===C&&(n.value=D,n.value=n.factory()),"object"==typeof n.value&&n.value&&function ze(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=lt(t.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function G(e){const t=Qa(e),n=null!==t?t.factory:Ps(e);if(null!==n)return n;if(e instanceof Ft)throw new Tt(204,!1);if(e instanceof Function)return function Z(e){const t=e.length;if(t>0)throw function Ma(e,t){const n=[];for(let i=0;i<e;i++)n.push(t);return n}(t,"?"),new Tt(204,!1);const n=function Md(e){const t=e&&(e[ko]||e[tl]);if(t){const n=function Sd(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Tt(204,!1)}function se(e,t,n){let i;if(we(e)){const l=lt(e);return Ps(l)||G(l)}if(he(e))i=()=>lt(e.useValue);else if(function fe(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...xp(e.deps||[]));else if(function de(e){return!(!e||!e.useExisting)}(e))i=()=>bt(lt(e.useExisting));else{const l=lt(e&&(e.useClass||e.provide));if(!function ke(e){return!!e.deps}(e))return Ps(l)||G(l);i=()=>new l(...xp(e.deps))}return i}function le(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function he(e){return null!==e&&"object"==typeof e&&cg in e}function we(e){return"function"==typeof e}let Ee=(()=>{class e{static create(n,i){var l;if(Array.isArray(n))return P({name:""},i,n,"");{const d=null!==(l=n.name)&&void 0!==l?l:"";return P({name:d},n.parent,n.providers,d)}}}return e.THROW_IF_NOT_FOUND=Eh,e.NULL=new _,e.\u0275prov=zt({token:e,providedIn:"any",factory:()=>bt(m)}),e.__NG_ELEMENT_ID__=-1,e})();function Nr(e,t){Q(Fp(e)[1],yr())}function Ct(e){let t=function Un(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const i=[e];for(;t;){let l;if(Wi(e))l=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Tt(903,"");l=t.\u0275dir}if(l){if(n){i.push(l);const y=e;y.inputs=Xr(e.inputs),y.declaredInputs=Xr(e.declaredInputs),y.outputs=Xr(e.outputs);const w=l.hostBindings;w&&ci(e,w);const T=l.viewQuery,k=l.contentQueries;if(T&&dr(e,T),k&&Ci(e,k),ca(e.inputs,l.inputs),ca(e.declaredInputs,l.declaredInputs),ca(e.outputs,l.outputs),Wi(l)&&l.data.animation){const L=e.data;L.animation=(L.animation||[]).concat(l.data.animation)}}const d=l.features;if(d)for(let y=0;y<d.length;y++){const w=d[y];w&&w.ngInherit&&w(e),w===Ct&&(n=!1)}}t=Object.getPrototypeOf(t)}!function zi(e){let t=0,n=null;for(let i=e.length-1;i>=0;i--){const l=e[i];l.hostVars=t+=l.hostVars,l.hostAttrs=vt(l.hostAttrs,n=vt(n,l.hostAttrs))}}(i)}function Xr(e){return e===Jo?{}:e===Mn?[]:e}function dr(e,t){const n=e.viewQuery;e.viewQuery=n?(i,l)=>{t(i,l),n(i,l)}:t}function Ci(e,t){const n=e.contentQueries;e.contentQueries=n?(i,l,d)=>{t(i,l,d),n(i,l,d)}:t}function ci(e,t){const n=e.hostBindings;e.hostBindings=n?(i,l)=>{t(i,l),n(i,l)}:t}let kl=null;function Zs(){if(!kl){const e=un.Symbol;if(e&&e.iterator)kl=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const i=t[n];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(kl=i)}}}return kl}function ir(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function ui(e,t,n,i){const l=je();return ir(l,Ki(),t)&&(rn(),bo(H(),l,e,t,n,i)),ui}function jv(e,t,n,i,l,d,y,w){const T=je(),k=rn(),L=e+20,U=k.firstCreatePass?function sM(e,t,n,i,l,d,y,w,T){const k=t.consts,L=Lu(t,e,4,y||null,Qo(k,w));Of(t,n,L,Qo(k,T)),Q(t,L);const U=L.tViews=xo(2,L,i,l,d,t.directiveRegistry,t.pipeRegistry,null,t.schemas,k);return null!==t.queries&&(t.queries.template(t,L),U.queries=t.queries.embeddedTView(L)),L}(L,k,T,t,n,i,l,d,y):k.data[L];Ri(U,!1);const Y=T[11].createComment("");vf(k,T,Y,U),si(Y,T),Bf(T,T[L]=d_(Y,T,Y,U)),rc(U)&&nm(k,T,U),null!=y&&Rf(T,U,w)}function $v(e){return function ba(e,t){return e[t]}(function fc(){return Nt.lFrame.contextLView}(),20+e)}function Ze(e,t=St.Default){const n=je();return null===n?bt(e,t):pu(yr(),n,lt(e),t)}function Wv(){throw new Error("invalid")}function jn(e,t,n){const i=je();return ir(i,Ki(),t)&&function io(e,t,n,i,l,d,y,w){const T=ni(t,n);let L,k=t.inputs;!w&&null!=k&&(L=k[i])?(mm(e,n,L,i,l),Ms(t)&&function l_(e,t){const n=vi(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(i=function Rv(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(i),l=null!=y?y(l,t.value||"",i):l,Yn(d)?d.setProperty(T,i,l):ht(i)||(T.setProperty?T.setProperty(i,l):T[i]=l))}(rn(),H(),i,e,t,i[11],n,!1),jn}function Xv(e,t,n,i,l){const y=l?"class":"style";mm(e,n,t.inputs[y],y,i)}function De(e,t,n,i){const l=je(),d=rn(),y=20+e,w=l[11],T=l[y]=jp(w,t,function te(){return Nt.lFrame.currentNamespace}()),k=d.firstCreatePass?function MM(e,t,n,i,l,d,y){const w=t.consts,k=Lu(t,e,2,l,Qo(w,d));return Of(t,n,k,Qo(w,y)),null!==k.attrs&&r(k,k.attrs,!1),null!==k.mergedAttrs&&r(k,k.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,k),k}(y,d,l,0,t,n,i):d.data[y];Ri(k,!0);const L=k.mergedAttrs;null!==L&&_t(w,T,L);const U=k.classes;null!==U&&wf(w,T,U);const Y=k.styles;return null!==Y&&Zp(w,T,Y),64!=(64&k.flags)&&vf(d,l,T,k),0===function hc(){return Nt.lFrame.elementDepthCount}()&&si(T,l),function _h(){Nt.lFrame.elementDepthCount++}(),rc(k)&&(nm(d,l,k),function tm(e,t,n){if(_i(t)){const l=t.directiveEnd;for(let d=t.directiveStart;d<l;d++){const y=e.data[d];y.contentQueries&&y.contentQueries(1,n[d],d)}}}(d,k,l)),null!==i&&Rf(l,k),De}function Ae(){let e=yr();vh()?function xh(){Nt.lFrame.isParent=!1}():(e=e.parent,Ri(e,!1));const t=e;!function Gd(){Nt.lFrame.elementDepthCount--}();const n=rn();return n.firstCreatePass&&(Q(n,e),_i(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function it(e){return 0!=(16&e.flags)}(t)&&Xv(n,t,je(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function mt(e){return 0!=(32&e.flags)}(t)&&Xv(n,t,je(),t.stylesWithoutHost,!1),Ae}function Je(e,t,n,i){return De(e,t,n,i),Ae(),Je}function gm(e){return!!e&&"function"==typeof e.then}const Jv=function sb(e){return!!e&&"function"==typeof e.subscribe};function Co(e,t,n,i){const l=je(),d=rn(),y=yr();return function lb(e,t,n,i,l,d,y,w){const T=rc(i),L=e.firstCreatePass&&m_(e),U=t[8],Y=fm(t);let ie=!0;if(3&i.type||w){const Ke=ni(i,t),Xe=w?w(Ke):Ke,Pe=Y.length,wt=w?en=>w(Jn(en[i.index])):i.index;if(Yn(n)){let en=null;if(!w&&T&&(en=function IM(e,t,n,i){const l=e.cleanup;if(null!=l)for(let d=0;d<l.length-1;d+=2){const y=l[d];if(y===n&&l[d+1]===i){const w=t[7],T=l[d+2];return w.length>T?w[T]:null}"string"==typeof y&&(d+=2)}return null}(e,t,l,i.index)),null!==en)(en.__ngLastListenerFn__||en).__ngNextListenerFn__=d,en.__ngLastListenerFn__=d,ie=!1;else{d=Qv(i,t,U,d,!1);const Sn=n.listen(Xe,l,d);Y.push(d,Sn),L&&L.push(l,wt,Pe,Pe+1)}}else d=Qv(i,t,U,d,!0),Xe.addEventListener(l,d,y),Y.push(d),L&&L.push(l,wt,Pe,y)}else d=Qv(i,t,U,d,!1);const ve=i.outputs;let Fe;if(ie&&null!==ve&&(Fe=ve[l])){const Ke=Fe.length;if(Ke)for(let Xe=0;Xe<Ke;Xe+=2){const ds=t[Fe[Xe]][Fe[Xe+1]].subscribe(d),Cd=Y.length;Y.push(d,ds),L&&L.push(l,i.index,Cd,-(Cd+1))}}}(d,l,l[11],y,e,t,!!n,i),Co}function cb(e,t,n,i){try{return!1!==n(i)}catch(l){return g_(e,l),!1}}function Qv(e,t,n,i,l){return function d(y){if(y===Function)return i;const w=2&e.flags?vi(e.index,t):t;0==(32&t[2])&&kc(w);let T=cb(t,0,i,y),k=d.__ngNextListenerFn__;for(;k;)T=cb(t,0,k,y)&&T,k=k.__ngNextListenerFn__;return l&&!1===T&&(y.preventDefault(),y.returnValue=!1),T}}function vb(e,t,n,i,l){const d=e[n+1],y=null===t;let w=i?os(d):Gs(d),T=!1;for(;0!==w&&(!1===T||y);){const L=e[w+1];LM(e[w],t)&&(T=!0,e[w+1]=i?Qh(L):$s(L)),w=i?os(L):Gs(L)}T&&(e[n+1]=i?$s(d):Qh(d))}function LM(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&wu(e,t)>=0}function b_(e,t){return function Fa(e,t,n,i){const l=je(),d=rn(),y=function mo(e){const t=Nt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}(2);d.firstUpdatePass&&function Sb(e,t,n,i){const l=e.data;if(null===l[n+1]){const d=l[j()],y=function Mb(e,t){return t>=e.expandoStartIndex}(e,n);(function kb(e,t){return 0!=(e.flags&(t?16:32))})(d,i)&&null===t&&!y&&(t=!1),t=function HM(e,t,n,i){const l=function Os(e){const t=Nt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let d=i?t.residualClasses:t.residualStyles;if(null===l)0===(i?t.classBindings:t.styleBindings)&&(n=_m(n=tx(null,e,t,n,i),t.attrs,i),d=null);else{const y=t.directiveStylingLast;if(-1===y||e[y]!==l)if(n=tx(l,e,t,n,i),null===d){let T=function qM(e,t,n){const i=n?t.classBindings:t.styleBindings;if(0!==Gs(i))return e[os(i)]}(e,t,i);void 0!==T&&Array.isArray(T)&&(T=tx(null,e,t,T[1],i),T=_m(T,t.attrs,i),function ZM(e,t,n,i){e[os(n?t.classBindings:t.styleBindings)]=i}(e,t,i,T))}else d=function WM(e,t,n){let i;const l=t.directiveEnd;for(let d=1+t.directiveStylingLast;d<l;d++)i=_m(i,e[d].hostAttrs,n);return _m(i,t.attrs,n)}(e,t,i)}return void 0!==d&&(i?t.residualClasses=d:t.residualStyles=d),n}(l,d,t,i),function OM(e,t,n,i,l,d){let y=d?t.classBindings:t.styleBindings,w=os(y),T=Gs(y);e[i]=n;let L,k=!1;if(Array.isArray(n)){const U=n;L=U[1],(null===L||wu(U,L)>0)&&(k=!0)}else L=n;if(l)if(0!==T){const Y=os(e[w+1]);e[i+1]=Yh(Y,w),0!==Y&&(e[Y+1]=Sf(e[Y+1],i)),e[w+1]=function Tv(e,t){return 131071&e|t<<17}(e[w+1],i)}else e[i+1]=Yh(w,0),0!==w&&(e[w+1]=Sf(e[w+1],i)),w=i;else e[i+1]=Yh(T,0),0===w?w=i:e[T+1]=Sf(e[T+1],i),T=i;k&&(e[i+1]=$s(e[i+1])),vb(e,L,i,!0),vb(e,L,i,!1),function FM(e,t,n,i,l){const d=l?e.residualClasses:e.residualStyles;null!=d&&"string"==typeof t&&wu(d,t)>=0&&(n[i+1]=Qh(n[i+1]))}(t,L,e,i,d),y=Yh(w,T),d?t.classBindings=y:t.styleBindings=y}(l,d,t,n,y,i)}}(d,e,y,i),t!==Gt&&ir(l,y,t)&&function Ab(e,t,n,i,l,d,y,w){if(!(3&t.type))return;const T=e.data,k=T[w+1];w_(function Jh(e){return 1==(1&e)}(k)?Pb(T,t,n,l,Gs(k),y):void 0)||(w_(d)||function Mf(e){return 2==(2&e)}(k)&&(d=Pb(T,null,n,l,w,y)),function Gg(e,t,n,i,l){const d=Yn(e);if(t)l?d?e.addClass(n,i):n.classList.add(i):d?e.removeClass(n,i):n.classList.remove(i);else{let y=-1===i.indexOf("-")?void 0:Wr.DashCase;if(null==l)d?e.removeStyle(n,i,y):n.style.removeProperty(i);else{const w="string"==typeof l&&l.endsWith("!important");w&&(l=l.slice(0,-10),y|=Wr.Important),d?e.setStyle(n,i,l,y):n.style.setProperty(i,l,w?"important":"")}}}(i,y,function ll(e,t){return Jn(t[e])}(j(),n),l,d))}(d,d.data[j()],l,l[11],e,l[y+1]=function YM(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=_n(Aa(e)))),e}(t,n),i,y)}(e,t,null,!0),b_}function tx(e,t,n,i,l){let d=null;const y=n.directiveEnd;let w=n.directiveStylingLast;for(-1===w?w=n.directiveStart:w++;w<y&&(d=t[w],i=_m(i,d.hostAttrs,l),d!==e);)w++;return null!==e&&(n.directiveStylingLast=w),i}function _m(e,t,n){const i=n?1:2;let l=-1;if(null!==t)for(let d=0;d<t.length;d++){const y=t[d];"number"==typeof y?l=y:l===i&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),xi(e,y,!!n||t[++d]))}return void 0===e?null:e}function Pb(e,t,n,i,l,d){const y=null===t;let w;for(;l>0;){const T=e[l],k=Array.isArray(T),L=k?T[1]:T,U=null===L;let Y=n[l+1];Y===Gt&&(Y=U?Mn:void 0);let ie=U?Ch(Y,i):L===i?Y:void 0;if(k&&!w_(ie)&&(ie=Ch(T,i)),w_(ie)&&(w=ie,y))return w;const ve=e[l+1];l=y?os(ve):Gs(ve)}if(null!==t){let T=d?t.residualClasses:t.residualStyles;null!=T&&(w=Ch(T,i))}return w}function w_(e){return void 0!==e}function Ge(e,t=""){const n=je(),i=rn(),l=e+20,d=i.firstCreatePass?Lu(i,l,1,t,null):i.data[l],y=n[l]=function is(e,t){return Yn(e)?e.createText(t):e.createTextNode(t)}(n[11],t);vf(i,n,y,d),Ri(d,!1)}const C_="en-US";let tw=C_;function ox(e,t,n,i,l){if(e=lt(e),Array.isArray(e))for(let d=0;d<e.length;d++)ox(e[d],t,n,i,l);else{const d=rn(),y=je();let w=we(e)?e:lt(e.provide),T=se(e);const k=yr(),L=1048575&k.providerIndexes,U=k.directiveStart,Y=k.providerIndexes>>20;if(we(e)||!e.multi){const ie=new pe(T,l,Ze),ve=ax(w,t,l?L:L+Y,U);-1===ve?(Fs(Wn(k,y),d,w),sx(d,e,t.length),t.push(w),k.directiveStart++,k.directiveEnd++,l&&(k.providerIndexes+=1048576),n.push(ie),y.push(ie)):(n[ve]=ie,y[ve]=ie)}else{const ie=ax(w,t,L+Y,U),ve=ax(w,t,L,L+Y),Fe=ie>=0&&n[ie],Ke=ve>=0&&n[ve];if(l&&!Ke||!l&&!Fe){Fs(Wn(k,y),d,w);const Xe=function gI(e,t,n,i,l){const d=new pe(e,n,Ze);return d.multi=[],d.index=t,d.componentProviders=0,Dw(d,l,i&&!n),d}(l?mI:pI,n.length,l,i,T);!l&&Ke&&(n[ve].providerFactory=Xe),sx(d,e,t.length,0),t.push(w),k.directiveStart++,k.directiveEnd++,l&&(k.providerIndexes+=1048576),n.push(Xe),y.push(Xe)}else sx(d,e,ie>-1?ie:ve,Dw(n[l?ve:ie],T,!l&&i));!l&&i&&Ke&&n[ve].componentProviders++}}}function sx(e,t,n,i){const l=we(t),d=function Me(e){return!!e.useClass}(t);if(l||d){const T=(d?lt(t.useClass):t).prototype.ngOnDestroy;if(T){const k=e.destroyHooks||(e.destroyHooks=[]);if(!l&&t.multi){const L=k.indexOf(n);-1===L?k.push(n,[i,T]):k[L+1].push(i,T)}else k.push(n,T)}}}function Dw(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function ax(e,t,n,i){for(let l=n;l<i;l++)if(t[l]===e)return l;return-1}function pI(e,t,n,i){return lx(this.multi,[])}function mI(e,t,n,i){const l=this.multi;let d;if(this.providerFactory){const y=this.providerFactory.componentProviders,w=fl(n,n[1],this.providerFactory.index,i);d=w.slice(0,y),lx(l,d);for(let T=y;T<w.length;T++)d.push(w[T])}else d=[],lx(l,d);return d}function lx(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function xr(e,t=[]){return n=>{n.providersResolver=(i,l)=>function fI(e,t,n){const i=rn();if(i.firstCreatePass){const l=Wi(e);ox(n,i.data,i.blueprint,l,!0),ox(t,i.data,i.blueprint,l,!1)}}(i,l?l(e):e,t)}}class Tw{}class vI{resolveComponentFactory(t){throw function yI(e){const t=Error(`No component factory found for ${_n(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let wm=(()=>{class e{}return e.NULL=new vI,e})();function xI(){return Hf(yr(),je())}function Hf(e,t){return new ls(ni(e,t))}let ls=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=xI,e})();function bI(e){return e instanceof ls?e.nativeElement:e}class Sw{}let zc=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function CI(){const e=je(),n=vi(yr().index,e);return function wI(e){return e[11]}(Pi(n)?n:e)}(),e})(),EI=(()=>{class e{}return e.\u0275prov=zt({token:e,providedIn:"root",factory:()=>null}),e})();class Cm{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const DI=new Cm("13.3.11"),cx={};function S_(e,t,n,i,l=!1){for(;null!==n;){const d=t[n.index];if(null!==d&&i.push(Jn(d)),Ye(d))for(let w=10;w<d.length;w++){const T=d[w],k=T[1].firstChild;null!==k&&S_(T[1],T,k,i)}const y=n.type;if(8&y)S_(e,t,n.child,i);else if(32&y){const w=Np(n,t);let T;for(;T=w();)i.push(T)}else if(16&y){const w=qp(t,n);if(Array.isArray(w))i.push(...w);else{const T=Hh(t[16]);S_(T[1],T,w,i,!0)}}n=l?n.projectionNext:n.next}return i}class Em{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return S_(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Ye(t)){const n=t[8],i=n?n.indexOf(this):-1;i>-1&&($p(t,i),xu(n,i))}this._attachedToViewContainer=!1}qh(this._lView[1],this._lView)}onDestroy(t){rm(this._lView[1],this._lView,null,t)}markForCheck(){kc(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function Oc(e,t,n){const i=t[10];i.begin&&i.begin();try{Er(e,t,e.template,n)}catch(l){throw g_(t,l),l}finally{i.end&&i.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Tt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function yv(e,t){Kh(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Tt(902,"");this._appRef=t}}class TI extends Em{constructor(t){super(t),this._view=t}detectChanges(){dd(this._view)}checkNoChanges(){}get context(){return null}}class Iw extends wm{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=qr(t);return new ux(n,this.ngModule)}}function Aw(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class ux extends Tw{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Ev(e){return e.map(Cv).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return Aw(this.componentDef.inputs)}get outputs(){return Aw(this.componentDef.outputs)}create(t,n,i,l){const d=(l=l||this.ngModule)?function SI(e,t){return{get:(n,i,l)=>{const d=e.get(n,cx,l);return d!==cx||i===cx?d:t.get(n,i,l)}}}(t,l.injector):t,y=d.get(Sw,dh),w=d.get(EI,null),T=y.createRenderer(null,this.componentDef),k=this.componentDef.selectors[0][0]||"div",L=i?function cd(e,t,n){if(Yn(e))return e.selectRootElement(t,n===qi.ShadowDom);let i="string"==typeof t?e.querySelector(t):t;return i.textContent="",i}(T,i,this.componentDef.encapsulation):jp(y.createRenderer(null,this.componentDef),k,function MI(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(k)),U=this.componentDef.onPush?576:528,Y=function Li(e,t){return{components:[],scheduler:e||hv,clean:Uv,playerHandler:t||null,flags:0}}(),ie=xo(0,null,null,1,0,null,null,null,null,null),ve=ad(null,ie,Y,U,null,null,y,T,w,d);let Fe,Ke;x(ve);try{const Xe=function wn(e,t,n,i,l,d){const y=n[1];n[20]=e;const T=Lu(y,20,2,"#host",null),k=T.mergedAttrs=t.hostAttrs;null!==k&&(r(T,k,!0),null!==e&&(_t(l,e,k),null!==T.classes&&wf(l,e,T.classes),null!==T.styles&&Zp(l,e,T.styles)));const L=i.createRenderer(e,t),U=ad(n,vo(t),null,t.onPush?64:16,n[20],T,i,L,d||null,null);return y.firstCreatePass&&(Fs(Wn(T,n),y,t.type),Lf(y,T),Sl(T,n.length,1)),Bf(n,U),n[20]=U}(L,this.componentDef,ve,y,T);if(L)if(i)_t(T,L,["ng-version",DI.full]);else{const{attrs:Pe,classes:wt}=function Dv(e){const t=[],n=[];let i=1,l=2;for(;i<e.length;){let d=e[i];if("string"==typeof d)2===l?""!==d&&t.push(d,e[++i]):8===l&&n.push(d);else{if(!yo(l))break;l=d}i++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);Pe&&_t(T,L,Pe),wt&&wt.length>0&&wf(T,L,wt.join(" "))}if(Ke=cl(ie,20),void 0!==n){const Pe=Ke.projection=[];for(let wt=0;wt<this.ngContentSelectors.length;wt++){const en=n[wt];Pe.push(null!=en?Array.from(en):null)}}Fe=function li(e,t,n,i,l){const d=n[1],y=function Ml(e,t,n){const i=yr();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),cm(e,i,t,Oa(e,t,1,null),n));const l=fl(t,e,i.directiveStart,i);si(l,t);const d=ni(i,t);return d&&si(d,t),l}(d,n,t);if(i.components.push(y),e[8]=y,l&&l.forEach(T=>T(y,t)),t.contentQueries){const T=yr();t.contentQueries(1,y,T.directiveStart)}const w=yr();return!d.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(q(w.index),ud(n[1],w,0,w.directiveStart,w.directiveEnd,t),Ff(t,y)),y}(Xe,this.componentDef,ve,Y,[Nr]),zu(ie,ve,null)}finally{R()}return new AI(this.componentType,Fe,Hf(Ke,ve),ve,Ke)}}class AI extends class _I{}{constructor(t,n,i,l,d){super(),this.location=i,this._rootLView=l,this._tNode=d,this.instance=n,this.hostView=this.changeDetectorRef=new TI(l),this.componentType=t}get injector(){return new Qi(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class Bc{}class Pw{}const qf=new Map;class Ow extends Bc{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Iw(this);const i=Zi(t);this._bootstrapComponents=Us(i.bootstrap),this._r3Injector=F(t,n,[{provide:Bc,useValue:this},{provide:wm,useValue:this.componentFactoryResolver}],_n(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,n=Ee.THROW_IF_NOT_FOUND,i=St.Default){return t===Ee||t===Bc||t===m?this:this._r3Injector.get(t,n,i)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class hx extends Pw{constructor(t){super(),this.moduleType=t,null!==Zi(t)&&function kI(e){const t=new Set;!function n(i){const l=Zi(i,!0),d=l.id;null!==d&&(function kw(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${_n(t)} vs ${_n(t.name)}`)}(d,qf.get(d),i),qf.set(d,i));const y=Us(l.imports);for(const w of y)t.has(w)||(t.add(w),n(w))}(e)}(t)}create(t){return new Ow(this.moduleType,t)}}function Kn(e,t,n){const i=function Pn(){const e=Nt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}()+e,l=je();return l[i]===Gt?function No(e,t,n){return e[t]=n}(l,i,n?t.call(n):t()):function Fc(e,t){return e[t]}(l,i)}function dx(e){return t=>{setTimeout(e,void 0,t)}}const Rr=class XI extends br{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,i){var l,d,y;let w=t,T=n||(()=>null),k=i;if(t&&"object"==typeof t){const U=t;w=null===(l=U.next)||void 0===l?void 0:l.bind(U),T=null===(d=U.error)||void 0===d?void 0:d.bind(U),k=null===(y=U.complete)||void 0===y?void 0:y.bind(U)}this.__isAsync&&(T=dx(T),w&&(w=dx(w)),k&&(k=dx(k)));const L=super.subscribe({next:w,error:T,complete:k});return t instanceof er&&t.add(L),L}};function KI(){return this._results[Zs()]()}class fx{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=Zs(),i=fx.prototype;i[n]||(i[n]=KI)}get changes(){return this._changes||(this._changes=new Rr)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const i=this;i.dirty=!1;const l=eo(t);(this._changesDetected=!function _l(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){let l=e[i],d=t[i];if(n&&(l=n(l),d=n(d)),d!==l)return!1}return!0}(i._results,l,n))&&(i._results=l,i.length=l.length,i.last=l[this.length-1],i.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Nc=(()=>{class e{}return e.__NG_ELEMENT_ID__=QI,e})();const YI=Nc,JI=class extends YI{constructor(t,n,i){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=i}createEmbeddedView(t){const n=this._declarationTContainer.tViews,i=ad(this._declarationLView,n,t,16,null,n.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(i[19]=d.createEmbeddedView(n)),zu(n,i,t),new Em(i)}};function QI(){return I_(yr(),je())}function I_(e,t){return 4&e.type?new JI(t,e,Hf(e,t)):null}let za=(()=>{class e{}return e.__NG_ELEMENT_ID__=eA,e})();function eA(){return jw(yr(),je())}const tA=za,Vw=class extends tA{constructor(t,n,i){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=i}get element(){return Hf(this._hostTNode,this._hostLView)}get injector(){return new Qi(this._hostTNode,this._hostLView)}get parentInjector(){const t=ii(this._hostTNode,this._hostLView);if(Hn(t)){const n=Ar(t,this._hostLView),i=hr(t);return new Qi(n[1].data[i+8],n)}return new Qi(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=Uw(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,i){const l=t.createEmbeddedView(n||{});return this.insert(l,i),l}createComponent(t,n,i,l,d){const y=t&&!function Vn(e){return"function"==typeof e}(t);let w;if(y)w=n;else{const U=n||{};w=U.index,i=U.injector,l=U.projectableNodes,d=U.ngModuleRef}const T=y?t:new ux(qr(t)),k=i||this.parentInjector;if(!d&&null==T.ngModule){const Y=(y?k:this.parentInjector).get(Bc,null);Y&&(d=Y)}const L=T.create(k,l,void 0,d);return this.insert(L.hostView,w),L}insert(t,n){const i=t._lView,l=i[1];if(function $d(e){return Ye(e[3])}(i)){const L=this.indexOf(t);if(-1!==L)this.detach(L);else{const U=i[3],Y=new Vw(U,U[6],U[3]);Y.detach(Y.indexOf(t))}}const d=this._adjustIndex(n),y=this._lContainer;!function xv(e,t,n,i){const l=10+i,d=n.length;i>0&&(n[l-1][4]=t),i<d-10?(t[4]=n[l],gp(n,10+i,t)):(n.push(t),t[4]=null),t[3]=n;const y=t[17];null!==y&&n!==y&&function bv(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(y,t);const w=t[19];null!==w&&w.insertView(e),t[2]|=128}(l,i,y,d);const w=Xh(d,y),T=i[11],k=El(T,y[7]);return null!==k&&function _v(e,t,n,i,l,d){i[0]=l,i[6]=t,Kh(e,i,n,1,l,d)}(l,y[6],T,i,k,w),t.attachToViewContainerRef(),gp(px(y),d,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=Uw(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),i=$p(this._lContainer,n);i&&(xu(px(this._lContainer),n),qh(i[1],i))}detach(t){const n=this._adjustIndex(t,-1),i=$p(this._lContainer,n);return i&&null!=xu(px(this._lContainer),n)?new Em(i):null}_adjustIndex(t,n=0){return null==t?this.length+n:t}};function Uw(e){return e[8]}function px(e){return e[8]||(e[8]=[])}function jw(e,t){let n;const i=t[e.index];if(Ye(i))n=i;else{let l;if(8&e.type)l=Jn(i);else{const d=t[11];l=d.createComment("");const y=ni(e,t);ka(d,El(d,y),l,function Pu(e,t){return Yn(e)?e.nextSibling(t):t.nextSibling}(d,y),!1)}t[e.index]=n=d_(i,t,l,e),Bf(t,n)}return new Vw(n,e,t)}class mx{constructor(t){this.queryList=t,this.matches=null}clone(){return new mx(this.queryList)}setDirty(){this.queryList.setDirty()}}class gx{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const i=null!==t.contentQueries?t.contentQueries[0]:n.length,l=[];for(let d=0;d<i;d++){const y=n.getByIndex(d);l.push(this.queries[y.indexInDeclarationView].clone())}return new gx(l)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==Ww(t,n).matches&&this.queries[n].setDirty()}}class $w{constructor(t,n,i=null){this.predicate=t,this.flags=n,this.read=i}}class _x{constructor(t=[]){this.queries=t}elementStart(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let i=0;i<this.length;i++){const l=null!==n?n.length:0,d=this.getByIndex(i).embeddedTView(t,l);d&&(d.indexInDeclarationView=i,null!==n?n.push(d):n=[d])}return null!==n?new _x(n):null}template(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class yx{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new yx(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==n;)i=i.parent;return n===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const i=this.metadata.predicate;if(Array.isArray(i))for(let l=0;l<i.length;l++){const d=i[l];this.matchTNodeWithReadOption(t,n,iA(n,d)),this.matchTNodeWithReadOption(t,n,dl(n,t,d,!1,!1))}else i===Nc?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,dl(n,t,i,!1,!1))}matchTNodeWithReadOption(t,n,i){if(null!==i){const l=this.metadata.read;if(null!==l)if(l===ls||l===za||l===Nc&&4&n.type)this.addMatch(n.index,-2);else{const d=dl(n,t,l,!1,!1);null!==d&&this.addMatch(n.index,d)}else this.addMatch(n.index,i)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function iA(e,t){const n=e.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===t)return n[i+1];return null}function sA(e,t,n,i){return-1===n?function oA(e,t){return 11&e.type?Hf(e,t):4&e.type?I_(e,t):null}(t,e):-2===n?function aA(e,t,n){return n===ls?Hf(t,e):n===Nc?I_(t,e):n===za?jw(t,e):void 0}(e,t,i):fl(e,e[1],n,t)}function Gw(e,t,n,i){const l=t[19].queries[i];if(null===l.matches){const d=e.data,y=n.matches,w=[];for(let T=0;T<y.length;T+=2){const k=y[T];w.push(k<0?null:sA(t,d[k],y[T+1],n.metadata.read))}l.matches=w}return l.matches}function vx(e,t,n,i){const l=e.queries.getByIndex(n),d=l.matches;if(null!==d){const y=Gw(e,t,l,n);for(let w=0;w<d.length;w+=2){const T=d[w];if(T>0)i.push(y[w/2]);else{const k=d[w+1],L=t[-T];for(let U=10;U<L.length;U++){const Y=L[U];Y[17]===Y[3]&&vx(Y[1],Y,k,i)}if(null!==L[9]){const U=L[9];for(let Y=0;Y<U.length;Y++){const ie=U[Y];vx(ie[1],ie,k,i)}}}}}return i}function A_(e){const t=je(),n=rn(),i=p();o(i+1);const l=Ww(n,i);if(e.dirty&&ph(t)===(2==(2&l.metadata.flags))){if(null===l.matches)e.reset([]);else{const d=l.crossesNgTemplate?vx(n,t,i,[]):Gw(n,t,l,i);e.reset(d,bI),e.notifyOnChanges()}return!0}return!1}function Hw(e,t,n){const i=rn();i.firstCreatePass&&(function Zw(e,t,n){null===e.queries&&(e.queries=new _x),e.queries.track(new yx(t,n))}(i,new $w(e,t,n),-1),2==(2&t)&&(i.staticViewQueries=!0)),function qw(e,t,n){const i=new fx(4==(4&n));rm(e,t,i,i.destroy),null===t[19]&&(t[19]=new gx),t[19].queries.push(new mx(i))}(i,je(),t)}function Ww(e,t){return e.queries.getByIndex(t)}function Xw(e,t){return I_(e,t)}function O_(...e){}const F_=new Ft("Application Initializer");let Tx=(()=>{class e{constructor(n){this.appInits=n,this.resolve=O_,this.reject=O_,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,l)=>{this.resolve=i,this.reject=l})}runInitializers(){if(this.initialized)return;const n=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let l=0;l<this.appInits.length;l++){const d=this.appInits[l]();if(gm(d))n.push(d);else if(Jv(d)){const y=new Promise((w,T)=>{d.subscribe({complete:w,error:T})});n.push(y)}}Promise.all(n).then(()=>{i()}).catch(l=>{this.reject(l)}),0===n.length&&i(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(bt(F_,8))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Sm=new Ft("AppId",{providedIn:"root",factory:function dC(){return`${Mx()}${Mx()}${Mx()}`}});function Mx(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const fC=new Ft("Platform Initializer"),Im=new Ft("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),pC=new Ft("appBootstrapListener");let TA=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const ju=new Ft("LocaleId",{providedIn:"root",factory:()=>Uy(ju,St.Optional|St.SkipSelf)||function MA(){return"undefined"!=typeof $localize&&$localize.locale||C_}()});class IA{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let mC=(()=>{class e{compileModuleSync(n){return new hx(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),d=Us(Zi(n).declarations).reduce((y,w)=>{const T=qr(w);return T&&y.push(new ux(T)),y},[]);return new IA(i,d)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const PA=(()=>Promise.resolve(0))();function Sx(e){"undefined"==typeof Zone?PA.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Ei{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Rr(!1),this.onMicrotaskEmpty=new Rr(!1),this.onStable=new Rr(!1),this.onError=new Rr(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!i&&n,l.shouldCoalesceRunChangeDetection=i,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function kA(){let e=un.requestAnimationFrame,t=un.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function FA(e){const t=()=>{!function OA(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(un,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Ax(e),e.isCheckStableRunning=!0,Ix(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Ax(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,l,d,y,w)=>{try{return gC(e),n.invokeTask(l,d,y,w)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===d.type||e.shouldCoalesceRunChangeDetection)&&t(),_C(e)}},onInvoke:(n,i,l,d,y,w,T)=>{try{return gC(e),n.invoke(l,d,y,w,T)}finally{e.shouldCoalesceRunChangeDetection&&t(),_C(e)}},onHasTask:(n,i,l,d)=>{n.hasTask(l,d),i===l&&("microTask"==d.change?(e._hasPendingMicrotasks=d.microTask,Ax(e),Ix(e)):"macroTask"==d.change&&(e.hasPendingMacrotasks=d.macroTask))},onHandleError:(n,i,l,d)=>(n.handleError(l,d),e.runOutsideAngular(()=>e.onError.emit(d)),!1)})}(l)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ei.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Ei.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,n,i){return this._inner.run(t,n,i)}runTask(t,n,i,l){const d=this._inner,y=d.scheduleEventTask("NgZoneEvent: "+l,t,RA,O_,O_);try{return d.runTask(y,n,i)}finally{d.cancelTask(y)}}runGuarded(t,n,i){return this._inner.runGuarded(t,n,i)}runOutsideAngular(t){return this._outer.run(t)}}const RA={};function Ix(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Ax(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function gC(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function _C(e){e._nesting--,Ix(e)}class LA{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Rr,this.onMicrotaskEmpty=new Rr,this.onStable=new Rr,this.onError=new Rr}run(t,n,i){return t.apply(n,i)}runGuarded(t,n,i){return t.apply(n,i)}runOutsideAngular(t){return t()}runTask(t,n,i,l){return t.apply(n,i)}}let Px=(()=>{class e{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ei.assertNotInAngularZone(),Sx(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Sx(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,l){let d=-1;i&&i>0&&(d=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==d),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:d,updateCb:l})}whenStable(n,i,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,i,l){return[]}}return e.\u0275fac=function(n){return new(n||e)(bt(Ei))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),zA=(()=>{class e{constructor(){this._applications=new Map,kx.addToWindow(this)}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return kx.findTestabilityInTree(this,n,i)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();class BA{addToWindow(t){}findTestabilityInTree(t,n,i){return null}}let kx=new BA,pd=null;const yC=new Ft("AllowMultipleToken"),vC=new Ft("PlatformOnDestroy");class xC{constructor(t,n){this.name=t,this.token=n}}function bC(e,t,n=[]){const i=`Platform: ${t}`,l=new Ft(i);return(d=[])=>{let y=Rx();if(!y||y.injector.get(yC,!1)){const w=[...n,...d,{provide:l,useValue:!0}];e?e(w):function jA(e){if(pd&&!pd.get(yC,!1))throw new Tt(400,"");pd=e;const t=e.get(wC),n=e.get(fC,null);n&&n.forEach(i=>i())}(function GA(e=[],t){return Ee.create({name:t,providers:[{provide:v,useValue:"platform"},{provide:vC,useValue:()=>pd=null},...e]})}(w,i))}return function $A(e){const t=Rx();if(!t)throw new Tt(401,"");return t}()}}function Rx(){var e;return null!==(e=null==pd?void 0:pd.get(wC))&&void 0!==e?e:null}let wC=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const w=function HA(e,t){let n;return n="noop"===e?new LA:("zone.js"===e?void 0:e)||new Ei({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),T=[{provide:Ei,useValue:w}];return w.run(()=>{const k=Ee.create({providers:T,parent:this.injector,name:n.moduleType.name}),L=n.create(k),U=L.injector.get(jh,null);if(!U)throw new Tt(402,"");return w.runOutsideAngular(()=>{const Y=w.onError.subscribe({next:ie=>{U.handleError(ie)}});L.onDestroy(()=>{Ox(this._modules,L),Y.unsubscribe()})}),function qA(e,t,n){try{const i=n();return gm(i)?i.catch(l=>{throw t.runOutsideAngular(()=>e.handleError(l)),l}):i}catch(i){throw t.runOutsideAngular(()=>e.handleError(i)),i}}(U,w,()=>{const Y=L.injector.get(Tx);return Y.runInitializers(),Y.donePromise.then(()=>(function wS(e){mi(e,"Expected localeId to be defined"),"string"==typeof e&&(tw=e.toLowerCase().replace(/_/g,"-"))}(L.injector.get(ju,C_)||C_),this._moduleDoBootstrap(L),L))})})}bootstrapModule(n,i=[]){const l=CC({},i);return function VA(e,t,n){const i=new hx(n);return Promise.resolve(i)}(0,0,n).then(d=>this.bootstrapModuleFactory(d,l))}_moduleDoBootstrap(n){const i=n.injector.get(L_);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(l=>i.bootstrap(l));else{if(!n.instance.ngDoBootstrap)throw new Tt(403,"");n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Tt(404,"");this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const n=this._injector.get(vC,null);null==n||n(),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(bt(Ee))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function CC(e,t){return Array.isArray(t)?t.reduce(CC,e):Object.assign(Object.assign({},e),t)}let L_=(()=>{class e{constructor(n,i,l,d){this._zone=n,this._injector=i,this._exceptionHandler=l,this._initStatus=d,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const y=new Dn(T=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{T.next(this._stable),T.complete()})}),w=new Dn(T=>{let k;this._zone.runOutsideAngular(()=>{k=this._zone.onStable.subscribe(()=>{Ei.assertNotInAngularZone(),Sx(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,T.next(!0))})})});const L=this._zone.onUnstable.subscribe(()=>{Ei.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{T.next(!1)}))});return()=>{k.unsubscribe(),L.unsubscribe()}});this.isStable=ys(y,w.pipe(function ji(e={}){const{connector:t=(()=>new br),resetOnError:n=!0,resetOnComplete:i=!0,resetOnRefCountZero:l=!0}=e;return d=>{let y=null,w=null,T=null,k=0,L=!1,U=!1;const Y=()=>{null==w||w.unsubscribe(),w=null},ie=()=>{Y(),y=T=null,L=U=!1},ve=()=>{const Fe=y;ie(),null==Fe||Fe.unsubscribe()};return $n((Fe,Ke)=>{k++,!U&&!L&&Y();const Xe=T=null!=T?T:t();Ke.add(()=>{k--,0===k&&!U&&!L&&(w=Fn(ve,l))}),Xe.subscribe(Ke),y||(y=new or({next:Pe=>Xe.next(Pe),error:Pe=>{U=!0,Y(),w=Fn(ie,n,Pe),Xe.error(Pe)},complete:()=>{L=!0,Y(),w=Fn(ie,i),Xe.complete()}}),qn(Fe).subscribe(y))})(d)}}()))}bootstrap(n,i){if(!this._initStatus.done)throw new Tt(405,"");let l;l=n instanceof Tw?n:this._injector.get(wm).resolveComponentFactory(n),this.componentTypes.push(l.componentType);const d=function UA(e){return e.isBoundToModule}(l)?void 0:this._injector.get(Bc),w=l.create(Ee.NULL,[],i||l.selector,d),T=w.location.nativeElement,k=w.injector.get(Px,null),L=k&&w.injector.get(zA);return k&&L&&L.registerApplication(T,k),w.onDestroy(()=>{this.detachView(w.hostView),Ox(this.components,w),L&&L.unregisterApplication(T)}),this._loadComponent(w),w}tick(){if(this._runningTick)throw new Tt(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;Ox(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(pC,[]).concat(this._bootstrapListeners).forEach(l=>l(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(n){return new(n||e)(bt(Ei),bt(Ee),bt(jh),bt(Tx))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Ox(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let DC=!0,z_=(()=>{class e{}return e.__NG_ELEMENT_ID__=XA,e})();function XA(e){return function KA(e,t,n){if(Ms(e)&&!n){const i=vi(e.index,t);return new Em(i,i)}return 47&e.type?new Em(t[16],t):null}(yr(),je(),16==(16&e))}const c2=bC(null,"core",[]);let u2=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(bt(L_))},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({}),e})(),U_=null;function Bl(){return U_}const cs=new Ft("DocumentToken");let gd=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:function(){return function p2(){return bt(LC)}()},providedIn:"platform"}),e})();const m2=new Ft("Location Initialized");let LC=(()=>{class e extends gd{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Bl().getBaseHref(this._doc)}onPopState(n){const i=Bl().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=Bl().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,i,l){zC()?this._history.pushState(n,i,l):this.location.hash=l}replaceState(n,i,l){zC()?this._history.replaceState(n,i,l):this.location.hash=l}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(bt(cs))},e.\u0275prov=zt({token:e,factory:function(){return function g2(){return new LC(bt(cs))}()},providedIn:"platform"}),e})();function zC(){return!!window.history.pushState}function Nx(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function BC(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Vc(e){return e&&"?"!==e[0]?"?"+e:e}let Wf=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:function(){return function _2(e){const t=bt(cs).location;return new NC(bt(gd),t&&t.origin||"")}()},providedIn:"root"}),e})();const Vx=new Ft("appBaseHref");let NC=(()=>{class e extends Wf{constructor(n,i){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Nx(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Vc(this._platformLocation.search),l=this._platformLocation.hash;return l&&n?`${i}${l}`:i}pushState(n,i,l,d){const y=this.prepareExternalUrl(l+Vc(d));this._platformLocation.pushState(n,i,y)}replaceState(n,i,l,d){const y=this.prepareExternalUrl(l+Vc(d));this._platformLocation.replaceState(n,i,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var i,l;null===(l=(i=this._platformLocation).historyGo)||void 0===l||l.call(i,n)}}return e.\u0275fac=function(n){return new(n||e)(bt(gd),bt(Vx,8))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),y2=(()=>{class e extends Wf{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=Nx(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,l,d){let y=this.prepareExternalUrl(l+Vc(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(n,i,y)}replaceState(n,i,l,d){let y=this.prepareExternalUrl(l+Vc(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var i,l;null===(l=(i=this._platformLocation).historyGo)||void 0===l||l.call(i,n)}}return e.\u0275fac=function(n){return new(n||e)(bt(gd),bt(Vx,8))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),Ux=(()=>{class e{constructor(n,i){this._subject=new Rr,this._urlChangeListeners=[],this._platformStrategy=n;const l=this._platformStrategy.getBaseHref();this._platformLocation=i,this._baseHref=BC(VC(l)),this._platformStrategy.onPopState(d=>{this._subject.emit({url:this.path(!0),pop:!0,state:d.state,type:d.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Vc(i))}normalize(n){return e.stripTrailingSlash(function x2(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,VC(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,i="",l=null){this._platformStrategy.pushState(l,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Vc(i)),l)}replaceState(n,i="",l=null){this._platformStrategy.replaceState(l,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Vc(i)),l)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var i,l;null===(l=(i=this._platformStrategy).historyGo)||void 0===l||l.call(i,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}))}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(l=>l(n,i))}subscribe(n,i,l){return this._subject.subscribe({next:n,error:i,complete:l})}}return e.normalizeQueryParams=Vc,e.joinWithSlash=Nx,e.stripTrailingSlash=BC,e.\u0275fac=function(n){return new(n||e)(bt(Wf),bt(gd))},e.\u0275prov=zt({token:e,factory:function(){return function v2(){return new Ux(bt(Wf),bt(gd))}()},providedIn:"root"}),e})();function VC(e){return e.replace(/\/index.html$/,"")}function XC(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const i=n.indexOf("="),[l,d]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(l.trim()===t)return decodeURIComponent(d)}return null}let YC=(()=>{class e{constructor(n,i){this._viewContainer=n,this._context=new aP,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){JC("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){JC("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,i){return!0}}return e.\u0275fac=function(n){return new(n||e)(Ze(za),Ze(Nc))},e.\u0275dir=It({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class aP{constructor(){this.$implicit=null,this.ngIf=null}}function JC(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${_n(t)}'.`)}let tE=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({}),e})();const nE="browser";function rE(e){return e===nE}let zP=(()=>{class e{}return e.\u0275prov=zt({token:e,providedIn:"root",factory:()=>new BP(bt(cs),window)}),e})();class BP{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function NP(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const i=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let l=i.currentNode;for(;l;){const d=l.shadowRoot;if(d){const y=d.getElementById(t)||d.querySelector(`[name="${t}"]`);if(y)return y}l=i.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),i=n.left+this.window.pageXOffset,l=n.top+this.window.pageYOffset,d=this.offset();this.window.scrollTo(i-d[0],l-d[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=iE(this.window.history)||iE(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function iE(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class oE{}class t0 extends class VP extends class f2{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function d2(e){U_||(U_=e)}(new t0)}onAndCancel(t,n,i){return t.addEventListener(n,i,!1),()=>{t.removeEventListener(n,i,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function UP(){return Rm=Rm||document.querySelector("base"),Rm?Rm.getAttribute("href"):null}();return null==n?null:function jP(e){Y_=Y_||document.createElement("a"),Y_.setAttribute("href",e);const t=Y_.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Rm=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return XC(document.cookie,t)}}let Y_,Rm=null;const sE=new Ft("TRANSITION_ID"),GP=[{provide:F_,useFactory:function $P(e,t,n){return()=>{n.get(Tx).donePromise.then(()=>{const i=Bl(),l=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let d=0;d<l.length;d++)i.remove(l[d])})}},deps:[sE,cs,Ee],multi:!0}];class n0{static init(){!function NA(e){kx=e}(new n0)}addToWindow(t){un.getAngularTestability=(i,l=!0)=>{const d=t.findTestabilityInTree(i,l);if(null==d)throw new Error("Could not find testability for element.");return d},un.getAllAngularTestabilities=()=>t.getAllTestabilities(),un.getAllAngularRootElements=()=>t.getAllRootElements(),un.frameworkStabilizers||(un.frameworkStabilizers=[]),un.frameworkStabilizers.push(i=>{const l=un.getAllAngularTestabilities();let d=l.length,y=!1;const w=function(T){y=y||T,d--,0==d&&i(y)};l.forEach(function(T){T.whenStable(w)})})}findTestabilityInTree(t,n,i){if(null==n)return null;const l=t.getTestability(n);return null!=l?l:i?Bl().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null}}let HP=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const J_=new Ft("EventManagerPlugins");let Q_=(()=>{class e{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(l=>l.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,i,l){return this._findPluginFor(i).addEventListener(n,i,l)}addGlobalEventListener(n,i,l){return this._findPluginFor(i).addGlobalEventListener(n,i,l)}getZone(){return this._zone}_findPluginFor(n){const i=this._eventNameToPlugin.get(n);if(i)return i;const l=this._plugins;for(let d=0;d<l.length;d++){const y=l[d];if(y.supports(n))return this._eventNameToPlugin.set(n,y),y}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(bt(J_),bt(Ei))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();class aE{constructor(t){this._doc=t}addGlobalEventListener(t,n,i){const l=Bl().getGlobalEventTarget(this._doc,t);if(!l)throw new Error(`Unsupported event target ${l} for event ${n}`);return this.addEventListener(l,n,i)}}let lE=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const i=new Set;n.forEach(l=>{this._stylesSet.has(l)||(this._stylesSet.add(l),i.add(l))}),this.onStylesAdded(i)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),Om=(()=>{class e extends lE{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,i,l){n.forEach(d=>{const y=this._doc.createElement("style");y.textContent=d,l.push(i.appendChild(y))})}addHost(n){const i=[];this._addStylesToHost(this._stylesSet,n,i),this._hostNodes.set(n,i)}removeHost(n){const i=this._hostNodes.get(n);i&&i.forEach(cE),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((i,l)=>{this._addStylesToHost(n,l,i)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(cE))}}return e.\u0275fac=function(n){return new(n||e)(bt(cs))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();function cE(e){Bl().remove(e)}const r0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},o0=/%COMP%/g;function ey(e,t,n){for(let i=0;i<t.length;i++){let l=t[i];Array.isArray(l)?ey(e,l,n):(l=l.replace(o0,e),n.push(l))}return n}function dE(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let s0=(()=>{class e{constructor(n,i,l){this.eventManager=n,this.sharedStylesHost=i,this.appId=l,this.rendererByCompId=new Map,this.defaultRenderer=new a0(n)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;switch(i.encapsulation){case qi.Emulated:{let l=this.rendererByCompId.get(i.id);return l||(l=new YP(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,l)),l.applyToHost(n),l}case 1:case qi.ShadowDom:return new JP(this.eventManager,this.sharedStylesHost,n,i);default:if(!this.rendererByCompId.has(i.id)){const l=ey(i.id,i.styles,[]);this.sharedStylesHost.addStyles(l),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(bt(Q_),bt(Om),bt(Sm))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();class a0{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(r0[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){t.appendChild(n)}insertBefore(t,n,i){t&&t.insertBefore(n,i)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return n||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,i,l){if(l){n=l+":"+n;const d=r0[l];d?t.setAttributeNS(d,n,i):t.setAttribute(n,i)}else t.setAttribute(n,i)}removeAttribute(t,n,i){if(i){const l=r0[i];l?t.removeAttributeNS(l,n):t.removeAttribute(`${i}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,i,l){l&(Wr.DashCase|Wr.Important)?t.style.setProperty(n,i,l&Wr.Important?"important":""):t.style[n]=i}removeStyle(t,n,i){i&Wr.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,i){t[n]=i}setValue(t,n){t.nodeValue=n}listen(t,n,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,dE(i)):this.eventManager.addEventListener(t,n,dE(i))}}class YP extends a0{constructor(t,n,i,l){super(t),this.component=i;const d=ey(l+"-"+i.id,i.styles,[]);n.addStyles(d),this.contentAttr=function WP(e){return"_ngcontent-%COMP%".replace(o0,e)}(l+"-"+i.id),this.hostAttr=function XP(e){return"_nghost-%COMP%".replace(o0,e)}(l+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const i=super.createElement(t,n);return super.setAttribute(i,this.contentAttr,""),i}}class JP extends a0{constructor(t,n,i,l){super(t),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const d=ey(l.id,l.styles,[]);for(let y=0;y<d.length;y++){const w=document.createElement("style");w.textContent=d[y],this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,i){return super.insertBefore(this.nodeOrShadowRoot(t),n,i)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let QP=(()=>{class e extends aE{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,l){return n.addEventListener(i,l,!1),()=>this.removeEventListener(n,i,l)}removeEventListener(n,i,l){return n.removeEventListener(i,l)}}return e.\u0275fac=function(n){return new(n||e)(bt(cs))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const pE=["alt","control","meta","shift"],tk={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},mE={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},nk={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let rk=(()=>{class e extends aE{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,l){const d=e.parseEventName(i),y=e.eventCallback(d.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Bl().onAndCancel(n,d.domEventName,y))}static parseEventName(n){const i=n.toLowerCase().split("."),l=i.shift();if(0===i.length||"keydown"!==l&&"keyup"!==l)return null;const d=e._normalizeKey(i.pop());let y="";if(pE.forEach(T=>{const k=i.indexOf(T);k>-1&&(i.splice(k,1),y+=T+".")}),y+=d,0!=i.length||0===d.length)return null;const w={};return w.domEventName=l,w.fullKey=y,w}static getEventFullKey(n){let i="",l=function ik(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&mE.hasOwnProperty(t)&&(t=mE[t]))}return tk[t]||t}(n);return l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),pE.forEach(d=>{d!=l&&nk[d](n)&&(i+=d+".")}),i+=l,i}static eventCallback(n,i,l){return d=>{e.getEventFullKey(d)===n&&l.runGuarded(()=>i(d))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(bt(cs))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const lk=bC(c2,"browser",[{provide:Im,useValue:nE},{provide:fC,useValue:function ok(){t0.makeCurrent(),n0.init()},multi:!0},{provide:cs,useFactory:function ak(){return function uu(e){cu=e}(document),document},deps:[]}]),ck=[{provide:v,useValue:"root"},{provide:jh,useFactory:function sk(){return new jh},deps:[]},{provide:J_,useClass:QP,multi:!0,deps:[cs,Ei,Im]},{provide:J_,useClass:rk,multi:!0,deps:[cs]},{provide:s0,useClass:s0,deps:[Q_,Om,Sm]},{provide:Sw,useExisting:s0},{provide:lE,useExisting:Om},{provide:Om,useClass:Om,deps:[cs]},{provide:Px,useClass:Px,deps:[Ei]},{provide:Q_,useClass:Q_,deps:[J_,Ei]},{provide:oE,useClass:HP,deps:[]}];let uk=(()=>{class e{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:e,providers:[{provide:Sm,useValue:n.appId},{provide:sE,useExisting:Sm},GP]}}}return e.\u0275fac=function(n){return new(n||e)(bt(e,12))},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({providers:ck,imports:[tE,u2]}),e})();function Zt(...e){return qn(e,rt(e))}function Xf(e,t){return dn(t)?Ue(e,t,1):Ue(e,1)}function us(e,t){return $n((n,i)=>{let l=0;n.subscribe(tr(i,d=>e.call(t,d,l++)&&i.next(d)))})}"undefined"!=typeof window&&window;class yE{}class vE{}class jc{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(n=>{const i=n.indexOf(":");if(i>0){const l=n.slice(0,i),d=l.toLowerCase(),y=n.slice(i+1).trim();this.maybeSetNormalizedName(l,d),this.headers.has(d)?this.headers.get(d).push(y):this.headers.set(d,[y])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(n=>{let i=t[n];const l=n.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(l,i),this.maybeSetNormalizedName(n,l))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof jc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new jc;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof jc?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,n);const l=("a"===t.op?this.headers.get(n):void 0)||[];l.push(...i),this.headers.set(n,l);break;case"d":const d=t.value;if(d){let y=this.headers.get(n);if(!y)return;y=y.filter(w=>-1===d.indexOf(w)),0===y.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,y)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class bk{encodeKey(t){return xE(t)}encodeValue(t){return xE(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const Ck=/%(\d[a-f0-9])/gi,Ek={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function xE(e){return encodeURIComponent(e).replace(Ck,(t,n)=>{var i;return null!==(i=Ek[n])&&void 0!==i?i:t})}function bE(e){return`${e}`}class Gu{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new bk,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function wk(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(l=>{const d=l.indexOf("="),[y,w]=-1==d?[t.decodeKey(l),""]:[t.decodeKey(l.slice(0,d)),t.decodeValue(l.slice(d+1))],T=n.get(y)||[];T.push(w),n.set(y,T)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const i=t.fromObject[n];this.map.set(n,Array.isArray(i)?i:[i])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(i=>{const l=t[i];Array.isArray(l)?l.forEach(d=>{n.push({param:i,value:d,op:"a"})}):n.push({param:i,value:l,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(i=>n+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Gu({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(bE(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const l=i.indexOf(bE(t.value));-1!==l&&i.splice(l,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class Dk{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function wE(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function CE(e){return"undefined"!=typeof Blob&&e instanceof Blob}function EE(e){return"undefined"!=typeof FormData&&e instanceof FormData}class Fm{constructor(t,n,i,l){let d;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function Tk(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||l?(this.body=void 0!==i?i:null,d=l):d=i,d&&(this.reportProgress=!!d.reportProgress,this.withCredentials=!!d.withCredentials,d.responseType&&(this.responseType=d.responseType),d.headers&&(this.headers=d.headers),d.context&&(this.context=d.context),d.params&&(this.params=d.params)),this.headers||(this.headers=new jc),this.context||(this.context=new Dk),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=n;else{const w=n.indexOf("?");this.urlWithParams=n+(-1===w?"?":w<n.length-1?"&":"")+y}}else this.params=new Gu,this.urlWithParams=n}serializeBody(){return null===this.body?null:wE(this.body)||CE(this.body)||EE(this.body)||function Mk(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Gu?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||EE(this.body)?null:CE(this.body)?this.body.type||null:wE(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Gu?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var n;const i=t.method||this.method,l=t.url||this.url,d=t.responseType||this.responseType,y=void 0!==t.body?t.body:this.body,w=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,T=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let k=t.headers||this.headers,L=t.params||this.params;const U=null!==(n=t.context)&&void 0!==n?n:this.context;return void 0!==t.setHeaders&&(k=Object.keys(t.setHeaders).reduce((Y,ie)=>Y.set(ie,t.setHeaders[ie]),k)),t.setParams&&(L=Object.keys(t.setParams).reduce((Y,ie)=>Y.set(ie,t.setParams[ie]),L)),new Fm(i,l,y,{params:L,headers:k,context:U,reportProgress:T,responseType:d,withCredentials:w})}}var Jr=(()=>((Jr=Jr||{})[Jr.Sent=0]="Sent",Jr[Jr.UploadProgress=1]="UploadProgress",Jr[Jr.ResponseHeader=2]="ResponseHeader",Jr[Jr.DownloadProgress=3]="DownloadProgress",Jr[Jr.Response=4]="Response",Jr[Jr.User=5]="User",Jr))();class c0{constructor(t,n=200,i="OK"){this.headers=t.headers||new jc,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class u0 extends c0{constructor(t={}){super(t),this.type=Jr.ResponseHeader}clone(t={}){return new u0({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class ty extends c0{constructor(t={}){super(t),this.type=Jr.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new ty({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class DE extends c0{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function h0(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let TE=(()=>{class e{constructor(n){this.handler=n}request(n,i,l={}){let d;if(n instanceof Fm)d=n;else{let T,k;T=l.headers instanceof jc?l.headers:new jc(l.headers),l.params&&(k=l.params instanceof Gu?l.params:new Gu({fromObject:l.params})),d=new Fm(n,i,void 0!==l.body?l.body:null,{headers:T,context:l.context,params:k,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const y=Zt(d).pipe(Xf(T=>this.handler.handle(T)));if(n instanceof Fm||"events"===l.observe)return y;const w=y.pipe(us(T=>T instanceof ty));switch(l.observe||"body"){case"body":switch(d.responseType){case"arraybuffer":return w.pipe(Ot(T=>{if(null!==T.body&&!(T.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return T.body}));case"blob":return w.pipe(Ot(T=>{if(null!==T.body&&!(T.body instanceof Blob))throw new Error("Response is not a Blob.");return T.body}));case"text":return w.pipe(Ot(T=>{if(null!==T.body&&"string"!=typeof T.body)throw new Error("Response is not a string.");return T.body}));default:return w.pipe(Ot(T=>T.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(n,i={}){return this.request("DELETE",n,i)}get(n,i={}){return this.request("GET",n,i)}head(n,i={}){return this.request("HEAD",n,i)}jsonp(n,i){return this.request("JSONP",n,{params:(new Gu).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,i={}){return this.request("OPTIONS",n,i)}patch(n,i,l={}){return this.request("PATCH",n,h0(l,i))}post(n,i,l={}){return this.request("POST",n,h0(l,i))}put(n,i,l={}){return this.request("PUT",n,h0(l,i))}}return e.\u0275fac=function(n){return new(n||e)(bt(yE))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();class ME{constructor(t,n){this.next=t,this.interceptor=n}handle(t){return this.interceptor.intercept(t,this.next)}}const SE=new Ft("HTTP_INTERCEPTORS");let Sk=(()=>{class e{intercept(n,i){return i.handle(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const Ik=/^\)\]\}',?\n/;let IE=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Dn(i=>{const l=this.xhrFactory.build();if(l.open(n.method,n.urlWithParams),n.withCredentials&&(l.withCredentials=!0),n.headers.forEach((ie,ve)=>l.setRequestHeader(ie,ve.join(","))),n.headers.has("Accept")||l.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const ie=n.detectContentTypeHeader();null!==ie&&l.setRequestHeader("Content-Type",ie)}if(n.responseType){const ie=n.responseType.toLowerCase();l.responseType="json"!==ie?ie:"text"}const d=n.serializeBody();let y=null;const w=()=>{if(null!==y)return y;const ie=l.statusText||"OK",ve=new jc(l.getAllResponseHeaders()),Fe=function Ak(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(l)||n.url;return y=new u0({headers:ve,status:l.status,statusText:ie,url:Fe}),y},T=()=>{let{headers:ie,status:ve,statusText:Fe,url:Ke}=w(),Xe=null;204!==ve&&(Xe=void 0===l.response?l.responseText:l.response),0===ve&&(ve=Xe?200:0);let Pe=ve>=200&&ve<300;if("json"===n.responseType&&"string"==typeof Xe){const wt=Xe;Xe=Xe.replace(Ik,"");try{Xe=""!==Xe?JSON.parse(Xe):null}catch(en){Xe=wt,Pe&&(Pe=!1,Xe={error:en,text:Xe})}}Pe?(i.next(new ty({body:Xe,headers:ie,status:ve,statusText:Fe,url:Ke||void 0})),i.complete()):i.error(new DE({error:Xe,headers:ie,status:ve,statusText:Fe,url:Ke||void 0}))},k=ie=>{const{url:ve}=w(),Fe=new DE({error:ie,status:l.status||0,statusText:l.statusText||"Unknown Error",url:ve||void 0});i.error(Fe)};let L=!1;const U=ie=>{L||(i.next(w()),L=!0);let ve={type:Jr.DownloadProgress,loaded:ie.loaded};ie.lengthComputable&&(ve.total=ie.total),"text"===n.responseType&&!!l.responseText&&(ve.partialText=l.responseText),i.next(ve)},Y=ie=>{let ve={type:Jr.UploadProgress,loaded:ie.loaded};ie.lengthComputable&&(ve.total=ie.total),i.next(ve)};return l.addEventListener("load",T),l.addEventListener("error",k),l.addEventListener("timeout",k),l.addEventListener("abort",k),n.reportProgress&&(l.addEventListener("progress",U),null!==d&&l.upload&&l.upload.addEventListener("progress",Y)),l.send(d),i.next({type:Jr.Sent}),()=>{l.removeEventListener("error",k),l.removeEventListener("abort",k),l.removeEventListener("load",T),l.removeEventListener("timeout",k),n.reportProgress&&(l.removeEventListener("progress",U),null!==d&&l.upload&&l.upload.removeEventListener("progress",Y)),l.readyState!==l.DONE&&l.abort()}})}}return e.\u0275fac=function(n){return new(n||e)(bt(oE))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const d0=new Ft("XSRF_COOKIE_NAME"),f0=new Ft("XSRF_HEADER_NAME");class AE{}let Pk=(()=>{class e{constructor(n,i,l){this.doc=n,this.platform=i,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=XC(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(bt(cs),bt(Im),bt(d0))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),p0=(()=>{class e{constructor(n,i){this.tokenService=n,this.headerName=i}intercept(n,i){const l=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||l.startsWith("http://")||l.startsWith("https://"))return i.handle(n);const d=this.tokenService.getToken();return null!==d&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,d)})),i.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(bt(AE),bt(f0))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),kk=(()=>{class e{constructor(n,i){this.backend=n,this.injector=i,this.chain=null}handle(n){if(null===this.chain){const i=this.injector.get(SE,[]);this.chain=i.reduceRight((l,d)=>new ME(l,d),this.backend)}return this.chain.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(bt(vE),bt(Ee))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),Rk=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:p0,useClass:Sk}]}}static withOptions(n={}){return{ngModule:e,providers:[n.cookieName?{provide:d0,useValue:n.cookieName}:[],n.headerName?{provide:f0,useValue:n.headerName}:[]]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({providers:[p0,{provide:SE,useExisting:p0,multi:!0},{provide:AE,useClass:Pk},{provide:d0,useValue:"XSRF-TOKEN"},{provide:f0,useValue:"X-XSRF-TOKEN"}]}),e})(),Ok=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({providers:[TE,{provide:yE,useClass:kk},IE,{provide:vE,useExisting:IE}],imports:[[Rk.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();const{isArray:Fk}=Array,{getPrototypeOf:Lk,prototype:zk,keys:Bk}=Object;function PE(e){if(1===e.length){const t=e[0];if(Fk(t))return{args:t,keys:null};if(function Nk(e){return e&&"object"==typeof e&&Lk(e)===zk}(t)){const n=Bk(t);return{args:n.map(i=>t[i]),keys:n}}}return{args:e,keys:null}}const{isArray:Vk}=Array;function m0(e){return Ot(t=>function Uk(e,t){return Vk(t)?e(...t):e(t)}(e,t))}function kE(e,t){return e.reduce((n,i,l)=>(n[i]=t[l],n),{})}let RE=(()=>{class e{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return e.\u0275fac=function(n){return new(n||e)(Ze(zc),Ze(ls))},e.\u0275dir=It({type:e}),e})(),_d=(()=>{class e extends RE{}return e.\u0275fac=function(){let t;return function(i){return(t||(t=zr(e)))(i||e)}}(),e.\u0275dir=It({type:e,features:[Ct]}),e})();const Nl=new Ft("NgValueAccessor");function GE(e){return null!=e}function HE(e){const t=gm(e)?qn(e):e;return Jv(t),t}function qE(e){let t={};return e.forEach(n=>{t=null!=n?Object.assign(Object.assign({},t),n):t}),0===Object.keys(t).length?null:t}function ZE(e,t){return t.map(n=>n(e))}function WE(e){return e.map(t=>function Wk(e){return!e.validate}(t)?t:n=>t.validate(n))}function _0(e){return null!=e?function XE(e){if(!e)return null;const t=e.filter(GE);return 0==t.length?null:function(n){return qE(ZE(n,t))}}(WE(e)):null}function y0(e){return null!=e?function KE(e){if(!e)return null;const t=e.filter(GE);return 0==t.length?null:function(n){return function jk(...e){const t=sn(e),{args:n,keys:i}=PE(e),l=new Dn(d=>{const{length:y}=n;if(!y)return void d.complete();const w=new Array(y);let T=y,k=y;for(let L=0;L<y;L++){let U=!1;z(n[L]).subscribe(tr(d,Y=>{U||(U=!0,k--),w[L]=Y},()=>T--,void 0,()=>{(!T||!U)&&(k||d.next(i?kE(i,w):w),d.complete())}))}});return t?l.pipe(m0(t)):l}(ZE(n,t).map(HE)).pipe(Ot(qE))}}(WE(e)):null}function v0(e){return e?Array.isArray(e)?e:[e]:[]}function ry(e,t){return Array.isArray(e)?e.includes(t):e===t}function eD(e,t){const n=v0(t);return v0(e).forEach(l=>{ry(n,l)||n.push(l)}),n}function tD(e,t){return v0(t).filter(n=>!ry(e,n))}class To extends class nD{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=_0(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=y0(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,n){return!!this.control&&this.control.hasError(t,n)}getError(t,n){return this.control?this.control.getError(t,n):null}}{get formDirective(){return null}get path(){return null}}let Lm=(()=>{class e extends class rD{constructor(t){this._cd=t}is(t){var n,i,l;return"submitted"===t?!!(null===(n=this._cd)||void 0===n?void 0:n.submitted):!!(null===(l=null===(i=this._cd)||void 0===i?void 0:i.control)||void 0===l?void 0:l[t])}}{constructor(n){super(n)}}return e.\u0275fac=function(n){return new(n||e)(Ze(To,10))},e.\u0275dir=It({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,i){2&n&&b_("ng-untouched",i.is("untouched"))("ng-touched",i.is("touched"))("ng-pristine",i.is("pristine"))("ng-dirty",i.is("dirty"))("ng-valid",i.is("valid"))("ng-invalid",i.is("invalid"))("ng-pending",i.is("pending"))("ng-submitted",i.is("submitted"))},features:[Ct]}),e})();function D0(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Bm="VALID",cy="INVALID",Kf="PENDING",Nm="DISABLED";function M0(e){return(uy(e)?e.validators:e)||null}function cD(e){return Array.isArray(e)?_0(e):e||null}function S0(e,t){return(uy(t)?t.asyncValidators:e)||null}function uD(e){return Array.isArray(e)?y0(e):e||null}function uy(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}const I0=e=>e instanceof P0,hy=e=>e instanceof dy,hD=e=>e instanceof mD;function dD(e){return I0(e)?e.value:e.getRawValue()}function fD(e,t){const n=hy(e),i=e.controls;if(!(n?Object.keys(i):i).length)throw new Tt(1e3,"");if(!i[t])throw new Tt(1001,"")}function pD(e,t){hy(e),e._forEachChild((i,l)=>{if(void 0===t[l])throw new Tt(1002,"")})}class A0{constructor(t,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=n,this._composedValidatorFn=cD(this._rawValidators),this._composedAsyncValidatorFn=uD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Bm}get invalid(){return this.status===cy}get pending(){return this.status==Kf}get disabled(){return this.status===Nm}get enabled(){return this.status!==Nm}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=cD(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=uD(t)}addValidators(t){this.setValidators(eD(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(eD(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(tD(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(tD(t,this._rawAsyncValidators))}hasValidator(t){return ry(this._rawValidators,t)}hasAsyncValidator(t){return ry(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Kf,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=Nm,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:n})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=Bm,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:n})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Bm||this.status===Kf)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Nm:Bm}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Kf,this._hasOwnPendingAsyncValidator=!0;const n=HE(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,n={}){this.errors=t,this._updateControlsErrors(!1!==n.emitEvent)}get(t){return function cR(e,t,n){if(null==t||(Array.isArray(t)||(t=t.split(n)),Array.isArray(t)&&0===t.length))return null;let i=e;return t.forEach(l=>{i=hy(i)?i.controls.hasOwnProperty(l)?i.controls[l]:null:hD(i)&&i.at(l)||null}),i}(this,t,".")}getError(t,n){const i=n?this.get(n):this;return i&&i.errors?i.errors[t]:null}hasError(t,n){return!!this.getError(t,n)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Rr,this.statusChanges=new Rr}_calculateStatus(){return this._allControlsDisabled()?Nm:this.errors?cy:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Kf)?Kf:this._anyControlsHaveStatus(cy)?cy:Bm}_anyControlsHaveStatus(t){return this._anyControls(n=>n.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){uy(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class P0 extends A0{constructor(t=null,n,i){super(M0(n),S0(i,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),uy(n)&&n.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(t)?t.value:t)}setValue(t,n={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(t,n={}){this.setValue(t,n)}reset(t=this.defaultValue,n={}){this._applyFormState(t),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){D0(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){D0(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class dy extends A0{constructor(t,n,i){super(M0(n),S0(i,n)),this.controls=t,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,n){return this.controls[t]?this.controls[t]:(this.controls[t]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(t,n,i={}){this.registerControl(t,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(t,n,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],n&&this.registerControl(t,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,n={}){pD(this,t),Object.keys(t).forEach(i=>{fD(this,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(t,n={}){null!=t&&(Object.keys(t).forEach(i=>{this.controls[i]&&this.controls[i].patchValue(t[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(t={},n={}){this._forEachChild((i,l)=>{i.reset(t[l],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(t,n,i)=>(t[i]=dD(n),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(n,i)=>!!i._syncPendingControls()||n);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(n=>{const i=this.controls[n];i&&t(i,n)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const n of Object.keys(this.controls)){const i=this.controls[n];if(this.contains(n)&&t(i))return!0}return!1}_reduceValue(){return this._reduceChildren({},(t,n,i)=>((n.enabled||this.disabled)&&(t[i]=n.value),t))}_reduceChildren(t,n){let i=t;return this._forEachChild((l,d)=>{i=n(i,l,d)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class mD extends A0{constructor(t,n,i){super(M0(n),S0(i,n)),this.controls=t,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[t]}push(t,n={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}insert(t,n,i={}){this.controls.splice(t,0,n),this._registerControl(n),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(t,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity({emitEvent:n.emitEvent})}setControl(t,n,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),n&&(this.controls.splice(t,0,n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,n={}){pD(this,t),t.forEach((i,l)=>{fD(this,l),this.at(l).setValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(t,n={}){null!=t&&(t.forEach((i,l)=>{this.at(l)&&this.at(l).patchValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(t=[],n={}){this._forEachChild((i,l)=>{i.reset(t[l],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this.controls.map(t=>dD(t))}clear(t={}){this.controls.length<1||(this._forEachChild(n=>n._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_syncPendingControls(){let t=this.controls.reduce((n,i)=>!!i._syncPendingControls()||n,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((n,i)=>{t(n,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(n=>n.enabled&&t(n))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}let Um=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=It({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})(),bD=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({}),e})();const R0=new Ft("NgModelWithFormControlWarning"),wR={provide:Nl,useExisting:In(()=>z0),multi:!0};function MD(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let z0=(()=>{class e extends _d{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;const l=MD(this._getOptionId(n),n);this.setProperty("value",l)}registerOnChange(n){this.onChange=i=>{this.value=this._getOptionValue(i),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i),n))return i;return null}_getOptionValue(n){const i=function CR(e){return e.split(":")[0]}(n);return this._optionMap.has(i)?this._optionMap.get(i):n}}return e.\u0275fac=function(){let t;return function(i){return(t||(t=zr(e)))(i||e)}}(),e.\u0275dir=It({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,i){1&n&&Co("change",function(d){return i.onChange(d.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[xr([wR]),Ct]}),e})(),fy=(()=>{class e{constructor(n,i,l){this._element=n,this._renderer=i,this._select=l,this._select&&(this.id=this._select._registerOption())}set ngValue(n){null!=this._select&&(this._select._optionMap.set(this.id,n),this._setElementValue(MD(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(n){return new(n||e)(Ze(ls),Ze(zc),Ze(z0,9))},e.\u0275dir=It({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})();const ER={provide:Nl,useExisting:In(()=>B0),multi:!0};function SD(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let B0=(()=>{class e extends _d{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){let i;if(this.value=n,Array.isArray(n)){const l=n.map(d=>this._getOptionId(d));i=(d,y)=>{d._setSelected(l.indexOf(y.toString())>-1)}}else i=(l,d)=>{l._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(n){this.onChange=i=>{const l=[],d=i.selectedOptions;if(void 0!==d){const y=d;for(let w=0;w<y.length;w++){const k=this._getOptionValue(y[w].value);l.push(k)}}else{const y=i.options;for(let w=0;w<y.length;w++){const T=y[w];if(T.selected){const k=this._getOptionValue(T.value);l.push(k)}}}this.value=l,n(l)}}_registerOption(n){const i=(this._idCounter++).toString();return this._optionMap.set(i,n),i}_getOptionId(n){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i)._value,n))return i;return null}_getOptionValue(n){const i=function DR(e){return e.split(":")[0]}(n);return this._optionMap.has(i)?this._optionMap.get(i)._value:n}}return e.\u0275fac=function(){let t;return function(i){return(t||(t=zr(e)))(i||e)}}(),e.\u0275dir=It({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,i){1&n&&Co("change",function(d){return i.onChange(d.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[xr([ER]),Ct]}),e})(),py=(()=>{class e{constructor(n,i,l){this._element=n,this._renderer=i,this._select=l,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){null!=this._select&&(this._value=n,this._setElementValue(SD(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(SD(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return e.\u0275fac=function(n){return new(n||e)(Ze(ls),Ze(zc),Ze(B0,9))},e.\u0275dir=It({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e})(),FR=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({imports:[[bD]]}),e})(),BD=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:R0,useValue:n.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({imports:[FR]}),e})(),zR=(()=>{class e{group(n,i=null){const l=this._reduceControls(n);let w,d=null,y=null;return null!=i&&(function LR(e){return void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn}(i)?(d=null!=i.validators?i.validators:null,y=null!=i.asyncValidators?i.asyncValidators:null,w=null!=i.updateOn?i.updateOn:void 0):(d=null!=i.validator?i.validator:null,y=null!=i.asyncValidator?i.asyncValidator:null)),new dy(l,{asyncValidators:y,updateOn:w,validators:d})}control(n,i,l){return new P0(n,i,l)}array(n,i,l){const d=n.map(y=>this._createControl(y));return new mD(d,i,l)}_reduceControls(n){const i={};return Object.keys(n).forEach(l=>{i[l]=this._createControl(n[l])}),i}_createControl(n){return I0(n)||hy(n)||hD(n)?n:Array.isArray(n)?this.control(n[0],n.length>1?n[1]:null,n.length>2?n[2]:null):this.control(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:BD}),e})();class Va extends br{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:i}=this;if(t)throw n;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function ND(e,t,n){e?ye(n,e,t):t()}function jm(e,t){const n=dn(e)?e:()=>e,i=l=>l.error(n());return new Dn(t?l=>t.schedule(i,0,l):i)}const my=Yu(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function $m(...e){return function VR(){return Le(1)}()(qn(e,rt(e)))}function gy(e){return new Dn(t=>{z(e()).subscribe(t)})}function VD(){return $n((e,t)=>{let n=null;e._refCount++;const i=tr(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const l=e._connection,d=n;n=null,l&&(!d||l===d)&&l.unsubscribe(),t.unsubscribe()});e.subscribe(i),i.closed||(n=e.connect())})}class UD extends Dn{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Qs(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new er;const n=this.getSubject();t.add(this.source.subscribe(tr(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=er.EMPTY)}return t}refCount(){return VD()(this)}}function Ua(e,t){return $n((n,i)=>{let l=null,d=0,y=!1;const w=()=>y&&!l&&i.complete();n.subscribe(tr(i,T=>{null==l||l.unsubscribe();let k=0;const L=d++;z(e(T,L)).subscribe(l=tr(i,U=>i.next(t?t(T,U,L,k++):U),()=>{l=null,w()}))},()=>{y=!0,w()}))})}function jR(e,t,n,i,l){return(d,y)=>{let w=n,T=t,k=0;d.subscribe(tr(y,L=>{const U=k++;T=w?e(T,L,U):(w=!0,L),i&&y.next(T)},l&&(()=>{w&&y.next(T),y.complete()})))}}function jD(e,t){return $n(jR(e,t,arguments.length>=2,!0))}function Wu(e){return $n((t,n)=>{let d,i=null,l=!1;i=t.subscribe(tr(n,void 0,void 0,y=>{d=z(e(y,Wu(e)(t))),i?(i.unsubscribe(),i=null,d.subscribe(n)):l=!0})),l&&(i.unsubscribe(),i=null,d.subscribe(n))})}function V0(e){return e<=0?()=>ut:$n((t,n)=>{let i=[];t.subscribe(tr(n,l=>{i.push(l),e<i.length&&i.shift()},()=>{for(const l of i)n.next(l);n.complete()},void 0,()=>{i=null}))})}function $D(e=$R){return $n((t,n)=>{let i=!1;t.subscribe(tr(n,l=>{i=!0,n.next(l)},()=>i?n.complete():n.error(e())))})}function $R(){return new my}function GD(e){return $n((t,n)=>{let i=!1;t.subscribe(tr(n,l=>{i=!0,n.next(l)},()=>{i||n.next(e),n.complete()}))})}function Yf(e,t){const n=arguments.length>=2;return i=>i.pipe(e?us((l,d)=>e(l,d,i)):Ni,Gn(1),n?GD(t):$D(()=>new my))}function jo(e,t,n){const i=dn(e)||t||n?{next:e,error:t,complete:n}:e;return i?$n((l,d)=>{var y;null===(y=i.subscribe)||void 0===y||y.call(i);let w=!0;l.subscribe(tr(d,T=>{var k;null===(k=i.next)||void 0===k||k.call(i,T),d.next(T)},()=>{var T;w=!1,null===(T=i.complete)||void 0===T||T.call(i),d.complete()},T=>{var k;w=!1,null===(k=i.error)||void 0===k||k.call(i,T),d.error(T)},()=>{var T,k;w&&(null===(T=i.unsubscribe)||void 0===T||T.call(i)),null===(k=i.finalize)||void 0===k||k.call(i)}))}):Ni}class $c{constructor(t,n){this.id=t,this.url=n}}class U0 extends $c{constructor(t,n,i="imperative",l=null){super(t,n),this.navigationTrigger=i,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Gm extends $c{constructor(t,n,i){super(t,n),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class HD extends $c{constructor(t,n,i){super(t,n),this.reason=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class qR extends $c{constructor(t,n,i){super(t,n),this.error=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ZR extends $c{constructor(t,n,i,l){super(t,n),this.urlAfterRedirects=i,this.state=l}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class WR extends $c{constructor(t,n,i,l){super(t,n),this.urlAfterRedirects=i,this.state=l}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class XR extends $c{constructor(t,n,i,l,d){super(t,n),this.urlAfterRedirects=i,this.state=l,this.shouldActivate=d}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class KR extends $c{constructor(t,n,i,l){super(t,n),this.urlAfterRedirects=i,this.state=l}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class YR extends $c{constructor(t,n,i,l){super(t,n),this.urlAfterRedirects=i,this.state=l}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qD{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ZD{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class JR{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class QR{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eO{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tO{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class WD{constructor(t,n,i){this.routerEvent=t,this.position=n,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const mn="primary";class nO{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Jf(e){return new nO(e)}const XD="ngNavigationCancelingError";function j0(e){const t=Error("NavigationCancelingError: "+e);return t[XD]=!0,t}function iO(e,t,n){const i=n.path.split("/");if(i.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;const l={};for(let d=0;d<i.length;d++){const y=i[d],w=e[d];if(y.startsWith(":"))l[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:e.slice(0,i.length),posParams:l}}function Vl(e,t){const n=e?Object.keys(e):void 0,i=t?Object.keys(t):void 0;if(!n||!i||n.length!=i.length)return!1;let l;for(let d=0;d<n.length;d++)if(l=n[d],!KD(e[l],t[l]))return!1;return!0}function KD(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),i=[...t].sort();return n.every((l,d)=>i[d]===l)}return e===t}function YD(e){return Array.prototype.concat.apply([],e)}function JD(e){return e.length>0?e[e.length-1]:null}function Bi(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Ul(e){return Jv(e)?e:gm(e)?qn(Promise.resolve(e)):Zt(e)}const aO={exact:function tT(e,t,n){if(!xd(e.segments,t.segments)||!_y(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!e.children[i]||!tT(e.children[i],t.children[i],n))return!1;return!0},subset:nT},QD={exact:function lO(e,t){return Vl(e,t)},subset:function cO(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>KD(e[n],t[n]))},ignored:()=>!0};function eT(e,t,n){return aO[n.paths](e.root,t.root,n.matrixParams)&&QD[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function nT(e,t,n){return rT(e,t,t.segments,n)}function rT(e,t,n,i){if(e.segments.length>n.length){const l=e.segments.slice(0,n.length);return!(!xd(l,n)||t.hasChildren()||!_y(l,n,i))}if(e.segments.length===n.length){if(!xd(e.segments,n)||!_y(e.segments,n,i))return!1;for(const l in t.children)if(!e.children[l]||!nT(e.children[l],t.children[l],i))return!1;return!0}{const l=n.slice(0,e.segments.length),d=n.slice(e.segments.length);return!!(xd(e.segments,l)&&_y(e.segments,l,i)&&e.children[mn])&&rT(e.children[mn],t,d,i)}}function _y(e,t,n){return t.every((i,l)=>QD[n](e[l].parameters,i.parameters))}class vd{constructor(t,n,i){this.root=t,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Jf(this.queryParams)),this._queryParamMap}toString(){return dO.serialize(this)}}class yn{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Bi(n,(i,l)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return yy(this)}}class Hm{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Jf(this.parameters)),this._parameterMap}toString(){return lT(this)}}function xd(e,t){return e.length===t.length&&e.every((n,i)=>n.path===t[i].path)}class iT{}class oT{parse(t){const n=new bO(t);return new vd(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${qm(t.root,!0)}`,i=function mO(e){const t=Object.keys(e).map(n=>{const i=e[n];return Array.isArray(i)?i.map(l=>`${vy(n)}=${vy(l)}`).join("&"):`${vy(n)}=${vy(i)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${i}${"string"==typeof t.fragment?`#${function fO(e){return encodeURI(e)}(t.fragment)}`:""}`}}const dO=new oT;function yy(e){return e.segments.map(t=>lT(t)).join("/")}function qm(e,t){if(!e.hasChildren())return yy(e);if(t){const n=e.children[mn]?qm(e.children[mn],!1):"",i=[];return Bi(e.children,(l,d)=>{d!==mn&&i.push(`${d}:${qm(l,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function hO(e,t){let n=[];return Bi(e.children,(i,l)=>{l===mn&&(n=n.concat(t(i,l)))}),Bi(e.children,(i,l)=>{l!==mn&&(n=n.concat(t(i,l)))}),n}(e,(i,l)=>l===mn?[qm(e.children[mn],!1)]:[`${l}:${qm(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[mn]?`${yy(e)}/${n[0]}`:`${yy(e)}/(${n.join("//")})`}}function sT(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function vy(e){return sT(e).replace(/%3B/gi,";")}function $0(e){return sT(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function xy(e){return decodeURIComponent(e)}function aT(e){return xy(e.replace(/\+/g,"%20"))}function lT(e){return`${$0(e.path)}${function pO(e){return Object.keys(e).map(t=>`;${$0(t)}=${$0(e[t])}`).join("")}(e.parameters)}`}const gO=/^[^\/()?;=#]+/;function by(e){const t=e.match(gO);return t?t[0]:""}const _O=/^[^=?&#]+/,vO=/^[^&#]+/;class bO{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new yn([],{}):new yn([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(i[mn]=new yn(t,n)),i}parseSegment(){const t=by(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new Hm(xy(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=by(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const l=by(this.remaining);l&&(i=l,this.capture(i))}t[xy(n)]=xy(i)}parseQueryParam(t){const n=function yO(e){const t=e.match(_O);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const y=function xO(e){const t=e.match(vO);return t?t[0]:""}(this.remaining);y&&(i=y,this.capture(i))}const l=aT(n),d=aT(i);if(t.hasOwnProperty(l)){let y=t[l];Array.isArray(y)||(y=[y],t[l]=y),y.push(d)}else t[l]=d}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=by(this.remaining),l=this.remaining[i.length];if("/"!==l&&")"!==l&&";"!==l)throw new Error(`Cannot parse url '${this.url}'`);let d;i.indexOf(":")>-1?(d=i.substr(0,i.indexOf(":")),this.capture(d),this.capture(":")):t&&(d=mn);const y=this.parseChildren();n[d]=1===Object.keys(y).length?y[mn]:new yn([],y),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class cT{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=G0(t,this._root);return n?n.children.map(i=>i.value):[]}firstChild(t){const n=G0(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=H0(t,this._root);return n.length<2?[]:n[n.length-2].children.map(l=>l.value).filter(l=>l!==t)}pathFromRoot(t){return H0(t,this._root).map(n=>n.value)}}function G0(e,t){if(e===t.value)return t;for(const n of t.children){const i=G0(e,n);if(i)return i}return null}function H0(e,t){if(e===t.value)return[t];for(const n of t.children){const i=H0(e,n);if(i.length)return i.unshift(t),i}return[]}class Gc{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Qf(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class uT extends cT{constructor(t,n){super(t),this.snapshot=n,q0(this,t)}toString(){return this.snapshot.toString()}}function hT(e,t){const n=function wO(e,t){const y=new wy([],{},{},"",{},mn,t,null,e.root,-1,{});return new fT("",new Gc(y,[]))}(e,t),i=new Va([new Hm("",{})]),l=new Va({}),d=new Va({}),y=new Va({}),w=new Va(""),T=new ep(i,l,y,w,d,mn,t,n.root);return T.snapshot=n.root,new uT(new Gc(T,[]),n)}class ep{constructor(t,n,i,l,d,y,w,T){this.url=t,this.params=n,this.queryParams=i,this.fragment=l,this.data=d,this.outlet=y,this.component=w,this._futureSnapshot=T}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Ot(t=>Jf(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Ot(t=>Jf(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function dT(e,t="emptyOnly"){const n=e.pathFromRoot;let i=0;if("always"!==t)for(i=n.length-1;i>=1;){const l=n[i],d=n[i-1];if(l.routeConfig&&""===l.routeConfig.path)i--;else{if(d.component)break;i--}}return function CO(e){return e.reduce((t,n)=>({params:Object.assign(Object.assign({},t.params),n.params),data:Object.assign(Object.assign({},t.data),n.data),resolve:Object.assign(Object.assign({},t.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(i))}class wy{constructor(t,n,i,l,d,y,w,T,k,L,U){this.url=t,this.params=n,this.queryParams=i,this.fragment=l,this.data=d,this.outlet=y,this.component=w,this.routeConfig=T,this._urlSegment=k,this._lastPathIndex=L,this._resolve=U}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Jf(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Jf(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class fT extends cT{constructor(t,n){super(n),this.url=t,q0(this,n)}toString(){return pT(this._root)}}function q0(e,t){t.value._routerState=e,t.children.forEach(n=>q0(e,n))}function pT(e){const t=e.children.length>0?` { ${e.children.map(pT).join(", ")} } `:"";return`${e.value}${t}`}function Z0(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Vl(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Vl(t.params,n.params)||e.params.next(n.params),function oO(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Vl(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Vl(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function W0(e,t){const n=Vl(e.params,t.params)&&function uO(e,t){return xd(e,t)&&e.every((n,i)=>Vl(n.parameters,t[i].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||W0(e.parent,t.parent))}function Zm(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=t.value;const l=function DO(e,t,n){return t.children.map(i=>{for(const l of n.children)if(e.shouldReuseRoute(i.value,l.value.snapshot))return Zm(e,i,l);return Zm(e,i)})}(e,t,n);return new Gc(i,l)}{if(e.shouldAttach(t.value)){const d=e.retrieve(t.value);if(null!==d){const y=d.route;return y.value._futureSnapshot=t.value,y.children=t.children.map(w=>Zm(e,w)),y}}const i=function TO(e){return new ep(new Va(e.url),new Va(e.params),new Va(e.queryParams),new Va(e.fragment),new Va(e.data),e.outlet,e.component,e)}(t.value),l=t.children.map(d=>Zm(e,d));return new Gc(i,l)}}function Cy(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Wm(e){return"object"==typeof e&&null!=e&&e.outlets}function X0(e,t,n,i,l){let d={};if(i&&Bi(i,(w,T)=>{d[T]=Array.isArray(w)?w.map(k=>`${k}`):`${w}`}),e===t)return new vd(n,d,l);const y=mT(e,t,n);return new vd(y,d,l)}function mT(e,t,n){const i={};return Bi(e.children,(l,d)=>{i[d]=l===t?n:mT(l,t,n)}),new yn(e.segments,i)}class gT{constructor(t,n,i){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=i,t&&i.length>0&&Cy(i[0]))throw new Error("Root segment cannot have matrix parameters");const l=i.find(Wm);if(l&&l!==JD(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class K0{constructor(t,n,i){this.segmentGroup=t,this.processChildren=n,this.index=i}}function _T(e,t,n){if(e||(e=new yn([],{})),0===e.segments.length&&e.hasChildren())return Ey(e,t,n);const i=function kO(e,t,n){let i=0,l=t;const d={match:!1,pathIndex:0,commandIndex:0};for(;l<e.segments.length;){if(i>=n.length)return d;const y=e.segments[l],w=n[i];if(Wm(w))break;const T=`${w}`,k=i<n.length-1?n[i+1]:null;if(l>0&&void 0===T)break;if(T&&k&&"object"==typeof k&&void 0===k.outlets){if(!vT(T,k,y))return d;i+=2}else{if(!vT(T,{},y))return d;i++}l++}return{match:!0,pathIndex:l,commandIndex:i}}(e,t,n),l=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const d=new yn(e.segments.slice(0,i.pathIndex),{});return d.children[mn]=new yn(e.segments.slice(i.pathIndex),e.children),Ey(d,0,l)}return i.match&&0===l.length?new yn(e.segments,{}):i.match&&!e.hasChildren()?Y0(e,t,n):i.match?Ey(e,0,l):Y0(e,t,n)}function Ey(e,t,n){if(0===n.length)return new yn(e.segments,{});{const i=function PO(e){return Wm(e[0])?e[0].outlets:{[mn]:e}}(n),l={};return Bi(i,(d,y)=>{"string"==typeof d&&(d=[d]),null!==d&&(l[y]=_T(e.children[y],t,d))}),Bi(e.children,(d,y)=>{void 0===i[y]&&(l[y]=d)}),new yn(e.segments,l)}}function Y0(e,t,n){const i=e.segments.slice(0,t);let l=0;for(;l<n.length;){const d=n[l];if(Wm(d)){const T=RO(d.outlets);return new yn(i,T)}if(0===l&&Cy(n[0])){i.push(new Hm(e.segments[t].path,yT(n[0]))),l++;continue}const y=Wm(d)?d.outlets[mn]:`${d}`,w=l<n.length-1?n[l+1]:null;y&&w&&Cy(w)?(i.push(new Hm(y,yT(w))),l+=2):(i.push(new Hm(y,{})),l++)}return new yn(i,{})}function RO(e){const t={};return Bi(e,(n,i)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[i]=Y0(new yn([],{}),0,n))}),t}function yT(e){const t={};return Bi(e,(n,i)=>t[i]=`${n}`),t}function vT(e,t,n){return e==n.path&&Vl(t,n.parameters)}class FO{constructor(t,n,i,l){this.routeReuseStrategy=t,this.futureState=n,this.currState=i,this.forwardEvent=l}activate(t){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,t),Z0(this.futureState.root),this.activateChildRoutes(n,i,t)}deactivateChildRoutes(t,n,i){const l=Qf(n);t.children.forEach(d=>{const y=d.value.outlet;this.deactivateRoutes(d,l[y],i),delete l[y]}),Bi(l,(d,y)=>{this.deactivateRouteAndItsChildren(d,i)})}deactivateRoutes(t,n,i){const l=t.value,d=n?n.value:null;if(l===d)if(l.component){const y=i.getContext(l.outlet);y&&this.deactivateChildRoutes(t,n,y.children)}else this.deactivateChildRoutes(t,n,i);else d&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const i=n.getContext(t.value.outlet),l=i&&t.value.component?i.children:n,d=Qf(t);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],l);if(i&&i.outlet){const y=i.outlet.detach(),w=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:y,route:t,contexts:w})}}deactivateRouteAndOutlet(t,n){const i=n.getContext(t.value.outlet),l=i&&t.value.component?i.children:n,d=Qf(t);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],l);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,n,i){const l=Qf(n);t.children.forEach(d=>{this.activateRoutes(d,l[d.value.outlet],i),this.forwardEvent(new tO(d.value.snapshot))}),t.children.length&&this.forwardEvent(new QR(t.value.snapshot))}activateRoutes(t,n,i){const l=t.value,d=n?n.value:null;if(Z0(l),l===d)if(l.component){const y=i.getOrCreateContext(l.outlet);this.activateChildRoutes(t,n,y.children)}else this.activateChildRoutes(t,n,i);else if(l.component){const y=i.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const w=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),Z0(w.route.value),this.activateChildRoutes(t,null,y.children)}else{const w=function LO(e){for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(l.snapshot),T=w?w.module.componentFactoryResolver:null;y.attachRef=null,y.route=l,y.resolver=T,y.outlet&&y.outlet.activateWith(l,T),this.activateChildRoutes(t,null,y.children)}}else this.activateChildRoutes(t,null,i)}}class J0{constructor(t,n){this.routes=t,this.module=n}}function Xu(e){return"function"==typeof e}function bd(e){return e instanceof vd}const Xm=Symbol("INITIAL_VALUE");function Km(){return Ua(e=>function BR(...e){const t=rt(e),n=sn(e),{args:i,keys:l}=PE(e);if(0===i.length)return qn([],t);const d=new Dn(function NR(e,t,n=Ni){return i=>{ND(t,()=>{const{length:l}=e,d=new Array(l);let y=l,w=l;for(let T=0;T<l;T++)ND(t,()=>{const k=qn(e[T],t);let L=!1;k.subscribe(tr(i,U=>{d[T]=U,L||(L=!0,w--),w||i.next(n(d.slice()))},()=>{--y||i.complete()}))},i)},i)}}(i,t,l?y=>kE(l,y):Ni));return n?d.pipe(m0(n)):d}(e.map(t=>t.pipe(Gn(1),function UR(...e){const t=rt(e);return $n((n,i)=>{(t?$m(e,n,t):$m(e,n)).subscribe(i)})}(Xm)))).pipe(jD((t,n)=>{let i=!1;return n.reduce((l,d,y)=>l!==Xm?l:(d===Xm&&(i=!0),i||!1!==d&&y!==n.length-1&&!bd(d)?l:d),t)},Xm),us(t=>t!==Xm),Ot(t=>bd(t)?t:!0===t),Gn(1)))}class jO{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Ym,this.attachRef=null}}class Ym{constructor(){this.contexts=new Map}onChildOutletCreated(t,n){const i=this.getOrCreateContext(t);i.outlet=n,this.contexts.set(t,i)}onChildOutletDestroyed(t){const n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new jO,this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}}let Q0=(()=>{class e{constructor(n,i,l,d,y){this.parentContexts=n,this.location=i,this.resolver=l,this.changeDetector=y,this.activated=null,this._activatedRoute=null,this.activateEvents=new Rr,this.deactivateEvents=new Rr,this.attachEvents=new Rr,this.detachEvents=new Rr,this.name=d||mn,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const y=(i=i||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),w=this.parentContexts.getOrCreateContext(this.name).children,T=new $O(n,w,this.location.injector);this.activated=this.location.createComponent(y,this.location.length,T),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(Ze(Ym),Ze(za),Ze(wm),mu("name"),Ze(z_))},e.\u0275dir=It({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),e})();class $O{constructor(t,n,i){this.route=t,this.childContexts=n,this.parent=i}get(t,n){return t===ep?this.route:t===Ym?this.childContexts:this.parent.get(t,n)}}let xT=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,i){1&n&&Je(0,"router-outlet")},directives:[Q0],encapsulation:2}),e})();function bT(e,t=""){for(let n=0;n<e.length;n++){const i=e[n];GO(i,HO(t,i))}}function GO(e,t){e.children&&bT(e.children,t)}function HO(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function e1(e){const t=e.children&&e.children.map(e1),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==mn&&(n.component=xT),n}function Ys(e){return e.outlet||mn}function wT(e,t){const n=e.filter(i=>Ys(i)===t);return n.push(...e.filter(i=>Ys(i)!==t)),n}const CT={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Dy(e,t,n){var i;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},CT):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const d=(t.matcher||iO)(n,e,t);if(!d)return Object.assign({},CT);const y={};Bi(d.posParams,(T,k)=>{y[k]=T.path});const w=d.consumed.length>0?Object.assign(Object.assign({},y),d.consumed[d.consumed.length-1].parameters):y;return{matched:!0,consumedSegments:d.consumed,remainingSegments:n.slice(d.consumed.length),parameters:w,positionalParamSegments:null!==(i=d.posParams)&&void 0!==i?i:{}}}function Ty(e,t,n,i,l="corrected"){if(n.length>0&&function WO(e,t,n){return n.some(i=>My(e,t,i)&&Ys(i)!==mn)}(e,n,i)){const y=new yn(t,function ZO(e,t,n,i){const l={};l[mn]=i,i._sourceSegment=e,i._segmentIndexShift=t.length;for(const d of n)if(""===d.path&&Ys(d)!==mn){const y=new yn([],{});y._sourceSegment=e,y._segmentIndexShift=t.length,l[Ys(d)]=y}return l}(e,t,i,new yn(n,e.children)));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:[]}}if(0===n.length&&function XO(e,t,n){return n.some(i=>My(e,t,i))}(e,n,i)){const y=new yn(e.segments,function qO(e,t,n,i,l,d){const y={};for(const w of i)if(My(e,n,w)&&!l[Ys(w)]){const T=new yn([],{});T._sourceSegment=e,T._segmentIndexShift="legacy"===d?e.segments.length:t.length,y[Ys(w)]=T}return Object.assign(Object.assign({},l),y)}(e,t,n,i,e.children,l));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:n}}const d=new yn(e.segments,e.children);return d._sourceSegment=e,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:n}}function My(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function ET(e,t,n,i){return!!(Ys(e)===i||i!==mn&&My(t,n,e))&&("**"===e.path||Dy(t,e,n).matched)}function DT(e,t,n){return 0===t.length&&!e.children[n]}class Sy{constructor(t){this.segmentGroup=t||null}}class TT{constructor(t){this.urlTree=t}}function Jm(e){return jm(new Sy(e))}function MT(e){return jm(new TT(e))}class QO{constructor(t,n,i,l,d){this.configLoader=n,this.urlSerializer=i,this.urlTree=l,this.config=d,this.allowRedirects=!0,this.ngModule=t.get(Bc)}apply(){const t=Ty(this.urlTree.root,[],[],this.config).segmentGroup,n=new yn(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,n,mn).pipe(Ot(d=>this.createUrlTree(t1(d),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Wu(d=>{if(d instanceof TT)return this.allowRedirects=!1,this.match(d.urlTree);throw d instanceof Sy?this.noMatchError(d):d}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,mn).pipe(Ot(l=>this.createUrlTree(t1(l),t.queryParams,t.fragment))).pipe(Wu(l=>{throw l instanceof Sy?this.noMatchError(l):l}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,n,i){const l=t.segments.length>0?new yn([],{[mn]:t}):t;return new vd(l,n,i)}expandSegmentGroup(t,n,i,l){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,n,i).pipe(Ot(d=>new yn([],d))):this.expandSegment(t,i,n,i.segments,l,!0)}expandChildren(t,n,i){const l=[];for(const d of Object.keys(i.children))"primary"===d?l.unshift(d):l.push(d);return qn(l).pipe(Xf(d=>{const y=i.children[d],w=wT(n,d);return this.expandSegmentGroup(t,w,y,d).pipe(Ot(T=>({segment:T,outlet:d})))}),jD((d,y)=>(d[y.outlet]=y.segment,d),{}),function GR(e,t){const n=arguments.length>=2;return i=>i.pipe(e?us((l,d)=>e(l,d,i)):Ni,V0(1),n?GD(t):$D(()=>new my))}())}expandSegment(t,n,i,l,d,y){return qn(i).pipe(Xf(w=>this.expandSegmentAgainstRoute(t,n,i,w,l,d,y).pipe(Wu(k=>{if(k instanceof Sy)return Zt(null);throw k}))),Yf(w=>!!w),Wu((w,T)=>{if(w instanceof my||"EmptyError"===w.name)return DT(n,l,d)?Zt(new yn([],{})):Jm(n);throw w}))}expandSegmentAgainstRoute(t,n,i,l,d,y,w){return ET(l,n,d,y)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(t,n,l,d,y):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,i,l,d,y):Jm(n):Jm(n)}expandSegmentAgainstRouteUsingRedirect(t,n,i,l,d,y){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,l,y):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,l,d,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,i,l){const d=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?MT(d):this.lineralizeSegments(i,d).pipe(Ue(y=>{const w=new yn(y,{});return this.expandSegment(t,w,n,y,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,l,d,y){const{matched:w,consumedSegments:T,remainingSegments:k,positionalParamSegments:L}=Dy(n,l,d);if(!w)return Jm(n);const U=this.applyRedirectCommands(T,l.redirectTo,L);return l.redirectTo.startsWith("/")?MT(U):this.lineralizeSegments(l,U).pipe(Ue(Y=>this.expandSegment(t,n,i,Y.concat(k),y,!1)))}matchSegmentAgainstRoute(t,n,i,l,d){if("**"===i.path)return i.loadChildren?(i._loadedConfig?Zt(i._loadedConfig):this.configLoader.load(t.injector,i)).pipe(Ot(U=>(i._loadedConfig=U,new yn(l,{})))):Zt(new yn(l,{}));const{matched:y,consumedSegments:w,remainingSegments:T}=Dy(n,i,l);return y?this.getChildConfig(t,i,l).pipe(Ue(L=>{const U=L.module,Y=L.routes,{segmentGroup:ie,slicedSegments:ve}=Ty(n,w,T,Y),Fe=new yn(ie.segments,ie.children);if(0===ve.length&&Fe.hasChildren())return this.expandChildren(U,Y,Fe).pipe(Ot(wt=>new yn(w,wt)));if(0===Y.length&&0===ve.length)return Zt(new yn(w,{}));const Ke=Ys(i)===d;return this.expandSegment(U,Fe,Y,ve,Ke?mn:d,!0).pipe(Ot(Pe=>new yn(w.concat(Pe.segments),Pe.children)))})):Jm(n)}getChildConfig(t,n,i){return n.children?Zt(new J0(n.children,t)):n.loadChildren?void 0!==n._loadedConfig?Zt(n._loadedConfig):this.runCanLoadGuards(t.injector,n,i).pipe(Ue(l=>l?this.configLoader.load(t.injector,n).pipe(Ot(d=>(n._loadedConfig=d,d))):function YO(e){return jm(j0(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`))}(n))):Zt(new J0([],t))}runCanLoadGuards(t,n,i){const l=n.canLoad;return l&&0!==l.length?Zt(l.map(y=>{const w=t.get(y);let T;if(function BO(e){return e&&Xu(e.canLoad)}(w))T=w.canLoad(n,i);else{if(!Xu(w))throw new Error("Invalid CanLoad guard");T=w(n,i)}return Ul(T)})).pipe(Km(),jo(y=>{if(!bd(y))return;const w=j0(`Redirecting to "${this.urlSerializer.serialize(y)}"`);throw w.url=y,w}),Ot(y=>!0===y)):Zt(!0)}lineralizeSegments(t,n){let i=[],l=n.root;for(;;){if(i=i.concat(l.segments),0===l.numberOfChildren)return Zt(i);if(l.numberOfChildren>1||!l.children[mn])return jm(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t.redirectTo}'`));l=l.children[mn]}}applyRedirectCommands(t,n,i){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),t,i)}applyRedirectCreatreUrlTree(t,n,i,l){const d=this.createSegmentGroup(t,n.root,i,l);return new vd(d,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const i={};return Bi(t,(l,d)=>{if("string"==typeof l&&l.startsWith(":")){const w=l.substring(1);i[d]=n[w]}else i[d]=l}),i}createSegmentGroup(t,n,i,l){const d=this.createSegments(t,n.segments,i,l);let y={};return Bi(n.children,(w,T)=>{y[T]=this.createSegmentGroup(t,w,i,l)}),new yn(d,y)}createSegments(t,n,i,l){return n.map(d=>d.path.startsWith(":")?this.findPosParam(t,d,l):this.findOrReturn(d,i))}findPosParam(t,n,i){const l=i[n.path.substring(1)];if(!l)throw new Error(`Cannot redirect to '${t}'. Cannot find '${n.path}'.`);return l}findOrReturn(t,n){let i=0;for(const l of n){if(l.path===t.path)return n.splice(i),l;i++}return t}}function t1(e){const t={};for(const i of Object.keys(e.children)){const d=t1(e.children[i]);(d.segments.length>0||d.hasChildren())&&(t[i]=d)}return function eF(e){if(1===e.numberOfChildren&&e.children[mn]){const t=e.children[mn];return new yn(e.segments.concat(t.segments),t.children)}return e}(new yn(e.segments,t))}class ST{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Iy{constructor(t,n){this.component=t,this.route=n}}function nF(e,t,n){const i=e._root;return Qm(i,t?t._root:null,n,[i.value])}function Ay(e,t,n){const i=function iF(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(i?i.module.injector:n).get(e)}function Qm(e,t,n,i,l={canDeactivateChecks:[],canActivateChecks:[]}){const d=Qf(t);return e.children.forEach(y=>{(function oF(e,t,n,i,l={canDeactivateChecks:[],canActivateChecks:[]}){const d=e.value,y=t?t.value:null,w=n?n.getContext(e.value.outlet):null;if(y&&d.routeConfig===y.routeConfig){const T=function sF(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!xd(e.url,t.url);case"pathParamsOrQueryParamsChange":return!xd(e.url,t.url)||!Vl(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!W0(e,t)||!Vl(e.queryParams,t.queryParams);default:return!W0(e,t)}}(y,d,d.routeConfig.runGuardsAndResolvers);T?l.canActivateChecks.push(new ST(i)):(d.data=y.data,d._resolvedData=y._resolvedData),Qm(e,t,d.component?w?w.children:null:n,i,l),T&&w&&w.outlet&&w.outlet.isActivated&&l.canDeactivateChecks.push(new Iy(w.outlet.component,y))}else y&&eg(t,w,l),l.canActivateChecks.push(new ST(i)),Qm(e,null,d.component?w?w.children:null:n,i,l)})(y,d[y.value.outlet],n,i.concat([y.value]),l),delete d[y.value.outlet]}),Bi(d,(y,w)=>eg(y,n.getContext(w),l)),l}function eg(e,t,n){const i=Qf(e),l=e.value;Bi(i,(d,y)=>{eg(d,l.component?t?t.children.getContext(y):null:t,n)}),n.canDeactivateChecks.push(new Iy(l.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,l))}class mF{}function IT(e){return new Dn(t=>t.error(e))}class _F{constructor(t,n,i,l,d,y){this.rootComponentType=t,this.config=n,this.urlTree=i,this.url=l,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=y}recognize(){const t=Ty(this.urlTree.root,[],[],this.config.filter(y=>void 0===y.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,t,mn);if(null===n)return null;const i=new wy([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},mn,this.rootComponentType,null,this.urlTree.root,-1,{}),l=new Gc(i,n),d=new fT(this.url,l);return this.inheritParamsAndData(d._root),d}inheritParamsAndData(t){const n=t.value,i=dT(n,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),t.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(t,n,i){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,n):this.processSegment(t,n,n.segments,i)}processChildren(t,n){const i=[];for(const d of Object.keys(n.children)){const y=n.children[d],w=wT(t,d),T=this.processSegmentGroup(w,y,d);if(null===T)return null;i.push(...T)}const l=AT(i);return function yF(e){e.sort((t,n)=>t.value.outlet===mn?-1:n.value.outlet===mn?1:t.value.outlet.localeCompare(n.value.outlet))}(l),l}processSegment(t,n,i,l){for(const d of t){const y=this.processSegmentAgainstRoute(d,n,i,l);if(null!==y)return y}return DT(n,i,l)?[]:null}processSegmentAgainstRoute(t,n,i,l){if(t.redirectTo||!ET(t,n,i,l))return null;let d,y=[],w=[];if("**"===t.path){const ie=i.length>0?JD(i).parameters:{};d=new wy(i,ie,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,RT(t),Ys(t),t.component,t,PT(n),kT(n)+i.length,OT(t))}else{const ie=Dy(n,t,i);if(!ie.matched)return null;y=ie.consumedSegments,w=ie.remainingSegments,d=new wy(y,ie.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,RT(t),Ys(t),t.component,t,PT(n),kT(n)+y.length,OT(t))}const T=function vF(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(t),{segmentGroup:k,slicedSegments:L}=Ty(n,y,w,T.filter(ie=>void 0===ie.redirectTo),this.relativeLinkResolution);if(0===L.length&&k.hasChildren()){const ie=this.processChildren(T,k);return null===ie?null:[new Gc(d,ie)]}if(0===T.length&&0===L.length)return[new Gc(d,[])];const U=Ys(t)===l,Y=this.processSegment(T,k,L,U?mn:l);return null===Y?null:[new Gc(d,Y)]}}function xF(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function AT(e){const t=[],n=new Set;for(const i of e){if(!xF(i)){t.push(i);continue}const l=t.find(d=>i.value.routeConfig===d.value.routeConfig);void 0!==l?(l.children.push(...i.children),n.add(l)):t.push(i)}for(const i of n){const l=AT(i.children);t.push(new Gc(i.value,l))}return t.filter(i=>!n.has(i))}function PT(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function kT(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function RT(e){return e.data||{}}function OT(e){return e.resolve||{}}function FT(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function n1(e){return Ua(t=>{const n=e(t);return n?qn(n).pipe(Ot(()=>t)):Zt(t)})}class SF extends class MF{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const r1=new Ft("ROUTES");class LT{constructor(t,n,i,l){this.injector=t,this.compiler=n,this.onLoadStartListener=i,this.onLoadEndListener=l}load(t,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const l=this.loadModuleFactory(n.loadChildren).pipe(Ot(d=>{this.onLoadEndListener&&this.onLoadEndListener(n);const y=d.create(t);return new J0(YD(y.injector.get(r1,void 0,St.Self|St.Optional)).map(e1),y)}),Wu(d=>{throw n._loader$=void 0,d}));return n._loader$=new UD(l,()=>new br).pipe(VD()),n._loader$}loadModuleFactory(t){return Ul(t()).pipe(Ue(n=>n instanceof Pw?Zt(n):qn(this.compiler.compileModuleAsync(n))))}}class AF{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function PF(e){throw e}function kF(e,t,n){return t.parse("/")}function zT(e,t){return Zt(null)}const RF={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},OF={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let hs=(()=>{class e{constructor(n,i,l,d,y,w,T){this.rootComponentType=n,this.urlSerializer=i,this.rootContexts=l,this.location=d,this.config=T,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new br,this.errorHandler=PF,this.malformedUriErrorHandler=kF,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:zT,afterPreactivation:zT},this.urlHandlingStrategy=new AF,this.routeReuseStrategy=new SF,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=y.get(Bc),this.console=y.get(TA);const U=y.get(Ei);this.isNgZoneEnabled=U instanceof Ei&&Ei.isInAngularZone(),this.resetConfig(T),this.currentUrlTree=function sO(){return new vd(new yn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new LT(y,w,Y=>this.triggerEvent(new qD(Y)),Y=>this.triggerEvent(new ZD(Y))),this.routerState=hT(this.currentUrlTree,this.rootComponentType),this.transitions=new Va({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const i=this.events;return n.pipe(us(l=>0!==l.id),Ot(l=>Object.assign(Object.assign({},l),{extractedUrl:this.urlHandlingStrategy.extract(l.rawUrl)})),Ua(l=>{let d=!1,y=!1;return Zt(l).pipe(jo(w=>{this.currentNavigation={id:w.id,initialUrl:w.currentRawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Ua(w=>{const T=this.browserUrlTree.toString(),k=!this.navigated||w.extractedUrl.toString()!==T||T!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||k)&&this.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return BT(w.source)&&(this.browserUrlTree=w.extractedUrl),Zt(w).pipe(Ua(U=>{const Y=this.transitions.getValue();return i.next(new U0(U.id,this.serializeUrl(U.extractedUrl),U.source,U.restoredState)),Y!==this.transitions.getValue()?ut:Promise.resolve(U)}),function tF(e,t,n,i){return Ua(l=>function JO(e,t,n,i,l){return new QO(e,t,n,i,l).apply()}(e,t,n,l.extractedUrl,i).pipe(Ot(d=>Object.assign(Object.assign({},l),{urlAfterRedirects:d}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),jo(U=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:U.urlAfterRedirects})}),function bF(e,t,n,i,l){return Ue(d=>function gF(e,t,n,i,l="emptyOnly",d="legacy"){try{const y=new _F(e,t,n,i,l,d).recognize();return null===y?IT(new mF):Zt(y)}catch(y){return IT(y)}}(e,t,d.urlAfterRedirects,n(d.urlAfterRedirects),i,l).pipe(Ot(y=>Object.assign(Object.assign({},d),{targetSnapshot:y}))))}(this.rootComponentType,this.config,U=>this.serializeUrl(U),this.paramsInheritanceStrategy,this.relativeLinkResolution),jo(U=>{if("eager"===this.urlUpdateStrategy){if(!U.extras.skipLocationChange){const ie=this.urlHandlingStrategy.merge(U.urlAfterRedirects,U.rawUrl);this.setBrowserUrl(ie,U)}this.browserUrlTree=U.urlAfterRedirects}const Y=new ZR(U.id,this.serializeUrl(U.extractedUrl),this.serializeUrl(U.urlAfterRedirects),U.targetSnapshot);i.next(Y)}));if(k&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:Y,extractedUrl:ie,source:ve,restoredState:Fe,extras:Ke}=w,Xe=new U0(Y,this.serializeUrl(ie),ve,Fe);i.next(Xe);const Pe=hT(ie,this.rootComponentType).snapshot;return Zt(Object.assign(Object.assign({},w),{targetSnapshot:Pe,urlAfterRedirects:ie,extras:Object.assign(Object.assign({},Ke),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=w.rawUrl,w.resolve(null),ut}),n1(w=>{const{targetSnapshot:T,id:k,extractedUrl:L,rawUrl:U,extras:{skipLocationChange:Y,replaceUrl:ie}}=w;return this.hooks.beforePreactivation(T,{navigationId:k,appliedUrlTree:L,rawUrlTree:U,skipLocationChange:!!Y,replaceUrl:!!ie})}),jo(w=>{const T=new WR(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(T)}),Ot(w=>Object.assign(Object.assign({},w),{guards:nF(w.targetSnapshot,w.currentSnapshot,this.rootContexts)})),function aF(e,t){return Ue(n=>{const{targetSnapshot:i,currentSnapshot:l,guards:{canActivateChecks:d,canDeactivateChecks:y}}=n;return 0===y.length&&0===d.length?Zt(Object.assign(Object.assign({},n),{guardsResult:!0})):function lF(e,t,n,i){return qn(e).pipe(Ue(l=>function pF(e,t,n,i,l){const d=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return d&&0!==d.length?Zt(d.map(w=>{const T=Ay(w,t,l);let k;if(function UO(e){return e&&Xu(e.canDeactivate)}(T))k=Ul(T.canDeactivate(e,t,n,i));else{if(!Xu(T))throw new Error("Invalid CanDeactivate guard");k=Ul(T(e,t,n,i))}return k.pipe(Yf())})).pipe(Km()):Zt(!0)}(l.component,l.route,n,t,i)),Yf(l=>!0!==l,!0))}(y,i,l,e).pipe(Ue(w=>w&&function zO(e){return"boolean"==typeof e}(w)?function cF(e,t,n,i){return qn(t).pipe(Xf(l=>$m(function hF(e,t){return null!==e&&t&&t(new JR(e)),Zt(!0)}(l.route.parent,i),function uF(e,t){return null!==e&&t&&t(new eO(e)),Zt(!0)}(l.route,i),function fF(e,t,n){const i=t[t.length-1],d=t.slice(0,t.length-1).reverse().map(y=>function rF(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(y)).filter(y=>null!==y).map(y=>gy(()=>Zt(y.guards.map(T=>{const k=Ay(T,y.node,n);let L;if(function VO(e){return e&&Xu(e.canActivateChild)}(k))L=Ul(k.canActivateChild(i,e));else{if(!Xu(k))throw new Error("Invalid CanActivateChild guard");L=Ul(k(i,e))}return L.pipe(Yf())})).pipe(Km())));return Zt(d).pipe(Km())}(e,l.path,n),function dF(e,t,n){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Zt(!0);const l=i.map(d=>gy(()=>{const y=Ay(d,t,n);let w;if(function NO(e){return e&&Xu(e.canActivate)}(y))w=Ul(y.canActivate(t,e));else{if(!Xu(y))throw new Error("Invalid CanActivate guard");w=Ul(y(t,e))}return w.pipe(Yf())}));return Zt(l).pipe(Km())}(e,l.route,n))),Yf(l=>!0!==l,!0))}(i,d,e,t):Zt(w)),Ot(w=>Object.assign(Object.assign({},n),{guardsResult:w})))})}(this.ngModule.injector,w=>this.triggerEvent(w)),jo(w=>{if(bd(w.guardsResult)){const k=j0(`Redirecting to "${this.serializeUrl(w.guardsResult)}"`);throw k.url=w.guardsResult,k}const T=new XR(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.triggerEvent(T)}),us(w=>!!w.guardsResult||(this.restoreHistory(w),this.cancelNavigationTransition(w,""),!1)),n1(w=>{if(w.guards.canActivateChecks.length)return Zt(w).pipe(jo(T=>{const k=new KR(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(k)}),Ua(T=>{let k=!1;return Zt(T).pipe(function wF(e,t){return Ue(n=>{const{targetSnapshot:i,guards:{canActivateChecks:l}}=n;if(!l.length)return Zt(n);let d=0;return qn(l).pipe(Xf(y=>function CF(e,t,n,i){return function EF(e,t,n,i){const l=FT(e);if(0===l.length)return Zt({});const d={};return qn(l).pipe(Ue(y=>function DF(e,t,n,i){const l=Ay(e,t,i);return Ul(l.resolve?l.resolve(t,n):l(t,n))}(e[y],t,n,i).pipe(jo(w=>{d[y]=w}))),V0(1),Ue(()=>FT(d).length===l.length?Zt(d):ut))}(e._resolve,e,t,i).pipe(Ot(d=>(e._resolvedData=d,e.data=Object.assign(Object.assign({},e.data),dT(e,n).resolve),null)))}(y.route,i,e,t)),jo(()=>d++),V0(1),Ue(y=>d===l.length?Zt(n):ut))})}(this.paramsInheritanceStrategy,this.ngModule.injector),jo({next:()=>k=!0,complete:()=>{k||(this.restoreHistory(T),this.cancelNavigationTransition(T,"At least one route resolver didn't emit any value."))}}))}),jo(T=>{const k=new YR(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(k)}))}),n1(w=>{const{targetSnapshot:T,id:k,extractedUrl:L,rawUrl:U,extras:{skipLocationChange:Y,replaceUrl:ie}}=w;return this.hooks.afterPreactivation(T,{navigationId:k,appliedUrlTree:L,rawUrlTree:U,skipLocationChange:!!Y,replaceUrl:!!ie})}),Ot(w=>{const T=function EO(e,t,n){const i=Zm(e,t._root,n?n._root:void 0);return new uT(i,t)}(this.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return Object.assign(Object.assign({},w),{targetRouterState:T})}),jo(w=>{this.currentUrlTree=w.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl),this.routerState=w.targetRouterState,"deferred"===this.urlUpdateStrategy&&(w.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,w),this.browserUrlTree=w.urlAfterRedirects)}),((e,t,n)=>Ot(i=>(new FO(t,i.targetRouterState,i.currentRouterState,n).activate(e),i)))(this.rootContexts,this.routeReuseStrategy,w=>this.triggerEvent(w)),jo({next(){d=!0},complete(){d=!0}}),function HR(e){return $n((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var w;d||y||this.cancelNavigationTransition(l,`Navigation ID ${l.id} is not equal to the current navigation id ${this.navigationId}`),(null===(w=this.currentNavigation)||void 0===w?void 0:w.id)===l.id&&(this.currentNavigation=null)}),Wu(w=>{if(y=!0,function rO(e){return e&&e[XD]}(w)){const T=bd(w.url);T||(this.navigated=!0,this.restoreHistory(l,!0));const k=new HD(l.id,this.serializeUrl(l.extractedUrl),w.message);i.next(k),T?setTimeout(()=>{const L=this.urlHandlingStrategy.merge(w.url,this.rawUrlTree),U={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||BT(l.source)};this.scheduleNavigation(L,"imperative",null,U,{resolve:l.resolve,reject:l.reject,promise:l.promise})},0):l.resolve(!1)}else{this.restoreHistory(l,!0);const T=new qR(l.id,this.serializeUrl(l.extractedUrl),w);i.next(T);try{l.resolve(this.errorHandler(w))}catch(k){l.reject(k)}}return ut}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const i="popstate"===n.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var l;const d={replaceUrl:!0},y=(null===(l=n.state)||void 0===l?void 0:l.navigationId)?n.state:null;if(y){const T=Object.assign({},y);delete T.navigationId,delete T.\u0275routerPageId,0!==Object.keys(T).length&&(d.state=T)}const w=this.parseUrl(n.url);this.scheduleNavigation(w,i,y,d)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){bT(n),this.config=n.map(e1),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,i={}){const{relativeTo:l,queryParams:d,fragment:y,queryParamsHandling:w,preserveFragment:T}=i,k=l||this.routerState.root,L=T?this.currentUrlTree.fragment:y;let U=null;switch(w){case"merge":U=Object.assign(Object.assign({},this.currentUrlTree.queryParams),d);break;case"preserve":U=this.currentUrlTree.queryParams;break;default:U=d||null}return null!==U&&(U=this.removeEmptyProps(U)),function MO(e,t,n,i,l){if(0===n.length)return X0(t.root,t.root,t.root,i,l);const d=function SO(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new gT(!0,0,e);let t=0,n=!1;const i=e.reduce((l,d,y)=>{if("object"==typeof d&&null!=d){if(d.outlets){const w={};return Bi(d.outlets,(T,k)=>{w[k]="string"==typeof T?T.split("/"):T}),[...l,{outlets:w}]}if(d.segmentPath)return[...l,d.segmentPath]}return"string"!=typeof d?[...l,d]:0===y?(d.split("/").forEach((w,T)=>{0==T&&"."===w||(0==T&&""===w?n=!0:".."===w?t++:""!=w&&l.push(w))}),l):[...l,d]},[]);return new gT(n,t,i)}(n);if(d.toRoot())return X0(t.root,t.root,new yn([],{}),i,l);const y=function IO(e,t,n){if(e.isAbsolute)return new K0(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const d=n.snapshot._urlSegment;return new K0(d,d===t.root,0)}const i=Cy(e.commands[0])?0:1;return function AO(e,t,n){let i=e,l=t,d=n;for(;d>l;){if(d-=l,i=i.parent,!i)throw new Error("Invalid number of '../'");l=i.segments.length}return new K0(i,!1,l-d)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+i,e.numberOfDoubleDots)}(d,t,e),w=y.processChildren?Ey(y.segmentGroup,y.index,d.commands):_T(y.segmentGroup,y.index,d.commands);return X0(t.root,y.segmentGroup,w,i,l)}(k,this.currentUrlTree,n,U,null!=L?L:null)}navigateByUrl(n,i={skipLocationChange:!1}){const l=bd(n)?n:this.parseUrl(n),d=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(d,"imperative",null,i)}navigate(n,i={skipLocationChange:!1}){return function FF(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let i;try{i=this.urlSerializer.parse(n)}catch(l){i=this.malformedUriErrorHandler(l,this.urlSerializer,n)}return i}isActive(n,i){let l;if(l=!0===i?Object.assign({},RF):!1===i?Object.assign({},OF):i,bd(n))return eT(this.currentUrlTree,n,l);const d=this.parseUrl(n);return eT(this.currentUrlTree,d,l)}removeEmptyProps(n){return Object.keys(n).reduce((i,l)=>{const d=n[l];return null!=d&&(i[l]=d),i},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new Gm(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,i,l,d,y){var w,T;if(this.disposed)return Promise.resolve(!1);let k,L,U;y?(k=y.resolve,L=y.reject,U=y.promise):U=new Promise((ve,Fe)=>{k=ve,L=Fe});const Y=++this.navigationId;let ie;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(l=this.location.getState()),ie=l&&l.\u0275routerPageId?l.\u0275routerPageId:d.replaceUrl||d.skipLocationChange?null!==(w=this.browserPageId)&&void 0!==w?w:0:(null!==(T=this.browserPageId)&&void 0!==T?T:0)+1):ie=0,this.setTransition({id:Y,targetPageId:ie,source:i,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:d,resolve:k,reject:L,promise:U,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),U.catch(ve=>Promise.reject(ve))}setBrowserUrl(n,i){const l=this.urlSerializer.serialize(n),d=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(l)||i.extras.replaceUrl?this.location.replaceState(l,"",d):this.location.go(l,"",d)}restoreHistory(n,i=!1){var l,d;if("computed"===this.canceledNavigationResolution){const y=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(l=this.currentNavigation)||void 0===l?void 0:l.finalUrl)||0===y?this.currentUrlTree===(null===(d=this.currentNavigation)||void 0===d?void 0:d.finalUrl)&&0===y&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(y)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,i){const l=new HD(n.id,this.serializeUrl(n.extractedUrl),i);this.triggerEvent(l),n.resolve(!1)}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}}return e.\u0275fac=function(n){Wv()},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();function BT(e){return"imperative"!==e}let lo=(()=>{class e{constructor(n,i,l,d,y){this.router=n,this.route=i,this.tabIndexAttribute=l,this.renderer=d,this.el=y,this.commands=null,this.onChanges=new br,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){if(null!=this.tabIndexAttribute)return;const i=this.renderer,l=this.el.nativeElement;null!==n?i.setAttribute(l,"tabindex",n):i.removeAttribute(l,"tabindex")}ngOnChanges(n){this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const n={skipLocationChange:tp(this.skipLocationChange),replaceUrl:tp(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,n),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:tp(this.preserveFragment)})}}return e.\u0275fac=function(n){return new(n||e)(Ze(hs),Ze(ep),mu("tabindex"),Ze(zc),Ze(ls))},e.\u0275dir=It({type:e,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(n,i){1&n&&Co("click",function(){return i.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[ki]}),e})(),Py=(()=>{class e{constructor(n,i,l){this.router=n,this.route=i,this.locationStrategy=l,this.commands=null,this.href=null,this.onChanges=new br,this.subscription=n.events.subscribe(d=>{d instanceof Gm&&this.updateTargetUrlAndHref()})}set routerLink(n){this.commands=null!=n?Array.isArray(n)?n:[n]:null}ngOnChanges(n){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(n,i,l,d,y){if(0!==n||i||l||d||y||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const w={skipLocationChange:tp(this.skipLocationChange),replaceUrl:tp(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,w),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:tp(this.preserveFragment)})}}return e.\u0275fac=function(n){return new(n||e)(Ze(hs),Ze(ep),Ze(Wf))},e.\u0275dir=It({type:e,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(n,i){1&n&&Co("click",function(d){return i.onClick(d.button,d.ctrlKey,d.shiftKey,d.altKey,d.metaKey)}),2&n&&ui("target",i.target)("href",i.href,Rp)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[ki]}),e})();function tp(e){return""===e||!!e}class NT{}class VT{preload(t,n){return Zt(null)}}let UT=(()=>{class e{constructor(n,i,l,d){this.router=n,this.injector=l,this.preloadingStrategy=d,this.loader=new LT(l,i,T=>n.triggerEvent(new qD(T)),T=>n.triggerEvent(new ZD(T)))}setUpPreloading(){this.subscription=this.router.events.pipe(us(n=>n instanceof Gm),Xf(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Bc);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const l=[];for(const d of i)if(d.loadChildren&&!d.canLoad&&d._loadedConfig){const y=d._loadedConfig;l.push(this.processRoutes(y.module,y.routes))}else d.loadChildren&&!d.canLoad?l.push(this.preloadConfig(n,d)):d.children&&l.push(this.processRoutes(n,d.children));return qn(l).pipe(Le(),Ot(d=>{}))}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>(i._loadedConfig?Zt(i._loadedConfig):this.loader.load(n.injector,i)).pipe(Ue(d=>(i._loadedConfig=d,this.processRoutes(d.module,d.routes)))))}}return e.\u0275fac=function(n){return new(n||e)(bt(hs),bt(mC),bt(Ee),bt(NT))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),i1=(()=>{class e{constructor(n,i,l={}){this.router=n,this.viewportScroller=i,this.options=l,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},l.scrollPositionRestoration=l.scrollPositionRestoration||"disabled",l.anchorScrolling=l.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof U0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Gm&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof WD&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.router.triggerEvent(new WD(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){Wv()},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const wd=new Ft("ROUTER_CONFIGURATION"),jT=new Ft("ROUTER_FORROOT_GUARD"),NF=[Ux,{provide:iT,useClass:oT},{provide:hs,useFactory:function GF(e,t,n,i,l,d,y={},w,T){const k=new hs(null,e,t,n,i,l,YD(d));return w&&(k.urlHandlingStrategy=w),T&&(k.routeReuseStrategy=T),function HF(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(y,k),y.enableTracing&&k.events.subscribe(L=>{var U,Y;null===(U=console.group)||void 0===U||U.call(console,`Router Event: ${L.constructor.name}`),console.log(L.toString()),console.log(L),null===(Y=console.groupEnd)||void 0===Y||Y.call(console)}),k},deps:[iT,Ym,Ux,Ee,mC,r1,wd,[class IF{},new no],[class TF{},new no]]},Ym,{provide:ep,useFactory:function qF(e){return e.routerState.root},deps:[hs]},UT,VT,class BF{preload(t,n){return n().pipe(Wu(()=>Zt(null)))}},{provide:wd,useValue:{enableTracing:!1}}];function VF(){return new xC("Router",hs)}let o1=(()=>{class e{constructor(n,i){}static forRoot(n,i){return{ngModule:e,providers:[NF,$T(n),{provide:jT,useFactory:$F,deps:[[hs,new no,new xc]]},{provide:wd,useValue:i||{}},{provide:Wf,useFactory:jF,deps:[gd,[new Cu(Vx),new no],wd]},{provide:i1,useFactory:UF,deps:[hs,zP,wd]},{provide:NT,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:VT},{provide:xC,multi:!0,useFactory:VF},[s1,{provide:F_,multi:!0,useFactory:ZF,deps:[s1]},{provide:GT,useFactory:WF,deps:[s1]},{provide:pC,multi:!0,useExisting:GT}]]}}static forChild(n){return{ngModule:e,providers:[$T(n)]}}}return e.\u0275fac=function(n){return new(n||e)(bt(jT,8),bt(hs,8))},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({}),e})();function UF(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new i1(e,t,n)}function jF(e,t,n={}){return n.useHash?new y2(e,t):new NC(e,t)}function $F(e){return"guarded"}function $T(e){return[{provide:ml,multi:!0,useValue:e},{provide:r1,multi:!0,useValue:e}]}let s1=(()=>{class e{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new br}appInitializer(){return this.injector.get(m2,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const l=new Promise(w=>i=w),d=this.injector.get(hs),y=this.injector.get(wd);return"disabled"===y.initialNavigation?(d.setUpLocationChangeListener(),i(!0)):"enabled"===y.initialNavigation||"enabledBlocking"===y.initialNavigation?(d.hooks.afterPreactivation=()=>this.initNavigation?Zt(null):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),d.initialNavigation()):i(!0),l})}bootstrapListener(n){const i=this.injector.get(wd),l=this.injector.get(UT),d=this.injector.get(i1),y=this.injector.get(hs),w=this.injector.get(L_);n===w.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&y.initialNavigation(),l.setUpPreloading(),d.init(),y.resetRootComponentType(w.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(n){return new(n||e)(bt(Ee))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();function ZF(e){return e.appInitializer.bind(e)}function WF(e){return e.bootstrapListener.bind(e)}const GT=new Ft("Router Initializer"),KF=function(){return["/","PerfilComponent"]},YF=function(){return["/","LoginComponent"]};let JF=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-home"]],decls:13,vars:4,consts:[[1,"contenedor"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",1,"logo"],[1,"slogan"],[1,"boton",3,"routerLink"],["src","https://directivosygerentes.es/wp-content/uploads/2019/07/farmacia-online.jpg",1,"logo"]],template:function(n,i){1&n&&(De(0,"div",0),Je(1,"img",1),De(2,"div",2),Ge(3,"TUFARMACIA"),Ae(),Je(4,"br"),De(5,"div")(6,"button",3),Ge(7," Crear cuenta "),Ae(),Je(8,"br"),De(9,"button",3),Ge(10," Iniciar Sesion "),Ae()(),Je(11,"br")(12,"img",4),Ae()),2&n&&(xn(6),jn("routerLink",Kn(2,KF)),xn(3),jn("routerLink",Kn(3,YF)))},directives:[lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center}.imagen[_ngcontent-%COMP%]{border:0;max-height:18%;max-width:18%}.logo[_ngcontent-%COMP%]{width:300px}@media (max-width: 560px){.logo[_ngcontent-%COMP%]{width:60%;height:150px}}.boton[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:50%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:25px;padding:10px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:200px}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:50px}"]}),e})();const QF=function(){return["/","LoginComponent"]};let eL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-perfil"]],decls:57,vars:2,consts:[[1,"contenedor"],[1,"atras-container"],["href","javascript:history.back()",1,"atras"],["src","https://thumbs.dreamstime.com/b/icono-de-flecha-s%C3%B3lida-hacia-atr%C3%A1s-o-la-izquierda-gran-tama%C3%B1o-negro-esbozado-como-s%C3%ADmbolo-vector-189359889.jpg","height","33","width","50","alt","Bot\xf3n"],[1,"header"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png"],[1,"slogan2"],[1,"form"],["for","validationDefault01",1,"form-label"],[1,"form-floating"],["type","text","id","floatingInput","placeholder","nombre","required","",1,"form-control"],["for","floatingInput"],[1,"form-floating","mb-2"],["type","text","id","validationDefaultUsername floatingInput","aria-describedby","inputGroupPrepend2","placeholder","name@example.com","required","",1,"form-control"],["for","floatingInput validationDefaultUsername",1,"form-label"],[1,"input-group","mb-2"],["id","basic-addon1",1,"input-group-text"],["type","date","placeholder","fecha","aria-label","fecha","aria-describedby","basic-addon1","required","",1,"form-control"],[1,"row"],[1,"col","mb-2"],["aria-label",".form-select-sm example","required","",1,"form-select","form-select-sm","fix-select"],["selected",""],["value","1"],["value","2"],[1,"col"],["type","text","placeholder","Numero","aria-label","Last name","required","",1,"form-control"],["type","password","id","floatingPassword","placeholder","Password","required","",1,"form-control"],["for","floatingPassword"],[1,"form-check","mb-2"],["type","checkbox","value","","id","flexCheckIndeterminate","required","",1,"form-check-input"],["for","flexCheckIndeterminate",1,"terminos"],["type","submit",1,"btn1","btn-primary",3,"routerLink"],[1,"buttons"],["src","https://fitory.com/static/FitApp/img/BotonSesionFacebook.png",1,"imagen","mt-10"],["src","https://fitory.com/static/FitApp/img/BotonSesionGoogle.png",1,"imagen","mt-10"]],template:function(n,i){1&n&&(De(0,"div",0)(1,"div",1)(2,"a",2),Je(3,"img",3),Ae()(),De(4,"div",4),Je(5,"img",5),De(6,"div",6),Ge(7,"TUFARMACIA"),Ae(),Je(8,"br"),Ae(),De(9,"div")(10,"form",7)(11,"div")(12,"label",8)(13,"div",9),Je(14,"input",10),De(15,"label",11),Ge(16,"Nombre"),Ae()()()(),De(17,"div",12),Je(18,"input",13),De(19,"label",14),Ge(20,"Correo Electronico"),Ae()(),De(21,"div")(22,"div",15)(23,"span",16),Ge(24,"Fecha de naciemiento"),Ae(),Je(25,"input",17),Ae()(),De(26,"div")(27,"div",18)(28,"div",19)(29,"select",20)(30,"option",21),Ge(31,"Documento"),Ae(),De(32,"option",22),Ge(33,"DNI"),Ae(),De(34,"option",23),Ge(35,"RUC"),Ae(),De(36,"option",23),Ge(37,"OTRO"),Ae()()(),De(38,"div",24),Je(39,"input",25),Ae()()(),De(40,"div",12),Je(41,"input",26),De(42,"label",27),Ge(43,"Contrase\xf1a"),Ae()(),De(44,"div",12),Je(45,"input",26),De(46,"label",27),Ge(47,"Repetir contrase\xf1a"),Ae()(),De(48,"div",28),Je(49,"input",29),De(50,"label",30),Ge(51," Aceptar Terminos y Condiciones "),Ae()()(),De(52,"button",31),Ge(53," Registrarse "),Ae(),De(54,"div",32),Je(55,"img",33)(56,"img",34),Ae()()()),2&n&&(xn(52),jn("routerLink",Kn(1,QF)))},directives:[Um,Lm,fy,py,lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;min-height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column}.header[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:270px;height:150px}@media (max-width: 560px){.header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30%;height:100px}}.header[_ngcontent-%COMP%]   .slogan2[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:25px}.btn1[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:20%;margin:10px auto 20px;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:160px}.form-floating[_ngcontent-%COMP%]{width:500%;max-width:320px;background:#c3c3c3;background-color:#bec5c2;border-radius:2500000px}.form[_ngcontent-%COMP%]{width:500%;max-width:320px;margin:0 auto;display:flex;flex-direction:column;justify-content:center;align-items:flex-start}.casilla[_ngcontent-%COMP%]{justify-content:left;width:150%;color:#fff;background:#c3c3c3;background-color:#bec5c2;border-color:#bec5c2;border-radius:250px;padding:10px}.fecha[_ngcontent-%COMP%]{color:#fff;background-color:#bec5c2;border-color:#bec5c2;padding:10px;border-radius:280px}.document2[_ngcontent-%COMP%]{color:#fff;background-color:#bec5c2;border-color:#bec5c2;padding:10px;border-radius:250px;width:52%}.buttons[_ngcontent-%COMP%]{width:100%;max-width:280px;margin:0 auto}.buttons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.botonoesFG[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:left;align-items:center}.terminos[_ngcontent-%COMP%]{color:#fff}.mt-10[_ngcontent-%COMP%]{margin-top:10px}.atras-container[_ngcontent-%COMP%]{position:relative;width:100%;height:40px}.atras-container[_ngcontent-%COMP%]   .atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}.fix-select[_ngcontent-%COMP%]{height:38px!important}"]}),e})();const tL=function(){return["/","PerfilComponent"]},nL=function(){return["/","UsuariofarmaciaComponent"]};let rL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-login"]],decls:40,vars:4,consts:[[1,"contenedor"],[1,"atras-container"],["href","javascript:history.back()",1,"atras"],["src","https://thumbs.dreamstime.com/b/icono-de-flecha-s%C3%B3lida-hacia-atr%C3%A1s-o-la-izquierda-gran-tama%C3%B1o-negro-esbozado-como-s%C3%ADmbolo-vector-189359889.jpg","height","33","width","50","alt","Bot\xf3n"],[1,"header"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png"],[1,"slogan2"],[1,"formulario"],[1,"form"],[1,"form-floating","mb-3","fix-select"],["id","floatingSelect","aria-label","Floating label select example",1,"form-select"],["selected",""],["value","1"],["value","2"],["value","3"],["for","floatingSelect"],[1,"form-floating","mb-3"],["type","email","id","floatingInput","placeholder","name@example.com",1,"casilla","form-control"],["for","floatingInput"],["type","password","id","floatingPassword","placeholder","Password",1,"casilla","form-control"],["for","floatingPassword"],[1,"muted"],["data-bs-toggle","tooltip","title","Default tooltip",3,"routerLink"],["type","submit",1,"btn1",3,"routerLink"],[1,"buttons"],["src","https://fitory.com/static/FitApp/img/BotonSesionFacebook.png",1,"imagen","mt-10"],["src","https://fitory.com/static/FitApp/img/BotonSesionGoogle.png",1,"imagen","mt-10"]],template:function(n,i){1&n&&(De(0,"div",0)(1,"div",1)(2,"a",2),Je(3,"img",3),Ae()(),De(4,"div",4),Je(5,"img",5),De(6,"div",6),Ge(7,"TUFARMACIA"),Ae()(),De(8,"div",7)(9,"form",8)(10,"div",9)(11,"select",10)(12,"option",11),Ge(13,"Deslizar hacia abajo"),Ae(),De(14,"option",12),Ge(15,"DNI"),Ae(),De(16,"option",13),Ge(17,"RUC"),Ae(),De(18,"option",14),Ge(19,"OTRO"),Ae()(),De(20,"label",15),Ge(21,"Tipo de documento"),Ae()(),De(22,"div",16),Je(23,"input",17),De(24,"label",18),Ge(25,"Numero"),Ae()(),De(26,"div",16),Je(27,"input",19),De(28,"label",20),Ge(29,"Password"),Ae()(),De(30,"p",21),Ge(31," No tienes cuenta? "),De(32,"a",22),Ge(33,"Ingresa aqui"),Ae(),Ge(34," Para crear una nueva cuenta "),Ae()(),De(35,"button",23),Ge(36," Iniciar Sesion "),Ae(),De(37,"div",24),Je(38,"img",25)(39,"img",26),Ae()()()),2&n&&(xn(32),jn("routerLink",Kn(2,tL)),xn(3),jn("routerLink",Kn(3,nL)))},directives:[Um,Lm,fy,py,Py,lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;min-height:85vh;display:flex;align-items:center;justify-content:center;flex-direction:column;position:relative}.header[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:270px;height:150px}@media (max-width: 560px){.header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30%;height:100px}}.header[_ngcontent-%COMP%]   .slogan2[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:25px}.btn1[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:20%;margin:10px auto 20px;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:160px}.form-floating[_ngcontent-%COMP%]{width:500%;max-width:320px;background:#c3c3c3;background-color:#bec5c2;border-radius:2500000px}.form[_ngcontent-%COMP%]{width:500%;max-width:320px;margin:0 auto;display:flex;flex-direction:column;justify-content:center;align-items:flex-start}.casilla[_ngcontent-%COMP%]{justify-content:left;width:100%;color:#fff;background:#c3c3c3;background-color:#bec5c2;border-color:#bec5c2;border-radius:8px;padding:10px}.fecha[_ngcontent-%COMP%]{color:#fff;background-color:#bec5c2;border-color:#bec5c2;padding:10px;border-radius:280px}.document2[_ngcontent-%COMP%]{color:#fff;background-color:#bec5c2;border-color:#bec5c2;padding:10px;border-radius:250px;width:52%}.buttons[_ngcontent-%COMP%]{width:100%;max-width:280px;margin:0 auto}.buttons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.botonoesFG[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:left;align-items:center}.terminos[_ngcontent-%COMP%]{color:#fff}.mt-10[_ngcontent-%COMP%]{margin-top:10px}.atras-container[_ngcontent-%COMP%]{position:relative;width:100%;height:40px}.atras-container[_ngcontent-%COMP%]   .atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}.fix-select[_ngcontent-%COMP%]{margin:30px 0!important}"]}),e})();const iL=function(){return["/","EditarUsuarioComponent"]},oL=function(){return["/","BuscarFarmaciaComponent"]},sL=function(){return["/","BuscarMedicamentoComponent"]},aL=function(){return["/","HistorialComponent"]},lL=function(){return["/","LoginComponent"]};let cL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:23,vars:10,consts:[[1,"contenedor"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",1,"logo"],[1,"slogan"],["src","https://png.pngtree.com/png-vector/20190223/ourlarge/pngtree-profile-glyph-black-icon-png-image_691589.jpg ",1,"logo2",3,"routerLink"],[1,"slogan2"],[1,"boton",3,"routerLink"],[1,"boton2",3,"routerLink"]],template:function(n,i){1&n&&(De(0,"div",0),Je(1,"img",1),De(2,"div",2),Ge(3,"TUFARMACIA"),Ae(),Je(4,"img",3),De(5,"div",4),Ge(6,"NOMBRE"),Ae(),Je(7,"br"),De(8,"div")(9,"button",5),Ge(10," Busqueda de Farmacias "),Ae(),Je(11,"br"),De(12,"button",5),Ge(13," Busqueda de Medicamentos "),Ae(),Je(14,"br"),De(15,"button",5),Ge(16," Historial de Consultas "),Ae(),Je(17,"br")(18,"br")(19,"br"),De(20,"button",6),Ge(21," Cerrar Session "),Ae()(),Je(22,"br"),Ae()),2&n&&(xn(4),jn("routerLink",Kn(5,iL)),xn(5),jn("routerLink",Kn(6,oL)),xn(3),jn("routerLink",Kn(7,sL)),xn(3),jn("routerLink",Kn(8,aL)),xn(5),jn("routerLink",Kn(9,lL)))},directives:[lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center}div[_ngcontent-%COMP%]{background-color:#000}.imagen[_ngcontent-%COMP%]{border:0;max-height:18%;max-width:18%}.logo[_ngcontent-%COMP%]{width:180px}@media (max-width: 560px){.logo[_ngcontent-%COMP%]{width:30%;height:110px}}.logo2[_ngcontent-%COMP%]{width:200px;border-radius:400px}@media (max-width: 560px){.logo2[_ngcontent-%COMP%]{width:50%;height:190px}}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:20px}.boton[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:50%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:280px}.boton2[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:50%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:150px}.atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}"]}),e})();const uL=function(){return["/","EditarUsuarioComponent"]},hL=function(){return["/","MedicamentoComponent"]},dL=function(){return["/","ListarMedicamentoComponent"]},fL=function(){return["/","DireccionComponent"]},pL=function(){return["/","LoginComponent"]};let mL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:23,vars:10,consts:[[1,"contenedor"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",1,"logo"],[1,"slogan"],["src","https://png.pngtree.com/png-vector/20190223/ourlarge/pngtree-profile-glyph-black-icon-png-image_691589.jpg ",1,"logo2",3,"routerLink"],[1,"slogan2"],[1,"boton",3,"routerLink"],[1,"boton2",3,"routerLink"]],template:function(n,i){1&n&&(De(0,"div",0),Je(1,"img",1),De(2,"div",2),Ge(3,"TUFARMACIA"),Ae(),Je(4,"img",3),De(5,"div",4),Ge(6,"NOMBRE FARMACIA"),Ae(),De(7,"div"),Je(8,"br"),De(9,"button",5),Ge(10," Registrar Medicamentos "),Ae(),Je(11,"br"),De(12,"button",5),Ge(13," Listar Medicamentos "),Ae(),Je(14,"br"),De(15,"button",5),Ge(16," Registrar Direccion y estado "),Ae(),Je(17,"br")(18,"br")(19,"br"),De(20,"button",6),Ge(21," Cerrar Session "),Ae()(),Je(22,"br"),Ae()),2&n&&(xn(4),jn("routerLink",Kn(5,uL)),xn(5),jn("routerLink",Kn(6,hL)),xn(3),jn("routerLink",Kn(7,dL)),xn(3),jn("routerLink",Kn(8,fL)),xn(5),jn("routerLink",Kn(9,pL)))},directives:[lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center}div[_ngcontent-%COMP%]{background-color:#000}.imagen[_ngcontent-%COMP%]{border:0;max-height:18%;max-width:18%}.logo[_ngcontent-%COMP%]{width:180px}@media (max-width: 560px){.logo[_ngcontent-%COMP%]{width:30%;height:110px}}.logo2[_ngcontent-%COMP%]{width:200px;border-radius:400px}@media (max-width: 560px){.logo2[_ngcontent-%COMP%]{width:50%;height:190px}}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:20px}.boton[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:50%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:280px}.boton2[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:50%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:150px}.atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}"]}),e})();const gL=function(){return["/","PerfilComponent"]},HT=function(){return["/","LoginComponent"]};let _L=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:28,vars:6,consts:[["href","javascript:history.back()",1,"atras"],["src","https://thumbs.dreamstime.com/b/icono-de-flecha-s%C3%B3lida-hacia-atr%C3%A1s-o-la-izquierda-gran-tama%C3%B1o-negro-esbozado-como-s%C3%ADmbolo-vector-189359889.jpg","height","33","width","50","alt","Bot\xf3n"],[1,"contenedor"],[1,"slogan"],["src","https://png.pngtree.com/png-vector/20190223/ourlarge/pngtree-profile-glyph-black-icon-png-image_691589.jpg ",1,"logo2"],[1,"slogan2"],[1,"boton",3,"routerLink"],[1,"switch-button"],["type","checkbox","name","switch-button","id","switch-label",1,"switch-button__checkbox"],["for","switch-label",1,"switch-button__label"],["role","alert",1,"alert","alert-primary"]],template:function(n,i){1&n&&(De(0,"div")(1,"a",0),Je(2,"img",1),Ae()(),De(3,"div",2)(4,"div",3),Ge(5,"Usuario "),Ae(),Je(6,"img",4),De(7,"div")(8,"div",5),Ge(9,"Mira y Edita tu Usuario"),Ae(),Je(10,"br"),De(11,"button",6),Ge(12," Cambiar Contrase\xf1a "),Ae(),Je(13,"br"),De(14,"button",6),Ge(15," Cambiar Foto "),Ae(),Je(16,"br"),De(17,"button",6),Ge(18," Eliminar Cuenta "),Ae(),Je(19,"br"),De(20,"div",5),Ge(21,"Control de Notificaciones"),Ae(),Je(22,"br"),De(23,"div",7),Je(24,"input",8)(25,"label",9),Ae(),De(26,"div",10),Ge(27," Activar Ubicacion "),Ae()()()),2&n&&(xn(11),jn("routerLink",Kn(3,gL)),xn(3),jn("routerLink",Kn(4,HT)),xn(3),jn("routerLink",Kn(5,HT)))},directives:[lo],styles:['.contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;height:80vh;display:flex;flex-direction:column;justify-content:center;align-items:center}div[_ngcontent-%COMP%]{background-color:#000}.imagen[_ngcontent-%COMP%]{border:0;max-height:18%;max-width:18%}.logo2[_ngcontent-%COMP%]{width:100px;border-radius:150px}@media (max-width: 560px){.logo2[_ngcontent-%COMP%]{width:30%;height:115px}}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;color:#00ff6f;font-family:fantasy;font-size:20px}.boton[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:50%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:400px;min-width:230px}.atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}[_ngcontent-%COMP%]:root{--color-green: #00a878;--color-red: #00ff6f;--color-button: #fdffff;--color-black: #000}.switch-button[_ngcontent-%COMP%]   .switch-button__label[_ngcontent-%COMP%]{background-color:#00ff6f;width:5rem;height:3rem;border-radius:3rem;display:inline-block;position:relative}.switch-button[_ngcontent-%COMP%]   .switch-button__label[_ngcontent-%COMP%]:before{transition:.2s;display:block;position:absolute;width:3rem;height:3rem;background-color:#fdffff;content:"";border-radius:50%;box-shadow:inset 0 0 0 1px var(--color-black)}.switch-button[_ngcontent-%COMP%]   .switch-button__checkbox[_ngcontent-%COMP%]:checked + .switch-button__label[_ngcontent-%COMP%]{background-color:var(--color-green)}.switch-button[_ngcontent-%COMP%]   .switch-button__checkbox[_ngcontent-%COMP%]:checked + .switch-button__label[_ngcontent-%COMP%]:before{transform:translate(2rem)}']}),e})();const qT=function(){return["/","MedicamentoComponent"]},yL=function(){return["/","UsuariofarmaciaComponent"]};let vL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:94,vars:6,consts:[[1,"contenedor"],[1,"header"],[1,"slogan2"],[1,"form"],["for","validationDefault01",1,"form-label"],[1,"form-floating"],["type","text","id","floatingInput","placeholder","codigo","required","",1,"form-control"],["for","floatingInput"],["type","text","id","floatingInput","placeholder","nombre","required","",1,"form-control"],["type","text","id","floatingInput","placeholder","laboratorio","required","",1,"form-control"],["type","text","id","floatingInput","placeholder","cantidad","required","",1,"form-control"],[1,"input-group","mb-2"],["id","basic-addon1",1,"input-group-text"],["type","date","placeholder","fecha","aria-label","fecha","aria-describedby","basic-addon1","required","",1,"form-control"],[1,"form1","form-floating"],["type","text","id","floatingInput","placeholder","precio","required","",1,"form-control"],[1,"form3","form-floating","fix-select"],["id","floatingSelect","aria-label","Floating label select example",1,"form-select"],["selected",""],["value","1"],["value","2"],["for","floatingSelect"],["type","text","id","floatingInput","placeholder","dosis","required","",1,"form-control"],[1,"form2","form-floating","fix-select"],["value","3"],["value","4"],["value","5"],["value","6"],[1,"div-centrado","borde","fondo_deg"],["href","javascript:explorar();"],[1,""],["src","https://png.pngtree.com/element_our/20190601/ourlarge/pngtree-file-upload-icon-image_1344464.jpg","height","100px","title","subir imagen"],["clear",""],["type","file","name","f_subir","id","f_subir","value",""],[1,"row"],[1,"col-md-3","col-md-offset-9","text-right"],["role","group",1,"btn-group","contenedor-botones"],["type","submit",1,"btn1","btn-primary",3,"routerLink"],["type","reset",1,"btn2","btn-primary",3,"routerLink"]],template:function(n,i){1&n&&(De(0,"div",0)(1,"div",1)(2,"div",2),Ge(3,"REGISTRAR MEDICAMENTO"),Ae()(),Je(4,"br"),De(5,"div")(6,"form",3)(7,"div")(8,"label",4)(9,"div",5),Je(10,"input",6),De(11,"label",7),Ge(12,"Codigo"),Ae()()()(),De(13,"div")(14,"label",4)(15,"div",5),Je(16,"input",8),De(17,"label",7),Ge(18,"Nombre"),Ae()()()(),De(19,"div")(20,"label",4)(21,"div",5),Je(22,"input",9),De(23,"label",7),Ge(24,"Laboratorio"),Ae()()()(),De(25,"div")(26,"label",4)(27,"div",5),Je(28,"input",10),De(29,"label",7),Ge(30,"Cantidad"),Ae()()()(),De(31,"div")(32,"div",11)(33,"span",12),Ge(34,"Fecha Vencimiento"),Ae(),Je(35,"input",13),Ae()(),De(36,"div")(37,"label",4)(38,"div",14),Je(39,"input",15),De(40,"label",7),Ge(41,"Precio"),Ae()()(),De(42,"div",16)(43,"select",17)(44,"option",18),Ge(45,"Deslizar hacia abajo"),Ae(),De(46,"option",19),Ge(47,"Marca"),Ae(),De(48,"option",20),Ge(49,"Generica"),Ae()(),De(50,"label",21),Ge(51,"Categoria "),Ae()()(),De(52,"div")(53,"label",4)(54,"div",14),Je(55,"input",22),De(56,"label",7),Ge(57,"Dosis"),Ae()()(),De(58,"div",23)(59,"select",17)(60,"option",18),Ge(61,"Deslizar hacia abajo"),Ae(),De(62,"option",19),Ge(63,"mL"),Ae(),De(64,"option",20),Ge(65,"mg"),Ae(),De(66,"option",24),Ge(67,"mmol"),Ae(),De(68,"option",25),Ge(69,"mcg"),Ae(),De(70,"option",26),Ge(71,"ng"),Ae(),De(72,"option",27),Ge(73,"Kg"),Ae()(),De(74,"label",21),Ge(75,"Unidad de Medida"),Ae()()()(),Je(76,"br"),De(77,"div",28)(78,"a",29)(79,"div",30),Je(80,"img",31)(81,"br",32),Ge(82," Subir Img "),Ae()(),Je(83,"input",33),Ae(),Je(84,"br"),De(85,"div",34)(86,"div",35)(87,"div",36)(88,"button",37),Ge(89," Guardar "),Ae(),De(90,"button",38),Ge(91," Limpiar "),Ae(),De(92,"button",38),Ge(93," Cerrar "),Ae()()()()()()),2&n&&(xn(88),jn("routerLink",Kn(3,qT)),xn(2),jn("routerLink",Kn(4,qT)),xn(2),jn("routerLink",Kn(5,yL)))},directives:[Um,Lm,fy,py,lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;min-height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.btn1[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:20%;margin:10px auto 20px;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:110px}.btn2[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:20%;margin:10px auto 20px 10px;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:110px}.form-floating[_ngcontent-%COMP%]{width:400%;max-width:350px;background:#c3c3c3;background-color:#bec5c2;border-radius:2500000px}.form1[_ngcontent-%COMP%]{width:400%;max-width:130px;background:#c3c3c3;background-color:#bec5c2;border-radius:2500000px;float:left}.form2[_ngcontent-%COMP%], .form3[_ngcontent-%COMP%]{width:400%;max-width:200px;background:#c3c3c3;background-color:#bec5c2;border-radius:2500000px;float:right}.form4[_ngcontent-%COMP%]{width:400%;max-width:190px;background:#c3c3c3;background-color:#bec5c2;border-radius:2500000px;float:left}.fecha[_ngcontent-%COMP%]{color:#fff;background-color:#bec5c2;border-color:#bec5c2;padding:10px;border-radius:280px}.atras-container[_ngcontent-%COMP%]{position:relative;width:100%;height:40px}.atras-container[_ngcontent-%COMP%]   .atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}"]}),e})();const xL=function(){return["/","UsuariofarmaciaComponent"]};let bL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:65,vars:2,consts:[[1,"contenedor"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",1,"logo"],[1,"slogan"],[1,"slogan2"],[1,"box"],[1,"container-4"],["type","search","id","search","placeholder","Buscar.."],[1,"icon"],[1,"fa","fa-search"],["href","//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css","rel","stylesheet"],[1,"table-responsive"],[1,"table","table-bordered"],[1,"table-light"],["scope","col"],[1,"table-group-divider","table-light"],["scope","row"],[1,"boton2",3,"routerLink"]],template:function(n,i){1&n&&(De(0,"div",0),Je(1,"img",1),De(2,"div",2),Ge(3,"TUFARMACIA"),Ae(),Je(4,"br"),De(5,"div",3),Ge(6,"LISTAR MEDICAMENTOS"),Ae(),De(7,"div",4)(8,"div",5),Je(9,"input",6),De(10,"button",7)(11,"i",8),Je(12,"link",9),Ae()()()(),Je(13,"br"),De(14,"div",10)(15,"table",11)(16,"thead",12)(17,"tr")(18,"th",13),Ge(19,"#"),Ae(),De(20,"th",13),Ge(21,"First"),Ae(),De(22,"th",13),Ge(23,"Last"),Ae(),De(24,"th",13),Ge(25,"Handle"),Ae(),De(26,"th",13),Ge(27,"Handle"),Ae(),De(28,"th",13),Ge(29,"Handle"),Ae(),De(30,"th",13),Ge(31,"Handle"),Ae()()(),De(32,"tbody",14)(33,"tr")(34,"th",15),Ge(35,"1"),Ae(),Je(36,"td")(37,"td")(38,"td")(39,"td")(40,"td")(41,"td"),Ae(),De(42,"tr")(43,"th",15),Ge(44,"2"),Ae(),Je(45,"td")(46,"td")(47,"td")(48,"td")(49,"td")(50,"td"),Ae(),De(51,"tr")(52,"th",15),Ge(53,"3"),Ae(),Je(54,"td")(55,"td")(56,"td")(57,"td")(58,"td")(59,"td"),Ae()()(),Je(60,"div"),Ae(),Je(61,"br")(62,"br"),De(63,"button",16),Ge(64," Cerrar "),Ae()()),2&n&&(xn(63),jn("routerLink",Kn(1,xL)))},directives:[lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;height:80vh;display:flex;flex-direction:column;justify-content:center;align-items:center}.logo[_ngcontent-%COMP%]{width:180px}@media (max-width: 560px){.logo[_ngcontent-%COMP%]{width:30%;height:110px}}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;color:#fff;font-family:fantasy;font-size:25px;position:relative;right:52px}.container-4[_ngcontent-%COMP%]{overflow:hidden;width:300px;vertical-align:middle;white-space:nowrap;position:relative;right:18px}.container-4[_ngcontent-%COMP%]   input#search[_ngcontent-%COMP%]{width:300px;height:40px;background:#ffffff;border:none;font-size:10pt;float:left;color:#000;padding-left:15px;border-radius:5px}.container-4[_ngcontent-%COMP%]:hover   button.icon[_ngcontent-%COMP%], .container-4[_ngcontent-%COMP%]:active   button.icon[_ngcontent-%COMP%], .container-4[_ngcontent-%COMP%]:focus   button.icon[_ngcontent-%COMP%]{outline:none;opacity:1;margin-left:-50px}.container-4[_ngcontent-%COMP%]:hover   button.icon[_ngcontent-%COMP%]:hover{background:#232833}.container-4[_ngcontent-%COMP%]   button.icon[_ngcontent-%COMP%]{-webkit-border-top-right-radius:5px;-webkit-border-bottom-right-radius:5px;-moz-border-radius-topright:5px;-moz-border-radius-bottomright:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border:none;background:#232833;height:40px;width:50px;color:#4f5b66;opacity:0;font-size:10pt;transition:all .55s ease}.boton2[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:10%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:150px}.atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}.table-responsive[_ngcontent-%COMP%]{min-height:.01%;overflow-x:auto;background-color:#fff}@media screen and (max-width: 767px){.table-responsive[_ngcontent-%COMP%]{width:90%;margin-bottom:15px;overflow-y:hidden;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd}.table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%]{margin-bottom:15px}.table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{white-space:nowrap}}"]}),e})();function ZT(e,t,n,i,l,d,y){try{var w=e[d](y),T=w.value}catch(k){return void n(k)}w.done?t(T):Promise.resolve(T).then(i,l)}let ky=(()=>{class e{constructor(n){this.http=n,this.getUserLocation()}get isUserLocationReady(){return!!this.useLocation}getUserLocation(){var n=this;return function wL(e){return function(){var t=this,n=arguments;return new Promise(function(i,l){var d=e.apply(t,n);function y(T){ZT(d,i,l,y,w,"next",T)}function w(T){ZT(d,i,l,y,w,"throw",T)}y(void 0)})}}(function*(){return new Promise((i,l)=>{navigator.geolocation.getCurrentPosition(({coords:d})=>{n.useLocation=[d.longitude,d.latitude],i(n.useLocation)},d=>{alert("No se pudo obtener la geolocalizacion"),console.log(d),l()})})})()}getPlacesByQuery(n=""){this.http.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${n}.json?country=pe&proximity=-77.00043664878905%2C-11.974823012536064&types=place%2Caddress%2Cpoi%2Ccountry%2Clocality%2Cneighborhood%2Cregion&language=es&access_token=pk.eyJ1IjoibHVpczkyY3IiLCJhIjoiY2w0aXcwbXhrMDBhazNrcGlzMjBvazQ2cyJ9.EKtLqACAbJSS7WfU-4y_Qg`).subscribe(console.log)}}return e.\u0275fac=function(n){return new(n||e)(bt(TE))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),CL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-search-results"]],decls:13,vars:0,consts:[[1,"alert","alert-primary","mt-2","text-center"],[1,"list-group","mt-2"],[1,"list-group-item","list-group-item-action","pointer"],[1,"btn","btn-sm","btn-outline-primary"]],template:function(n,i){1&n&&(De(0,"div",0)(1,"h6"),Ge(2,"Cargando"),Ae(),De(3,"span"),Ge(4,"Espere por favor..."),Ae()(),De(5,"ul",1)(6,"li",2)(7,"h6"),Ge(8,"Lugar"),Ae(),De(9,"p"),Ge(10,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptas blanditiis, modi corrupti consequuntur mollitia iusto repudiandae, exercitationem aliquam distinctio totam nesciunt ut! Atque at rem consequatur vero? Cum, odit distinctio? "),Ae(),De(11,"button",3),Ge(12," Direcciones "),Ae()()())},styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}p[_ngcontent-%COMP%]{font-size:12px}"]}),e})(),WT=(()=>{class e{constructor(n){this.placesService=n}onQueryChanged(n=""){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.placesService.getPlacesByQuery(n)},350)}}return e.\u0275fac=function(n){return new(n||e)(Ze(ky))},e.\u0275cmp=zn({type:e,selectors:[["app-search-bar"]],decls:4,vars:0,consts:[[1,"search-container"],["type","text","placeholder","Buscar Lugar...",1,"form-control",3,"keyup"],["txtQuery",""]],template:function(n,i){if(1&n){const l=function ob(){return je()}();De(0,"div",0)(1,"input",1,2),Co("keyup",function(){!function yh(e){return Nt.lFrame.contextLView=e,e[8]}(l);const y=$v(2);return i.onQueryChanged(y.value)}),Ae(),Je(3,"app-search-results"),Ae()}},directives:[CL],styles:[".search-container[_ngcontent-%COMP%]{position:fixed;top:20px;left:20px;width:270px;background-color:#fff;padding:5px;box-shadow:0 10px 10px #0000001a;border-radius:5px;border:1px solid rgba(0,0,0,.1)}"]}),e})();const EL=function(){return["/","MapScreenComponent"]},DL=function(){return["/","UsuariofarmaciaComponent"]};let TL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:43,vars:4,consts:[[1,"contenedor"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",1,"logo"],[1,"slogan"],[1,"slogan2"],[1,"form"],[1,"form-check","mb-2"],["type","checkbox","value","","id","flexCheckIndeterminate","required","",1,"form-check-input"],["for","flexCheckIndeterminate",1,"terminos"],["for","validationDefault01",1,"form-label"],[1,"form-floating"],["type","text","id","floatingInput","placeholder","direccion","required","",1,"form-control"],["for","floatingInput"],[1,"slogan3"],["type","checkbox","value","","id","flexCheckIndeterminate","required","",1,"form1","form-check-input"],["for","flexCheckIndeterminate",1,"terminos1"],[1,"row"],[1,"col-md-3","col-md-offset-9","text-right"],["role","group",1,"btn-group","contenedor-botones"],["type","submit",1,"btn1","btn-primary",3,"routerLink"],["type","reset",1,"btn2","btn-primary",3,"routerLink"]],template:function(n,i){1&n&&(De(0,"div",0),Je(1,"img",1),De(2,"div",2),Ge(3,"TUFARMACIA"),Ae(),Je(4,"br"),De(5,"div",3),Ge(6,"REGISTRAR DIRECCION"),Ae(),De(7,"div")(8,"form",4),Je(9,"br"),De(10,"div",5),Je(11,"input",6),De(12,"label",7),Ge(13," Usar Direccion Actual "),Ae()(),De(14,"label",8)(15,"div",9),Je(16,"input",10),De(17,"label",11),Ge(18,"Direccion"),Ae()()(),Je(19,"app-search-bar")(20,"br")(21,"br"),De(22,"div",12),Ge(23,"ESTADO"),Ae(),Je(24,"br"),De(25,"div",5),Je(26,"input",13),De(27,"label",14),Ge(28," Activo "),Ae()(),De(29,"div",5),Je(30,"input",13),De(31,"label",14),Ge(32," Inactivo "),Ae()()(),Je(33,"br")(34,"br")(35,"br"),De(36,"div",15)(37,"div",16)(38,"div",17)(39,"button",18),Ge(40," Guardar "),Ae(),De(41,"button",19),Ge(42," Cerrar "),Ae()()()()()()),2&n&&(xn(39),jn("routerLink",Kn(2,EL)),xn(2),jn("routerLink",Kn(3,DL)))},directives:[Um,Lm,WT,lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;min-height:90vh;display:flex;align-items:center;justify-content:center;flex-direction:column}.logo[_ngcontent-%COMP%]{width:180px}@media (max-width: 560px){.logo[_ngcontent-%COMP%]{width:30%;height:110px}}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:25px;position:relative;right:30px}.slogan3[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:25px}.btn1[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:20%;margin:10px auto 20px;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:110px}.btn2[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:20%;margin:10px auto 20px 10px;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:110px}.form-floating[_ngcontent-%COMP%]{width:300%;max-width:310px;background:#c3c3c3;background-color:#bec5c2;border-radius:2500000px;left:-20%}.terminos[_ngcontent-%COMP%]{color:#fff;justify-content:center;position:relative;right:40px}.terminos1[_ngcontent-%COMP%]{color:#fff;justify-content:center;position:relative;right:-5px}.form-check-input[_ngcontent-%COMP%]{position:relative;right:40px}.form1[_ngcontent-%COMP%]{position:relative;right:-5px}"]}),e})();const ML=function(){return["/","UsuarioComponent"]};let SL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:27,vars:2,consts:[[1,"contenedor"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",1,"logo"],[1,"slogan"],[1,"slogan2"],[1,"box"],[1,"container-4"],["type","search","id","search","placeholder","Buscar.."],[1,"icon"],[1,"fa","fa-search"],["href","//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css","rel","stylesheet"],[1,"boton",3,"routerLink"]],template:function(n,i){1&n&&(De(0,"div",0),Je(1,"img",1),De(2,"div",2),Ge(3,"TUFARMACIA"),Ae(),Je(4,"br"),De(5,"div",3),Ge(6,"BUSCAR MEDICAMENTOS"),Ae(),De(7,"div",4)(8,"div",5),Je(9,"input",6),De(10,"button",7)(11,"i",8),Je(12,"link",9),Ae()()()(),Je(13,"br")(14,"br")(15,"br")(16,"br")(17,"br")(18,"br")(19,"br")(20,"br")(21,"br")(22,"br")(23,"br")(24,"br"),De(25,"button",10),Ge(26," Cerrar "),Ae()()),2&n&&(xn(25),jn("routerLink",Kn(1,ML)))},directives:[lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;height:80vh;display:flex;flex-direction:column;justify-content:center;align-items:center}.logo[_ngcontent-%COMP%]{width:180px}@media (max-width: 560px){.logo[_ngcontent-%COMP%]{width:30%;height:110px}}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;color:#fff;font-family:fantasy;font-size:25px;position:relative;right:45px}.container-4[_ngcontent-%COMP%]{overflow:hidden;width:300px;vertical-align:middle;white-space:nowrap;position:relative;right:18px}.container-4[_ngcontent-%COMP%]   input#search[_ngcontent-%COMP%]{width:300px;height:40px;background:#ffffff;border:none;font-size:10pt;float:left;color:#000;padding-left:15px;border-radius:5px}.container-4[_ngcontent-%COMP%]:hover   button.icon[_ngcontent-%COMP%], .container-4[_ngcontent-%COMP%]:active   button.icon[_ngcontent-%COMP%], .container-4[_ngcontent-%COMP%]:focus   button.icon[_ngcontent-%COMP%]{outline:none;opacity:1;margin-left:-50px}.container-4[_ngcontent-%COMP%]:hover   button.icon[_ngcontent-%COMP%]:hover{background:#232833}.container-4[_ngcontent-%COMP%]   button.icon[_ngcontent-%COMP%]{-webkit-border-top-right-radius:5px;-webkit-border-bottom-right-radius:5px;-moz-border-radius-topright:5px;-moz-border-radius-bottomright:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border:none;background:#232833;height:40px;width:50px;color:#4f5b66;opacity:0;font-size:10pt;transition:all .55s ease}.boton[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:10%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:150px}.atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}.table-responsive[_ngcontent-%COMP%]{min-height:.01%;overflow-x:auto;background-color:#fff}@media screen and (max-width: 767px){.table-responsive[_ngcontent-%COMP%]{width:90%;margin-bottom:15px;overflow-y:hidden;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd}.table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%]{margin-bottom:15px}.table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{white-space:nowrap}}"]}),e})();const IL=function(){return["/","UsuarioComponent"]};let AL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:27,vars:2,consts:[[1,"contenedor"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",1,"logo"],[1,"slogan"],[1,"slogan2"],[1,"box"],[1,"container-4"],["type","search","id","search","placeholder","Buscar.."],[1,"icon"],[1,"fa","fa-search"],["href","//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css","rel","stylesheet"],[1,"boton",3,"routerLink"]],template:function(n,i){1&n&&(De(0,"div",0),Je(1,"img",1),De(2,"div",2),Ge(3,"TUFARMACIA"),Ae(),Je(4,"br"),De(5,"div",3),Ge(6,"BUSCAR FARMACIAS"),Ae(),De(7,"div",4)(8,"div",5),Je(9,"input",6),De(10,"button",7)(11,"i",8),Je(12,"link",9),Ae()()()(),Je(13,"br")(14,"br")(15,"br")(16,"br")(17,"br")(18,"br")(19,"br")(20,"br")(21,"br")(22,"br")(23,"br")(24,"br"),De(25,"button",10),Ge(26," Cerrar "),Ae()()),2&n&&(xn(25),jn("routerLink",Kn(1,IL)))},directives:[lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;height:80vh;display:flex;flex-direction:column;justify-content:center;align-items:center}.logo[_ngcontent-%COMP%]{width:180px}@media (max-width: 560px){.logo[_ngcontent-%COMP%]{width:30%;height:110px}}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;color:#fff;font-family:fantasy;font-size:25px;position:relative;right:68px}.container-4[_ngcontent-%COMP%]{overflow:hidden;width:300px;vertical-align:middle;white-space:nowrap;position:relative;right:18px}.container-4[_ngcontent-%COMP%]   input#search[_ngcontent-%COMP%]{width:300px;height:40px;background:#ffffff;border:none;font-size:10pt;float:left;color:#000;padding-left:15px;border-radius:5px}.container-4[_ngcontent-%COMP%]:hover   button.icon[_ngcontent-%COMP%], .container-4[_ngcontent-%COMP%]:active   button.icon[_ngcontent-%COMP%], .container-4[_ngcontent-%COMP%]:focus   button.icon[_ngcontent-%COMP%]{outline:none;opacity:1;margin-left:-50px}.container-4[_ngcontent-%COMP%]:hover   button.icon[_ngcontent-%COMP%]:hover{background:#232833}.container-4[_ngcontent-%COMP%]   button.icon[_ngcontent-%COMP%]{-webkit-border-top-right-radius:5px;-webkit-border-bottom-right-radius:5px;-moz-border-radius-topright:5px;-moz-border-radius-bottomright:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border:none;background:#232833;height:40px;width:50px;color:#4f5b66;opacity:0;font-size:10pt;transition:all .55s ease}.boton[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:10%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:150px}.atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}.table-responsive[_ngcontent-%COMP%]{min-height:.01%;overflow-x:auto;background-color:#fff}@media screen and (max-width: 767px){.table-responsive[_ngcontent-%COMP%]{width:90%;margin-bottom:15px;overflow-y:hidden;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd}.table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%]{margin-bottom:15px}.table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{white-space:nowrap}}"]}),e})();const PL=function(){return["/","UsuarioComponent"]};let kL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-usuario"]],decls:21,vars:2,consts:[[1,"contenedor"],["src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",1,"logo"],[1,"slogan"],[1,"slogan2"],[1,"boton",3,"routerLink"]],template:function(n,i){1&n&&(De(0,"div",0),Je(1,"img",1),De(2,"div",2),Ge(3,"TUFARMACIA"),Ae(),Je(4,"br"),De(5,"div",3),Ge(6,"HISTORIAL DE BUSQUEDA"),Ae(),Je(7,"br")(8,"br")(9,"br")(10,"br")(11,"br")(12,"br")(13,"br")(14,"br")(15,"br")(16,"br")(17,"br")(18,"br"),De(19,"button",4),Ge(20," Cerrar "),Ae()()),2&n&&(xn(19),jn("routerLink",Kn(1,PL)))},directives:[lo],styles:[".contenedor[_ngcontent-%COMP%]{background-color:#000;width:100%;height:80vh;display:flex;flex-direction:column;justify-content:center;align-items:center}.logo[_ngcontent-%COMP%]{width:180px}@media (max-width: 560px){.logo[_ngcontent-%COMP%]{width:30%;height:110px}}.slogan[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:30px}.slogan2[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;font-family:fantasy;font-size:25px;position:relative}.boton[_ngcontent-%COMP%]{display:flex;cursor:pointer;justify-content:center;width:10%;margin-left:auto;margin-right:auto;font-family:Arial;color:#fff;font-size:20px;padding:5px;background-color:#00ff6f;border-color:#00ff6f;border-radius:5px;min-width:150px}.atras[_ngcontent-%COMP%]{position:absolute;top:10px;left:20px}"]}),e})(),RL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-loading"]],decls:6,vars:0,consts:[[1,"loading-map","d-flex","justify-content-center","align-items-center"],[1,"text-center"]],template:function(n,i){1&n&&(De(0,"div",0)(1,"div",1)(2,"h3"),Ge(3,"Espere por favor"),Ae(),De(4,"span"),Ge(5,"Localizando..."),Ae()()())},styles:[".loading-map[_ngcontent-%COMP%]{background-color:#000c;color:#fff;height:100vh;position:fixed;right:0px;top:0px;width:100vw}"]}),e})();var Ry=jl(898),OL=jl.n(Ry);let XT=(()=>{class e{get isMapReady(){return!!this.map}setMap(n){this.map=n}flyTo(n){var i;if(!this.isMapReady)throw Error("El mapa no esta inicializado");null===(i=this.map)||void 0===i||i.flyTo({zoom:14,center:n})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const FL=["mapDiv"];let LL=(()=>{class e{constructor(n,i){this.placesService=n,this.mapService=i}ngAfterViewInit(){if(!this.placesService.useLocation)throw Error("No hay placesServices.userLocation");const n=new Ry.Map({container:this.mapDivElement.nativeElement,style:"mapbox://styles/mapbox/streets-v11",center:this.placesService.useLocation,zoom:14}),i=(new Ry.Popup).setHTML("\n    <h6>Aqui estoy</h6>\n    <span>Estoy en este lugar del mundo</span>\n\n    ");new Ry.Marker({color:"red"}).setLngLat(this.placesService.useLocation).setPopup(i).addTo(n),this.mapService.setMap(n)}}return e.\u0275fac=function(n){return new(n||e)(Ze(ky),Ze(XT))},e.\u0275cmp=zn({type:e,selectors:[["app-map-view"]],viewQuery:function(n,i){if(1&n&&Hw(FL,5),2&n){let l;A_(l=function P_(){return function lA(e,t){return e[19].queries[t].queryList}(je(),p())}())&&(i.mapDivElement=l.first)}},decls:2,vars:0,consts:[[1,"map-container"],["mapDiv",""]],template:function(n,i){1&n&&Je(0,"div",0,1)},styles:[".map-container[_ngcontent-%COMP%]{background-color:#fff;position:fixed;top:0px;right:0px;width:100vw;height:100vh}"]}),e})(),zL=(()=>{class e{constructor(n,i){this.placeService=n,this.mapService=i}goToMyLocation(){if(!this.placeService.isUserLocationReady)throw Error("No hay Ubicacion");if(!this.mapService.isMapReady)throw Error("No hay mapa disponible");this.mapService.flyTo(this.placeService.useLocation)}}return e.\u0275fac=function(n){return new(n||e)(Ze(ky),Ze(XT))},e.\u0275cmp=zn({type:e,selectors:[["app-btn-my-location"]],decls:2,vars:0,consts:[[1,"btn","btn-primary",3,"click"]],template:function(n,i){1&n&&(De(0,"button",0),Co("click",function(){return i.goToMyLocation()}),Ge(1,"\nMi Ubicacion\n"),Ae())},styles:["button[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px}"]}),e})();const BL=function(){return["/","UsuariofarmaciaComponent"]};let NL=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zn({type:e,selectors:[["app-farmacia-logo"]],decls:1,vars:2,consts:[["width","100","alt","Logo Farmacia","src","https://cdn.discordapp.com/attachments/719010991924314126/977421848151216158/logotf.png",3,"routerLink"]],template:function(n,i){1&n&&Je(0,"img",0),2&n&&jn("routerLink",Kn(1,BL))},directives:[lo],styles:["img[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px}"]}),e})();function VL(e,t){1&e&&Je(0,"app-loading")}function UL(e,t){1&e&&Je(0,"app-map-view")(1,"app-btn-my-location")(2,"app-search-bar")}const jL=[{path:"",component:JF},{path:"PerfilComponent",component:eL},{path:"LoginComponent",component:rL},{path:"UsuarioComponent",component:cL},{path:"UsuariofarmaciaComponent",component:mL},{path:"EditarUsuarioComponent",component:_L},{path:"MedicamentoComponent",component:vL},{path:"ListarMedicamentoComponent",component:bL},{path:"DireccionComponent",component:TL},{path:"BuscarMedicamentoComponent",component:SL},{path:"BuscarFarmaciaComponent",component:AL},{path:"HistorialComponent",component:kL},{path:"MapScreenComponent",component:(()=>{class e{constructor(n){this.placesService=n}get isUserLocationReady(){return this.placesService.isUserLocationReady}}return e.\u0275fac=function(n){return new(n||e)(Ze(ky))},e.\u0275cmp=zn({type:e,selectors:[["app-map-screen"]],decls:4,vars:2,consts:[[4,"ngIf","ngIfElse"],["mapReady",""]],template:function(n,i){if(1&n&&(jv(0,VL,1,0,"app-loading",0),jv(1,UL,3,0,"ng-template",null,1,Xw),Je(3,"app-farmacia-logo")),2&n){const l=$v(2);jn("ngIf",!i.isUserLocationReady)("ngIfElse",l)}},directives:[YC,RL,LL,zL,WT,NL],styles:[""]}),e})()}];let $L=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({imports:[[o1.forRoot(jL)],o1]}),e})(),GL=(()=>{class e{constructor(n){this.formBuilder=n,this.title="Appfarmacia"}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)(Ze(zR))},e.\u0275cmp=zn({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,i){1&n&&Je(0,"router-outlet")},directives:[Q0],styles:["html[_ngcontent-%COMP%]{background:black}"]}),e})();const HL=["addListener","removeListener"],qL=["addEventListener","removeEventListener"],ZL=["on","off"];function Oy(e,t,n,i){if(dn(n)&&(i=n,n=void 0),i)return Oy(e,t,n).pipe(m0(i));const[l,d]=function KL(e){return dn(e.addEventListener)&&dn(e.removeEventListener)}(e)?qL.map(y=>w=>e[y](t,w,n)):function WL(e){return dn(e.addListener)&&dn(e.removeListener)}(e)?HL.map(KT(e,t)):function XL(e){return dn(e.on)&&dn(e.off)}(e)?ZL.map(KT(e,t)):[];if(!l&&Wo(e))return Ue(y=>Oy(y,t,n))(z(e));if(!l)throw new TypeError("Invalid event target");return new Dn(y=>{const w=(...T)=>y.next(1<T.length?T:T[0]);return l(w),()=>d(w)})}function KT(e,t){return n=>i=>e[n](t,i)}const Ku=new Dn(Mo),JL={connector:()=>new br};function YT(e,t=JL){const{connector:n}=t;return $n((i,l)=>{const d=n();qn(e(function YL(e){return new Dn(t=>e.subscribe(t))}(d))).subscribe(l),l.add(i.subscribe(d))})}class tz extends er{constructor(t,n){super()}schedule(t,n=0){return this}}const Fy={setInterval(e,t,...n){const{delegate:i}=Fy;return(null==i?void 0:i.setInterval)?i.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=Fy;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},JT={now:()=>(JT.delegate||Date).now(),delegate:void 0};class tg{constructor(t,n=tg.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,i){return new this.schedulerActionCtor(this,t).schedule(i,n)}}tg.now=JT.now;const QT=new class rz extends tg{constructor(t,n=tg.now){super(t,n),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}}}(class nz extends tz{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){if(this.closed)return this;this.state=t;const i=this.id,l=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(l,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(l,this.id,n),this}requestAsyncId(t,n,i=0){return Fy.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,n,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return n;Fy.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,n);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let l,i=!1;try{this.work(t)}catch(d){i=!0,l=d||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),l}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:i}=n;this.work=this.state=this.scheduler=null,this.pending=!1,f(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}),iz=QT;function eM(e,t){return t?n=>$m(t.pipe(Gn(1),function oz(){return $n((e,t)=>{e.subscribe(tr(t,Mo))})}()),n.pipe(eM(e))):Ue((n,i)=>e(n,i).pipe(Gn(1),function sz(e){return Ot(()=>e)}(n)))}const ng="Service workers are disabled or not supported by this browser";class Ly{constructor(t){if(this.serviceWorker=t,t){const i=Oy(t,"controllerchange").pipe(Ot(()=>t.controller)),d=$m(gy(()=>Zt(t.controller)),i);this.worker=d.pipe(us(L=>!!L)),this.registration=this.worker.pipe(Ua(()=>t.getRegistration()));const k=Oy(t,"message").pipe(Ot(L=>L.data)).pipe(us(L=>L&&L.type)).pipe(function ez(e){return e?t=>YT(e)(t):t=>function QL(e,t){const n=dn(e)?e:()=>e;return dn(t)?YT(t,{connector:n}):i=>new UD(i,n)}(new br)(t)}());k.connect(),this.events=k}else this.worker=this.events=this.registration=function uz(e){return gy(()=>jm(new Error(e)))}(ng)}postMessage(t,n){return this.worker.pipe(Gn(1),jo(i=>{i.postMessage(Object.assign({action:t},n))})).toPromise().then(()=>{})}postMessageWithOperation(t,n,i){const l=this.waitForOperationCompleted(i),d=this.postMessage(t,n);return Promise.all([d,l]).then(([,y])=>y)}generateNonce(){return Math.round(1e7*Math.random())}eventsOfType(t){let n;return n="string"==typeof t?i=>i.type===t:i=>t.includes(i.type),this.events.pipe(us(n))}nextEventOfType(t){return this.eventsOfType(t).pipe(Gn(1))}waitForOperationCompleted(t){return this.eventsOfType("OPERATION_COMPLETED").pipe(us(n=>n.nonce===t),Gn(1),Ot(n=>{if(void 0!==n.result)return n.result;throw new Error(n.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}}let hz=(()=>{class e{constructor(n){if(this.sw=n,this.subscriptionChanges=new br,!n.isEnabled)return this.messages=Ku,this.notificationClicks=Ku,void(this.subscription=Ku);this.messages=this.sw.eventsOfType("PUSH").pipe(Ot(l=>l.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(Ot(l=>l.data)),this.pushManager=this.sw.registration.pipe(Ot(l=>l.pushManager));const i=this.pushManager.pipe(Ua(l=>l.getSubscription()));this.subscription=ys(i,this.subscriptionChanges)}get isEnabled(){return this.sw.isEnabled}requestSubscription(n){if(!this.sw.isEnabled)return Promise.reject(new Error(ng));const i={userVisibleOnly:!0};let l=this.decodeBase64(n.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),d=new Uint8Array(new ArrayBuffer(l.length));for(let y=0;y<l.length;y++)d[y]=l.charCodeAt(y);return i.applicationServerKey=d,this.pushManager.pipe(Ua(y=>y.subscribe(i)),Gn(1)).toPromise().then(y=>(this.subscriptionChanges.next(y),y))}unsubscribe(){return this.sw.isEnabled?this.subscription.pipe(Gn(1),Ua(i=>{if(null===i)throw new Error("Not subscribed to push notifications.");return i.unsubscribe().then(l=>{if(!l)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})})).toPromise():Promise.reject(new Error(ng))}decodeBase64(n){return atob(n)}}return e.\u0275fac=function(n){return new(n||e)(bt(Ly))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),dz=(()=>{class e{constructor(n){if(this.sw=n,!n.isEnabled)return this.versionUpdates=Ku,this.available=Ku,this.activated=Ku,void(this.unrecoverable=Ku);this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY"]),this.available=this.versionUpdates.pipe(us(i=>"VERSION_READY"===i.type),Ot(i=>({type:"UPDATE_AVAILABLE",current:i.currentVersion,available:i.latestVersion}))),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED"),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}get isEnabled(){return this.sw.isEnabled}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(ng));const n=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:n},n)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(ng));const n=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:n},n)}}return e.\u0275fac=function(n){return new(n||e)(bt(Ly))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();class a1{}const tM=new Ft("NGSW_REGISTER_SCRIPT");function fz(e,t,n,i){return()=>{if(!rE(i)||!("serviceWorker"in navigator)||!1===n.enabled)return;let d;if(navigator.serviceWorker.addEventListener("controllerchange",()=>{null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),"function"==typeof n.registrationStrategy)d=n.registrationStrategy();else{const[w,...T]=(n.registrationStrategy||"registerWhenStable:30000").split(":");switch(w){case"registerImmediately":d=Zt(null);break;case"registerWithDelay":d=nM(+T[0]||0);break;case"registerWhenStable":d=T[0]?ys(rM(e),nM(+T[0])):rM(e);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${n.registrationStrategy}`)}}e.get(Ei).runOutsideAngular(()=>d.pipe(Gn(1)).subscribe(()=>navigator.serviceWorker.register(t,{scope:n.scope}).catch(w=>console.error("Service worker registration failed with:",w))))}}function nM(e){return Zt(null).pipe(function cz(e,t=QT){const n=function lz(e=0,t,n=iz){let i=-1;return null!=t&&(xt(t)?n=t:i=t),new Dn(l=>{let d=function az(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;d<0&&(d=0);let y=0;return n.schedule(function(){l.closed||(l.next(y++),0<=i?this.schedule(void 0,i):l.complete())},d)})}(e,t);return eM(()=>n)}(e))}function rM(e){return e.get(L_).isStable.pipe(us(n=>n))}function pz(e,t){return new Ly(rE(t)&&!1!==e.enabled?navigator.serviceWorker:void 0)}let mz=(()=>{class e{static register(n,i={}){return{ngModule:e,providers:[{provide:tM,useValue:n},{provide:a1,useValue:i},{provide:Ly,useFactory:pz,deps:[a1,Im]},{provide:F_,useFactory:fz,deps:[Ee,tM,a1,Im],multi:!0}]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({providers:[hz,dz]}),e})();let gz=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e}),e.\u0275inj=ti({imports:[[tE,o1]]}),e})(),_z=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Fr({type:e,bootstrap:[GL]}),e.\u0275inj=ti({providers:[],imports:[[uk,Ok,BD,$L,gz,mz.register("ngsw-worker.js",{enabled:true,registrationStrategy:"registerImmediately"})]]}),e})();if(OL().accessToken="pk.eyJ1IjoibHVpczkyY3IiLCJhIjoiY2w0aXcwbXhrMDBhazNrcGlzMjBvazQ2cyJ9.EKtLqACAbJSS7WfU-4y_Qg",!navigator.geolocation)throw alert("Navegador no soporta la Geolocalizacion"),new Error("Navegador no soporta la Geolocalizacion");(function WA(){DC=!1})(),lk().bootstrapModule(_z).catch(e=>console.error(e))},898:function(np){np.exports=function(){"use strict";var Hc,jl,dn;function Yu(f,er){if(Hc)if(jl){var $o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Hc+")(sharedChunk); ("+jl+")(sharedChunk); self.onerror = null;",fi={};Hc(fi),dn=er(fi),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(dn.workerUrl=window.URL.createObjectURL(new Blob([$o],{type:"text/javascript"})))}else jl=er;else Hc=er}return Yu(0,function(f){var $o=fi;function fi(s,r,a,c){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=c,this.p2x=a,this.p2y=c}fi.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},fi.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},fi.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},fi.prototype.solveCurveX=function(s,r){var a,c,h,m,_;for(void 0===r&&(r=1e-6),h=s,_=0;_<8;_++){if(m=this.sampleCurveX(h)-s,Math.abs(m)<r)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=m/v}if((h=s)<(a=0))return a;if(h>(c=1))return c;for(;a<c;){if(m=this.sampleCurveX(h),Math.abs(m-s)<r)return h;s>m?a=h:c=h,h=.5*(c-a)+a}return h},fi.prototype.solve=function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))};var Oe=Pt;function Pt(s,r){this.x=s,this.y=r}Pt.prototype={clone:function(){return new Pt(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,a=s.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),a=Math.sin(s),c=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=c,this},_rotateAround:function(s,r){var a=Math.cos(s),c=Math.sin(s),h=r.y+c*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-c*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pt.convert=function(s){return s instanceof Pt?s:Array.isArray(s)?new Pt(s[0],s[1]):s};var ft="undefined"!=typeof self?self:{};const co=Math.PI/180,Mo=180/Math.PI;function nn(s){return s*co}function pi(s){return s*Mo}const qc=[[0,0],[1,0],[1,1],[0,1]];function Go(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,a=r*s;return 4*(s<.5?a:3*(s-r)+a-.75)}function Di(s,r,a,c){const h=new $o(s,r,a,c);return function(m){return h.solve(m)}}const Ti=Di(.25,.1,.25,1);function tn(s,r,a){return Math.min(a,Math.max(r,s))}function Js(s,r,a){return(a=tn((a-s)/(r-s),0,1))*a*(3-2*a)}function So(s,r,a){const c=a-r,h=((s-r)%c+c)%c+r;return h===r?a:h}function fs(s,r,a){if(!s.length)return a(null,[]);let c=s.length;const h=new Array(s.length);let m=null;s.forEach((_,v)=>{r(_,(C,D)=>{C&&(m=C),h[v]=D,0==--c&&a(m,h)})})}function $l(s){const r=[];for(const a in s)r.push(s[a]);return r}function or(s,...r){for(const a of r)for(const c in a)s[c]=a[c];return s}let ps=1;function ja(){return ps++}function $a(){return function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Zc(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Ho(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Ni(s,r){s.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function qo(s,r){return-1!==s.indexOf(r,s.length-r.length)}function Zo(s,r,a){const c={};for(const h in s)c[h]=r.call(a||this,s[h],h,s);return c}function Dn(s,r,a){const c={};for(const h in s)r.call(a||this,s[h],h,s)&&(c[h]=s[h]);return c}function Mi(s){return Array.isArray(s)?s.map(Mi):"object"==typeof s&&s?Zo(s,Mi):s}const Wc={};function Tn(s){Wc[s]||("undefined"!=typeof console&&console.warn(s),Wc[s]=!0)}function Gr(s,r,a){return(a.y-s.y)*(r.x-s.x)>(r.y-s.y)*(a.x-s.x)}function br(s){let r=0;for(let a,c,h=0,m=s.length,_=m-1;h<m;_=h++)a=s[h],c=s[_],r+=(c.x-a.x)*(a.y+c.y);return r}function Vi(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Qs(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,c,h,m)=>{const _=h||m;return r[c]=!_||_.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let $n,tr,ea,Ot,qt=null;function ta(s){if(null==qt){const r=s.navigator?s.navigator.userAgent:null;qt=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return qt}function Gl(s){try{const r=ft[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const Si={now:()=>void 0!==ea?ea:ft.performance.now(),setNow(s){ea=s},restoreNow(){ea=void 0},frame(s){const r=ft.requestAnimationFrame(s);return{cancel:()=>ft.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:a,height:c}=s;Ot||(Ot=ft.document.createElement("canvas"));const h=Ot.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(a>Ot.width||c>Ot.height)&&(Ot.width=a,Ot.height=c),h.clearRect(-r,-r,a+2*r,c+2*r),h.drawImage(s,0,0,a,c),h.getImageData(-r,-r,a+2*r,c+2*r)},resolveURL:s=>($n||($n=ft.document.createElement("a")),$n.href=s,$n.href),get devicePixelRatio(){return ft.devicePixelRatio},get prefersReducedMotion(){return!!ft.matchMedia&&(null==tr&&(tr=ft.matchMedia("(prefers-reduced-motion: reduce)")),tr.matches)}};let Ga;const fn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ga){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ga=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch(r){Ga=s}}return Ga},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},na={supported:!1,testSupport:function(s){!ms&&uo&&(Hl?Ha(s):ra=s)}};let ra,uo,ms=!1,Hl=!1;function Ha(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,uo),s.isContextLost())return;na.supported=!0}catch(a){}s.deleteTexture(r),ms=!0}ft.document&&(uo=ft.document.createElement("img"),uo.onload=function(){ra&&Ha(ra),ra=null,Hl=!0},uo.onerror=function(){ms=!0,ra=null},uo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qa="01",Za="NO_ACCESS_TOKEN";function Io(s){return 0===s.indexOf("mapbox:")}function Wa(s){return fn.API_URL_REGEX.test(s)}const Or=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ho(s){const r=s.match(Or);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function ia(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}function ql(s){if(!s)return null;const r=s.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(ft.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(a){return null}}class Xa{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=ql(fn.ACCESS_TOKEN);let c="";return c=a&&a.u?ft.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(Number("0x"+m)))):fn.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const r=Gl("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const h=ft.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));const m=ft.localStorage.getItem(c);m&&(this.anonId=m)}catch(h){Tn("Unable to read from LocalStorage")}}saveEventData(){const r=Gl("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{ft.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&ft.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){Tn("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,c,h){if(!fn.EVENTS_URL)return;const m=ho(fn.EVENTS_URL);m.params.push(`access_token=${h||fn.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.8.2",skuId:qa,userId:this.anonId},v=a?or(_,a):_,C={url:ia(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=ce(C,D=>{this.pendingRequest=null,c(D),this.saveEventData(),this.processRequests(h)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const Ka=new class extends Xa{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){fn.EVENTS_URL&&fn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(a=>Io(a)||Wa(a))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=ql(fn.ACCESS_TOKEN),a=r?r.u:fn.ACCESS_TOKEN;let c=a!==this.eventData.tokenU;Ho(this.anonId)||(this.anonId=$a(),c=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;c=c||v>=1||v<-1||m.getDate()!==_.getDate()}else c=!0;c?this.postEvent(h,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=a)},s):this.processRequests()}},Ed=Ka.postTurnstileEvent.bind(Ka),Ju=new class extends Xa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,a,c){this.skuToken=r,this.errorCb=c,fn.EVENTS_URL&&(a||fn.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(Za)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Ho(this.anonId)||(this.anonId=$a()),this.postEvent(a,{skuToken:this.skuToken},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},s))}},Qu=Ju.postMapLoadEvent.bind(Ju),Zl=new class extends Xa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,a,c){if(!fn.API_URL||!fn.SESSION_PATH)return;const h=ho(fn.API_URL+fn.SESSION_PATH);h.params.push(`sku=${r||""}`),h.params.push(`access_token=${c||fn.ACCESS_TOKEN||""}`);const m={url:ia(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ge(m,_=>{this.pendingRequest=null,a(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(s,r,a,c){this.skuToken=r,this.errorCb=c,fn.SESSION_PATH&&fn.API_URL&&(a||fn.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(Za)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},s)}},eh=Zl.getSessionAPI.bind(Zl),Wo=new Set,Wl="mapbox-tiles";let Ui,Xo,gs=500,oa=50;function sa(){ft.caches&&!Ui&&(Ui=ft.caches.open(Wl))}function Ya(s){const r=s.indexOf("?");return r<0?s:s.slice(0,r)}let aa=1/0;const J={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(J);class z extends Error{constructor(r,a,c){401===a&&Wa(c)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const V=Vi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ft.location.protocol?ft.parent:ft).location.href,W=function(s,r){if(!(/^file:/.test(a=s.url)||/^file:/.test(V())&&!/^\w+:/.test(a))){if(ft.fetch&&ft.Request&&ft.AbortController&&ft.Request.prototype.hasOwnProperty("signal"))return function(c,h){const m=new ft.AbortController,_=new ft.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:V(),signal:m.signal});let v=!1,C=!1;const D=(S=_.url).indexOf("sku=")>0&&Wa(S);var S;"json"===c.type&&_.headers.set("Accept","application/json");const I=(F,N,G)=>{if(C)return;if(F&&"SecurityError"!==F.message&&Tn(F),N&&G)return P(N);const Z=Date.now();ft.fetch(_).then(K=>{if(K.ok){const se=D?K.clone():null;return P(K,se,Z)}return h(new z(K.statusText,K.status,c.url))}).catch(K=>{20!==K.code&&h(new Error(K.message))})},P=(F,N,G)=>{("arrayBuffer"===c.type?F.arrayBuffer():"json"===c.type?F.json():F.text()).then(Z=>{C||(N&&G&&function(K,se,le){if(sa(),!Ui)return;const he={status:se.status,statusText:se.statusText,headers:new ft.Headers};se.headers.forEach((we,Me)=>he.headers.set(Me,we));const de=Qs(se.headers.get("Cache-Control")||"");if(de["no-store"])return;de["max-age"]&&he.headers.set("Expires",new Date(le+1e3*de["max-age"]).toUTCString());const fe=he.headers.get("Expires");fe&&(new Date(fe).getTime()-le<42e4||function(we,Me){if(void 0===Xo)try{new Response(new ReadableStream),Xo=!0}catch(ke){Xo=!1}Xo?Me(we.body):we.blob().then(Me)}(se,we=>{const Me=new ft.Response(we,he);sa(),Ui&&Ui.then(ke=>ke.put(Ya(K.url),Me)).catch(ke=>Tn(ke.message))}))}(_,N,G),v=!0,h(null,Z,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Z=>{C||h(new Error(Z.message))})};return D?function(F,N){if(sa(),!Ui)return N(null);const G=Ya(F.url);Ui.then(Z=>{Z.match(G).then(K=>{const se=function(le){if(!le)return!1;const he=new Date(le.headers.get("Expires")||0),de=Qs(le.headers.get("Cache-Control")||"");return he>Date.now()&&!de["no-cache"]}(K);Z.delete(G),se&&Z.put(G,K.clone()),N(null,K,se)}).catch(N)}).catch(N)}(_,I):I(null,null),{cancel:()=>{C=!0,v||m.abort()}}}(s,r);if(Vi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var a;return function(c,h){const m=new ft.XMLHttpRequest;m.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(m.responseType="arraybuffer");for(const _ in c.headers)m.setRequestHeader(_,c.headers[_]);return"json"===c.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===c.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===c.type)try{_=JSON.parse(m.response)}catch(v){return h(v)}h(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new z(m.statusText,m.status,c.url))},m.send(c.body),{cancel:()=>m.abort()}}(s,r)},re=function(s,r){return W(or(s,{type:"arrayBuffer"}),r)},ce=function(s,r){return W(or(s,{method:"POST"}),r)},ge=function(s,r){return W(or(s,{method:"GET"}),r)};function _e(s){const r=ft.document.createElement("a");return r.href=s,r.protocol===ft.document.location.protocol&&r.host===ft.document.location.host}const ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ye,Re;ye=[],Re=0;const Ue=function(s,r){if(na.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Re>=fn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return ye.push(m),m}Re++;let a=!1;const c=()=>{if(!a)for(a=!0,Re--;ye.length&&Re<fn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=ye.shift(),{requestParameters:_,callback:v,cancelled:C}=m;C||(m.cancel=Ue(_,v).cancel)}},h=re(s,(m,_,v,C)=>{c(),m?r(m):_&&(ft.createImageBitmap?function(D,S){const I=new ft.Blob([new Uint8Array(D)],{type:"image/png"});ft.createImageBitmap(I).then(P=>{S(null,P)}).catch(P=>{S(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(D,S)=>r(D,S,v,C)):function(D,S){const I=new ft.Image,P=ft.URL;I.onload=()=>{S(null,I),P.revokeObjectURL(I.src),I.onload=null,ft.requestAnimationFrame(()=>{I.src=ue})},I.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new ft.Blob([new Uint8Array(D)],{type:"image/png"});I.src=D.byteLength?P.createObjectURL(F):ue}(_,(D,S)=>r(D,S,v,C)))});return{cancel:()=>{h.cancel(),c()}}};function Le(s,r,a){a[s]&&-1!==a[s].indexOf(r)||(a[s]=a[s]||[],a[s].push(r))}function ut(s,r,a){if(a&&a[s]){const c=a[s].indexOf(r);-1!==c&&a[s].splice(c,1)}}class gt{constructor(r,a={}){or(this,a),this.type=r}}class pt extends gt{constructor(r,a={}){super("error",or({error:r},a))}}class xt{on(r,a){return this._listeners=this._listeners||{},Le(r,a,this._listeners),this}off(r,a){return ut(r,a,this._listeners),ut(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Le(r,a,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,a){"string"==typeof r&&(r=new gt(r,a||{}));const c=r.type;if(this.listens(c)){r.target=this;const h=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const v of h)v.call(this,r);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const v of m)ut(c,v,this._oneTimeListeners),v.call(this,r);const _=this._eventedParent;_&&(or(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(r))}else r instanceof pt&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var xe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function sn(s,...r){for(const a of r)for(const c in a)s[c]=a[c];return s}function rt(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function an(s){if(Array.isArray(s))return s.map(an);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const a in s)r[a]=an(s[a]);return r}return rt(s)}class ln extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class _s{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[c,h]of a)this.bindings[c]=h}concat(r){return new _s(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Ko={kind:"null"},Qe={kind:"number"},Wt={kind:"string"},Ut={kind:"boolean"},fo={kind:"color"},la={kind:"object"},$t={kind:"value"},qn={kind:"collator"},ys={kind:"formatted"},Gn={kind:"resolvedImage"};function ji(s,r){return{kind:"array",itemType:s,N:r}}function Fn(s){if("array"===s.kind){const r=Fn(s.itemType);return"number"==typeof s.N?`array<${r}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${r}>`}return s.kind}const Ln=[Ko,Qe,Wt,Ut,fo,ys,la,ji($t),Gn];function ca(s,r){if("error"===r.kind)return null;if("array"===s.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!ca(s.itemType,r.itemType))&&("number"!=typeof s.N||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if("value"===s.kind)for(const a of Ln)if(!ca(a,r))return null}return`Expected ${Fn(s)} but found ${Fn(r)} instead.`}function _n(s,r){return r.some(a=>a.kind===s.kind)}function vs(s,r){return r.some(a=>"null"===a?null===s:"array"===a?Array.isArray(s):"object"===a?s&&!Array.isArray(s)&&"object"==typeof s:a===typeof s)}function Xc(s){var r={exports:{}};return s(r,r.exports),r.exports}var In=Xc(function(s,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(v){return(v=Math.round(v))<0?0:v>255?255:v}function h(v){return c("%"===v[v.length-1]?parseFloat(v)/100*255:parseInt(v))}function m(v){return(C="%"===v[v.length-1]?parseFloat(v)/100:parseFloat(v))<0?0:C>1?1:C;var C}function _(v,C,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?v+(C-v)*D*6:2*D<1?C:3*D<2?v+(C-v)*(2/3-D)*6:v}try{r.parseCSSColor=function(v){var C,D=v.replace(/ /g,"").toLowerCase();if(D in a)return a[D].slice();if("#"===D[0])return 4===D.length?(C=parseInt(D.substr(1),16))>=0&&C<=4095?[(3840&C)>>4|(3840&C)>>8,240&C|(240&C)>>4,15&C|(15&C)<<4,1]:null:7===D.length&&(C=parseInt(D.substr(1),16))>=0&&C<=16777215?[(16711680&C)>>16,(65280&C)>>8,255&C,1]:null;var S=D.indexOf("("),I=D.indexOf(")");if(-1!==S&&I+1===D.length){var P=D.substr(0,S),F=D.substr(S+1,I-(S+1)).split(","),N=1;switch(P){case"rgba":if(4!==F.length)return null;N=m(F.pop());case"rgb":return 3!==F.length?null:[h(F[0]),h(F[1]),h(F[2]),N];case"hsla":if(4!==F.length)return null;N=m(F.pop());case"hsl":if(3!==F.length)return null;var G=(parseFloat(F[0])%360+360)%360/360,Z=m(F[1]),K=m(F[2]),se=K<=.5?K*(Z+1):K+Z-K*Z,le=2*K-se;return[c(255*_(le,se,G+1/3)),c(255*_(le,se,G)),c(255*_(le,se,G-1/3)),N];default:return null}}return null}}catch(v){}});class lt{constructor(r,a,c,h=1){this.r=r,this.g=a,this.b=c,this.a=h}static parse(r){if(!r)return;if(r instanceof lt)return r;if("string"!=typeof r)return;const a=In.parseCSSColor(r);return a?new lt(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,c,h]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(c)},${h})`}toArray(){const{r,g:a,b:c,a:h}=this;return 0===h?[0,0,0,0]:[255*r/h,255*a/h,255*c/h,h]}}lt.black=new lt(0,0,0,1),lt.white=new lt(1,1,1,1),lt.transparent=new lt(0,0,0,0),lt.red=new lt(1,0,0,1),lt.blue=new lt(0,0,1,1);class ua{constructor(r,a,c){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dd{constructor(r,a,c,h,m){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=c,this.fontStack=h,this.textColor=m}}class Tt{constructor(r){this.sections=r}static fromString(r){return new Tt([new Dd(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Tt?r:Tt.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const c={};a.fontStack&&(c["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(c["font-scale"]=a.scale),a.textColor&&(c["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(c)}return r}}class Qr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Qr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Dt(s,r,a,c){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[s,r,a,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[s,r,a,c]:[s,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fr(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof lt||s instanceof ua||s instanceof Tt||s instanceof Qr)return!0;if(Array.isArray(s)){for(const r of s)if(!fr(r))return!1;return!0}if("object"==typeof s){for(const r in s)if(!fr(s[r]))return!1;return!0}return!1}function lr(s){if(null===s)return Ko;if("string"==typeof s)return Wt;if("boolean"==typeof s)return Ut;if("number"==typeof s)return Qe;if(s instanceof lt)return fo;if(s instanceof ua)return qn;if(s instanceof Tt)return ys;if(s instanceof Qr)return Gn;if(Array.isArray(s)){const r=s.length;let a;for(const c of s){const h=lr(c);if(a){if(a===h)continue;a=$t;break}a=h}return ji(a||$t,r)}return la}function xs(s){const r=typeof s;return null===s?"":"string"===r||"number"===r||"boolean"===r?String(s):s instanceof lt||s instanceof Tt||s instanceof Qr?s.toString():JSON.stringify(s)}class bs{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!fr(r[1]))return a.error("invalid value");const c=r[1];let h=lr(c);const m=a.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new bs(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof lt?["rgba"].concat(this.value.toArray()):this.value instanceof Tt?this.value.serialize():this.value}}class pr{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const ei={string:Wt,number:Qe,boolean:Ut,object:la};class Ao{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let c,h=1;const m=r[0];if("array"===m){let v,C;if(r.length>2){const D=r[1];if("string"!=typeof D||!(D in ei)||"object"===D)return a.error('The item type argument of "array" must be one of string, number, boolean',1);v=ei[D],h++}else v=$t;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=r[2],h++}c=ji(v,C)}else c=ei[m];const _=[];for(;h<r.length;h++){const v=a.parse(r[h],h,$t);if(!v)return null;_.push(v)}return new Ao(c,_)}evaluate(r){for(let a=0;a<this.args.length;a++){const c=this.args[a].evaluate(r);if(!ca(this.type,lr(c)))return c;if(a===this.args.length-1)throw new pr(`Expected value to be of type ${Fn(this.type)}, but found ${Fn(lr(c))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if("array"===r.kind){const c=r.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){a.push(c.kind);const h=r.N;("number"==typeof h||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(c=>c.serialize()))}}class Ja{constructor(r){this.type=ys,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&"object"==typeof c)return a.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=r.length-1;++_){const v=r[_];if(m&&"object"==typeof v&&!Array.isArray(v)){m=!1;let C=null;if(v["font-scale"]&&(C=a.parse(v["font-scale"],1,Qe),!C))return null;let D=null;if(v["text-font"]&&(D=a.parse(v["text-font"],1,ji(Wt)),!D))return null;let S=null;if(v["text-color"]&&(S=a.parse(v["text-color"],1,fo),!S))return null;const I=h[h.length-1];I.scale=C,I.font=D,I.textColor=S}else{const C=a.parse(r[_],1,$t);if(!C)return null;const D=C.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:C,scale:null,font:null,textColor:null})}}return new Ja(h)}evaluate(r){return new Tt(this.sections.map(a=>{const c=a.content.evaluate(r);return lr(c)===Gn?new Dd("",c,null,null,null):new Dd(xs(c),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const c={};a.scale&&(c["font-scale"]=a.scale.serialize()),a.font&&(c["text-font"]=a.font.serialize()),a.textColor&&(c["text-color"]=a.textColor.serialize()),r.push(c)}return r}}class Xl{constructor(r){this.type=Gn,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const c=a.parse(r[1],1,Wt);return c?new Xl(c):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),c=Qr.fromString(a);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(a)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Yo={"to-boolean":Ut,"to-color":fo,"to-number":Qe,"to-string":Wt};class Po{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[0];if(("to-boolean"===c||"to-string"===c)&&2!==r.length)return a.error("Expected one argument.");const h=Yo[c],m=[];for(let _=1;_<r.length;_++){const v=a.parse(r[_],_,$t);if(!v)return null;m.push(v)}return new Po(h,m)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let a,c;for(const h of this.args){if(a=h.evaluate(r),c=null,a instanceof lt)return a;if("string"==typeof a){const m=r.parseColor(a);if(m)return m}else if(Array.isArray(a)&&(c=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Dt(a[0],a[1],a[2],a[3]),!c))return new lt(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new pr(c||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const c of this.args){if(a=c.evaluate(r),null===a)return 0;const h=Number(a);if(!isNaN(h))return h}throw new pr(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?Tt.fromString(xs(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Qr.fromString(xs(this.args[0].evaluate(r))):xs(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ja([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Xl(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}const rg=["Unknown","Point","LineString","Polygon"];class ip{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?rg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*a-r[0])+this.featureDistanceData.bearing[1]*(h*a-r[1])}return 0}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=lt.parse(r)),a}}class $i{constructor(r,a,c,h){this.name=r,this.type=a,this._evaluate=c,this.args=h}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const c=r[0],h=$i.definitions[c];if(!h)return a.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=_.filter(([D])=>!Array.isArray(D)||D.length===r.length-1);let C=null;for(const[D,S]of v){C=new Ro(a.registry,a.path,null,a.scope);const I=[];let P=!1;for(let F=1;F<r.length;F++){const N=r[F],G=Array.isArray(D)?D[F-1]:D.type,Z=C.parse(N,1+I.length,G);if(!Z){P=!0;break}I.push(Z)}if(!P)if(Array.isArray(D)&&D.length!==I.length)C.error(`Expected ${D.length} arguments, but found ${I.length} instead.`);else{for(let F=0;F<I.length;F++){const N=Array.isArray(D)?D[F]:D.type,G=I[F];C.concat(F+1).checkSubtype(N,G.type)}if(0===C.errors.length)return new $i(c,m,S,I)}}if(1===v.length)a.errors.push(...C.errors);else{const D=(v.length?v:_).map(([I])=>{return P=I,Array.isArray(P)?`(${P.map(Fn).join(", ")})`:`(${Fn(P.type)}...)`;var P}).join(" | "),S=[];for(let I=1;I<r.length;I++){const P=a.parse(r[I],1+S.length);if(!P)return null;S.push(Fn(P.type))}a.error(`Expected arguments of type ${D}, but found (${S.join(", ")}) instead.`)}return null}static register(r,a){$i.definitions=a;for(const c in a)r[c]=$i}}class Kc{constructor(r,a,c){this.type=qn,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const c=r[1];if("object"!=typeof c||Array.isArray(c))return a.error("Collator options argument must be an object.");const h=a.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,Ut);if(!h)return null;const m=a.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,Ut);if(!m)return null;let _=null;return c.locale&&(_=a.parse(c.locale,1,Wt),!_)?null:new Kc(h,m,_)}evaluate(r){return new ua(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const ha=8192;function th(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function nh(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function mi(s,r){const a=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(a*h*ha),Math.round(c*h*ha)]}function Cn(s,r,a){const c=s[0]-r[0],h=s[1]-r[1],m=s[0]-a[0],_=s[1]-a[1];return c*_-m*h==0&&c*m<=0&&h*_<=0}function Td(s,r){let a=!1;for(let _=0,v=r.length;_<v;_++){const C=r[_];for(let D=0,S=C.length;D<S-1;D++){if(Cn(s,C[D],C[D+1]))return!1;(h=C[D])[1]>(c=s)[1]!=(m=C[D+1])[1]>c[1]&&c[0]<(m[0]-h[0])*(c[1]-h[1])/(m[1]-h[1])+h[0]&&(a=!a)}}var c,h,m;return a}function ig(s,r){for(let a=0;a<r.length;a++)if(Td(s,r[a]))return!0;return!1}function op(s,r,a,c){const h=c[0]-a[0],m=c[1]-a[1],_=(s[0]-a[0])*m-h*(s[1]-a[1]),v=(r[0]-a[0])*m-h*(r[1]-a[1]);return _>0&&v<0||_<0&&v>0}function zt(s,r,a){for(const D of a)for(let S=0;S<D.length-1;++S)if((v=[(_=D[S+1])[0]-(m=D[S])[0],_[1]-m[1]])[0]*(C=[(h=r)[0]-(c=s)[0],h[1]-c[1]])[1]-v[1]*C[0]!=0&&op(c,h,m,_)&&op(m,_,c,h))return!0;var c,h,m,_,v,C;return!1}function sp(s,r){for(let a=0;a<s.length;++a)if(!Td(s[a],r))return!1;for(let a=0;a<s.length-1;++a)if(zt(s[a],s[a+1],r))return!1;return!0}function ti(s,r){for(let a=0;a<r.length;a++)if(sp(s,r[a]))return!0;return!1}function Qa(s,r,a){const c=[];for(let h=0;h<s.length;h++){const m=[];for(let _=0;_<s[h].length;_++){const v=mi(s[h][_],a);th(r,v),m.push(v)}c.push(m)}return c}function el(s,r,a){const c=[];for(let h=0;h<s.length;h++){const m=Qa(s[h],r,a);c.push(m)}return c}function Md(s,r,a,c){if(s[0]<a[0]||s[0]>a[2]){const h=.5*c;let m=s[0]-a[0]>h?-c:a[0]-s[0]>h?c:0;0===m&&(m=s[0]-a[2]>h?-c:a[2]-s[0]>h?c:0),s[0]+=m}th(r,s)}function Sd(s,r,a,c){const h=Math.pow(2,c.z)*ha,m=[c.x*ha,c.y*ha],_=[];if(!s)return _;for(const v of s)for(const C of v){const D=[C.x+m[0],C.y+m[1]];Md(D,r,a,h),_.push(D)}return _}function rh(s,r,a,c){const h=Math.pow(2,c.z)*ha,m=[c.x*ha,c.y*ha],_=[];if(!s)return _;for(const C of s){const D=[];for(const S of C){const I=[S.x+m[0],S.y+m[1]];th(r,I),D.push(I)}_.push(D)}if(r[2]-r[0]<=h/2){(v=r)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const C of _)for(const D of C)Md(D,r,a,h)}var v;return _}class ko{constructor(r,a){this.type=Ut,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(fr(r[1])){const c=r[1];if("FeatureCollection"===c.type)for(let h=0;h<c.features.length;++h){const m=c.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new ko(c,c.features[h].geometry)}else if("Feature"===c.type){const h=c.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new ko(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new ko(c,c)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,c){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===c.type){const v=Qa(c.coordinates,m,_),C=Sd(a.geometry(),h,m,_);if(!nh(h,m))return!1;for(const D of C)if(!Td(D,v))return!1}if("MultiPolygon"===c.type){const v=el(c.coordinates,m,_),C=Sd(a.geometry(),h,m,_);if(!nh(h,m))return!1;for(const D of C)if(!ig(D,v))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,c){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===c.type){const v=Qa(c.coordinates,m,_),C=rh(a.geometry(),h,m,_);if(!nh(h,m))return!1;for(const D of C)if(!sp(D,v))return!1}if("MultiPolygon"===c.type){const v=el(c.coordinates,m,_),C=rh(a.geometry(),h,m,_);if(!nh(h,m))return!1;for(const D of C)if(!ti(D,v))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Hr(s){if(s instanceof $i&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof ko)return!1;let r=!0;return s.eachChild(a=>{r&&!Hr(a)&&(r=!1)}),r}function tl(s){if(s instanceof $i&&"feature-state"===s.name)return!1;let r=!0;return s.eachChild(a=>{r&&!tl(a)&&(r=!1)}),r}function Kl(s,r){if(s instanceof $i&&r.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(c=>{a&&!Kl(c,r)&&(a=!1)}),a}class St{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const c=r[1];return a.scope.has(c)?new St(c,a.scope.get(c)):a.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ro{constructor(r,a=[],c,h=new _s,m=[]){this.registry=r,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=m,this.expectedType=c}parse(r,a,c,h,m={}){return a?this.concat(a,c,h)._parse(r,m):this._parse(r,m)}_parse(r,a){function c(h,m,_){return"assert"===_?new Ao(m,[h]):"coerce"===_?new Po(m,[h]):h}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=r[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let _=m.parse(r,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,C=_.type;if("string"!==v.kind&&"number"!==v.kind&&"boolean"!==v.kind&&"object"!==v.kind&&"array"!==v.kind||"value"!==C.kind)if("color"!==v.kind&&"formatted"!==v.kind&&"resolvedImage"!==v.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(v,C))return null}else _=c(_,v,a.typeAnnotation||"coerce");else _=c(_,v,a.typeAnnotation||"assert")}if(!(_ instanceof bs)&&"resolvedImage"!==_.type.kind&&Yc(_)){const v=new ip;try{_=new bs(_.type,_.evaluate(v))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,c){const h="number"==typeof r?this.path.concat(r):this.path,m=c?this.scope.concat(c):this.scope;return new Ro(this.registry,h,a||null,m,this.errors)}error(r,...a){const c=`${this.key}${a.map(h=>`[${h}]`).join("")}`;this.errors.push(new ln(c,r))}checkSubtype(r,a){const c=ca(r,a);return c&&this.error(c),c}}function Yc(s){if(s instanceof St)return Yc(s.boundExpression);if(s instanceof $i&&"error"===s.name||s instanceof Kc||s instanceof ko)return!1;const r=s instanceof Po||s instanceof Ao;let a=!0;return s.eachChild(c=>{a=r?a&&Yc(c):a&&c instanceof bs}),!!a&&Hr(s)&&Kl(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Gi(s,r){const a=s.length-1;let c,h,m=0,_=a,v=0;for(;m<=_;)if(v=Math.floor((m+_)/2),c=s[v],h=s[v+1],c<=r){if(v===a||r<h)return v;m=v+1}else{if(!(c>r))throw new pr("Input is not a number.");_=v-1}return 0}class nl{constructor(r,a,c){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[h,m]of c)this.labels.push(h),this.outputs.push(m)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const c=a.parse(r[1],1,Qe);if(!c)return null;const h=[];let m=null;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);for(let _=1;_<r.length;_+=2){const v=1===_?-1/0:r[_],C=r[_+1],D=_,S=_+1;if("number"!=typeof v)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=v)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const I=a.parse(C,S,m);if(!I)return null;m=m||I.type,h.push([v,I])}return new nl(m,c,h)}evaluate(r){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return c[0].evaluate(r);const m=a.length;return h>=a[m-1]?c[m-1].evaluate(r):c[Gi(a,h)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}function yt(s,r,a){return s*(1-a)+r*a}var po=Object.freeze({__proto__:null,number:yt,color:function(s,r,a){return new lt(yt(s.r,r.r,a),yt(s.g,r.g,a),yt(s.b,r.b,a),yt(s.a,r.a,a))},array:function(s,r,a){return s.map((c,h)=>yt(c,r[h],a))}});const Id=4/29,qi=6/29,ih=3*qi*qi,Ad=Math.PI/180,Pd=180/Math.PI;function oh(s){return s>.008856451679035631?Math.pow(s,1/3):s/ih+Id}function un(s){return s>qi?s*s*s:ih*(s-Id)}function Yl(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function kd(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Jo(s){const r=kd(s.r),a=kd(s.g),c=kd(s.b),h=oh((.4124564*r+.3575761*a+.1804375*c)/.95047),m=oh((.2126729*r+.7151522*a+.072175*c)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-oh((.0193339*r+.119192*a+.9503041*c)/1.08883)),alpha:s.a}}function Mn(s){let r=(s.l+16)/116,a=isNaN(s.a)?r:r+s.a/500,c=isNaN(s.b)?r:r-s.b/200;return r=1*un(r),a=.95047*un(a),c=1.08883*un(c),new lt(Yl(3.2404542*a-1.5371385*r-.4985314*c),Yl(-.969266*a+1.8760108*r+.041556*c),Yl(.0556434*a-.2040259*r+1.0572252*c),s.alpha)}function Jc(s,r,a){const c=r-s;return s+a*(c>180||c<-180?c-360*Math.round(c/360):c)}const da={forward:Jo,reverse:Mn,interpolate:function(s,r,a){return{l:yt(s.l,r.l,a),a:yt(s.a,r.a,a),b:yt(s.b,r.b,a),alpha:yt(s.alpha,r.alpha,a)}}},fa={forward:function(s){const{l:r,a,b:c}=Jo(s),h=Math.atan2(c,a)*Pd;return{h:h<0?h+360:h,c:Math.sqrt(a*a+c*c),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Ad,a=s.c;return Mn({l:s.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:s.alpha})},interpolate:function(s,r,a){return{h:Jc(s.h,r.h,a),c:yt(s.c,r.c,a),l:yt(s.l,r.l,a),alpha:yt(s.alpha,r.alpha,a)}}};var Qc=Object.freeze({__proto__:null,lab:da,hcl:fa});class cr{constructor(r,a,c,h,m){this.type=r,this.operator=a,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of m)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(r,a,c,h){let m=0;if("exponential"===r.name)m=ws(a,r.base,c,h);else if("linear"===r.name)m=ws(a,1,c,h);else if("cubic-bezier"===r.name){const _=r.controlPoints;m=new $o(_[0],_[1],_[2],_[3]).solve(ws(a,1,c,h))}return m}static parse(r,a){let[c,h,m,..._]=r;if(!Array.isArray(h)||0===h.length)return a.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const D=h[1];if("number"!=typeof D)return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:D}}else{if("cubic-bezier"!==h[0])return a.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const D=h.slice(1);if(4!==D.length||D.some(S=>"number"!=typeof S||S<0||S>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:D}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(m=a.parse(m,2,Qe),!m)return null;const v=[];let C=null;"interpolate-hcl"===c||"interpolate-lab"===c?C=fo:a.expectedType&&"value"!==a.expectedType.kind&&(C=a.expectedType);for(let D=0;D<_.length;D+=2){const S=_[D],I=_[D+1],P=D+3,F=D+4;if("number"!=typeof S)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(v.length&&v[v.length-1][0]>=S)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const N=a.parse(I,F,C);if(!N)return null;C=C||N.type,v.push([S,N])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new cr(C,c,h,m,v):a.error(`Type ${Fn(C)} is not interpolatable.`)}evaluate(r){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return c[0].evaluate(r);const m=a.length;if(h>=a[m-1])return c[m-1].evaluate(r);const _=Gi(a,h),v=cr.interpolationFactor(this.interpolation,h,a[_],a[_+1]),C=c[_].evaluate(r),D=c[_+1].evaluate(r);return"interpolate"===this.operator?po[this.type.kind.toLowerCase()](C,D,v):"interpolate-hcl"===this.operator?fa.reverse(fa.interpolate(fa.forward(C),fa.forward(D),v)):da.reverse(da.interpolate(da.forward(C),da.forward(D),v))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let c=0;c<this.labels.length;c++)a.push(this.labels[c],this.outputs[c].serialize());return a}}function ws(s,r,a,c){const h=c-a,m=s-a;return 0===h?0:1===r?m/h:(Math.pow(r,m)-1)/(Math.pow(r,h)-1)}class Jl{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let c=null;const h=a.expectedType;h&&"value"!==h.kind&&(c=h);const m=[];for(const v of r.slice(1)){const C=a.parse(v,1+m.length,c,void 0,{typeAnnotation:"omit"});if(!C)return null;c=c||C.type,m.push(C)}const _=h&&m.some(v=>ca(h,v.type));return new Jl(_?$t:c,m)}evaluate(r){let a,c=null,h=0;for(const m of this.args){if(h++,c=m.evaluate(r),c&&c instanceof Qr&&!c.available&&(a||(a=c),c=null,h===this.args.length))return a;if(null!==c)break}return c}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class zn{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let m=1;m<r.length-1;m+=2){const _=r[m];if("string"!=typeof _)return a.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=a.parse(r[m+1],m+1);if(!v)return null;c.push([_,v])}const h=a.parse(r[r.length-1],r.length-1,a.expectedType,c);return h?new zn(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,c]of this.bindings)r.push(a,c.serialize());return r.push(this.result.serialize()),r}}class sh{constructor(r,a,c){this.type=r,this.index=a,this.input=c}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,Qe),h=a.parse(r[2],2,ji(a.expectedType||$t));return c&&h?new sh(h.type.itemType,c,h):null}evaluate(r){const a=this.index.evaluate(r),c=this.input.evaluate(r);if(a<0)throw new pr(`Array index out of bounds: ${a} < 0.`);if(a>=c.length)throw new pr(`Array index out of bounds: ${a} > ${c.length-1}.`);if(a!==Math.floor(a))throw new pr(`Array index must be an integer, but found ${a} instead.`);return c[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ql{constructor(r,a){this.type=Ut,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,$t),h=a.parse(r[2],2,$t);return c&&h?_n(c.type,[Ut,Wt,Qe,Ko,$t])?new Ql(c,h):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(c.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(null==c)return!1;if(!vs(a,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(lr(a))} instead.`);if(!vs(c,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${Fn(lr(c))} instead.`);return c.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ec{constructor(r,a,c){this.type=Qe,this.needle=r,this.haystack=a,this.fromIndex=c}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,$t),h=a.parse(r[2],2,$t);if(!c||!h)return null;if(!_n(c.type,[Ut,Wt,Qe,Ko,$t]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(c.type)} instead`);if(4===r.length){const m=a.parse(r[3],3,Qe);return m?new ec(c,h,m):null}return new ec(c,h)}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!vs(a,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(lr(a))} instead.`);if(!vs(c,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${Fn(lr(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return c.indexOf(a,h)}return c.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class tc{constructor(r,a,c,h,m,_){this.inputType=r,this.type=a,this.input=c,this.cases=h,this.outputs=m,this.otherwise=_}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let c,h;a.expectedType&&"value"!==a.expectedType.kind&&(h=a.expectedType);const m={},_=[];for(let D=2;D<r.length-1;D+=2){let S=r[D];const I=r[D+1];Array.isArray(S)||(S=[S]);const P=a.concat(D);if(0===S.length)return P.error("Expected at least one branch label.");for(const N of S){if("number"!=typeof N&&"string"!=typeof N)return P.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return P.error("Numeric branch labels must be integer values.");if(c){if(P.checkSubtype(c,lr(N)))return null}else c=lr(N);if(void 0!==m[String(N)])return P.error("Branch labels must be unique.");m[String(N)]=_.length}const F=a.parse(I,D,h);if(!F)return null;h=h||F.type,_.push(F)}const v=a.parse(r[1],1,$t);if(!v)return null;const C=a.parse(r[r.length-1],r.length-1,h);return C?"value"!==v.type.kind&&a.concat(1).checkSubtype(c,v.type)?null:new tc(c,h,v,m,_,C):null}evaluate(r){const a=this.input.evaluate(r);return(lr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),c=[],h={};for(const _ of a){const v=h[this.cases[_]];void 0===v?(h[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[v][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,v]of c)r.push(1===v.length?m(v[0]):v.map(m)),r.push(this.outputs[_].serialize());return r.push(this.otherwise.serialize()),r}}class Fr{constructor(r,a,c){this.type=r,this.branches=a,this.otherwise=c}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let c;a.expectedType&&"value"!==a.expectedType.kind&&(c=a.expectedType);const h=[];for(let _=1;_<r.length-1;_+=2){const v=a.parse(r[_],_,Ut);if(!v)return null;const C=a.parse(r[_+1],_+1,c);if(!C)return null;h.push([v,C]),c=c||C.type}const m=a.parse(r[r.length-1],r.length-1,c);return m?new Fr(c,h,m):null}evaluate(r){for(const[a,c]of this.branches)if(a.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,c]of this.branches)r(a),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class eu{constructor(r,a,c,h){this.type=r,this.input=a,this.beginIndex=c,this.endIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,$t),h=a.parse(r[2],2,Qe);if(!c||!h)return null;if(!_n(c.type,[ji($t),Wt,$t]))return a.error(`Expected first argument to be of type array or string, but found ${Fn(c.type)} instead`);if(4===r.length){const m=a.parse(r[3],3,Qe);return m?new eu(c.type,c,h,m):null}return new eu(c.type,c,h)}evaluate(r){const a=this.input.evaluate(r),c=this.beginIndex.evaluate(r);if(!vs(a,["string","array"]))throw new pr(`Expected first argument to be of type array or string, but found ${Fn(lr(a))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return a.slice(c,h)}return a.slice(c)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ah(s,r){return"=="===s||"!="===s?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function It(s,r,a,c){return 0===c.compare(r,a)}function wr(s,r,a){const c="=="!==s&&"!="!==s;return class oM{constructor(m,_,v){this.type=Ut,this.lhs=m,this.rhs=_,this.collator=v,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const v=m[0];let C=_.parse(m[1],1,$t);if(!C)return null;if(!ah(v,C.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Fn(C.type)}'.`);let D=_.parse(m[2],2,$t);if(!D)return null;if(!ah(v,D.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Fn(D.type)}'.`);if(C.type.kind!==D.type.kind&&"value"!==C.type.kind&&"value"!==D.type.kind)return _.error(`Cannot compare types '${Fn(C.type)}' and '${Fn(D.type)}'.`);c&&("value"===C.type.kind&&"value"!==D.type.kind?C=new Ao(D.type,[C]):"value"!==C.type.kind&&"value"===D.type.kind&&(D=new Ao(C.type,[D])));let S=null;if(4===m.length){if("string"!==C.type.kind&&"string"!==D.type.kind&&"value"!==C.type.kind&&"value"!==D.type.kind)return _.error("Cannot use collator to compare non-string types.");if(S=_.parse(m[3],3,qn),!S)return null}return new oM(C,D,S)}evaluate(m){const _=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){const C=lr(_),D=lr(v);if(C.kind!==D.kind||"string"!==C.kind&&"number"!==C.kind)throw new pr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${C.kind}, ${D.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const C=lr(_),D=lr(v);if("string"!==C.kind||"string"!==D.kind)return r(m,_,v)}return this.collator?a(m,_,v,this.collator.evaluate(m)):r(m,_,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[s];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const qr=wr("==",function(s,r,a){return r===a},It),Cs=wr("!=",function(s,r,a){return r!==a},function(s,r,a,c){return!It(0,r,a,c)}),Es=wr("<",function(s,r,a){return r<a},function(s,r,a,c){return c.compare(r,a)<0}),Zi=wr(">",function(s,r,a){return r>a},function(s,r,a,c){return c.compare(r,a)>0}),tu=wr("<=",function(s,r,a){return r<=a},function(s,r,a,c){return c.compare(r,a)<=0}),lh=wr(">=",function(s,r,a){return r>=a},function(s,r,a,c){return c.compare(r,a)>=0});class pa{constructor(r,a,c,h,m){this.type=Wt,this.number=r,this.locale=a,this.currency=c,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const c=a.parse(r[1],1,Qe);if(!c)return null;const h=r[2];if("object"!=typeof h||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=a.parse(h.locale,1,Wt),!m))return null;let _=null;if(h.currency&&(_=a.parse(h.currency,1,Wt),!_))return null;let v=null;if(h["min-fraction-digits"]&&(v=a.parse(h["min-fraction-digits"],1,Qe),!v))return null;let C=null;return h["max-fraction-digits"]&&(C=a.parse(h["max-fraction-digits"],1,Qe),!C)?null:new pa(c,m,_,v,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class ma{constructor(r){this.type=Qe,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=a.parse(r[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?a.error(`Expected argument of type string or array, but found ${Fn(c.type)} instead.`):new ma(c):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a||Array.isArray(a))return a.length;throw new pr(`Expected value to be of type string or array, but found ${Fn(lr(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const Ii={"==":qr,"!=":Cs,">":Zi,"<":Es,">=":lh,"<=":tu,array:Ao,at:sh,boolean:Ao,case:Fr,coalesce:Jl,collator:Kc,format:Ja,image:Xl,in:Ql,"index-of":ec,interpolate:cr,"interpolate-hcl":cr,"interpolate-lab":cr,length:ma,let:zn,literal:bs,match:tc,number:Ao,"number-format":pa,object:Ao,slice:eu,step:nl,string:Ao,"to-boolean":Po,"to-color":Po,"to-number":Po,"to-string":Po,var:St,within:ko};function Sr(s,[r,a,c,h]){r=r.evaluate(s),a=a.evaluate(s),c=c.evaluate(s);const m=h?h.evaluate(s):1,_=Dt(r,a,c,m);if(_)throw new pr(_);return new lt(r/255*m,a/255*m,c/255*m,m)}function Rd(s,r){return s in r}function gi(s,r){const a=r[s];return void 0===a?null:a}function ot(s){return{type:s}}function Xt(s){return{result:"success",value:s}}function En(s){return{result:"error",value:s}}function Ir(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function Ds(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function mr(s){return!!s.expression&&s.expression.interpolated}function Kt(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function Bn(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function rl(s){return s}function Ts(s,r){const a="color"===r.type,c=s.stops&&"object"==typeof s.stops[0][0],h=c||!(c||void 0!==s.property),m=s.type||(mr(r)?"exponential":"interval");if(a&&((s=sn({},s)).stops&&(s.stops=s.stops.map(D=>[D[0],lt.parse(D[1])])),s.default=lt.parse(s.default?s.default:r.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!Qc[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let _,v,C;if("exponential"===m)_=nc;else if("interval"===m)_=il;else if("categorical"===m){_=nu,v=Object.create(null);for(const D of s.stops)v[D[0]]=D[1];C=typeof s.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=ga}if(c){const D={},S=[];for(let F=0;F<s.stops.length;F++){const N=s.stops[F],G=N[0].zoom;void 0===D[G]&&(D[G]={zoom:G,type:s.type,property:s.property,default:s.default,stops:[]},S.push(G)),D[G].stops.push([N[0].value,N[1]])}const I=[];for(const F of S)I.push([D[F].zoom,Ts(D[F],r)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:cr.interpolationFactor.bind(void 0,P),zoomStops:I.map(F=>F[0]),evaluate:({zoom:F},N)=>nc({stops:I,base:s.base},r,F).evaluate(F,N)}}if(h){const D="exponential"===m?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:cr.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(S=>S[0]),evaluate:({zoom:S})=>_(s,r,S,v,C)}}return{kind:"source",evaluate(D,S){const I=S&&S.properties?S.properties[s.property]:void 0;return void 0===I?Bt(s.default,r.default):_(s,r,I,v,C)}}}function Bt(s,r,a){return void 0!==s?s:void 0!==r?r:void 0!==a?a:void 0}function nu(s,r,a,c,h){return Bt(typeof a===h?c[a]:void 0,s.default,r.default)}function il(s,r,a){if("number"!==Kt(a))return Bt(s.default,r.default);const c=s.stops.length;if(1===c||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[c-1][0])return s.stops[c-1][1];const h=Gi(s.stops.map(m=>m[0]),a);return s.stops[h][1]}function nc(s,r,a){const c=void 0!==s.base?s.base:1;if("number"!==Kt(a))return Bt(s.default,r.default);const h=s.stops.length;if(1===h||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[h-1][0])return s.stops[h-1][1];const m=Gi(s.stops.map(S=>S[0]),a),_=function(S,I,P,F){const N=F-P,G=S-P;return 0===N?0:1===I?G/N:(Math.pow(I,G)-1)/(Math.pow(I,N)-1)}(a,c,s.stops[m][0],s.stops[m+1][0]),v=s.stops[m][1],C=s.stops[m+1][1];let D=po[r.type]||rl;if(s.colorSpace&&"rgb"!==s.colorSpace){const S=Qc[s.colorSpace];D=(I,P)=>S.reverse(S.interpolate(S.forward(I),S.forward(P),_))}return"function"==typeof v.evaluate?{evaluate(...S){const I=v.evaluate.apply(void 0,S),P=C.evaluate.apply(void 0,S);if(void 0!==I&&void 0!==P)return D(I,P,_)}}:D(v,C,_)}function ga(s,r,a){return"color"===r.type?a=lt.parse(a):"formatted"===r.type?a=Tt.fromString(a.toString()):"resolvedImage"===r.type?a=Qr.fromString(a.toString()):Kt(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),Bt(a,s.default,r.default)}$i.register(Ii,{error:[{kind:"error"},[Wt],(s,[r])=>{throw new pr(r.evaluate(s))}],typeof:[Wt,[$t],(s,[r])=>Fn(lr(r.evaluate(s)))],"to-rgba":[ji(Qe,4),[fo],(s,[r])=>r.evaluate(s).toArray()],rgb:[fo,[Qe,Qe,Qe],Sr],rgba:[fo,[Qe,Qe,Qe,Qe],Sr],has:{type:Ut,overloads:[[[Wt],(s,[r])=>Rd(r.evaluate(s),s.properties())],[[Wt,la],(s,[r,a])=>Rd(r.evaluate(s),a.evaluate(s))]]},get:{type:$t,overloads:[[[Wt],(s,[r])=>gi(r.evaluate(s),s.properties())],[[Wt,la],(s,[r,a])=>gi(r.evaluate(s),a.evaluate(s))]]},"feature-state":[$t,[Wt],(s,[r])=>gi(r.evaluate(s),s.featureState||{})],properties:[la,[],s=>s.properties()],"geometry-type":[Wt,[],s=>s.geometryType()],id:[$t,[],s=>s.id()],zoom:[Qe,[],s=>s.globals.zoom],pitch:[Qe,[],s=>s.globals.pitch||0],"distance-from-center":[Qe,[],s=>s.distanceFromCenter()],"heatmap-density":[Qe,[],s=>s.globals.heatmapDensity||0],"line-progress":[Qe,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[Qe,[],s=>s.globals.skyRadialProgress||0],accumulated:[$t,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[Qe,ot(Qe),(s,r)=>{let a=0;for(const c of r)a+=c.evaluate(s);return a}],"*":[Qe,ot(Qe),(s,r)=>{let a=1;for(const c of r)a*=c.evaluate(s);return a}],"-":{type:Qe,overloads:[[[Qe,Qe],(s,[r,a])=>r.evaluate(s)-a.evaluate(s)],[[Qe],(s,[r])=>-r.evaluate(s)]]},"/":[Qe,[Qe,Qe],(s,[r,a])=>r.evaluate(s)/a.evaluate(s)],"%":[Qe,[Qe,Qe],(s,[r,a])=>r.evaluate(s)%a.evaluate(s)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(s,[r,a])=>Math.pow(r.evaluate(s),a.evaluate(s))],sqrt:[Qe,[Qe],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[Qe,[Qe],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[Qe,[Qe],(s,[r])=>Math.log(r.evaluate(s))],log2:[Qe,[Qe],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[Qe,[Qe],(s,[r])=>Math.sin(r.evaluate(s))],cos:[Qe,[Qe],(s,[r])=>Math.cos(r.evaluate(s))],tan:[Qe,[Qe],(s,[r])=>Math.tan(r.evaluate(s))],asin:[Qe,[Qe],(s,[r])=>Math.asin(r.evaluate(s))],acos:[Qe,[Qe],(s,[r])=>Math.acos(r.evaluate(s))],atan:[Qe,[Qe],(s,[r])=>Math.atan(r.evaluate(s))],min:[Qe,ot(Qe),(s,r)=>Math.min(...r.map(a=>a.evaluate(s)))],max:[Qe,ot(Qe),(s,r)=>Math.max(...r.map(a=>a.evaluate(s)))],abs:[Qe,[Qe],(s,[r])=>Math.abs(r.evaluate(s))],round:[Qe,[Qe],(s,[r])=>{const a=r.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[Qe,[Qe],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[Qe,[Qe],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[Ut,[Wt,$t],(s,[r,a])=>s.properties()[r.value]===a.value],"filter-id-==":[Ut,[$t],(s,[r])=>s.id()===r.value],"filter-type-==":[Ut,[Wt],(s,[r])=>s.geometryType()===r.value],"filter-<":[Ut,[Wt,$t],(s,[r,a])=>{const c=s.properties()[r.value],h=a.value;return typeof c==typeof h&&c<h}],"filter-id-<":[Ut,[$t],(s,[r])=>{const a=s.id(),c=r.value;return typeof a==typeof c&&a<c}],"filter->":[Ut,[Wt,$t],(s,[r,a])=>{const c=s.properties()[r.value],h=a.value;return typeof c==typeof h&&c>h}],"filter-id->":[Ut,[$t],(s,[r])=>{const a=s.id(),c=r.value;return typeof a==typeof c&&a>c}],"filter-<=":[Ut,[Wt,$t],(s,[r,a])=>{const c=s.properties()[r.value],h=a.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[Ut,[$t],(s,[r])=>{const a=s.id(),c=r.value;return typeof a==typeof c&&a<=c}],"filter->=":[Ut,[Wt,$t],(s,[r,a])=>{const c=s.properties()[r.value],h=a.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[Ut,[$t],(s,[r])=>{const a=s.id(),c=r.value;return typeof a==typeof c&&a>=c}],"filter-has":[Ut,[$t],(s,[r])=>r.value in s.properties()],"filter-has-id":[Ut,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[Ut,[ji(Wt)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[Ut,[ji($t)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[Ut,[Wt,ji($t)],(s,[r,a])=>a.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[Ut,[Wt,ji($t)],(s,[r,a])=>function(c,h,m,_){for(;m<=_;){const v=m+_>>1;if(h[v]===c)return!0;h[v]>c?_=v-1:m=v+1}return!1}(s.properties()[r.value],a.value,0,a.value.length-1)],all:{type:Ut,overloads:[[[Ut,Ut],(s,[r,a])=>r.evaluate(s)&&a.evaluate(s)],[ot(Ut),(s,r)=>{for(const a of r)if(!a.evaluate(s))return!1;return!0}]]},any:{type:Ut,overloads:[[[Ut,Ut],(s,[r,a])=>r.evaluate(s)||a.evaluate(s)],[ot(Ut),(s,r)=>{for(const a of r)if(a.evaluate(s))return!0;return!1}]]},"!":[Ut,[Ut],(s,[r])=>!r.evaluate(s)],"is-supported-script":[Ut,[Wt],(s,[r])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(r.evaluate(s))}],upcase:[Wt,[Wt],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[Wt,[Wt],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[Wt,ot($t),(s,r)=>r.map(a=>xs(a.evaluate(s))).join("")],"resolved-locale":[Wt,[qn],(s,[r])=>r.evaluate(s).resolvedLocale()]});class Lr{constructor(r,a){var c;this.expression=r,this._warningHistory={},this._evaluator=new ip,this._defaultValue=a?"color"===(c=a).type&&Bn(c.default)?new lt(0,0,0,0):"color"===c.type?lt.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(r,a,c,h,m,_,v,C){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,c,h,m,_,v,C){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=C||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new pr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function Oo(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Ii}function Fo(s,r){const a=new Ro(Ii,[],r?function(h){const m={color:fo,string:Wt,number:Qe,enum:Wt,boolean:Ut,formatted:ys,resolvedImage:Gn};return"array"===h.type?ji(m[h.value]||$t,h.length):m[h.type]}(r):void 0),c=a.parse(s,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return c?Xt(new Lr(c,r)):En(a.errors)}class Ai{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!tl(a.expression)}evaluateWithoutErrorHandling(r,a,c,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,h,m,_)}evaluate(r,a,c,h,m,_){return this._styleExpression.evaluate(r,a,c,h,m,_)}}class An{constructor(r,a,c,h){this.kind=r,this.zoomStops=c,this._styleExpression=a,this.isStateDependent="camera"!==r&&!tl(a.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,a,c,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,h,m,_)}evaluate(r,a,c,h,m,_){return this._styleExpression.evaluate(r,a,c,h,m,_)}interpolationFactor(r,a,c){return this.interpolationType?cr.interpolationFactor(this.interpolationType,r,a,c):0}}function Od(s,r){if("error"===(s=Fo(s,r)).result)return s;const a=s.value.expression,c=Hr(a);if(!c&&!Ir(r))return En([new ln("","data expressions not supported")]);const h=Kl(a,["zoom","pitch","distance-from-center"]);if(!h&&!Ds(r))return En([new ln("","zoom expressions not supported")]);const m=Pi(a);return m||h?m instanceof ln?En([m]):m instanceof cr&&!mr(r)?En([new ln("",'"interpolate" expressions cannot be used with this property')]):Xt(m?new An(c?"camera":"composite",s.value,m.labels,m instanceof cr?m.interpolation:void 0):new Ai(c?"constant":"source",s.value)):En([new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ru{constructor(r,a){this._parameters=r,this._specification=a,sn(this,Ts(this._parameters,this._specification))}static deserialize(r){return new ru(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Pi(s){let r=null;if(s instanceof zn)r=Pi(s.result);else if(s instanceof Jl){for(const a of s.args)if(r=Pi(a),r)break}else(s instanceof nl||s instanceof cr)&&s.input instanceof $i&&"zoom"===s.input.name&&(r=s);return r instanceof ln||s.eachChild(a=>{const c=Pi(a);c instanceof ln?r=c:!r&&c?r=new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class Ye{constructor(r,a,c,h){this.message=(r?`${r}: `:"")+c,h&&(this.identifier=h),null!=a&&a.__line__&&(this.line=a.__line__)}}function _i(s){const r=s.key,a=s.value,c=s.valueSpec||{},h=s.objectElementValidators||{},m=s.style,_=s.styleSpec;let v=[];const C=Kt(a);if("object"!==C)return[new Ye(r,a,`object expected, ${C} found`)];for(const D in a){const S=D.split(".")[0],I=c[S]||c["*"];let P;h[S]?P=h[S]:c[S]?P=gr:h["*"]?P=h["*"]:c["*"]&&(P=gr),P?v=v.concat(P({key:(r&&`${r}.`)+D,value:a[D],valueSpec:I,style:m,styleSpec:_,object:a,objectKey:D},a)):v.push(new Ye(r,a[D],`unknown property "${D}"`))}for(const D in c)h[D]||c[D].required&&void 0===c[D].default&&void 0===a[D]&&v.push(new Ye(r,a,`missing required property "${D}"`));return v}function Ms(s){const r=s.value,a=s.valueSpec,c=s.style,h=s.styleSpec,m=s.key,_=s.arrayElementValidator||gr;if("array"!==Kt(r))return[new Ye(m,r,`array expected, ${Kt(r)} found`)];if(a.length&&r.length!==a.length)return[new Ye(m,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new Ye(m,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let v={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};h.$version<7&&(v.function=a.function),"object"===Kt(a.value)&&(v=a.value);let C=[];for(let D=0;D<r.length;D++)C=C.concat(_({array:r,arrayIndex:D,value:r[D],valueSpec:v,style:c,styleSpec:h,key:`${m}[${D}]`}));return C}function rc(s){const r=s.key,a=s.value,c=s.valueSpec;let h=Kt(a);if("number"===h&&a!=a&&(h="NaN"),"number"!==h)return[new Ye(r,a,`number expected, ${h} found`)];if("minimum"in c){let m=c.minimum;if("array"===Kt(c.minimum)&&(m=c.minimum[s.arrayIndex]),a<m)return[new Ye(r,a,`${a} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if("array"===Kt(c.maximum)&&(m=c.maximum[s.arrayIndex]),a>m)return[new Ye(r,a,`${a} is greater than the maximum value ${m}`)]}return[]}function Wi(s){const r=s.valueSpec,a=rt(s.value.type);let c,h,m,_={};const v="categorical"!==a&&void 0===s.value.property,C=!v,D="array"===Kt(s.value.stops)&&"array"===Kt(s.value.stops[0])&&"object"===Kt(s.value.stops[0][0]),S=_i({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(F){if("identity"===a)return[new Ye(F.key,F.value,'identity function may not have a "stops" property')];let N=[];const G=F.value;return N=N.concat(Ms({key:F.key,value:G,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:I})),"array"===Kt(G)&&0===G.length&&N.push(new Ye(F.key,G,"array must have at least one stop")),N},default:function(F){return gr({key:F.key,value:F.value,valueSpec:r,style:F.style,styleSpec:F.styleSpec})}}});return"identity"===a&&v&&S.push(new Ye(s.key,s.value,'missing required property "property"')),"identity"===a||s.value.stops||S.push(new Ye(s.key,s.value,'missing required property "stops"')),"exponential"===a&&s.valueSpec.expression&&!mr(s.valueSpec)&&S.push(new Ye(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(C&&!Ir(s.valueSpec)?S.push(new Ye(s.key,s.value,"property functions not supported")):v&&!Ds(s.valueSpec)&&S.push(new Ye(s.key,s.value,"zoom functions not supported"))),"categorical"!==a&&!D||void 0!==s.value.property||S.push(new Ye(s.key,s.value,'"property" property is required')),S;function I(F){let N=[];const G=F.value,Z=F.key;if("array"!==Kt(G))return[new Ye(Z,G,`array expected, ${Kt(G)} found`)];if(2!==G.length)return[new Ye(Z,G,`array length 2 expected, length ${G.length} found`)];if(D){if("object"!==Kt(G[0]))return[new Ye(Z,G,`object expected, ${Kt(G[0])} found`)];if(void 0===G[0].zoom)return[new Ye(Z,G,"object stop key must have zoom")];if(void 0===G[0].value)return[new Ye(Z,G,"object stop key must have value")];const K=rt(G[0].zoom);if("number"!=typeof K)return[new Ye(Z,G[0].zoom,"stop zoom values must be numbers")];if(m&&m>K)return[new Ye(Z,G[0].zoom,"stop zoom values must appear in ascending order")];K!==m&&(m=K,h=void 0,_={}),N=N.concat(_i({key:`${Z}[0]`,value:G[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:rc,value:P}}))}else N=N.concat(P({key:`${Z}[0]`,value:G[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},G));return Oo(an(G[1]))?N.concat([new Ye(`${Z}[1]`,G[1],"expressions are not allowed in function stops.")]):N.concat(gr({key:`${Z}[1]`,value:G[1],valueSpec:r,style:F.style,styleSpec:F.styleSpec}))}function P(F,N){const G=Kt(F.value),Z=rt(F.value),K=null!==F.value?F.value:N;if(c){if(G!==c)return[new Ye(F.key,K,`${G} stop domain type must match previous stop domain type ${c}`)]}else c=G;if("number"!==G&&"string"!==G&&"boolean"!==G&&"number"!=typeof Z&&"string"!=typeof Z&&"boolean"!=typeof Z)return[new Ye(F.key,K,"stop domain value must be a number, string, or boolean")];if("number"!==G&&"categorical"!==a){let se=`number expected, ${G} found`;return Ir(r)&&void 0===a&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(F.key,K,se)]}return"categorical"!==a||"number"!==G||"number"==typeof Z&&isFinite(Z)&&Math.floor(Z)===Z?"categorical"!==a&&"number"===G&&"number"==typeof Z&&"number"==typeof h&&void 0!==h&&Z<h?[new Ye(F.key,K,"stop domain values must appear in ascending order")]:(h=Z,"categorical"===a&&Z in _?[new Ye(F.key,K,"stop domain values must be unique")]:(_[Z]=!0,[])):[new Ye(F.key,K,`integer expected, found ${String(Z)}`)]}}function ol(s){const r=("property"===s.expressionContext?Od:Fo)(an(s.value),s.valueSpec);if("error"===r.result)return r.value.map(c=>new Ye(`${s.key}${c.key}`,s.value,c.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!a.outputDefined())return[new Ye(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!tl(a))return[new Ye(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return Ss(a,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Kl(a,["zoom","feature-state"]))return[new Ye(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!Hr(a))return[new Ye(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ss(s,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const h of r.valueSpec.expression.parameters)a.delete(h);if(0===a.size)return[];const c=[];return s instanceof $i&&a.has(s.name)?[new Ye(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild(h=>{c.push(...Ss(h,r))}),c)}function ic(s){const r=s.key,a=s.value,c=s.valueSpec,h=[];return Array.isArray(c.values)?-1===c.values.indexOf(rt(a))&&h.push(new Ye(r,a,`expected one of [${c.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(c.values).indexOf(rt(a))&&h.push(new Ye(r,a,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(a)} found`)),h}function Is(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!Is(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function _a(s,r="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Is(s)||(s=iu(s));const a=s;let c=!0;try{c=function(D){if(!ya(D))return D;let S=an(D);return lp(S),S=Fd(S),S}(a)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const h=xe[`filter_${r}`],m=Fo(c,h);let _=null;if("error"===m.result)throw new Error(m.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,S,I)=>m.value.evaluate(D,S,{},I);let v=null,C=null;if(c!==a){const D=Fo(a,h);if("error"===D.result)throw new Error(D.value.map(S=>`${S.key}: ${S.message}`).join(", "));v=(S,I,P,F,N)=>D.value.evaluate(S,I,{},P,void 0,void 0,F,N),C=!Hr(D.value.expression)}return _=_,{filter:_,dynamicFilter:v||void 0,needGeometry:ch(c),needFeature:!!C}}function Fd(s){if(!Array.isArray(s))return s;const r=function(a){if(cp.has(a[0]))for(let c=1;c<a.length;c++)if(ya(a[c]))return!0;return a}(s);return!0===r?r:r.map(a=>Fd(a))}function lp(s){let r=!1;const a=[];if("case"===s[0]){for(let c=1;c<s.length-1;c+=2)r=r||ya(s[c]),a.push(s[c+1]);a.push(s[s.length-1])}else if("match"===s[0]){r=r||ya(s[1]);for(let c=2;c<s.length-1;c+=2)a.push(s[c+1]);a.push(s[s.length-1])}else if("step"===s[0]){r=r||ya(s[1]);for(let c=1;c<s.length-1;c+=2)a.push(s[c+1])}r&&(s.length=0,s.push("any",...a));for(let c=1;c<s.length;c++)lp(s[c])}function ya(s){if(!Array.isArray(s))return!1;if("pitch"===(r=s[0])||"distance-from-center"===r)return!0;var r;for(let a=1;a<s.length;a++)if(ya(s[a]))return!0;return!1}const cp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ld(s,r){return s<r?-1:s>r?1:0}function ch(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let r=1;r<s.length;r++)if(ch(s[r]))return!0;return!1}function iu(s){if(!s)return!0;const r=s[0];return s.length<=1?"any"!==r:"=="===r?ou(s[1],s[2],"=="):"!="===r?su(ou(s[1],s[2],"==")):"<"===r||">"===r||"<="===r||">="===r?ou(s[1],s[2],r):"any"===r?(a=s.slice(1),["any"].concat(a.map(iu))):"all"===r?["all"].concat(s.slice(1).map(iu)):"none"===r?["all"].concat(s.slice(1).map(iu).map(su)):"in"===r?zd(s[1],s.slice(2)):"!in"===r?su(zd(s[1],s.slice(2))):"has"===r?Bd(s[1]):"!has"===r?su(Bd(s[1])):"within"!==r||s;var a}function ou(s,r,a){switch(s){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,s,r]}}function zd(s,r){if(0===r.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",s,["literal",r.sort(Ld)]]:["filter-in-small",s,["literal",r]]}}function Bd(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function su(s){return["!",s]}function va(s){return Is(an(s.value))?ol(sn({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Nd(s)}function Nd(s){const r=s.value,a=s.key;if("array"!==Kt(r))return[new Ye(a,r,`array expected, ${Kt(r)} found`)];const c=s.styleSpec;let h,m=[];if(r.length<1)return[new Ye(a,r,"filter array must have at least 1 element")];switch(m=m.concat(ic({key:`${a}[0]`,value:r[0],valueSpec:c.filter_operator,style:s.style,styleSpec:s.styleSpec})),rt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===rt(r[1])&&m.push(new Ye(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&m.push(new Ye(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(h=Kt(r[1]),"string"!==h&&m.push(new Ye(`${a}[1]`,r[1],`string expected, ${h} found`)));for(let _=2;_<r.length;_++)h=Kt(r[_]),"$type"===rt(r[1])?m=m.concat(ic({key:`${a}[${_}]`,value:r[_],valueSpec:c.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&m.push(new Ye(`${a}[${_}]`,r[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<r.length;_++)m=m.concat(Nd({key:`${a}[${_}]`,value:r[_],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":h=Kt(r[1]),2!==r.length?m.push(new Ye(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==h&&m.push(new Ye(`${a}[1]`,r[1],`string expected, ${h} found`));break;case"within":h=Kt(r[1]),2!==r.length?m.push(new Ye(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==h&&m.push(new Ye(`${a}[1]`,r[1],`object expected, ${h} found`))}return m}function au(s,r){const a=s.key,c=s.style,h=s.styleSpec,m=s.value,_=s.objectKey,v=h[`${r}_${s.layerType}`];if(!v)return[];const C=_.match(/^(.*)-transition$/);if("paint"===r&&C&&v[C[1]]&&v[C[1]].transition)return gr({key:a,value:m,valueSpec:h.transition,style:c,styleSpec:h});const D=s.valueSpec||v[_];if(!D)return[new Ye(a,m,`unknown property "${_}"`)];let S;if("string"===Kt(m)&&Ir(D)&&!D.tokens&&(S=/^{([^}]+)}$/.exec(m)))return[new Ye(a,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const I=[];return"symbol"===s.layerType&&("text-field"===_&&c&&!c.glyphs&&I.push(new Ye(a,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Bn(an(m))&&"identity"===rt(m.type)&&I.push(new Ye(a,m,'"text-font" does not support identity functions'))),I.concat(gr({key:s.key,value:m,valueSpec:D,style:c,styleSpec:h,expressionContext:"property",propertyType:r,propertyKey:_}))}function sl(s){return au(s,"paint")}function Vd(s){return au(s,"layout")}function up(s){let r=[];const a=s.value,c=s.key,h=s.style,m=s.styleSpec;a.type||a.ref||r.push(new Ye(c,a,'either "type" or "ref" is required'));let _=rt(a.type);const v=rt(a.ref);if(a.id){const C=rt(a.id);for(let D=0;D<s.arrayIndex;D++){const S=h.layers[D];rt(S.id)===C&&r.push(new Ye(c,a.id,`duplicate layer id "${a.id}", previously used at line ${S.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in a&&r.push(new Ye(c,a[D],`"${D}" is prohibited for ref layers`))}),h.layers.forEach(D=>{rt(D.id)===v&&(C=D)}),C?C.ref?r.push(new Ye(c,a.ref,"ref cannot reference another ref layer")):_=rt(C.type):"string"==typeof v&&r.push(new Ye(c,a.ref,`ref layer "${v}" not found`))}else if("background"!==_&&"sky"!==_)if(a.source){const C=h.sources&&h.sources[a.source],D=C&&rt(C.type);C?"vector"===D&&"raster"===_?r.push(new Ye(c,a.source,`layer "${a.id}" requires a raster source`)):"raster"===D&&"raster"!==_?r.push(new Ye(c,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==D||a["source-layer"]?"raster-dem"===D&&"hillshade"!==_?r.push(new Ye(c,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!a.paint||!a.paint["line-gradient"]||"geojson"===D&&C.lineMetrics||r.push(new Ye(c,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Ye(c,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new Ye(c,a.source,`source "${a.source}" not found`))}else r.push(new Ye(c,a,'missing required property "source"'));return r=r.concat(_i({key:c,value:a,valueSpec:m.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>gr({key:`${c}.type`,value:a.type,valueSpec:m.layer.type,style:s.style,styleSpec:s.styleSpec,object:a,objectKey:"type"}),filter:C=>va(sn({layerType:_},C)),layout:C=>_i({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Vd(sn({layerType:_},D))}}),paint:C=>_i({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>sl(sn({layerType:_},D))}})}})),r}function As(s){const r=s.value,a=s.key,c=Kt(r);return"string"!==c?[new Ye(a,r,`string expected, ${c} found`)]:[]}const Ps={promoteId:function({key:s,value:r}){if("string"===Kt(r))return As({key:s,value:r});{const a=[];for(const c in r)a.push(...As({key:`${s}.${c}`,value:r[c]}));return a}}};function Ud(s){const r=s.value,a=s.key,c=s.styleSpec,h=s.style;if(!r.type)return[new Ye(a,r,'"type" is required')];const m=rt(r.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=_i({key:a,value:r,valueSpec:c[`source_${m.replace("-","_")}`],style:s.style,styleSpec:c,objectElementValidators:Ps}),_;case"geojson":if(_=_i({key:a,value:r,valueSpec:c.source_geojson,style:h,styleSpec:c,objectElementValidators:Ps}),r.cluster)for(const v in r.clusterProperties){const[C,D]=r.clusterProperties[v],S="string"==typeof C?[C,["accumulated"],["get",v]]:C;_.push(...ol({key:`${a}.${v}.map`,value:D,expressionContext:"cluster-map"})),_.push(...ol({key:`${a}.${v}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return _;case"video":return _i({key:a,value:r,valueSpec:c.source_video,style:h,styleSpec:c});case"image":return _i({key:a,value:r,valueSpec:c.source_image,style:h,styleSpec:c});case"canvas":return[new Ye(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ic({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:c})}}function ki(s){const r=s.value,a=s.styleSpec,c=a.light,h=s.style;let m=[];const _=Kt(r);if(void 0===r)return m;if("object"!==_)return m=m.concat([new Ye("light",r,`object expected, ${_} found`)]),m;for(const v in r){const C=v.match(/^(.*)-transition$/);m=m.concat(C&&c[C[1]]&&c[C[1]].transition?gr({key:v,value:r[v],valueSpec:a.transition,style:h,styleSpec:a}):c[v]?gr({key:v,value:r[v],valueSpec:c[v],style:h,styleSpec:a}):[new Ye(v,r[v],`unknown property "${v}"`)])}return m}function uh(s){const r=s.value,a=s.key,c=s.style,h=s.styleSpec,m=h.terrain;let _=[];const v=Kt(r);if(void 0===r)return _;if("object"!==v)return _=_.concat([new Ye("terrain",r,`object expected, ${v} found`)]),_;for(const C in r){const D=C.match(/^(.*)-transition$/);_=_.concat(D&&m[D[1]]&&m[D[1]].transition?gr({key:C,value:r[C],valueSpec:h.transition,style:c,styleSpec:h}):m[C]?gr({key:C,value:r[C],valueSpec:m[C],style:c,styleSpec:h}):[new Ye(C,r[C],`unknown property "${C}"`)])}if(r.source){const C=c.sources&&c.sources[r.source],D=C&&rt(C.type);C?"raster-dem"!==D&&_.push(new Ye(a,r.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):_.push(new Ye(a,r.source,`source "${r.source}" not found`))}else _.push(new Ye(a,r,'terrain is missing required property "source"'));return _}function jd(s){const r=s.value,a=s.style,c=s.styleSpec,h=c.fog;let m=[];const _=Kt(r);if(void 0===r)return m;if("object"!==_)return m=m.concat([new Ye("fog",r,`object expected, ${_} found`)]),m;for(const v in r){const C=v.match(/^(.*)-transition$/);m=m.concat(C&&h[C[1]]&&h[C[1]].transition?gr({key:v,value:r[v],valueSpec:c.transition,style:a,styleSpec:c}):h[v]?gr({key:v,value:r[v],valueSpec:h[v],style:a,styleSpec:c}):[new Ye(v,r[v],`unknown property "${v}"`)])}return m}const oc={"*":()=>[],array:Ms,boolean:function(s){const r=s.value,a=s.key,c=Kt(r);return"boolean"!==c?[new Ye(a,r,`boolean expected, ${c} found`)]:[]},number:rc,color:function(s){const r=s.key,a=s.value,c=Kt(a);return"string"!==c?[new Ye(r,a,`color expected, ${c} found`)]:null===In.parseCSSColor(a)?[new Ye(r,a,`color expected, "${a}" found`)]:[]},enum:ic,filter:va,function:Wi,layer:up,object:_i,source:Ud,light:ki,terrain:uh,fog:jd,string:As,formatted:function(s){return 0===As(s).length?[]:ol(s)},resolvedImage:function(s){return 0===As(s).length?[]:ol(s)},projection:function(s){const r=s.value,a=s.styleSpec,c=a.projection,h=s.style;let m=[];const _=Kt(r);if("object"===_)for(const v in r)m=m.concat(gr({key:v,value:r[v],valueSpec:c[v],style:h,styleSpec:a}));else"string"!==_&&(m=m.concat([new Ye("projection",r,`object or string expected, ${_} found`)]));return m}};function gr(s){const r=s.value,a=s.valueSpec,c=s.styleSpec;return a.expression&&Bn(rt(r))?Wi(s):a.expression&&Oo(an(r))?ol(s):a.type&&oc[a.type]?oc[a.type](s):_i(sn({},s,{valueSpec:a.type?c[a.type]:a}))}function yi(s){const r=s.value,a=s.key,c=As(s);return c.length||(-1===r.indexOf("{fontstack}")&&c.push(new Ye(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&c.push(new Ye(a,r,'"glyphs" url must include a "{range}" token'))),c}function sc(s,r=xe){return _r(gr({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:yi,"*":()=>[]}}))}const hh=s=>_r(sl(s)),hp=s=>_r(Vd(s));function _r(s){return s.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function lu(s,r){let a=!1;if(r&&r.length)for(const c of r)s.fire(new pt(new Error(c.message))),a=!0;return a}var ks=Xi;function Xi(s,r,a){var c=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var h=new Int32Array(this.arrayBuffer);s=h[0],this.d=(r=h[1])+2*(a=h[2]);for(var m=0;m<this.d*this.d;m++){var _=h[3+m],v=h[3+m+1];c.push(_===v?null:h.subarray(_,v))}var C=h[3+c.length+1];this.keys=h.subarray(h[3+c.length],C),this.bboxes=h.subarray(C),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var D=0;D<this.d*this.d;D++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=a,this.scale=r/s,this.uid=0;var S=a/r*s;this.min=-S,this.max=s+S}Xi.prototype.insert=function(s,r,a,c,h){this._forEachCell(r,a,c,h,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(h)},Xi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xi.prototype._insertCell=function(s,r,a,c,h,m){this.cells[h].push(m)},Xi.prototype.query=function(s,r,a,c,h){var m=this.min,_=this.max;if(s<=m&&r<=m&&_<=a&&_<=c&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(s,r,a,c,this._queryCell,v,{},h),v},Xi.prototype._queryCell=function(s,r,a,c,h,m,_,v){var C=this.cells[h];if(null!==C)for(var D=this.keys,S=this.bboxes,I=0;I<C.length;I++){var P=C[I];if(void 0===_[P]){var F=4*P;(v?v(S[F+0],S[F+1],S[F+2],S[F+3]):s<=S[F+2]&&r<=S[F+3]&&a>=S[F+0]&&c>=S[F+1])?(_[P]=!0,m.push(D[P])):_[P]=!1}}},Xi.prototype._forEachCell=function(s,r,a,c,h,m,_,v){for(var C=this._convertToCellCoord(s),D=this._convertToCellCoord(r),S=this._convertToCellCoord(a),I=this._convertToCellCoord(c),P=C;P<=S;P++)for(var F=D;F<=I;F++){var N=this.d*F+P;if((!v||v(this._convertFromCellCoord(P),this._convertFromCellCoord(F),this._convertFromCellCoord(P+1),this._convertFromCellCoord(F+1)))&&h.call(this,s,r,a,c,N,m,_,v))return}},Xi.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Xi.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Xi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=3+this.cells.length+1+1,a=0,c=0;c<this.cells.length;c++)a+=this.cells[c].length;var h=new Int32Array(r+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=r,_=0;_<s.length;_++){var v=s[_];h[3+_]=m,h.set(v,m),m+=v.length}return h[3+s.length]=m,h.set(this.keys,m),h[3+s.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};const al={};function tt(s,r,a={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),al[r]={klass:s,omit:a.omit||[]}}tt(Object,"Object"),ks.serialize=function(s,r){const a=s.toArrayBuffer();return r&&r.push(a),{buffer:a}},ks.deserialize=function(s){return new ks(s.buffer)},Object.defineProperty(ks,"name",{value:"Grid"}),tt(ks,"Grid"),tt(lt,"Color"),tt(Error,"Error"),tt(z,"AJAXError"),tt(Qr,"ResolvedImage"),tt(ru,"StylePropertyFunction"),tt(Lr,"StyleExpression",{omit:["_evaluator"]}),tt(An,"ZoomDependentExpression"),tt(Ai,"ZoomConstantExpression"),tt($i,"CompoundExpression",{omit:["_evaluate"]});for(const s in Ii)al[Ii[s]._classRegistryKey]||tt(Ii[s],`Expression${s}`);function cu(s){return s&&"undefined"!=typeof ArrayBuffer&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function uu(s){return ft.ImageBitmap&&s instanceof ft.ImageBitmap}function xa(s,r){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(cu(s)||uu(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return r&&r.push(a.buffer),a}if(s instanceof ft.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const c of s)a.push(xa(c,r));return a}if("object"==typeof s){const a=s.constructor,c=a._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const h=a.serialize?a.serialize(s,r):{};if(!a.serialize){for(const m in s)s.hasOwnProperty(m)&&(al[c].omit.indexOf(m)>=0||(h[m]=xa(s[m],r)));s instanceof Error&&(h.message=s.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof s)}function ac(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||cu(s)||uu(s)||ArrayBuffer.isView(s)||s instanceof ft.ImageData)return s;if(Array.isArray(s))return s.map(ac);if("object"==typeof s){const r=s.$name||"Object",{klass:a}=al[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(s);const c=Object.create(a.prototype);for(const h of Object.keys(s))"$name"!==h&&(c[h]=ac(s[h]));return c}throw new Error("can't deserialize object of type "+typeof s)}class Yn{constructor(){this.first=!0}update(r,a){const c=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=c,!0))}}const dh=s=>s>=1536&&s<=1791,hu=s=>s>=1872&&s<=1919,Jn=s=>s>=2208&&s<=2303,fh=s=>s>=11904&&s<=12031,dp=s=>s>=12032&&s<=12255,ll=s=>s>=12272&&s<=12287,ni=s=>s>=12288&&s<=12351,lc=s=>s>=12352&&s<=12447,cl=s=>s>=12448&&s<=12543,ba=s=>s>=12544&&s<=12591,vi=s=>s>=12704&&s<=12735,ph=s=>s>=12736&&s<=12783,cc=s=>s>=12784&&s<=12799,$d=s=>s>=12800&&s<=13055,Qo=s=>s>=13056&&s<=13311,mh=s=>s>=13312&&s<=19903,uc=s=>s>=19968&&s<=40959,Nt=s=>s>=40960&&s<=42127,gh=s=>s>=42128&&s<=42191,fp=s=>s>=44032&&s<=55215,hc=s=>s>=63744&&s<=64255,_h=s=>s>=64336&&s<=65023,Gd=s=>s>=65040&&s<=65055,wa=s=>s>=65072&&s<=65103,Hd=s=>s>=65104&&s<=65135,du=s=>s>=65136&&s<=65279,je=s=>s>=65280&&s<=65519;function rn(s){for(const r of s)if(dc(r.charCodeAt(0)))return!0;return!1}function yh(s){for(const r of s)if(!yr(r.charCodeAt(0)))return!1;return!0}function yr(s){return!(dh(s)||hu(s)||Jn(s)||_h(s)||du(s))}function dc(s){return!(746!==s&&747!==s&&(s<4352||!(vi(s)||ba(s)||wa(s)&&!(s>=65097&&s<=65103)||hc(s)||Qo(s)||fh(s)||ph(s)||!(!ni(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||mh(s)||uc(s)||$d(s)||(r=s,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(s)||(r=>r>=55216&&r<=55295)(s)||(r=>r>=4352&&r<=4607)(s)||fp(s)||lc(s)||ll(s)||(r=>r>=12688&&r<=12703)(s)||dp(s)||cc(s)||cl(s)&&12540!==s||!(!je(s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Hd(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(r=>r>=5120&&r<=5759)(s)||(r=>r>=6320&&r<=6399)(s)||Gd(s)||(r=>r>=19904&&r<=19967)(s)||Nt(s)||gh(s))));var r}function Rs(s){return!(dc(s)||(r=s,(a=r)>=128&&a<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(a=>a>=8192&&a<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(a=>a>=8448&&a<=8527)(r)||(a=>a>=8528&&a<=8591)(r)||(a=>a>=8960&&a<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(a=>a>=9216&&a<=9279)(r)&&9251!==r||(a=>a>=9280&&a<=9311)(r)||(a=>a>=9312&&a<=9471)(r)||(a=>a>=9632&&a<=9727)(r)||(a=>a>=9728&&a<=9983)(r)&&!(r>=9754&&r<=9759)||(a=>a>=11008&&a<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ni(r)||cl(r)||(a=>a>=57344&&a<=63743)(r)||wa(r)||Hd(r)||je(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,a}function Ri(s){return s>=1424&&s<=2303||_h(s)||du(s)}function vh(s,r){return!(!r&&Ri(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(a=s,a>=6016&&a<=6143));var a}function xh(s){for(const r of s)if(Ri(r.charCodeAt(0)))return!0;return!1}const qd="deferred",fc="loading",Zd="loaded";let ul=null,Pn="unavailable",ur=null;const hl=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(Pn="error"),ul&&ul(s)};function Ki(){mo.fire(new gt("pluginStateChange",{pluginStatus:Pn,pluginURL:ur}))}const mo=new xt,fu=function(){return Pn},Ca=function(){if(Pn!==qd||!ur)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pn=fc,Ki(),ur&&re({url:ur},s=>{s?hl(s):(Pn=Zd,Ki())})},Yi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pn===Zd||null!=Yi.applyArabicShaping,isLoading:()=>Pn===fc,setState(s){Pn=s.pluginStatus,ur=s.pluginURL},isParsed:()=>null!=Yi.applyArabicShaping&&null!=Yi.processBidirectionalText&&null!=Yi.processStyledBidirectionalText,getPluginURL:()=>ur};class kn{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yn,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,c){for(const h of a)if(!vh(h.charCodeAt(0),c))return!1;return!0}(r,Yi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),c=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*a}}}class Ea{constructor(r,a){this.property=r,this.value=a,this.expression=function(c,h){if(Bn(c))return new ru(c,h);if(Oo(c)){const m=Od(c,h);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=c;return"string"==typeof c&&"color"===h.type&&(m=lt.parse(c)),{kind:"constant",evaluate:()=>m}}}(void 0===a?r.specification.default:a,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,a,c){return this.property.possiblyEvaluate(this,r,a,c)}}class Os{constructor(r){this.property=r,this.value=new Ea(r,void 0)}transitioned(r,a){return new o(this.property,this.value,a,or({},r.transition,this.transition),r.now)}untransitioned(){return new o(this.property,this.value,null,{},0)}}class p{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Mi(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new Os(this._values[r].property)),this._values[r].value=new Ea(this._values[r].property,null===a?void 0:Mi(a))}getTransition(r){return Mi(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new Os(this._values[r].property)),this._values[r].transition=Mi(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(r[a]=c);const h=this.getTransition(a);void 0!==h&&(r[`${a}-transition`]=h)}return r}transitioned(r,a){const c=new u(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(r,a._values[h]);return c}untransitioned(){const r=new u(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class o{constructor(r,a,c,h,m){const _=h.delay||0,v=h.duration||0;m=m||0,this.property=r,this.value=a,this.begin=m+_,this.end=this.begin+v,r.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(r,a,c){const h=r.now||0,m=this.value.possiblyEvaluate(r,a,c),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(r,a,c);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(r,a,c),m,Go(v))}}return m}}class u{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,c){const h=new b(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,a,c);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class g{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Mi(this._values[r].value)}setValue(r,a){this._values[r]=new Ea(this._values[r].property,null===a?void 0:Mi(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(r[a]=c)}return r}possiblyEvaluate(r,a,c){const h=new b(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,a,c);return h}}class x{constructor(r,a,c){this.property=r,this.value=a,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,c,h){return this.property.evaluate(this.value,this.parameters,r,a,c,h)}}class b{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class E{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,c){const h=po[this.specification.type];return h?h(r,a,c):r}}class M{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,c,h){return new x(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},c,h)}:r.expression,a)}interpolate(r,a,c){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new x(this,{kind:"constant",value:void 0},r.parameters);const h=po[this.specification.type];return h?new x(this,{kind:"constant",value:h(r.value.value,a.value.value,c)},r.parameters):r}evaluate(r,a,c,h,m,_){return"constant"===r.kind?r.value:r.evaluate(a,c,h,m,_)}}class A extends M{possiblyEvaluate(r,a,c,h){if(void 0===r.value)return new x(this,{kind:"constant",value:void 0},a);if("constant"===r.expression.kind){const m=r.expression.evaluate(a,null,{},c,h),_="resolvedImage"===r.property.specification.type&&"string"!=typeof m?m.name:m,v=this._calculate(_,_,_,a);return new x(this,{kind:"constant",value:v},a)}if("camera"===r.expression.kind){const m=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new x(this,{kind:"constant",value:m},a)}return new x(this,r.expression,a)}evaluate(r,a,c,h,m,_){if("source"===r.kind){const v=r.evaluate(a,c,h,m,_);return this._calculate(v,v,v,a)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},c,h),r.evaluate({zoom:Math.floor(a.zoom)},c,h),r.evaluate({zoom:Math.floor(a.zoom)+1},c,h),a):r.value}_calculate(r,a,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:a,other:c}:{from:c,to:a,other:r}}interpolate(r){return r}}class R{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,h){if(void 0!==r.value){if("constant"===r.expression.kind){const m=r.expression.evaluate(a,null,{},c,h);return this._calculate(m,m,m,a)}return this._calculate(r.expression.evaluate(new kn(Math.floor(a.zoom-1),a)),r.expression.evaluate(new kn(Math.floor(a.zoom),a)),r.expression.evaluate(new kn(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:c,to:a}}interpolate(r){return r}}class O{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,h){return!!r.expression.evaluate(a,null,{},c,h)}interpolate(){return!1}}class B{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in r){const c=r[a];c.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new Ea(c,void 0),m=this.defaultTransitionablePropertyValues[a]=new Os(c);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}}}function j(s,r){return 256*(s=tn(Math.floor(s),0,255))+tn(Math.floor(r),0,255)}tt(M,"DataDrivenProperty"),tt(E,"DataConstantProperty"),tt(A,"CrossFadedDataDrivenProperty"),tt(R,"CrossFadedProperty"),tt(O,"ColorRampProperty");const q={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class H{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ${constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ne(s,r=1){let a=0,c=0;return{members:s.map(h=>{const m=q[h.type].BYTES_PER_ELEMENT,_=a=X(a,Math.max(r,m)),v=h.components||1;return c=Math.max(c,m),a+=m*v,{name:h.name,type:h.type,components:v,offset:_}}),size:X(a,Math.max(c,r)),alignment:r}}function X(s,r){return Math.ceil(s/r)*r}class ee extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.int16[h+0]=a,this.int16[h+1]=c,r}}ee.prototype.bytesPerElement=4,tt(ee,"StructArrayLayout2i4");class te extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const m=3*r;return this.int16[m+0]=a,this.int16[m+1]=c,this.int16[m+2]=h,r}}te.prototype.bytesPerElement=6,tt(te,"StructArrayLayout3i6");class oe extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,c,h)}emplace(r,a,c,h,m){const _=4*r;return this.int16[_+0]=a,this.int16[_+1]=c,this.int16[_+2]=h,this.int16[_+3]=m,r}}oe.prototype.bytesPerElement=8,tt(oe,"StructArrayLayout4i8");class Q extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,h,m,_,v)}emplace(r,a,c,h,m,_,v,C){const D=6*r,S=12*r,I=3*r;return this.int16[D+0]=a,this.int16[D+1]=c,this.uint8[S+4]=h,this.uint8[S+5]=m,this.uint8[S+6]=_,this.uint8[S+7]=v,this.float32[I+2]=C,r}}Q.prototype.bytesPerElement=12,tt(Q,"StructArrayLayout2i4ub1f12");class ae extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,c,h)}emplace(r,a,c,h,m){const _=4*r;return this.float32[_+0]=a,this.float32[_+1]=c,this.float32[_+2]=h,this.float32[_+3]=m,r}}ae.prototype.bytesPerElement=16,tt(ae,"StructArrayLayout4f16");class me extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v,C,D,S){const I=this.length;return this.resize(I+1),this.emplace(I,r,a,c,h,m,_,v,C,D,S)}emplace(r,a,c,h,m,_,v,C,D,S,I){const P=10*r;return this.uint16[P+0]=a,this.uint16[P+1]=c,this.uint16[P+2]=h,this.uint16[P+3]=m,this.uint16[P+4]=_,this.uint16[P+5]=v,this.uint16[P+6]=C,this.uint16[P+7]=D,this.uint16[P+8]=S,this.uint16[P+9]=I,r}}me.prototype.bytesPerElement=20,tt(me,"StructArrayLayout10ui20");class be extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v,C){const D=this.length;return this.resize(D+1),this.emplace(D,r,a,c,h,m,_,v,C)}emplace(r,a,c,h,m,_,v,C,D){const S=8*r;return this.uint16[S+0]=a,this.uint16[S+1]=c,this.uint16[S+2]=h,this.uint16[S+3]=m,this.uint16[S+4]=_,this.uint16[S+5]=v,this.uint16[S+6]=C,this.uint16[S+7]=D,r}}be.prototype.bytesPerElement=16,tt(be,"StructArrayLayout8ui16");class Se extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,c,h,m,_)}emplace(r,a,c,h,m,_,v){const C=6*r;return this.int16[C+0]=a,this.int16[C+1]=c,this.int16[C+2]=h,this.int16[C+3]=m,this.int16[C+4]=_,this.int16[C+5]=v,r}}Se.prototype.bytesPerElement=12,tt(Se,"StructArrayLayout6i12");class Te extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z){const K=this.length;return this.resize(K+1),this.emplace(K,r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z)}emplace(r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z,K){const se=16*r;return this.int16[se+0]=a,this.int16[se+1]=c,this.int16[se+2]=h,this.int16[se+3]=m,this.uint16[se+4]=_,this.uint16[se+5]=v,this.uint16[se+6]=C,this.uint16[se+7]=D,this.int16[se+8]=S,this.int16[se+9]=I,this.int16[se+10]=P,this.int16[se+11]=F,this.int16[se+12]=N,this.int16[se+13]=G,this.int16[se+14]=Z,this.int16[se+15]=K,r}}Te.prototype.bytesPerElement=32,tt(Te,"StructArrayLayout4i4ui4i4i32");class Ne extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const m=3*r;return this.float32[m+0]=a,this.float32[m+1]=c,this.float32[m+2]=h,r}}Ne.prototype.bytesPerElement=12,tt(Ne,"StructArrayLayout3f12");class pe extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}pe.prototype.bytesPerElement=4,tt(pe,"StructArrayLayout1ul4");class He extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v,C,D,S,I,P,F){const N=this.length;return this.resize(N+1),this.emplace(N,r,a,c,h,m,_,v,C,D,S,I,P,F)}emplace(r,a,c,h,m,_,v,C,D,S,I,P,F,N){const G=20*r,Z=10*r;return this.int16[G+0]=a,this.int16[G+1]=c,this.int16[G+2]=h,this.int16[G+3]=m,this.int16[G+4]=_,this.float32[Z+3]=v,this.float32[Z+4]=C,this.float32[Z+5]=D,this.float32[Z+6]=S,this.int16[G+14]=I,this.uint32[Z+8]=P,this.uint16[G+18]=F,this.uint16[G+19]=N,r}}He.prototype.bytesPerElement=40,tt(He,"StructArrayLayout5i4f1i1ul2ui40");class Ve extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,h,m,_,v)}emplace(r,a,c,h,m,_,v,C){const D=8*r;return this.int16[D+0]=a,this.int16[D+1]=c,this.int16[D+2]=h,this.int16[D+4]=m,this.int16[D+5]=_,this.int16[D+6]=v,this.int16[D+7]=C,r}}Ve.prototype.bytesPerElement=16,tt(Ve,"StructArrayLayout3i2i2i16");class nt extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,c,h,m)}emplace(r,a,c,h,m,_){const v=4*r,C=8*r;return this.float32[v+0]=a,this.float32[v+1]=c,this.float32[v+2]=h,this.int16[C+6]=m,this.int16[C+7]=_,r}}nt.prototype.bytesPerElement=16,tt(nt,"StructArrayLayout2f1f2i16");class Ie extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,c,h)}emplace(r,a,c,h,m){const _=12*r,v=3*r;return this.uint8[_+0]=a,this.uint8[_+1]=c,this.float32[v+1]=h,this.float32[v+2]=m,r}}Ie.prototype.bytesPerElement=12,tt(Ie,"StructArrayLayout2ub2f12");class it extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const m=3*r;return this.uint16[m+0]=a,this.uint16[m+1]=c,this.uint16[m+2]=h,r}}it.prototype.bytesPerElement=6,tt(it,"StructArrayLayout3ui6");class mt extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z,K,se,le,he,de){const fe=this.length;return this.resize(fe+1),this.emplace(fe,r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z,K,se,le,he,de)}emplace(r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z,K,se,le,he,de,fe){const we=30*r,Me=15*r,ke=60*r;return this.int16[we+0]=a,this.int16[we+1]=c,this.int16[we+2]=h,this.float32[Me+2]=m,this.float32[Me+3]=_,this.uint16[we+8]=v,this.uint16[we+9]=C,this.uint32[Me+5]=D,this.uint32[Me+6]=S,this.uint32[Me+7]=I,this.uint16[we+16]=P,this.uint16[we+17]=F,this.uint16[we+18]=N,this.float32[Me+10]=G,this.float32[Me+11]=Z,this.uint8[ke+48]=K,this.uint8[ke+49]=se,this.uint8[ke+50]=le,this.uint32[Me+13]=he,this.int16[we+28]=de,this.uint8[ke+58]=fe,r}}mt.prototype.bytesPerElement=60,tt(mt,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class st extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z,K,se,le,he,de,fe,we,Me,ke,ze,Ce,Ee,Be,We){const $e=this.length;return this.resize($e+1),this.emplace($e,r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z,K,se,le,he,de,fe,we,Me,ke,ze,Ce,Ee,Be,We)}emplace(r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z,K,se,le,he,de,fe,we,Me,ke,ze,Ce,Ee,Be,We,$e){const qe=38*r,Et=19*r;return this.int16[qe+0]=a,this.int16[qe+1]=c,this.int16[qe+2]=h,this.float32[Et+2]=m,this.float32[Et+3]=_,this.int16[qe+8]=v,this.int16[qe+9]=C,this.int16[qe+10]=D,this.int16[qe+11]=S,this.int16[qe+12]=I,this.int16[qe+13]=P,this.uint16[qe+14]=F,this.uint16[qe+15]=N,this.uint16[qe+16]=G,this.uint16[qe+17]=Z,this.uint16[qe+18]=K,this.uint16[qe+19]=se,this.uint16[qe+20]=le,this.uint16[qe+21]=he,this.uint16[qe+22]=de,this.uint16[qe+23]=fe,this.uint16[qe+24]=we,this.uint16[qe+25]=Me,this.uint16[qe+26]=ke,this.uint16[qe+27]=ze,this.uint16[qe+28]=Ce,this.uint32[Et+15]=Ee,this.float32[Et+16]=Be,this.float32[Et+17]=We,this.float32[Et+18]=$e,r}}st.prototype.bytesPerElement=76,tt(st,"StructArrayLayout3i2f6i15ui1ul3f76");class at extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}at.prototype.bytesPerElement=4,tt(at,"StructArrayLayout1f4");class _t extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,h,m,_,v)}emplace(r,a,c,h,m,_,v,C){const D=7*r;return this.float32[D+0]=a,this.float32[D+1]=c,this.float32[D+2]=h,this.float32[D+3]=m,this.float32[D+4]=_,this.float32[D+5]=v,this.float32[D+6]=C,r}}_t.prototype.bytesPerElement=28,tt(_t,"StructArrayLayout7f28");class At extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,c,h,m)}emplace(r,a,c,h,m,_){const v=5*r;return this.float32[v+0]=a,this.float32[v+1]=c,this.float32[v+2]=h,this.float32[v+3]=m,this.float32[v+4]=_,r}}At.prototype.bytesPerElement=20,tt(At,"StructArrayLayout5f20");class ht extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,c,h)}emplace(r,a,c,h,m){const _=6*r;return this.uint32[3*r+0]=a,this.uint16[_+2]=c,this.uint16[_+3]=h,this.uint16[_+4]=m,r}}ht.prototype.bytesPerElement=12,tt(ht,"StructArrayLayout1ul3ui12");class vt extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.uint16[h+0]=a,this.uint16[h+1]=c,r}}vt.prototype.bytesPerElement=4,tt(vt,"StructArrayLayout2ui4");class Yt extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}Yt.prototype.bytesPerElement=2,tt(Yt,"StructArrayLayout1ui2");class Hn extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.float32[h+0]=a,this.float32[h+1]=c,r}}Hn.prototype.bytesPerElement=8,tt(Hn,"StructArrayLayout2f8");class hr extends ${_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,m,_,v){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,h,m,_,v)}emplace(r,a,c,h,m,_,v,C){const D=8*r,S=4*r;return this.int16[D+0]=a,this.int16[D+1]=c,this.int16[D+2]=h,this.int16[D+3]=m,this.int16[D+4]=_,this.int16[D+5]=v,this.float32[S+3]=C,r}}hr.prototype.bytesPerElement=16,tt(hr,"StructArrayLayout6i1f16");class Zr extends H{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Zr.prototype.size=12;class Ar extends Se{get(r){return new Zr(this,r)}}tt(Ar,"FillExtrusionExtArray");class Oi extends H{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Oi.prototype.size=40;class Ji extends He{get(r){return new Oi(this,r)}}tt(Ji,"CollisionBoxArray");class Da extends H{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Da.prototype.size=60;class Lo extends mt{get(r){return new Da(this,r)}}tt(Lo,"PlacedSymbolArray");class Zn extends H{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Zn.prototype.size=76;class nr extends st{get(r){return new Zn(this,r)}}tt(nr,"SymbolInstanceArray");class hn extends at{getoffsetX(r){return this.float32[1*r+0]}}tt(hn,"GlyphOffsetArray");class Wn extends te{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}tt(Wn,"SymbolLineVertexArray");class ri extends H{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ri.prototype.size=12;class Nn extends ht{get(r){return new ri(this,r)}}tt(Nn,"FeatureIndexArray");class ii extends H{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ii.prototype.size=4;class Fs extends vt{get(r){return new ii(this,r)}}tt(Fs,"FillExtrusionCentroidArray");class Fi extends H{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}Fi.prototype.size=16;class Ls extends hr{get(r){return new Fi(this,r)}}tt(Ls,"CircleGlobeExtArray");const bh=ne([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),pu=ne([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Ta=Xc(function(s){s.exports=function(r,a){var c,h,m,_,v,C,D,S;for(h=r.length-(c=3&r.length),m=a,v=3432918353,C=461845907,S=0;S<h;)D=255&r.charCodeAt(S)|(255&r.charCodeAt(++S))<<8|(255&r.charCodeAt(++S))<<16|(255&r.charCodeAt(++S))<<24,++S,m=27492+(65535&(_=5*(65535&(m=(m^=D=(65535&(D=(D=(65535&D)*v+(((D>>>16)*v&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(D=0,c){case 3:D^=(255&r.charCodeAt(S+2))<<16;case 2:D^=(255&r.charCodeAt(S+1))<<8;case 1:m^=D=(65535&(D=(D=(65535&(D^=255&r.charCodeAt(S)))*v+(((D>>>16)*v&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),pp=Xc(function(s){s.exports=function(r,a){for(var c,h=r.length,m=a^h,_=0;h>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:m^=(255&r.charCodeAt(_+2))<<16;case 2:m^=(255&r.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),zs=Ta,dl=pp;zs.murmur3=Ta,zs.murmur2=dl;class fl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,c,h){this.ids.push(og(r)),this.positions.push(a,c,h)}getPositions(r){const a=og(r);let c=0,h=this.ids.length-1;for(;c<h;){const _=c+h>>1;this.ids[_]>=a?h=_:c=_+1}const m=[];for(;this.ids[c]===a;)m.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return m}static serialize(r,a){const c=new Float64Array(r.ids),h=new Uint32Array(r.positions);return Wd(c,h,0,c.length-1),a&&a.push(c.buffer,h.buffer),{ids:c,positions:h}}static deserialize(r){const a=new fl;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function og(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:zs(String(s))}function Wd(s,r,a,c){for(;a<c;){const h=s[a+c>>1];let m=a-1,_=c+1;for(;;){do{m++}while(s[m]<h);do{_--}while(s[_]>h);if(m>=_)break;wh(s,m,_),wh(r,3*m,3*_),wh(r,3*m+1,3*_+1),wh(r,3*m+2,3*_+2)}_-a<c-_?(Wd(s,r,a,_),a=_+1):(Wd(s,r,_+1,c),c=_)}}function wh(s,r,a){const c=s[r];s[r]=s[a],s[a]=c}tt(fl,"FeaturePositionMap");class Qi{constructor(r,a){this.gl=r.gl,this.location=a}}class zr extends Qi{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Xd extends Qi{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class mu extends Qi{constructor(r,a){super(r,a),this.current=lt.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const gu=new Float32Array(16),_u=new Float32Array(9),yu=new Float32Array(4);function Kd(s){return[j(255*s.r,255*s.g),j(255*s.b,255*s.a)]}class pc{constructor(r,a,c){this.value=r,this.uniformNames=a.map(h=>`u_${h}`),this.type=c}setUniform(r,a,c){r.set(c.constantOr(this.value))}getBinding(r,a,c){return"color"===this.type?new mu(r,a):new zr(r,a)}}class es{constructor(r,a){this.uniformNames=a.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio||1,this.pixelRatioTo=r.pixelRatio||1,this.patternFrom=a.tl.concat(a.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,a,c,h){const m="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;m&&r.set(m)}getBinding(r,a,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new Xd(r,a):new zr(r,a)}}class pl{constructor(r,a,c,h){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=a.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,a,c,h,m,_){const v=this.paintVertexArray.length,C=this.expression.evaluate(new kn(0),a,{},m,h,_);this.paintVertexArray.resize(r),this._setPaintValue(v,r,C)}updatePaintArray(r,a,c,h,m){const _=this.expression.evaluate({zoom:0},c,h,void 0,m);this._setPaintValue(r,a,_)}_setPaintValue(r,a,c){if("color"===this.type){const h=Kd(c);for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=r;h<a;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ts{constructor(r,a,c,h,m,_){this.expression=r,this.uniformNames=a.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,a,c,h,m,_){const v=this.expression.evaluate(new kn(this.zoom),a,{},m,h,_),C=this.expression.evaluate(new kn(this.zoom+1),a,{},m,h,_),D=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(D,r,v,C)}updatePaintArray(r,a,c,h,m){const _=this.expression.evaluate({zoom:this.zoom},c,h,void 0,m),v=this.expression.evaluate({zoom:this.zoom+1},c,h,void 0,m);this._setPaintValue(r,a,_,v)}_setPaintValue(r,a,c,h){if("color"===this.type){const m=Kd(c),_=Kd(h);for(let v=r;v<a;v++)this.paintVertexArray.emplace(v,m[0],m[1],_[0],_[1])}else{for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const c=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=tn(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);r.set(h)}getBinding(r,a,c){return new zr(r,a)}}class Ft{constructor(r,a,c,h,m,_,v){this.expression=r,this.type=c,this.useIntegerZoom=h,this.zoom=m,this.layerId=v,this.paintVertexAttributes=("array"===c?pu:bh).members;for(let C=0;C<a.length;++C);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(r,a,c){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(h,r,a.patterns&&a.patterns[this.layerId],c)}updatePaintArray(r,a,c,h,m,_){this._setPaintValues(r,a,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(r,a,c,h){if(!h||!c)return;const{min:m,mid:_,max:v}=c,C=h[m],D=h[_],S=h[v];if(C&&D&&S)for(let I=r;I<a;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,D,C),this._setPaintValue(this.zoomOutPaintVertexArray,I,D,S)}_setPaintValue(r,a,c,h){r.emplace(a,c.tl[0],c.tl[1],c.br[0],c.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],c.pixelRatio,h.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ml{constructor(r,a,c=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const m in r.paint._values){if(!c(m))continue;const _=r.paint.get(m);if(!(_ instanceof x&&Ir(_.property.specification)))continue;const v=y1(m,r.type),C=_.value,D=_.property.specification.type,S=_.property.useIntegerZoom,I=_.property.specification["property-type"],P="cross-faded"===I||"cross-faded-data-driven"===I,F="line-dasharray"===String(m)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==C.kind||F)if("source"===C.kind||F||P){const N=zy(m,D,"source");this.binders[m]=P?new Ft(C,v,D,S,a,N,r.id):new pl(C,v,D,N),h.push(`/a_${m}`)}else{const N=zy(m,D,"composite");this.binders[m]=new ts(C,v,D,S,a,N),h.push(`/z_${m}`)}else this.binders[m]=P?new es(C.value,v):new pc(C.value,v,D),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof pl||a instanceof ts?a.maxValue:0}populatePaintArrays(r,a,c,h,m,_){for(const v in this.binders){const C=this.binders[v];(C instanceof pl||C instanceof ts||C instanceof Ft)&&C.populatePaintArray(r,a,c,h,m,_)}}setConstantPatternPositions(r,a){for(const c in this.binders){const h=this.binders[c];h instanceof es&&h.setConstantPatternPositions(r,a)}}updatePaintArrays(r,a,c,h,m,_){let v=!1;for(const C in r){const D=a.getPositions(C);for(const S of D){const I=c.feature(S.index);for(const P in this.binders){const F=this.binders[P];if((F instanceof pl||F instanceof ts||F instanceof Ft)&&!0===F.expression.isStateDependent){const N=h.paint.get(P);F.expression=N.value,F.updatePaintArray(S.start,S.end,I,r[C],m,_),v=!0}}}}return v}defines(){const r=[];for(const a in this.binders){const c=this.binders[a];(c instanceof pc||c instanceof es)&&r.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof pl||c instanceof ts||c instanceof Ft)for(let h=0;h<c.paintVertexAttributes.length;h++)r.push(c.paintVertexAttributes[h].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof pc||c instanceof es||c instanceof ts)for(const h of c.uniformNames)r.push(h)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const c=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof pc||m instanceof es||m instanceof ts)for(const _ of m.uniformNames)if(a[_]){const v=m.getBinding(r,a[_],_);c.push({name:_,property:h,binding:v})}}return c}setUniforms(r,a,c,h){for(const{name:m,property:_,binding:v}of a)this.binders[_].setUniform(v,h,c.get(_),m)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const c=this.binders[a];if(r&&c instanceof Ft){const h=2===r.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(c instanceof pl||c instanceof ts)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(r){for(const a in this.binders){const c=this.binders[a];(c instanceof pl||c instanceof ts||c instanceof Ft)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof pl||a instanceof ts||a instanceof Ft)&&a.destroy()}}}class vu{constructor(r,a,c=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new ml(h,a,c);this.needsUpload=!1,this._featureMap=new fl,this._bufferOffset=0}populatePaintArrays(r,a,c,h,m,_,v){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(r,a,h,m,_,v);void 0!==a.id&&this._featureMap.add(a.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,c,h,m){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(r,this._featureMap,a,_,h,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const _1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function y1(s,r){return _1[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const v1={"line-pattern":{source:me,composite:me},"fill-pattern":{source:me,composite:me},"fill-extrusion-pattern":{source:me,composite:me},"line-dasharray":{source:be,composite:be}},x1={color:{source:Hn,composite:ae},number:{source:at,composite:Hn}};function zy(s,r,a){const c=v1[s];return c&&c[a]||x1[r][a]}tt(pc,"ConstantBinder"),tt(es,"CrossFadedConstantBinder"),tt(pl,"SourceExpressionBinder"),tt(Ft,"CrossFadedCompositeBinder"),tt(ts,"CompositeExpressionBinder"),tt(ml,"ProgramConfiguration",{omit:["_buffers"]}),tt(vu,"ProgramConfigurationSet");const gl="-transition";class Bs extends xt{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new g(a.layout)),a.paint)){this._transitionablePaint=new p(a.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new b(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,c={}){null!=a&&this._validate(hp,`layers.${this.id}.layout.${r}`,r,a,c)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return qo(r,gl)?this._transitionablePaint.getTransition(r.slice(0,-gl.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,c={}){if(null!=a&&this._validate(hh,`layers.${this.id}.paint.${r}`,r,a,c))return!1;if(qo(r,gl))return this._transitionablePaint.setTransition(r.slice(0,-gl.length),a||void 0),!1;{const h=this._transitionablePaint._values[r],m="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const C=this._transitionablePaint._values[r].value;return C.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(r,v,C)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,c){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Dn(r,(a,c)=>!(void 0===a||"layout"===c&&!Object.keys(a).length||"paint"===c&&!Object.keys(a).length))}_validate(r,a,c,h,m={}){return(!m||!1!==m.validate)&&lu(this,r.call(sc,{key:a,layerType:this.type,objectKey:c,value:h,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof x&&Ir(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=_a(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Br=ne([{name:"a_pos",components:2,type:"Int16"}],4),mp=ne([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class Vn{constructor(r=[]){this.segments=r}prepareSegment(r,a,c,h){let m=this.segments[this.segments.length-1];return r>Vn.MAX_VERTEX_ARRAY_LENGTH&&Tn(`Max vertices per segment is ${Vn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!m||m.vertexLength+r>Vn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:a.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,c,h){return new Vn([{vertexOffset:r,primitiveOffset:a,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}Vn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tt(Vn,"SegmentVector");var kt=8192;class _l{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Jt?new Jt(r.lng,r.lat):Jt.convert(r),this}setSouthWest(r){return this._sw=r instanceof Jt?new Jt(r.lng,r.lat):Jt.convert(r),this}extend(r){const a=this._sw,c=this._ne;let h,m;if(r instanceof Jt)h=r,m=r;else{if(!(r instanceof _l))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(_l.convert(r)):this.extend(Jt.convert(r)):this;if(h=r._sw,m=r._ne,!h||!m)return this}return a||c?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new Jt(h.lng,h.lat),this._ne=new Jt(m.lng,m.lat)),this}getCenter(){return new Jt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Jt(this.getWest(),this.getNorth())}getSouthEast(){return new Jt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:c}=Jt.convert(r);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(r){return!r||r instanceof _l?r:new _l(r)}}const eo=6371008.8;class Jt{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Jt(So(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,c=this.lat*a,h=r.lat*a,m=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((r.lng-this.lng)*a);return eo*Math.acos(Math.min(m,1))}toBounds(r=0){const a=360*r/40075017,c=a/Math.cos(Math.PI/180*this.lat);return new _l(new Jt(this.lng-c,this.lat-a),new Jt(this.lng+c,this.lat+a))}static convert(r){if(r instanceof Jt)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new Jt(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new Jt(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const gp=2*Math.PI*eo;function xu(s){return gp*Math.cos(s*Math.PI/180)}function Ma(s){return(180+s)/360}function mc(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function bu(s,r){return s/xu(r)}function zo(s){return 360*s-180}function oi(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function By(s,r){return s*xu(oi(r))}const ns=85.051129;class xi{constructor(r,a,c=0){this.x=+r,this.y=+a,this.z=+c}static fromLngLat(r,a=0){const c=Jt.convert(r);return new xi(Ma(c.lng),mc(c.lat),bu(a,c.lat))}toLngLat(){return new Jt(zo(this.x),oi(this.y))}toAltitude(){return By(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gp*(r=oi(this.y),1/Math.cos(r*Math.PI/180));var r}}function Ch(s,r,a,c,h,m,_,v,C){const D=(r+c)/2,S=(a+h)/2,I=new Oe(D,S);v(I),function(P,F,N,G,Z,K){const se=N-Z,le=G-K;return Math.abs((G-F)*se-(N-P)*le)/Math.hypot(se,le)}(I.x,I.y,m.x,m.y,_.x,_.y)>=C?(Ch(s,r,a,D,S,m,I,v,C),Ch(s,D,S,c,h,I,_,v,C)):s.push(_)}function wu(s,r,a){let c=s[0],h=c.x,m=c.y;r(c);const _=[c];for(let v=1;v<s.length;v++){const C=s[v],{x:D,y:S}=C;r(C),Ch(_,h,m,D,S,c,C,r,a),h=D,m=S,c=C}return _}const sg=Math.pow(2,14)-1,_p=-sg-1;function Ny(s,r){const a=Math.round(s.x*r),c=Math.round(s.y*r);return s.x=tn(a,_p,sg),s.y=tn(c,_p,sg),(a<s.x||a>s.x+1||c<s.y||c>s.y+1)&&Tn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Sa(s,r,a){const c=s.loadGeometry(),h=s.extent,m=kt/h;if(r&&a&&a.projection.isReprojectedInTileSpace){const _=1<<r.z,{scale:v,x:C,y:D,projection:S}=a,I=P=>{const F=zo((r.x+P.x/h)/_),N=oi((r.y+P.y/h)/_),G=S.project(F,N);P.x=(G.x*v-C)*h,P.y=(G.y*v-D)*h};for(let P=0;P<c.length;P++)if(1!==s.type)c[P]=wu(c[P],I,1);else{const F=[];for(const N of c[P])N.x<0||N.x>=h||N.y<0||N.y>=h||(I(N),F.push(N));c[P]=F}}for(const _ of c)for(const v of _)Ny(v,m);return c}function gc(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?Sa(s):[]}}function Yd(s,r,a,c,h){s.emplaceBack(2*r+(c+1)/2,2*a+(h+1)/2)}function Jd(s,r,a,c){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2],c)}class Qd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new ee,this.indexArray=new it,this.segments=new Vn,this.programConfigurations=new vu(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,h){const m=this.layers[0],_=[];let v=null;"circle"===m.type&&(v=m.layout.get("circle-sort-key"));for(const{feature:D,id:S,index:I,sourceLayerIndex:P}of r){const F=this.layers[0]._featureFilter.needGeometry,N=gc(D,F);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),N,c))continue;const G=v?v.evaluate(N,{},c):void 0,Z={id:S,properties:D.properties,type:D.type,sourceLayerIndex:P,index:I,geometry:F?N.geometry:Sa(D,c,h),patterns:{},sortKey:G};_.push(Z)}v&&_.sort((D,S)=>D.sortKey-S.sortKey);let C=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Ls,C=h.projection);for(const D of _){const{geometry:S,index:I,sourceLayerIndex:P}=D,F=r[I].feature;this.addFeature(D,S,I,a.availableImages,c,C),a.featureIndex.insert(F,S,I,P,this.index)}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Br.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,mp.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,a,c,h,m,_){for(const v of a)for(const C of v){const D=C.x,S=C.y;if(D<0||D>=kt||S<0||S>=kt)continue;if(_){const F=_.projectTilePoint(D,S,m),N=_.upVector(m,D,S),G=oi((S/kt+m.y)/(1<<m.z)),Z=_.pixelsPerMeter(G,1)/bu(1,G),K=this.globeExtVertexArray;Jd(K,F,N,Z),Jd(K,F,N,Z),Jd(K,F,N,Z),Jd(K,F,N,Z)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),P=I.vertexLength;Yd(this.layoutVertexArray,D,S,-1,-1),Yd(this.layoutVertexArray,D,S,1,-1),Yd(this.layoutVertexArray,D,S,1,1),Yd(this.layoutVertexArray,D,S,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},h,m)}}function ef(s,r){for(let a=0;a<s.length;a++)if(_c(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(_c(s,r[a]))return!0;return!!Dh(s,r)}function tf(s,r,a){return!!_c(s,r)||!!yp(r,s,a)}function Vy(s,r){if(1===s.length)return lg(r,s[0]);for(let a=0;a<r.length;a++){const c=r[a];for(let h=0;h<c.length;h++)if(_c(s,c[h]))return!0}for(let a=0;a<s.length;a++)if(lg(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(Dh(s,r[a]))return!0;return!1}function Eh(s,r,a){if(s.length>1){if(Dh(s,r))return!0;for(let c=0;c<r.length;c++)if(yp(r[c],s,a))return!0}for(let c=0;c<s.length;c++)if(yp(s[c],r,a))return!0;return!1}function Dh(s,r){if(0===s.length||0===r.length)return!1;for(let a=0;a<s.length-1;a++){const c=s[a],h=s[a+1];for(let m=0;m<r.length-1;m++)if(nf(c,h,r[m],r[m+1]))return!0}return!1}function nf(s,r,a,c){return Gr(s,a,c)!==Gr(r,a,c)&&Gr(s,r,a)!==Gr(s,r,c)}function yp(s,r,a){const c=a*a;if(1===r.length)return s.distSqr(r[0])<c;for(let h=1;h<r.length;h++)if(ag(s,r[h-1],r[h])<c)return!0;return!1}function ag(s,r,a){const c=r.distSqr(a);if(0===c)return s.distSqr(r);const h=((s.x-r.x)*(a.x-r.x)+(s.y-r.y)*(a.y-r.y))/c;return s.distSqr(h<0?r:h>1?a:a.sub(r)._mult(h)._add(r))}function lg(s,r){let a,c,h,m=!1;for(let _=0;_<s.length;_++){a=s[_];for(let v=0,C=a.length-1;v<a.length;C=v++)c=a[v],h=a[C],c.y>r.y!=h.y>r.y&&r.x<(h.x-c.x)*(r.y-c.y)/(h.y-c.y)+c.x&&(m=!m)}return m}function _c(s,r){let a=!1;for(let c=0,h=s.length-1;c<s.length;h=c++){const m=s[c],_=s[h];m.y>r.y!=_.y>r.y&&r.x<(_.x-m.x)*(r.y-m.y)/(_.y-m.y)+m.x&&(a=!a)}return a}function cg(s,r,a,c,h){for(const _ of s)if(r<=_.x&&a<=_.y&&c>=_.x&&h>=_.y)return!0;const m=[new Oe(r,a),new Oe(r,h),new Oe(c,h),new Oe(c,a)];if(s.length>2)for(const _ of m)if(_c(s,_))return!0;for(let _=0;_<s.length-1;_++)if(Th(s[_],s[_+1],m))return!0;return!1}function Th(s,r,a){const c=a[0],h=a[2];if(s.x<c.x&&r.x<c.x||s.x>h.x&&r.x>h.x||s.y<c.y&&r.y<c.y||s.y>h.y&&r.y>h.y)return!1;const m=Gr(s,r,a[0]);return m!==Gr(s,r,a[1])||m!==Gr(s,r,a[2])||m!==Gr(s,r,a[3])}function yc(s,r,a){const c=r.paint.get(s).value;return"constant"===c.kind?c.value:a.programConfigurations.get(r.id).getMaxValue(s)}function rf(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function bt(s,r,a,c,h){if(!r[0]&&!r[1])return s;const m=Oe.convert(r)._mult(h);"viewport"===a&&m._rotate(-c);const _=[];for(let v=0;v<s.length;v++)_.push(s[v].sub(m));return _}function vp(s,r,a,c){const h=Oe.convert(s)._mult(c);return"viewport"===r&&h._rotate(-a),h}tt(Qd,"CircleBucket",{omit:["layers"]});const Uy=new B({"circle-sort-key":new M(xe.layout_circle["circle-sort-key"])});var xp={paint:new B({"circle-radius":new M(xe.paint_circle["circle-radius"]),"circle-color":new M(xe.paint_circle["circle-color"]),"circle-blur":new M(xe.paint_circle["circle-blur"]),"circle-opacity":new M(xe.paint_circle["circle-opacity"]),"circle-translate":new E(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new E(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new E(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new E(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new M(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new M(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new M(xe.paint_circle["circle-stroke-opacity"])}),layout:Uy},vc=1e-6,to="undefined"!=typeof Float32Array?Float32Array:Array;function ug(){var s=new to(9);return to!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Ns(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Cu(s,r,a){var c=r[0],h=r[1],m=r[2],_=r[3],v=r[4],C=r[5],D=r[6],S=r[7],I=r[8],P=r[9],F=r[10],N=r[11],G=r[12],Z=r[13],K=r[14],se=r[15],le=a[0],he=a[1],de=a[2],fe=a[3];return s[0]=le*c+he*v+de*I+fe*G,s[1]=le*h+he*C+de*P+fe*Z,s[2]=le*m+he*D+de*F+fe*K,s[3]=le*_+he*S+de*N+fe*se,s[4]=(le=a[4])*c+(he=a[5])*v+(de=a[6])*I+(fe=a[7])*G,s[5]=le*h+he*C+de*P+fe*Z,s[6]=le*m+he*D+de*F+fe*K,s[7]=le*_+he*S+de*N+fe*se,s[8]=(le=a[8])*c+(he=a[9])*v+(de=a[10])*I+(fe=a[11])*G,s[9]=le*h+he*C+de*P+fe*Z,s[10]=le*m+he*D+de*F+fe*K,s[11]=le*_+he*S+de*N+fe*se,s[12]=(le=a[12])*c+(he=a[13])*v+(de=a[14])*I+(fe=a[15])*G,s[13]=le*h+he*C+de*P+fe*Z,s[14]=le*m+he*D+de*F+fe*K,s[15]=le*_+he*S+de*N+fe*se,s}function no(s,r,a){var c,h,m,_,v,C,D,S,I,P,F,N,G=a[0],Z=a[1],K=a[2];return r===s?(s[12]=r[0]*G+r[4]*Z+r[8]*K+r[12],s[13]=r[1]*G+r[5]*Z+r[9]*K+r[13],s[14]=r[2]*G+r[6]*Z+r[10]*K+r[14],s[15]=r[3]*G+r[7]*Z+r[11]*K+r[15]):(h=r[1],m=r[2],_=r[3],v=r[4],C=r[5],D=r[6],S=r[7],I=r[8],P=r[9],F=r[10],N=r[11],s[0]=c=r[0],s[1]=h,s[2]=m,s[3]=_,s[4]=v,s[5]=C,s[6]=D,s[7]=S,s[8]=I,s[9]=P,s[10]=F,s[11]=N,s[12]=c*G+v*Z+I*K+r[12],s[13]=h*G+C*Z+P*K+r[13],s[14]=m*G+D*Z+F*K+r[14],s[15]=_*G+S*Z+N*K+r[15]),s}function Ia(s,r,a){var c=a[0],h=a[1],m=a[2];return s[0]=r[0]*c,s[1]=r[1]*c,s[2]=r[2]*c,s[3]=r[3]*c,s[4]=r[4]*h,s[5]=r[5]*h,s[6]=r[6]*h,s[7]=r[7]*h,s[8]=r[8]*m,s[9]=r[9]*m,s[10]=r[10]*m,s[11]=r[11]*m,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function xc(s,r,a){var c=Math.sin(a),h=Math.cos(a),m=r[4],_=r[5],v=r[6],C=r[7],D=r[8],S=r[9],I=r[10],P=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=m*h+D*c,s[5]=_*h+S*c,s[6]=v*h+I*c,s[7]=C*h+P*c,s[8]=D*h-m*c,s[9]=S*h-_*c,s[10]=I*h-v*c,s[11]=P*h-C*c,s}function bp(s,r,a){var c=Math.sin(a),h=Math.cos(a),m=r[0],_=r[1],v=r[2],C=r[3],D=r[8],S=r[9],I=r[10],P=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=m*h-D*c,s[1]=_*h-S*c,s[2]=v*h-I*c,s[3]=C*h-P*c,s[8]=m*c+D*h,s[9]=_*c+S*h,s[10]=v*c+I*h,s[11]=C*c+P*h,s}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var hg=Cu;function Mh(){var s=new to(3);return to!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Sh(s){var r=new to(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function wp(s){return Math.hypot(s[0],s[1],s[2])}function Ih(s,r,a){var c=new to(3);return c[0]=s,c[1]=r,c[2]=a,c}function dg(s,r,a){return s[0]=r[0]+a[0],s[1]=r[1]+a[1],s[2]=r[2]+a[2],s}function bc(s,r,a){return s[0]=r[0]-a[0],s[1]=r[1]-a[1],s[2]=r[2]-a[2],s}function Eu(s,r,a){return s[0]=r[0]*a[0],s[1]=r[1]*a[1],s[2]=r[2]*a[2],s}function Cp(s,r,a){return s[0]=Math.min(r[0],a[0]),s[1]=Math.min(r[1],a[1]),s[2]=Math.min(r[2],a[2]),s}function fg(s,r,a){return s[0]=Math.max(r[0],a[0]),s[1]=Math.max(r[1],a[1]),s[2]=Math.max(r[2],a[2]),s}function Du(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s}function Ep(s,r,a,c){return s[0]=r[0]+a[0]*c,s[1]=r[1]+a[1]*c,s[2]=r[2]+a[2]*c,s}function of(s,r){var a=r[0],c=r[1],h=r[2],m=a*a+c*c+h*h;return m>0&&(m=1/Math.sqrt(m)),s[0]=r[0]*m,s[1]=r[1]*m,s[2]=r[2]*m,s}function Ah(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function pg(s,r,a){var c=r[0],h=r[1],m=r[2],_=a[0],v=a[1],C=a[2];return s[0]=h*C-m*v,s[1]=m*_-c*C,s[2]=c*v-h*_,s}function wc(s,r,a){var c=r[0],h=r[1],m=r[2],_=a[3]*c+a[7]*h+a[11]*m+a[15];return s[0]=(a[0]*c+a[4]*h+a[8]*m+a[12])/(_=_||1),s[1]=(a[1]*c+a[5]*h+a[9]*m+a[13])/_,s[2]=(a[2]*c+a[6]*h+a[10]*m+a[14])/_,s}function Ph(s,r,a){var c=a[0],h=a[1],m=a[2],_=r[0],v=r[1],C=r[2],D=h*C-m*v,S=m*_-c*C,I=c*v-h*_,P=h*I-m*S,F=m*D-c*I,N=c*S-h*D,G=2*a[3];return S*=G,I*=G,F*=2,N*=2,s[0]=_+(D*=G)+(P*=2),s[1]=v+S+F,s[2]=C+I+N,s}var Cc,rs=bc,jy=Eu,$y=wp;function kh(s,r,a){var c=r[0],h=r[1],m=r[2],_=r[3];return s[0]=a[0]*c+a[4]*h+a[8]*m+a[12]*_,s[1]=a[1]*c+a[5]*h+a[9]*m+a[13]*_,s[2]=a[2]*c+a[6]*h+a[10]*m+a[14]*_,s[3]=a[3]*c+a[7]*h+a[11]*m+a[15]*_,s}function Rh(){var s=new to(4);return to!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function sf(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Dp(s,r,a){a*=.5;var c=r[0],h=r[1],m=r[2],_=r[3],v=Math.sin(a),C=Math.cos(a);return s[0]=c*C+_*v,s[1]=h*C+m*v,s[2]=m*C-h*v,s[3]=_*C-c*v,s}Mh(),Cc=new to(4),to!=Float32Array&&(Cc[0]=0,Cc[1]=0,Cc[2]=0,Cc[3]=0),Mh(),Ih(1,0,0),Ih(0,1,0),Rh(),Rh(),ug();class af{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,c,h){const m=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const D=kh([],C,r),S=1/D[3]/a*m;return(I=D)[0]=(P=D)[0]*(F=[S,S,h?1/D[3]:S,S])[0],I[1]=P[1]*F[1],I[2]=P[2]*F[2],I[3]=P[3]*F[3],I;var I,P,F}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const D=of([],pg([],rs([],_[C[0]],_[C[1]]),rs([],_[C[2]],_[C[1]]))),S=-Ah(D,_[C[1]]);return D.concat(S)});return new af(_,v)}}class ro{constructor(r,a){this.min=r,this.max=a,this.center=Du([],dg([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],c=Sh(this.min),h=Sh(this.max);for(let m=0;m<a.length;m++)c[m]=a[m]?this.min[m]:this.center[m],h[m]=a[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new ro(c,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let c=!0;for(let h=0;h<r.planes.length;h++){const m=r.planes[h];let _=0;for(let v=0;v<a.length;v++)_+=Ah(m,a[v])+m[3]>=0;if(0===_)return 0;_!==a.length&&(c=!1)}if(c)return 2;for(let h=0;h<3;h++){let m=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<r.points.length;v++){const C=r.points[v][h]-this.min[h];m=Math.min(m,C),_=Math.max(_,C)}if(_<0||m>this.max[h]-this.min[h])return 0}return 1}}function Tp(s,r,a,c,h,m,_,v,C){if(m&&s.queryGeometry.isAboveHorizon)return!1;m&&(C*=s.pixelToTileUnitsFactor);for(const D of r)for(const S of D){const I=S.add(v),P=h&&a.elevation?a.elevation.exaggeration()*h.getElevationAt(I.x,I.y,!0):0,F=m?I:Gy(I,P,c),N=m?s.tilespaceRays.map(Z=>qy(Z,P)):s.queryGeometry.screenGeometry,G=kh([],[S.x,S.y,P,1],c);if(!_&&m?C*=G[3]/a.cameraToCenterDistance:_&&!m&&(C*=a.cameraToCenterDistance/G[3]),tf(N,F,C))return!0}return!1}function Gy(s,r,a){const c=kh([],[s.x,s.y,r,1],a);return new Oe(c[0]/c[3],c[1]/c[3])}const mg=Ih(0,0,0),Hy=Ih(0,0,1);function qy(s,r){const a=Mh();return mg[2]=r,s.intersectsPlane(mg,Hy,a),new Oe(a[0],a[1])}class gg extends Qd{}function Aa(s,{width:r,height:a},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*a*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*a*c);return s.width=r,s.height=a,s.data=h,s}function Tu(s,r,a){const{width:c,height:h}=r;c===s.width&&h===s.height||(Mp(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,c),height:Math.min(s.height,h)},a),s.width=c,s.height=h,s.data=r.data)}function Mp(s,r,a,c,h,m){if(0===h.width||0===h.height)return r;if(h.width>s.width||h.height>s.height||a.x>s.width-h.width||a.y>s.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||c.x>r.width-h.width||c.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=s.data,v=r.data;for(let C=0;C<h.height;C++){const D=((a.y+C)*s.width+a.x)*m,S=((c.y+C)*r.width+c.x)*m;for(let I=0;I<h.width*m;I++)v[S+I]=_[D+I]}return r}tt(gg,"HeatmapBucket",{omit:["layers"]});class yl{constructor(r,a){Aa(this,r,1,a)}resize(r){Tu(this,new yl(r),1)}clone(){return new yl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,h,m){Mp(r,a,c,h,m,1)}}class go{constructor(r,a){Aa(this,r,4,a)}resize(r){Tu(this,new go(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,h,m){Mp(r,a,c,h,m,4)}}tt(yl,"AlphaImage"),tt(go,"RGBAImage");var b1={paint:new B({"heatmap-radius":new M(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new M(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new E(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new O(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new E(xe.paint_heatmap["heatmap-opacity"])})};function _g(s){const r={},a=s.resolution||256,c=s.clips?s.clips.length:1,h=s.image||new go({width:a,height:c}),m=(_,v,C)=>{r[s.evaluationKey]=C;const D=s.expression.evaluate(r);h.data[_+v+0]=Math.floor(255*D.r/D.a),h.data[_+v+1]=Math.floor(255*D.g/D.a),h.data[_+v+2]=Math.floor(255*D.b/D.a),h.data[_+v+3]=Math.floor(255*D.a)};if(s.clips)for(let _=0,v=0;_<c;++_,v+=4*a)for(let C=0,D=0;C<a;C++,D+=4){const S=C/(a-1),{start:I,end:P}=s.clips[_];m(v,D,I*(1-S)+P*S)}else for(let _=0,v=0;_<a;_++,v+=4)m(0,v,_/(a-1));return h}var w1={paint:new B({"hillshade-illumination-direction":new E(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new E(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new E(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new E(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new E(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new E(xe.paint_hillshade["hillshade-accent-color"])})};const yg=ne([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zy}=yg;var lf=cf,Wy=cf;function cf(s,r,a){a=a||2;var c,h,m,_,v,C,D,S=r&&r.length,I=S?r[0]*a:s.length,P=Xy(s,0,I,a,!0),F=[];if(!P||P.next===P.prev)return F;if(S&&(P=function(G,Z,K,se){var le,he,de,fe=[];for(le=0,he=Z.length;le<he;le++)(de=Xy(G,Z[le]*se,le<he-1?Z[le+1]*se:G.length,se,!1))===de.next&&(de.steiner=!0),fe.push(E1(de));for(fe.sort(bg),le=0;le<fe.length;le++)K=vl(K=wg(fe[le],K),K.next);return K}(s,r,P,a)),s.length>80*a){c=m=s[0],h=_=s[1];for(var N=a;N<I;N+=a)(v=s[N])<c&&(c=v),(C=s[N+1])<h&&(h=C),v>m&&(m=v),C>_&&(_=C);D=0!==(D=Math.max(m-c,_-h))?1/D:0}return xl(P,F,a,c,h,D),F}function Xy(s,r,a,c,h){var m,_;if(h===Ap(s,r,a,c)>0)for(m=r;m<a;m+=c)_=Dg(m,s[m],s[m+1],_);else for(m=a-c;m>=r;m-=c)_=Dg(m,s[m],s[m+1],_);return _&&Ip(_,_.next)&&(Mu(_),_=_.next),_}function vl(s,r){if(!s)return s;r||(r=s);var a,c=s;do{if(a=!1,c.steiner||!Ip(c,c.next)&&0!==rr(c.prev,c,c.next))c=c.next;else{if(Mu(c),(c=r=c.prev)===c.next)break;a=!0}}while(a||c!==r);return r}function xl(s,r,a,c,h,m,_){if(s){!_&&m&&function(S,I,P,F){var N=S;do{null===N.z&&(N.z=Cg(N.x,N.y,I,P,F)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==S);N.prevZ.nextZ=null,N.prevZ=null,function(G){var Z,K,se,le,he,de,fe,we,Me=1;do{for(K=G,G=null,he=null,de=0;K;){for(de++,se=K,fe=0,Z=0;Z<Me&&(fe++,se=se.nextZ);Z++);for(we=Me;fe>0||we>0&&se;)0!==fe&&(0===we||!se||K.z<=se.z)?(le=K,K=K.nextZ,fe--):(le=se,se=se.nextZ,we--),he?he.nextZ=le:G=le,le.prevZ=he,he=le;K=se}he.nextZ=null,Me*=2}while(de>1)}(N)}(s,c,h,m);for(var v,C,D=s;s.prev!==s.next;)if(v=s.prev,C=s.next,m?Vs(s,c,h,m):vg(s))r.push(v.i/a),r.push(s.i/a),r.push(C.i/a),Mu(s),s=C.next,D=C.next;else if((s=C)===D){_?1===_?xl(s=Oh(vl(s),r,a),r,a,c,h,m,2):2===_&&xg(s,r,a,c,h,m):xl(vl(s),r,a,c,h,m,1);break}}}function vg(s){var r=s.prev,a=s,c=s.next;if(rr(r,a,c)>=0)return!1;for(var h=s.next.next;h!==s.prev;){if(bl(r.x,r.y,a.x,a.y,c.x,c.y,h.x,h.y)&&rr(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Vs(s,r,a,c){var h=s.prev,m=s,_=s.next;if(rr(h,m,_)>=0)return!1;for(var v=h.x>m.x?h.x>_.x?h.x:_.x:m.x>_.x?m.x:_.x,C=h.y>m.y?h.y>_.y?h.y:_.y:m.y>_.y?m.y:_.y,D=Cg(h.x<m.x?h.x<_.x?h.x:_.x:m.x<_.x?m.x:_.x,h.y<m.y?h.y<_.y?h.y:_.y:m.y<_.y?m.y:_.y,r,a,c),S=Cg(v,C,r,a,c),I=s.prevZ,P=s.nextZ;I&&I.z>=D&&P&&P.z<=S;){if(I!==s.prev&&I!==s.next&&bl(h.x,h.y,m.x,m.y,_.x,_.y,I.x,I.y)&&rr(I.prev,I,I.next)>=0||(I=I.prevZ,P!==s.prev&&P!==s.next&&bl(h.x,h.y,m.x,m.y,_.x,_.y,P.x,P.y)&&rr(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;I&&I.z>=D;){if(I!==s.prev&&I!==s.next&&bl(h.x,h.y,m.x,m.y,_.x,_.y,I.x,I.y)&&rr(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;P&&P.z<=S;){if(P!==s.prev&&P!==s.next&&bl(h.x,h.y,m.x,m.y,_.x,_.y,P.x,P.y)&&rr(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function Oh(s,r,a){var c=s;do{var h=c.prev,m=c.next.next;!Ip(h,m)&&Ky(h,c,c.next,m)&&Lh(h,m)&&Lh(m,h)&&(r.push(h.i/a),r.push(c.i/a),r.push(m.i/a),Mu(c),Mu(c.next),c=s=m),c=c.next}while(c!==s);return vl(c)}function xg(s,r,a,c,h,m){var _=s;do{for(var v=_.next.next;v!==_.prev;){if(_.i!==v.i&&Sp(_,v)){var C=Eg(_,v);return _=vl(_,_.next),C=vl(C,C.next),xl(_,r,a,c,h,m),void xl(C,r,a,c,h,m)}v=v.next}_=_.next}while(_!==s)}function bg(s,r){return s.x-r.x}function wg(s,r){var a=function(m,_){var v,C=_,D=m.x,S=m.y,I=-1/0;do{if(S<=C.y&&S>=C.next.y&&C.next.y!==C.y){var P=C.x+(S-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(P<=D&&P>I){if(I=P,P===D){if(S===C.y)return C;if(S===C.next.y)return C.next}v=C.x<C.next.x?C:C.next}}C=C.next}while(C!==_);if(!v)return null;if(D===I)return v;var F,N=v,G=v.x,Z=v.y,K=1/0;C=v;do{D>=C.x&&C.x>=G&&D!==C.x&&bl(S<Z?D:I,S,G,Z,S<Z?I:D,S,C.x,C.y)&&(F=Math.abs(S-C.y)/(D-C.x),Lh(C,m)&&(F<K||F===K&&(C.x>v.x||C.x===v.x&&C1(v,C)))&&(v=C,K=F)),C=C.next}while(C!==N);return v}(s,r);if(!a)return r;var c=Eg(a,s),h=vl(a,a.next);return vl(c,c.next),r===a?h:r}function C1(s,r){return rr(s.prev,s,r.prev)<0&&rr(r.next,s,s.next)<0}function Cg(s,r,a,c,h){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-a)*h)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function E1(s){var r=s,a=s;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==s);return a}function bl(s,r,a,c,h,m,_,v){return(h-_)*(r-v)-(s-_)*(m-v)>=0&&(s-_)*(c-v)-(a-_)*(r-v)>=0&&(a-_)*(m-v)-(h-_)*(c-v)>=0}function Sp(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(a,c){var h=a;do{if(h.i!==a.i&&h.next.i!==a.i&&h.i!==c.i&&h.next.i!==c.i&&Ky(h,h.next,a,c))return!0;h=h.next}while(h!==a);return!1}(s,r)&&(Lh(s,r)&&Lh(r,s)&&function(a,c){var h=a,m=!1,_=(a.x+c.x)/2,v=(a.y+c.y)/2;do{h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==a);return m}(s,r)&&(rr(s.prev,s,r.prev)||rr(s,r.prev,r))||Ip(s,r)&&rr(s.prev,s,s.next)>0&&rr(r.prev,r,r.next)>0)}function rr(s,r,a){return(r.y-s.y)*(a.x-r.x)-(r.x-s.x)*(a.y-r.y)}function Ip(s,r){return s.x===r.x&&s.y===r.y}function Ky(s,r,a,c){var h=uf(rr(s,r,a)),m=uf(rr(s,r,c)),_=uf(rr(a,c,s)),v=uf(rr(a,c,r));return h!==m&&_!==v||!(0!==h||!Fh(s,a,r))||!(0!==m||!Fh(s,c,r))||!(0!==_||!Fh(a,s,c))||!(0!==v||!Fh(a,r,c))}function Fh(s,r,a){return r.x<=Math.max(s.x,a.x)&&r.x>=Math.min(s.x,a.x)&&r.y<=Math.max(s.y,a.y)&&r.y>=Math.min(s.y,a.y)}function uf(s){return s>0?1:s<0?-1:0}function Lh(s,r){return rr(s.prev,s,s.next)<0?rr(s,r,s.next)>=0&&rr(s,s.prev,r)>=0:rr(s,r,s.prev)<0||rr(s,s.next,r)<0}function Eg(s,r){var a=new Su(s.i,s.x,s.y),c=new Su(r.i,r.x,r.y),h=s.next,m=r.prev;return s.next=r,r.prev=s,a.next=h,h.prev=a,c.next=a,a.prev=c,m.next=c,c.prev=m,c}function Dg(s,r,a,c){var h=new Su(s,r,a);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function Mu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Su(s,r,a){this.i=s,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ap(s,r,a,c){for(var h=0,m=r,_=a-c;m<a;m+=c)h+=(s[_]-s[m])*(s[m+1]+s[_+1]),_=m;return h}function Pp(s,r,a,c,h){Tg(s,r,a||0,c||s.length-1,h||Yy)}function Tg(s,r,a,c,h){for(;c>a;){if(c-a>600){var m=c-a+1,_=r-a+1,v=Math.log(m),C=.5*Math.exp(2*v/3),D=.5*Math.sqrt(v*C*(m-C)/m)*(_-m/2<0?-1:1);Tg(s,r,Math.max(a,Math.floor(r-_*C/m+D)),Math.min(c,Math.floor(r+(m-_)*C/m+D)),h)}var S=s[r],I=a,P=c;for(sr(s,a,r),h(s[c],S)>0&&sr(s,a,c);I<P;){for(sr(s,I,P),I++,P--;h(s[I],S)<0;)I++;for(;h(s[P],S)>0;)P--}0===h(s[a],S)?sr(s,a,P):sr(s,++P,c),P<=r&&(a=P+1),r<=P&&(c=P-1)}}function sr(s,r,a){var c=s[r];s[r]=s[a],s[a]=c}function Yy(s,r){return s<r?-1:s>r?1:0}function kp(s,r){const a=s.length;if(a<=1)return[s];const c=[];let h,m;for(let _=0;_<a;_++){const v=br(s[_]);0!==v&&(s[_].area=Math.abs(v),void 0===m&&(m=v<0),m===v<0?(h&&c.push(h),h=[s[_]]):h.push(s[_]))}if(h&&c.push(h),r>1)for(let _=0;_<c.length;_++)c[_].length<=r||(Pp(c[_],r,1,c[_].length-1,Rp),c[_]=c[_].slice(0,r));return c}function Rp(s,r){return r.area-s.area}function hf(s,r,a){const c=a.patternDependencies;let h=!1;for(const m of r){const _=m.paint.get(`${s}-pattern`);_.isConstant()||(h=!0);const v=_.constantOr(null);v&&(h=!0,c[v.to]=!0,c[v.from]=!0)}return h}function Op(s,r,a,c,h){const m=h.patternDependencies;for(const _ of r){const v=_.paint.get(`${s}-pattern`).value;if("constant"!==v.kind){let C=v.evaluate({zoom:c-1},a,{},h.availableImages),D=v.evaluate({zoom:c},a,{},h.availableImages),S=v.evaluate({zoom:c+1},a,{},h.availableImages);C=C&&C.name?C.name:C,D=D&&D.name?D.name:D,S=S&&S.name?S.name:S,m[C]=!0,m[D]=!0,m[S]=!0,a.patterns[_.id]={min:C,mid:D,max:S}}}return a}cf.deviation=function(s,r,a,c){var h=r&&r.length,m=Math.abs(Ap(s,0,h?r[0]*a:s.length,a));if(h)for(var _=0,v=r.length;_<v;_++)m-=Math.abs(Ap(s,r[_]*a,_<v-1?r[_+1]*a:s.length,a));var C=0;for(_=0;_<c.length;_+=3){var D=c[_]*a,S=c[_+1]*a,I=c[_+2]*a;C+=Math.abs((s[D]-s[I])*(s[S+1]-s[D+1])-(s[D]-s[S])*(s[I+1]-s[D+1]))}return 0===m&&0===C?0:Math.abs((C-m)/m)},cf.flatten=function(s){for(var r=s[0][0].length,a={vertices:[],holes:[],dimensions:r},c=0,h=0;h<s.length;h++){for(var m=0;m<s[h].length;m++)for(var _=0;_<r;_++)a.vertices.push(s[h][m][_]);h>0&&a.holes.push(c+=s[h-1].length)}return a},lf.default=Wy;class df{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ee,this.indexArray=new it,this.indexArray2=new vt,this.programConfigurations=new vu(r.layers,r.zoom),this.segments=new Vn,this.segments2=new Vn,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection}populate(r,a,c,h){this.hasPattern=hf("fill",this.layers,a);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:C,index:D,sourceLayerIndex:S}of r){const I=this.layers[0]._featureFilter.needGeometry,P=gc(v,I);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),P,c))continue;const F=m?m.evaluate(P,{},c,a.availableImages):void 0,N={id:C,properties:v.properties,type:v.type,sourceLayerIndex:S,index:D,geometry:I?P.geometry:Sa(v,c,h),patterns:{},sortKey:F};_.push(N)}m&&_.sort((v,C)=>v.sortKey-C.sortKey);for(const v of _){const{geometry:C,index:D,sourceLayerIndex:S}=v;if(this.hasPattern){const I=Op("fill",this.layers,v,this.zoom,a);this.patternFeatures.push(I)}else this.addFeature(v,C,D,c,{},a.availableImages);a.featureIndex.insert(r[D].feature,C,D,S,this.index)}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}addFeatures(r,a,c,h,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,a,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Zy),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,c,h,m,_=[]){for(const v of kp(a,500)){let C=0;for(const N of v)C+=N.length;const D=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),S=D.vertexLength,I=[],P=[];for(const N of v){if(0===N.length)continue;N!==v[0]&&P.push(I.length/2);const G=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),Z=G.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(Z+N.length-1,Z),I.push(N[0].x),I.push(N[0].y);for(let K=1;K<N.length;K++)this.layoutVertexArray.emplaceBack(N[K].x,N[K].y),this.indexArray2.emplaceBack(Z+K-1,Z+K),I.push(N[K].x),I.push(N[K].y);G.vertexLength+=N.length,G.primitiveLength+=N.length}const F=lf(I,P);for(let N=0;N<F.length;N+=3)this.indexArray.emplaceBack(S+F[N],S+F[N+1],S+F[N+2]);D.vertexLength+=C,D.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,_,h)}}tt(df,"FillBucket",{omit:["layers","patternFeatures"]});const Jy=new B({"fill-sort-key":new M(xe.layout_fill["fill-sort-key"])});var Qy={paint:new B({"fill-antialias":new E(xe.paint_fill["fill-antialias"]),"fill-opacity":new M(xe.paint_fill["fill-opacity"]),"fill-color":new M(xe.paint_fill["fill-color"]),"fill-outline-color":new M(xe.paint_fill["fill-outline-color"]),"fill-translate":new E(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new E(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new A(xe.paint_fill["fill-pattern"])}),layout:Jy};const ev=ne([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),D1=ne([{name:"a_centroid_pos",components:2,type:"Uint16"}]),T1=ne([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:zh}=ev;var bi=wl;function wl(s,r,a,c,h){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=c,this._values=h,s.readFields(Mg,this,r)}function Mg(s,r,a){1==s?r.id=a.readVarint():2==s?function(c,h){for(var m=c.readVarint()+c.pos;c.pos<m;){var _=h._keys[c.readVarint()],v=h._values[c.readVarint()];h.properties[_]=v}}(a,r):3==s?r.type=a.readVarint():4==s&&(r._geometry=a.pos)}function Sg(s){for(var r,a,c=0,h=0,m=s.length,_=m-1;h<m;_=h++)c+=((a=s[_]).x-(r=s[h]).x)*(r.y+a.y);return c}wl.types=["Unknown","Point","LineString","Polygon"],wl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,a=s.readVarint()+s.pos,c=1,h=0,m=0,_=0,v=[];s.pos<a;){if(h<=0){var C=s.readVarint();c=7&C,h=C>>3}if(h--,1===c||2===c)m+=s.readSVarint(),_+=s.readSVarint(),1===c&&(r&&v.push(r),r=[]),r.push(new Oe(m,_));else{if(7!==c)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&v.push(r),v},wl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,a=1,c=0,h=0,m=0,_=1/0,v=-1/0,C=1/0,D=-1/0;s.pos<r;){if(c<=0){var S=s.readVarint();a=7&S,c=S>>3}if(c--,1===a||2===a)(h+=s.readSVarint())<_&&(_=h),h>v&&(v=h),(m+=s.readSVarint())<C&&(C=m),m>D&&(D=m);else if(7!==a)throw new Error("unknown command "+a)}return[_,C,v,D]},wl.prototype.toGeoJSON=function(s,r,a){var c,h,m=this.extent*Math.pow(2,a),_=this.extent*s,v=this.extent*r,C=this.loadGeometry(),D=wl.types[this.type];function S(F){for(var N=0;N<F.length;N++){var G=F[N];F[N]=[360*(G.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+v)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(c=0;c<C.length;c++)I[c]=C[c][0];S(C=I);break;case 2:for(c=0;c<C.length;c++)S(C[c]);break;case 3:for(C=function(F){var N=F.length;if(N<=1)return[F];for(var G,Z,K=[],se=0;se<N;se++){var le=Sg(F[se]);0!==le&&(void 0===Z&&(Z=le<0),Z===le<0?(G&&K.push(G),G=[F[se]]):G.push(F[se]))}return G&&K.push(G),K}(C),c=0;c<C.length;c++)for(h=0;h<C[c].length;h++)S(C[c][h])}1===C.length?C=C[0]:D="Multi"+D;var P={type:"Feature",geometry:{type:D,coordinates:C},properties:this.properties};return"id"in this&&(P.id=this.id),P};var si=Iu;function Iu(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Fp,this,r),this.length=this._features.length}function Fp(s,r,a){15===s?r.version=a.readVarint():1===s?r.name=a.readString():5===s?r.extent=a.readVarint():2===s?r._features.push(a.pos):3===s?r._keys.push(a.readString()):4===s&&r._values.push(function(c){for(var h=null,m=c.readVarint()+c.pos;c.pos<m;){var _=c.readVarint()>>3;h=1===_?c.readString():2===_?c.readFloat():3===_?c.readDouble():4===_?c.readVarint64():5===_?c.readVarint():6===_?c.readSVarint():7===_?c.readBoolean():null}return h}(a))}function tv(s,r,a){if(3===s){var c=new si(a,a.readVarint()+a.pos);c.length&&(r[c.name]=c)}}Iu.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new bi(this._pbf,r,this.extent,this._keys,this._values)};var Ec={VectorTile:function(s,r){this.layers=s.readFields(tv,{},r)},VectorTileFeature:bi,VectorTileLayer:si};function Bh(s,r,a,c){const h=[],m=0===c?(_,v,C,D,S,I)=>{_.push(new Oe(I,C+(I-v)/(D-v)*(S-C)))}:(_,v,C,D,S,I)=>{_.push(new Oe(v+(I-C)/(S-C)*(D-v),I))};for(const _ of s){const v=[];for(const C of _){if(C.length<=2)continue;const D=[];for(let P=0;P<C.length-1;P++){const F=C[P].x,N=C[P].y,G=C[P+1].x,Z=C[P+1].y,K=0===c?F:N,se=0===c?G:Z;K<r?se>r&&m(D,F,N,G,Z,r):K>a?se<a&&m(D,F,N,G,Z,a):D.push(C[P]),se<r&&K>=r&&m(D,F,N,G,Z,r),se>a&&K<=a&&m(D,F,N,G,Z,a)}let S=C[C.length-1];const I=0===c?S.x:S.y;I>=r&&I<=a&&D.push(S),D.length&&(S=D[D.length-1],D[0].x===S.x&&D[0].y===S.y||D.push(D[0]),v.push(D))}v.length&&h.push(v)}return h}const nv=Ec.VectorTileFeature.types,Ig=Math.pow(2,13);function Nh(s,r,a,c,h,m,_,v){s.emplaceBack((r<<1)+_,(a<<1)+m,(Math.floor(c*Ig)<<1)+h,Math.round(v))}function Au(s,r,a){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class Ag{constructor(){this.acc=new Oe(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Oe(r.x,r.y),this.max=new Oe(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);const c=this.min,h=this.max;r.x<c.x?c.x=r.x:r.x>h.x&&(h.x=r.x),r.y<c.y?c.y=r.y:r.y>h.y&&(h.y=r.y),((0===r.x||r.x===kt)&&r.x===a.x)!=((0===r.y||r.y===kt)&&r.y===a.y)&&this.processBorderOverlap(r,a),a.x<0!=r.x<0&&this.addBorderIntersection(0,yt(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>kt!=r.x>kt&&this.addBorderIntersection(1,yt(a.y,r.y,(kt-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,yt(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>kt!=r.y>kt&&this.addBorderIntersection(3,yt(a.x,r.x,(kt-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[r];a<c[0]&&(c[0]=a),a>c[1]&&(c[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const c=0===r.x?0:1;this.addBorderIntersection(c,a.y),this.addBorderIntersection(c,r.y)}else{const c=0===r.y?2:3;this.addBorderIntersection(c,a.x),this.addBorderIntersection(c,r.x)}}centroid(){const r=this.polyCount.reduce((a,c)=>a+c.edges,0);return 0!==r?this.acc.div(r)._round():new Oe(0,0)}span(){return new Oe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class Vh{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new oe,this.centroidVertexArray=new Fs,this.indexArray=new it,this.programConfigurations=new vu(r.layers,r.zoom),this.segments=new Vn,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,c,h){this.features=[],this.hasPattern=hf("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const _=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*_/(_*_+1)/kt/(1<<m.z)}(c);for(const{feature:m,id:_,index:v,sourceLayerIndex:C}of r){const D=this.layers[0]._featureFilter.needGeometry,S=gc(m,D);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),S,c))continue;const I={id:_,sourceLayerIndex:C,index:v,geometry:D?S.geometry:Sa(m,c,h),properties:m.properties,type:m.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Op("fill-extrusion",this.layers,I,this.zoom,a)):this.addFeature(I,I.geometry,v,c,{},a.availableImages,h),a.featureIndex.insert(m,I.geometry,v,C,this.index,P)}this.sortBorders()}addFeatures(r,a,c,h,m){for(const _ of this.features){const{geometry:v}=_;this.addFeature(_,v,_.index,a,c,h,m)}this.sortBorders()}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,zh),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,T1.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,D1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,c,h,m,_,v){const C=[new Oe(0,0),new Oe(kt,kt)],D=v.projection,S="globe"===D.name,I=this.enableTerrain&&!S?new Ag:null;S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ar);const P=kp(a,500);for(let G=P.length-1;G>=0;G--){const Z=P[G];(0===Z.length||(F=Z[0]).every(K=>K.x<=0)||F.every(K=>K.x>=kt)||F.every(K=>K.y<=0)||F.every(K=>K.y>=kt))&&P.splice(G,1)}var F;let N;if(S){const Z=1<<h.z,K=zo(h.x/Z),se=zo((h.x+1)/Z),le=oi(h.y/Z),he=oi((h.y+1)/Z);N=function(de,fe,we,Me,ke=0,ze){const Ce=[];if(!de.length||!we||!Me)return Ce;const Ee=(Mt,Rt)=>{for(const ct of Mt)Ce.push({polygon:ct,bounds:Rt})},Be=Math.ceil(Math.log2(we)),We=Math.ceil(Math.log2(Me)),$e=Be-We,qe=[];for(let Mt=0;Mt<Math.abs($e);Mt++)qe.push($e>0?0:1);for(let Mt=0;Mt<Math.min(Be,We);Mt++)qe.push(0),qe.push(1);let Et=de;if(Et=Bh(Et,fe[0].y-ke,fe[1].y+ke,1),Et=Bh(Et,fe[0].x-ke,fe[1].x+ke,0),!Et.length)return Ce;const jt=[];for(qe.length?jt.push({polygons:Et,bounds:fe,depth:0}):Ee(Et,fe);jt.length;){const Mt=jt.pop(),Rt=Mt.depth,ct=qe[Rt],et=Mt.bounds[0],Qt=Mt.bounds[1],cn=0===ct?et.x:et.y,vr=0===ct?Qt.x:Qt.y,Rn=ze?ze(ct,cn,vr):.5*(cn+vr),Dr=Bh(Mt.polygons,cn-ke,Rn+ke,ct),pn=Bh(Mt.polygons,Rn-ke,vr+ke,ct);if(Dr.length){const Ht=[et,new Oe(0===ct?Rn:Qt.x,1===ct?Rn:Qt.y)];qe.length>Rt+1?jt.push({polygons:Dr,bounds:Ht,depth:Rt+1}):Ee(Dr,Ht)}if(pn.length){const Ht=[new Oe(0===ct?Rn:et.x,1===ct?Rn:et.y),Qt];qe.length>Rt+1?jt.push({polygons:pn,bounds:Ht,depth:Rt+1}):Ee(pn,Ht)}}return Ce}(P,C,Math.ceil((se-K)/11.25),Math.ceil((le-he)/11.25),1,(de,fe,we)=>{if(0===de)return.5*(fe+we);{const Me=oi((h.y+fe/kt)/Z);return(mc(.5*(oi((h.y+we/kt)/Z)+Me))*Z-h.y)*kt}})}else{N=[];for(const G of P)N.push({polygon:G,bounds:C})}for(const G of N){const Z=G.polygon;let K=0,se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let we=0;we<Z.length;we++){const Me=Z[we];if(0===Me.length)continue;K+=Me.length;let ke=0;I&&I.startRing(Me[0]);for(let ze=0;ze<Me.length;ze++){const Ce=Me[ze];if(ze>=1){const Ee=Me[ze-1];if(!Lp(Ce,Ee,G.bounds)){I&&I.append(Ce,Ee),se.vertexLength+4>Vn.MAX_VERTEX_ARRAY_LENGTH&&(se=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Be=Ce.sub(Ee)._perp(),We=Be.x/(Math.abs(Be.x)+Math.abs(Be.y)),$e=Be.y>0?1:0,qe=Ee.dist(Ce);ke+qe>32768&&(ke=0),Nh(this.layoutVertexArray,Ce.x,Ce.y,We,$e,0,0,ke),Nh(this.layoutVertexArray,Ce.x,Ce.y,We,$e,0,1,ke),ke+=qe,Nh(this.layoutVertexArray,Ee.x,Ee.y,We,$e,0,0,ke),Nh(this.layoutVertexArray,Ee.x,Ee.y,We,$e,0,1,ke);const Et=se.vertexLength;if(this.indexArray.emplaceBack(Et,Et+2,Et+1),this.indexArray.emplaceBack(Et+1,Et+2,Et+3),se.vertexLength+=4,se.primitiveLength+=2,S){const jt=this.layoutVertexExtArray,Mt=D.projectTilePoint(Ce.x,Ce.y,h),Rt=D.projectTilePoint(Ee.x,Ee.y,h),ct=D.upVector(h,Ce.x,Ce.y),et=D.upVector(h,Ee.x,Ee.y);Au(jt,Mt,ct),Au(jt,Mt,ct),Au(jt,Rt,et),Au(jt,Rt,et)}}}}}if(se.vertexLength+K>Vn.MAX_VERTEX_ARRAY_LENGTH&&(se=this.segments.prepareSegment(K,this.layoutVertexArray,this.indexArray)),"Polygon"!==nv[r.type])continue;const le=[],he=[],de=se.vertexLength;for(let we=0;we<Z.length;we++){const Me=Z[we];if(0!==Me.length){Me!==Z[0]&&he.push(le.length/2);for(let ke=0;ke<Me.length;ke++){const ze=Me[ke];Nh(this.layoutVertexArray,ze.x,ze.y,0,0,1,1,0),le.push(ze.x),le.push(ze.y),I&&I.currentPolyCount.top++,S&&Au(this.layoutVertexExtArray,D.projectTilePoint(ze.x,ze.y,h),D.upVector(h,ze.x,ze.y))}}}const fe=lf(le,he);for(let we=0;we<fe.length;we+=3)this.indexArray.emplaceBack(de+fe[we],de+fe[we+2],de+fe[we+1]);se.primitiveLength+=fe.length/3,se.vertexLength+=K}if(I&&I.polyCount.length>0){if(I.borders){I.vertexArrayOffset=this.centroidVertexArray.length;const G=I.borders,Z=this.featuresOnBorder.push(I)-1;for(let K=0;K<4;K++)G[K][0]!==Number.MAX_VALUE&&this.borders[K].push(Z)}this.encodeCentroid(I.borders?void 0:I.centroid(),I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,_,h)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,c)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[c].borders[r][0])}encodeCentroid(r,a,c=!0){let h,m;if(r)if(0!==r.y){const v=a.span()._mult(this.tileToMeter);h=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(v.x/10)),m=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else h=Math.ceil(7*(r.x+450)),m=0;else h=0,m=+c;let _=c?this.centroidVertexArray.length:a.vertexArrayOffset;for(const v of a.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let C=0;C<2*v.edges;C++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,h,m);for(let C=0;C<v.top;C++)this.centroidVertexArray.emplace(_++,h,m)}}}function Lp(s,r,a){return s.x===r.x&&(s.x<a[0].x||s.x>a[1].x)||s.y===r.y&&(s.y<a[0].y||s.y>a[1].y)}tt(Vh,"FillExtrusionBucket",{omit:["layers","features"]}),tt(Ag,"PartMetadata");var rv={paint:new B({"fill-extrusion-opacity":new E(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new M(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new E(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new E(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new A(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new M(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new M(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new E(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Uh(s,r){return s.x*r.x+s.y*r.y}function ff(s,r){if(1===s.length){let a=0;const c=r[a++];let h;for(;!h||c.equals(h);)if(h=r[a++],!h)return 1/0;for(;a<r.length;a++){const m=r[a],_=s[0],v=h.sub(c),C=m.sub(c),D=_.sub(c),S=Uh(v,v),I=Uh(v,C),P=Uh(C,C),F=Uh(D,v),N=Uh(D,C),G=S*P-I*I,Z=(P*F-I*N)/G,K=(S*N-I*F)/G,se=c.z*(1-Z-K)+h.z*Z+m.z*K;if(isFinite(se))return se}return 1/0}{let a=1/0;for(const c of r)a=Math.min(a,c.z);return a}}function Pg(s){const r=new Oe(s[0],s[1]);return r.z=s[2],r}function iv(s,r,a,c,h,m,_,v){const C=_*h.getElevationAt(s,r,!0,!0),D=0!==m[0],S=D?0===m[1]?_*(m[0]/7-450):_*function(I,P,F){const N=Math.floor(P[0]/8),G=Math.floor(P[1]/8),Z=10*(P[0]-8*N),K=10*(P[1]-8*G),se=I.getElevationAt(N,G,!0,!0),le=I.getMeterToDEM(F),he=Math.floor(.5*(Z*le-1)),de=Math.floor(.5*(K*le-1)),fe=I.tileCoordToPixel(N,G),we=2*he+1,Me=2*de+1,ke=(jt=we,Mt=Me,[($e=I).getElevationAtPixel(qe=fe.x-he,Et=fe.y-de,!0),$e.getElevationAtPixel(qe+Mt,Et,!0),$e.getElevationAtPixel(qe,Et+Mt,!0),$e.getElevationAtPixel(qe+jt,Et+Mt,!0)]),ze=Math.abs(ke[0]-ke[1]),Ce=Math.abs(ke[2]-ke[3]),Ee=Math.abs(ke[0]-ke[2])+Math.abs(ke[1]-ke[3]),Be=Math.min(.25,.5*le*(ze+Ce)/we),We=Math.min(.25,.5*le*Ee/Me);var $e,qe,Et,jt,Mt;return se+Math.max(Be*Z,We*K)}(h,m,v):C;return{base:C+(0===a)?-1:a,top:D?Math.max(S+c,C+a+2):C+c}}const jh=ne([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ov}=jh,sv=ne([{name:"a_packed",components:3,type:"Float32"}]),{members:av}=sv,lv=Ec.VectorTileFeature.types,cv=Math.cos(Math.PI/180*37.5);class $h{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Q,this.layoutVertexArray2=new Ne,this.indexArray=new it,this.programConfigurations=new vu(r.layers,r.zoom),this.segments=new Vn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,h){this.hasPattern=hf("line",this.layers,a);const m=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:S,id:I,index:P,sourceLayerIndex:F}of r){const N=this.layers[0]._featureFilter.needGeometry,G=gc(S,N);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),G,c))continue;const Z=m?m.evaluate(G,{},c):void 0,K={id:I,properties:S.properties,type:S.type,sourceLayerIndex:F,index:P,geometry:N?G.geometry:Sa(S,c,h),patterns:{},sortKey:Z};_.push(K)}m&&_.sort((S,I)=>S.sortKey-I.sortKey);const{lineAtlas:v,featureIndex:C}=a,D=this.addConstantDashes(v);for(const S of _){const{geometry:I,index:P,sourceLayerIndex:F}=S;if(D&&this.addFeatureDashes(S,v),this.hasPattern){const N=Op("line",this.layers,S,this.zoom,a);this.patternFeatures.push(N)}else this.addFeature(S,I,P,c,v.positions,a.availableImages);C.insert(r[P].feature,I,P,F,this.index)}}addConstantDashes(r){let a=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)a=!0;else{const _=m.value,v=h.value;if(!v)continue;r.addDash(v.from,_),r.addDash(v.to,_),v.other&&r.addDash(v.other,_)}}return a}addFeatureDashes(r,a){const c=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let v,C,D,S,I,P;if("constant"===m.kind){const Z=m.value;if(!Z)continue;v=Z.other||Z.to,C=Z.to,D=Z.from}else v=m.evaluate({zoom:c-1},r),C=m.evaluate({zoom:c},r),D=m.evaluate({zoom:c+1},r);"constant"===_.kind?S=I=P=_.value:(S=_.evaluate({zoom:c-1},r),I=_.evaluate({zoom:c},r),P=_.evaluate({zoom:c+1},r)),a.addDash(v,S),a.addDash(C,I),a.addDash(D,P);const F=a.getKey(v,S),N=a.getKey(C,I),G=a.getKey(D,P);r.patterns[h.id]={min:F,mid:N,max:G}}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}addFeatures(r,a,c,h,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,a,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,av)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ov),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,c,h,m,_){const v=this.layers[0].layout,C=v.get("line-join").evaluate(r,{}),D=v.get("line-cap").evaluate(r,{}),S=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const P of a)this.addLine(P,r,C,D,S,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,m,_,h)}addLine(r,a,c,h,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<r.length-1;K++)this.totalDistance+=r[K].dist(r[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v="Polygon"===lv[a.type];let C=r.length;for(;C>=2&&r[C-1].equals(r[C-2]);)C--;let D=0;for(;D<C-1&&r[D].equals(r[D+1]);)D++;if(C<(v?3:2))return;"bevel"===c&&(m=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let P,F,N,G,Z;this.e1=this.e2=-1,v&&(P=r[C-2],Z=r[D].sub(P)._unit()._perp());for(let K=D;K<C;K++){if(N=K===C-1?v?r[D+1]:void 0:r[K+1],N&&r[K].equals(N))continue;Z&&(G=Z),P&&(F=P),P=r[K],Z=N?N.sub(P)._unit()._perp():G,G=G||Z;let se=G.add(Z);0===se.x&&0===se.y||se._unit();const le=G.x*Z.x+G.y*Z.y,he=se.x*Z.x+se.y*Z.y,de=0!==he?1/he:1/0,fe=2*Math.sqrt(2-2*he),we=he<cv&&F&&N,Me=G.x*Z.y-G.y*Z.x>0;if(we&&K>D){const Ce=P.dist(F);if(Ce>2*S){const Ee=P.sub(P.sub(F)._mult(S/Ce)._round());this.updateDistance(F,Ee),this.addCurrentVertex(Ee,G,0,0,I),F=Ee}}const ke=F&&N;let ze=ke?c:v?"butt":h;if(ke&&"round"===ze&&(de<_?ze="miter":de<=2&&(ze="fakeround")),"miter"===ze&&de>m&&(ze="bevel"),"bevel"===ze&&(de>2&&(ze="flipbevel"),de<m&&(ze="miter")),F&&this.updateDistance(F,P),"miter"===ze)se._mult(de),this.addCurrentVertex(P,se,0,0,I);else if("flipbevel"===ze){if(de>100)se=Z.mult(-1);else{const Ce=de*G.add(Z).mag()/G.sub(Z).mag();se._perp()._mult(Ce*(Me?-1:1))}this.addCurrentVertex(P,se,0,0,I),this.addCurrentVertex(P,se.mult(-1),0,0,I)}else if("bevel"===ze||"fakeround"===ze){const Ce=-Math.sqrt(de*de-1),Ee=Me?Ce:0,Be=Me?0:Ce;if(F&&this.addCurrentVertex(P,G,Ee,Be,I),"fakeround"===ze){const We=Math.round(180*fe/Math.PI/20);for(let $e=1;$e<We;$e++){let qe=$e/We;if(.5!==qe){const jt=qe-.5;qe+=qe*jt*(qe-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*jt*jt+(.848013+le*(.215638*le-1.06021)))}const Et=Z.sub(G)._mult(qe)._add(G)._unit()._mult(Me?-1:1);this.addHalfVertex(P,Et.x,Et.y,!1,Me,0,I)}}N&&this.addCurrentVertex(P,Z,-Ee,-Be,I)}else if("butt"===ze)this.addCurrentVertex(P,se,0,0,I);else if("square"===ze){const Ce=F?1:-1;F||this.addCurrentVertex(P,se,Ce,Ce,I),this.addCurrentVertex(P,se,0,0,I),F&&this.addCurrentVertex(P,se,Ce,Ce,I)}else"round"===ze&&(F&&(this.addCurrentVertex(P,G,0,0,I),this.addCurrentVertex(P,G,1,1,I,!0)),N&&(this.addCurrentVertex(P,Z,-1,-1,I,!0),this.addCurrentVertex(P,Z,0,0,I)));if(we&&K<C-1){const Ce=P.dist(N);if(Ce>2*S){const Ee=P.add(N.sub(P)._mult(S/Ce)._round());this.updateDistance(P,Ee),this.addCurrentVertex(Ee,Z,0,0,I),P=Ee}}}}addCurrentVertex(r,a,c,h,m,_=!1){const v=a.y*h-a.x,C=-a.y-a.x*h;this.addHalfVertex(r,a.x+a.y*c,a.y-a.x*c,_,!1,c,m),this.addHalfVertex(r,v,C,_,!0,-h,m)}addHalfVertex({x:r,y:a},c,h,m,_,v,C){this.layoutVertexArray.emplaceBack((r<<1)+(m?1:0),(a<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),C.primitiveLength++),_?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}tt($h,"LineBucket",{omit:["layers","patternFeatures"]});const uv=new B({"line-cap":new M(xe.layout_line["line-cap"]),"line-join":new M(xe.layout_line["line-join"]),"line-miter-limit":new E(xe.layout_line["line-miter-limit"]),"line-round-limit":new E(xe.layout_line["line-round-limit"]),"line-sort-key":new M(xe.layout_line["line-sort-key"])});var kg={paint:new B({"line-opacity":new M(xe.paint_line["line-opacity"]),"line-color":new M(xe.paint_line["line-color"]),"line-translate":new E(xe.paint_line["line-translate"]),"line-translate-anchor":new E(xe.paint_line["line-translate-anchor"]),"line-width":new M(xe.paint_line["line-width"]),"line-gap-width":new M(xe.paint_line["line-gap-width"]),"line-offset":new M(xe.paint_line["line-offset"]),"line-blur":new M(xe.paint_line["line-blur"]),"line-dasharray":new A(xe.paint_line["line-dasharray"]),"line-pattern":new A(xe.paint_line["line-pattern"]),"line-gradient":new O(xe.paint_line["line-gradient"])}),layout:uv};const Rg=new class extends M{possiblyEvaluate(s,r){return r=new kn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,a,c){return r=or({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,a,c)}}(kg.paint.properties["line-width"].specification);function Og(s,r){return r>0?r+2*s:s}Rg.useIntegerZoom=!0;const hv=ne([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),dv=ne([{name:"a_projected_pos",components:3,type:"Float32"}],4);ne([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fv=ne([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),pv=ne([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Dc=ne([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Us=ne([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ne([{name:"triangle",components:3,type:"Uint16"}]),ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ne([{type:"Float32",name:"offsetX"}]),ne([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Pa=128;function pf(s,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new kn(s+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:h}=a;let m=0;for(;m<c.length&&c[m]<=s;)m++;m=Math.max(0,m-1);let _=m;for(;_<c.length&&c[_]<s+1;)_++;_=Math.min(c.length-1,_);const v=c[m],C=c[_];return"composite"===a.kind?{kind:"composite",minZoom:v,maxZoom:C,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:C,minSize:a.evaluate(new kn(v)),maxSize:a.evaluate(new kn(C)),interpolationType:h}}}function zp(s,{uSize:r,uSizeT:a},{lowerSize:c,upperSize:h}){return"source"===s.kind?c/Pa:"composite"===s.kind?yt(c/Pa,h/Pa,a):r}function Wr(s,r){let a=0,c=0;if("constant"===s.kind)c=s.layoutSize;else if("source"!==s.kind){const{interpolationType:h,minZoom:m,maxZoom:_}=s,v=h?tn(cr.interpolationFactor(h,r,m,_),0,1):0;"camera"===s.kind?c=yt(s.minSize,s.maxSize,v):a=v}return{uSizeT:a,uSize:c}}var Bp=Object.freeze({__proto__:null,getSizeData:pf,evaluateSizeForFeature:zp,evaluateSizeForZoom:Wr,SIZE_PACK_FACTOR:Pa});function Np(s,r,a){return s.sections.forEach(c=>{c.text=function(h,m,_){const v=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===v?h=h.toLocaleUpperCase():"lowercase"===v&&(h=h.toLocaleLowerCase()),Yi.applyArabicShaping&&(h=Yi.applyArabicShaping(h)),h}(c.text,r,a)}),s}const Gh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Fg(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function Hh(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var Vp=function(s,r,a,c,h){var m,_,v=8*h-c-1,C=(1<<v)-1,D=C>>1,S=-7,I=a?h-1:0,P=a?-1:1,F=s[r+I];for(I+=P,m=F&(1<<-S)-1,F>>=-S,S+=v;S>0;m=256*m+s[r+I],I+=P,S-=8);for(_=m&(1<<-S)-1,m>>=-S,S+=c;S>0;_=256*_+s[r+I],I+=P,S-=8);if(0===m)m=1-D;else{if(m===C)return _?NaN:1/0*(F?-1:1);_+=Math.pow(2,c),m-=D}return(F?-1:1)*_*Math.pow(2,m-c)},Up=function(s,r,a,c,h,m){var _,v,C,D=8*m-h-1,S=(1<<D)-1,I=S>>1,P=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,F=c?0:m-1,N=c?1:-1,G=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(v=isNaN(r)?1:0,_=S):(_=Math.floor(Math.log(r)/Math.LN2),r*(C=Math.pow(2,-_))<1&&(_--,C*=2),(r+=_+I>=1?P/C:P*Math.pow(2,1-I))*C>=2&&(_++,C/=2),_+I>=S?(v=0,_=S):_+I>=1?(v=(r*C-1)*Math.pow(2,h),_+=I):(v=r*Math.pow(2,I-1)*Math.pow(2,h),_=0));h>=8;s[a+F]=255&v,F+=N,v/=256,h-=8);for(_=_<<h|v,D+=h;D>0;s[a+F]=255&_,F+=N,_/=256,D-=8);s[a+F-N]|=128*G},Tc=vn;function vn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}vn.Varint=0,vn.Fixed64=1,vn.Bytes=2,vn.Fixed32=5;var mf=4294967296,mv=1/mf,Mc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function is(s){return s.type===vn.Bytes?s.readVarint()+s.pos:s.pos+1}function Lg(s,r,a){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(c);for(var h=a.pos-1;h>=s;h--)a.buf[h+c]=a.buf[h]}function jp(s,r){for(var a=0;a<s.length;a++)r.writeVarint(s[a])}function gv(s,r){for(var a=0;a<s.length;a++)r.writeSVarint(s[a])}function _v(s,r){for(var a=0;a<s.length;a++)r.writeFloat(s[a])}function yv(s,r){for(var a=0;a<s.length;a++)r.writeDouble(s[a])}function vv(s,r){for(var a=0;a<s.length;a++)r.writeBoolean(s[a])}function xv(s,r){for(var a=0;a<s.length;a++)r.writeFixed32(s[a])}function bv(s,r){for(var a=0;a<s.length;a++)r.writeSFixed32(s[a])}function zg(s,r){for(var a=0;a<s.length;a++)r.writeFixed64(s[a])}function $p(s,r){for(var a=0;a<s.length;a++)r.writeSFixed64(s[a])}function qh(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function Cl(s,r,a){s[a]=r,s[a+1]=r>>>8,s[a+2]=r>>>16,s[a+3]=r>>>24}function Bg(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}function wv(s,r,a){r.glyphs=[],1===s&&a.readMessage(Ng,r)}function Ng(s,r,a){if(3===s){const{id:c,bitmap:h,width:m,height:_,left:v,top:C,advance:D}=a.readMessage(Vg,{});r.glyphs.push({id:c,bitmap:new yl({width:m+6,height:_+6},h),metrics:{width:m,height:_,left:v,top:C,advance:D}})}else 4===s?r.ascender=a.readSVarint():5===s&&(r.descender=a.readSVarint())}function Vg(s,r,a){1===s?r.id=a.readVarint():2===s?r.bitmap=a.readBytes():3===s?r.width=a.readVarint():4===s?r.height=a.readVarint():5===s?r.left=a.readSVarint():6===s?r.top=a.readSVarint():7===s&&(r.advance=a.readVarint())}function ka(s){let r=0,a=0;for(const _ of s)r+=_.w*_.h,a=Math.max(a,_.w);s.sort((_,v)=>v.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let h=0,m=0;for(const _ of s)for(let v=c.length-1;v>=0;v--){const C=c[v];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===C.w&&_.h===C.h){const D=c.pop();v<c.length&&(c[v]=D)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(c.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:h,h:m,fill:r/(h*m)||0}}vn.prototype={destroy:function(){this.buf=null},readFields:function(s,r,a){for(a=a||this.length;this.pos<a;){var c=this.readVarint(),h=c>>3,m=this.pos;this.type=7&c,s(h,r,this),this.pos===m&&this.skip(c)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=qh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Bg(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=qh(this.buf,this.pos)+qh(this.buf,this.pos+4)*mf;return this.pos+=8,s},readSFixed64:function(){var s=qh(this.buf,this.pos)+Bg(this.buf,this.pos+4)*mf;return this.pos+=8,s},readFloat:function(){var s=Vp(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Vp(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,a,c=this.buf;return r=127&(a=c[this.pos++]),a<128?r:(r|=(127&(a=c[this.pos++]))<<7,a<128?r:(r|=(127&(a=c[this.pos++]))<<14,a<128?r:(r|=(127&(a=c[this.pos++]))<<21,a<128?r:function(h,m,_){var v,C,D=_.buf;if(v=(112&(C=D[_.pos++]))>>4,C<128||(v|=(127&(C=D[_.pos++]))<<3,C<128)||(v|=(127&(C=D[_.pos++]))<<10,C<128)||(v|=(127&(C=D[_.pos++]))<<17,C<128)||(v|=(127&(C=D[_.pos++]))<<24,C<128)||(v|=(1&(C=D[_.pos++]))<<31,C<128))return function Sc(s,r,a){return a?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}(h,v,m);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=c[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&Mc?Mc.decode(this.buf.subarray(r,s)):function(a,c,h){for(var m="",_=c;_<h;){var v,C,D,S=a[_],I=null,P=S>239?4:S>223?3:S>191?2:1;if(_+P>h)break;1===P?S<128&&(I=S):2===P?128==(192&(v=a[_+1]))&&(I=(31&S)<<6|63&v)<=127&&(I=null):3===P?(C=a[_+2],128==(192&(v=a[_+1]))&&128==(192&C)&&((I=(15&S)<<12|(63&v)<<6|63&C)<=2047||I>=55296&&I<=57343)&&(I=null)):4===P&&(C=a[_+2],D=a[_+3],128==(192&(v=a[_+1]))&&128==(192&C)&&128==(192&D)&&((I=(15&S)<<18|(63&v)<<12|(63&C)<<6|63&D)<=65535||I>=1114112)&&(I=null)),null===I?(I=65533,P=1):I>65535&&(I-=65536,m+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),m+=String.fromCharCode(I),_+=P}return m}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==vn.Bytes)return s.push(this.readVarint(r));var a=is(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==vn.Bytes)return s.push(this.readSVarint());var r=is(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==vn.Bytes)return s.push(this.readBoolean());var r=is(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==vn.Bytes)return s.push(this.readFloat());var r=is(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==vn.Bytes)return s.push(this.readDouble());var r=is(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==vn.Bytes)return s.push(this.readFixed32());var r=is(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==vn.Bytes)return s.push(this.readSFixed32());var r=is(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==vn.Bytes)return s.push(this.readFixed64());var r=is(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==vn.Bytes)return s.push(this.readSFixed64());var r=is(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===vn.Varint)for(;this.buf[this.pos++]>127;);else if(r===vn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===vn.Fixed32)this.pos+=4;else{if(r!==vn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Cl(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Cl(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Cl(this.buf,-1&s,this.pos),Cl(this.buf,Math.floor(s*mv),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Cl(this.buf,-1&s,this.pos),Cl(this.buf,Math.floor(s*mv),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,a){var c,h,m,v;if(r>=0?(c=r%4294967296|0,h=r/4294967296|0):(h=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,h=h+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),m=c,(v=a).buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7),function(m,_){var v=(7&m)<<4;_.buf[_.pos++]|=v|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(h,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(c,h,m){for(var _,v,C=0;C<h.length;C++){if((_=h.charCodeAt(C))>55295&&_<57344){if(!v){_>56319||C+1===h.length?(c[m++]=239,c[m++]=191,c[m++]=189):v=_;continue}if(_<56320){c[m++]=239,c[m++]=191,c[m++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(c[m++]=239,c[m++]=191,c[m++]=189,v=null);_<128?c[m++]=_:(_<2048?c[m++]=_>>6|192:(_<65536?c[m++]=_>>12|224:(c[m++]=_>>18|240,c[m++]=_>>12&63|128),c[m++]=_>>6&63|128),c[m++]=63&_|128)}return m}(this.buf,s,this.pos);var a=this.pos-r;a>=128&&Lg(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),Up(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Up(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,r){this.pos++;var a=this.pos;s(r,this);var c=this.pos-a;c>=128&&Lg(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c},writeMessage:function(s,r,a){this.writeTag(s,vn.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,jp,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,gv,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,vv,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,_v,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,yv,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,xv,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,bv,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,zg,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,$p,r)},writeBytesField:function(s,r){this.writeTag(s,vn.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,vn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,vn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,vn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,vn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,vn.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,vn.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,vn.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,vn.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,vn.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,Boolean(r))}};class gf{constructor(r,{pixelRatio:a,version:c,stretchX:h,stretchY:m,content:_}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=h,this.stretchY=m,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Gp{constructor(r,a){const c={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(r,c,m),this.addImages(a,h,m);const{w:_,h:v}=ka(m),C=new go({width:_||1,height:v||1});for(const D in r){const S=r[D],I=c[D].paddedRect;go.copy(S.data,C,{x:0,y:0},{x:I.x+1,y:I.y+1},S.data)}for(const D in a){const S=a[D],I=h[D].paddedRect,P=I.x+1,F=I.y+1,N=S.data.width,G=S.data.height;go.copy(S.data,C,{x:0,y:0},{x:P,y:F},S.data),go.copy(S.data,C,{x:0,y:G-1},{x:P,y:F-1},{width:N,height:1}),go.copy(S.data,C,{x:0,y:0},{x:P,y:F+G},{width:N,height:1}),go.copy(S.data,C,{x:N-1,y:0},{x:P-1,y:F},{width:1,height:G}),go.copy(S.data,C,{x:0,y:0},{x:P+N,y:F},{width:1,height:G})}this.image=C,this.iconPositions=c,this.patternPositions=h}addImages(r,a,c){for(const h in r){const m=r[h],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};c.push(_),a[h]=new gf(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>r.hasImage(c)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),a),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),a)}patchUpdatedImage(r,a,c){if(!r||!a||r.version===a.version)return;r.version=a.version;const[h,m]=r.tl;c.update(a.data,void 0,{x:h,y:m})}}tt(gf,"ImagePosition"),tt(Gp,"ImageAtlas");const _o={horizontal:1,vertical:2,horizontalOnly:3};class El{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const c=new El;return c.scale=r||1,c.fontStack=a,c}static forImage(r){const a=new El;return a.imageName=r,a}}class Pu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const c=new Pu;for(let h=0;h<r.sections.length;h++){const m=r.sections[h];m.image?c.addImageSection(m):c.addTextSection(m,a)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,c){let h="";for(let m=0;m<a.length;m++){const _=a.charCodeAt(m+1)||null,v=a.charCodeAt(m-1)||null;h+=!c&&(_&&Rs(_)&&!Gh[a[m+1]]||v&&Rs(v)&&!Gh[a[m-1]])||!Gh[a[m]]?a[m]:Gh[a[m]]}return h}(this.text,r)}trim(){let r=0;for(let c=0;c<this.text.length&&Zh[this.text.charCodeAt(c)];c++)r++;let a=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&Zh[this.text.charCodeAt(c)];c--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const c=new Pu;return c.text=this.text.substring(r,a),c.sectionIndex=this.sectionIndex.slice(r,a),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(El.forText(r.scale,r.fontStack||a));const c=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(c)}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void Tn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(El.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Tn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _f(s,r,a,c,h,m,_,v,C,D,S,I,P,F,N,G){const Z=Pu.fromFeature(s,h);let K;I===_o.vertical&&Z.verticalizePunctuation(P);const{processBidirectionalText:se,processStyledBidirectionalText:le}=Yi;if(se&&1===Z.sections.length){K=[];const fe=se(Z.toString(),Xh(Z,D,m,r,c,F,N));for(const we of fe){const Me=new Pu;Me.text=we,Me.sections=Z.sections;for(let ke=0;ke<we.length;ke++)Me.sectionIndex.push(0);K.push(Me)}}else if(le){K=[];const fe=le(Z.text,Z.sectionIndex,Xh(Z,D,m,r,c,F,N));for(const we of fe){const Me=new Pu;Me.text=we[0],Me.sectionIndex=we[1],Me.sections=Z.sections,K.push(Me)}}else K=function(fe,we){const Me=[],ke=fe.text;let ze=0;for(const Ce of we)Me.push(fe.substring(ze,Ce)),ze=Ce;return ze<ke.length&&Me.push(fe.substring(ze,ke.length)),Me}(Z,Xh(Z,D,m,r,c,F,N));const he=[],de={positionedLines:he,text:Z.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,we,Me,ke,ze,Ce,Ee,Be,We,$e,qe,Et){let jt=0,Mt=0,Rt=0;const ct="right"===Be?1:"left"===Be?0:.5;let et=!1;for(const pn of ze){const Ht=pn.getSections();for(const bn of Ht){if(bn.imageName)continue;const Xn=we[bn.fontStack];if(Xn&&(et=void 0!==Xn.ascender&&void 0!==Xn.descender,!et))break}if(!et)break}let Qt=0;for(const pn of ze){pn.trim();const Ht=pn.getMaxScale(),bn=24*(Ht-1),Xn={positionedGlyphs:[],lineOffset:0};fe.positionedLines[Qt]=Xn;const Qn=Xn.positionedGlyphs;let Tr=0;if(!pn.length()){Mt+=Ce,++Qt;continue}let On=0,wo=0;for(let wn=0;wn<pn.length();wn++){const li=pn.getSection(wn),Li=pn.getSectionIndex(wn),Nr=pn.getCharCode(wn);let Vr=li.scale,Un=null,Ct=null,zi=null,Xr=24,dr=0;const Ci=!(We===_o.horizontal||!qe&&!dc(Nr)||qe&&(Zh[Nr]||(cn=Nr,dh(cn)||hu(cn)||Jn(cn)||_h(cn)||du(cn))));if(li.imageName){const ci=ke[li.imageName];if(!ci)continue;zi=li.imageName,fe.iconsInText=fe.iconsInText||!0,Ct=ci.paddedRect;const Pr=ci.displaySize;Vr=24*Vr/Et,Un={width:Pr[0],height:Pr[1],left:1,top:-3,advance:Ci?Pr[1]:Pr[0],localGlyph:!1},dr=et?-Un.height*Vr:24*Ht-17-Pr[1]*Vr,Xr=Un.advance;const Bo=(Ci?Pr[0]:Pr[1])*Vr-24*Ht;Bo>0&&Bo>Tr&&(Tr=Bo)}else{const ci=Me[li.fontStack];if(!ci)continue;ci[Nr]&&(Ct=ci[Nr]);const Pr=we[li.fontStack];if(!Pr)continue;const Bo=Pr.glyphs[Nr];if(!Bo)continue;if(Un=Bo.metrics,Xr=8203!==Nr?24:0,et){const Pl=void 0!==Pr.ascender?Math.abs(Pr.ascender):0,kl=void 0!==Pr.descender?Math.abs(Pr.descender):0,Zs=(Pl+kl)*Vr;On<Zs&&(On=Zs,wo=(Pl-kl)/2*Vr),dr=-Pl*Vr}else dr=24*(Ht-Vr)-17}Ci?(fe.verticalizable=!0,Qn.push({glyph:Nr,imageName:zi,x:jt,y:Mt+dr,vertical:Ci,scale:Vr,localGlyph:Un.localGlyph,fontStack:li.fontStack,sectionIndex:Li,metrics:Un,rect:Ct}),jt+=Xr*Vr+$e):(Qn.push({glyph:Nr,imageName:zi,x:jt,y:Mt+dr,vertical:Ci,scale:Vr,localGlyph:Un.localGlyph,fontStack:li.fontStack,sectionIndex:Li,metrics:Un,rect:Ct}),jt+=Un.advance*Vr+$e)}0!==Qn.length&&(Rt=Math.max(jt-$e,Rt),et?bf(Qn,ct,Tr,wo,Ce*Ht/2):bf(Qn,ct,Tr,0,Ce/2)),jt=0;const oo=Ce*Ht+Tr;Xn.lineOffset=Math.max(Tr,bn),Mt+=oo,++Qt}var cn;const vr=Mt,{horizontalAlign:Rn,verticalAlign:Dr}=xf(Ee);(function(pn,Ht,bn,Xn,Qn,Tr){const On=(Ht-bn)*Qn,wo=-Tr*Xn;for(const oo of pn)for(const wn of oo.positionedGlyphs)wn.x+=On,wn.y+=wo})(fe.positionedLines,ct,Rn,Dr,Rt,vr),fe.top+=-Dr*vr,fe.bottom=fe.top+vr,fe.left+=-Rn*Rt,fe.right=fe.left+Rt,fe.hasBaseline=et}(de,r,a,c,K,_,v,C,I,D,P,G),!function(fe){for(const we of fe)if(0!==we.positionedGlyphs.length)return!1;return!0}(he)&&de}const Zh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ug={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yf(s,r,a,c,h,m){if(r.imageName){const _=c[r.imageName];return _?_.displaySize[0]*r.scale*24/m+h:0}{const _=a[r.fontStack],v=_&&_.glyphs[s];return v?v.metrics.advance*r.scale+h:0}}function Hp(s,r,a,c){const h=Math.pow(s-r,2);return c?s<r?h/2:2*h:h+Math.abs(a)*a}function vf(s,r,a){let c=0;return 10===s&&(c-=1e4),a&&(c+=150),40!==s&&65288!==s||(c+=50),41!==r&&65289!==r||(c+=50),c}function Wh(s,r,a,c,h,m){let _=null,v=Hp(r,a,h,m);for(const C of c){const D=Hp(r-C.x,a,h,m)+C.badness;D<=v&&(_=C,v=D)}return{index:s,x:r,priorBreak:_,badness:v}}function qp(s){return s?qp(s.priorBreak).concat(s.index):[]}function Xh(s,r,a,c,h,m,_){if("point"!==m)return[];if(!s)return[];const v=[],C=function(P,F,N,G,Z,K){let se=0;for(let le=0;le<P.length();le++){const he=P.getSection(le);se+=yf(P.getCharCode(le),he,G,Z,F,K)}return se/Math.max(1,Math.ceil(se/N))}(s,r,a,c,h,_),D=s.text.indexOf("\u200b")>=0;let S=0;for(let P=0;P<s.length();P++){const F=s.getSection(P),N=s.getCharCode(P);if(Zh[N]||(S+=yf(N,F,c,h,r,_)),P<s.length()-1){const G=!((I=N)<11904||!(vi(I)||ba(I)||wa(I)||hc(I)||Qo(I)||fh(I)||ph(I)||ni(I)||mh(I)||uc(I)||$d(I)||je(I)||lc(I)||ll(I)||dp(I)||cc(I)||cl(I)||Gd(I)||gh(I)||Nt(I)));(Ug[N]||G||F.imageName)&&v.push(Wh(P+1,S,C,v,vf(N,s.getCharCode(P+1),G&&D),!1))}}var I;return qp(Wh(s.length(),S,C,v,0,!0))}function xf(s){let r=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function bf(s,r,a,c,h){if(!(r||a||c||h))return;const m=s.length-1,_=s[m],v=(_.x+_.metrics.advance*_.scale)*r;for(let C=0;C<=m;C++)s[C].x-=v,s[C].y+=a+c+h}function Kh(s,r,a){const{horizontalAlign:c,verticalAlign:h}=xf(a),m=r[0]-s.displaySize[0]*c,_=r[1]-s.displaySize[1]*h;return{image:s,top:_,bottom:_+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function jg(s,r,a,c,h,m){const _=s.image;let v;if(_.content){const Z=_.content,K=_.pixelRatio||1;v=[Z[0]/K,Z[1]/K,_.displaySize[0]-Z[2]/K,_.displaySize[1]-Z[3]/K]}const C=r.left*m,D=r.right*m;let S,I,P,F;"width"===a||"both"===a?(F=h[0]+C-c[3],I=h[0]+D+c[1]):(F=h[0]+(C+D-_.displaySize[0])/2,I=F+_.displaySize[0]);const N=r.top*m,G=r.bottom*m;return"height"===a||"both"===a?(S=h[1]+N-c[0],P=h[1]+G+c[2]):(S=h[1]+(N+G-_.displaySize[1])/2,P=S+_.displaySize[1]),{image:_,top:S,right:I,bottom:P,left:F,collisionPadding:v}}class js extends Oe{constructor(r,a,c,h,m){super(r,a),this.angle=h,this.z=c,void 0!==m&&(this.segment=m)}clone(){return new js(this.x,this.y,this.z,this.angle,this.segment)}}function $g(s,r,a,c,h){if(void 0===r.segment)return!0;let m=r,_=r.segment+1,v=0;for(;v>-a/2;){if(_--,_<0)return!1;v-=s[_].dist(m),m=s[_]}v+=s[_].dist(s[_+1]),_++;const C=[];let D=0;for(;v<a/2;){const S=s[_],I=s[_+1];if(!I)return!1;let P=s[_-1].angleTo(S)-S.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:v,angleDelta:P}),D+=P;v-C[0].distance>c;)D-=C.shift().angleDelta;if(D>h)return!1;_++,v+=S.dist(I)}return!0}function Gg(s){let r=0;for(let a=0;a<s.length-1;a++)r+=s[a].dist(s[a+1]);return r}function Zp(s,r,a){return s?.6*r*a:0}function wf(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function Hg(s,r,a,c,h,m){const _=Zp(a,h,m),v=wf(a,c)*m;let C=0;const D=Gg(s)/2;for(let S=0;S<s.length-1;S++){const I=s[S],P=s[S+1],F=I.dist(P);if(C+F>D){const N=(D-C)/F,G=yt(I.x,P.x,N),Z=yt(I.y,P.y,N),K=new js(G,Z,0,P.angleTo(I),S);return!_||$g(s,K,v,_,r)?K:void 0}C+=F}}function M1(s,r,a,c,h,m,_,v,C){const D=Zp(c,m,_),S=wf(c,h),I=S*_,P=0===s[0].x||s[0].x===C||0===s[0].y||s[0].y===C;return r-I<r/4&&(r=I+r/4),Wp(s,P?r/2*v%r:(S/2+2*m)*_*v%r,r,D,a,I,P,!1,C)}function Wp(s,r,a,c,h,m,_,v,C){const D=m/2,S=Gg(s);let I=0,P=r-a,F=[];for(let N=0;N<s.length-1;N++){const G=s[N],Z=s[N+1],K=G.dist(Z),se=Z.angleTo(G);for(;P+a<I+K;){P+=a;const le=(P-I)/K,he=yt(G.x,Z.x,le),de=yt(G.y,Z.y,le);if(he>=0&&he<C&&de>=0&&de<C&&P-D>=0&&P+D<=S){const fe=new js(he,de,0,se,N);fe._round(),c&&!$g(s,fe,m,c,h)||F.push(fe)}}I+=K}return v||F.length||_||(F=Wp(s,I/2,a,c,h,m,_,!0,C)),F}function qg(s,r,a,c,h){const m=[];for(let _=0;_<s.length;_++){const v=s[_];let C;for(let D=0;D<v.length-1;D++){let S=v[D],I=v[D+1];S.x<r&&I.x<r||(S.x<r?S=new Oe(r,S.y+(r-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x<r&&(I=new Oe(r,S.y+(r-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y<a&&I.y<a||(S.y<a?S=new Oe(S.x+(a-S.y)/(I.y-S.y)*(I.x-S.x),a)._round():I.y<a&&(I=new Oe(S.x+(a-S.y)/(I.y-S.y)*(I.x-S.x),a)._round()),S.x>=c&&I.x>=c||(S.x>=c?S=new Oe(c,S.y+(c-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x>=c&&(I=new Oe(c,S.y+(c-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y>=h&&I.y>=h||(S.y>=h?S=new Oe(S.x+(h-S.y)/(I.y-S.y)*(I.x-S.x),h)._round():I.y>=h&&(I=new Oe(S.x+(h-S.y)/(I.y-S.y)*(I.x-S.x),h)._round()),C&&S.equals(C[C.length-1])||(C=[S],m.push(C)),C.push(I)))))}}return m}tt(js,"Anchor");const ku=1e20;function Zg(s,r,a,c,h,m,_,v,C){for(let D=r;D<r+c;D++)Wg(s,a*m+D,m,h,_,v,C);for(let D=a;D<a+h;D++)Wg(s,D*m+r,1,c,_,v,C)}function Wg(s,r,a,c,h,m,_){m[0]=0,_[0]=-ku,_[1]=ku,h[0]=s[r];for(let v=1,C=0,D=0;v<c;v++){h[v]=s[r+v*a];const S=v*v;do{const I=m[C];D=(h[v]-h[I]+S-I*I)/(v-I)/2}while(D<=_[C]&&--C>-1);C++,m[C]=v,_[C]=D,_[C+1]=ku}for(let v=0,C=0;v<c;v++){for(;_[C+1]<v;)C++;const D=m[C],S=v-D;s[r+v*a]=h[D]+S*S}}const yo={none:0,ideographs:1,all:2};class Ru{constructor(r,a,c){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const c=[];for(const h in r)for(const m of r[h])c.push({stack:h,id:m});fs(c,({stack:h,id:m},_)=>{let v=this.entries[h];v||(v=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=v.glyphs[m];if(void 0!==C)return void _(null,{stack:h,id:m,glyph:C});if(C=this._tinySDF(v,h,m),C)return v.glyphs[m]=C,void _(null,{stack:h,id:m,glyph:C});const D=Math.floor(m/256);if(256*D>65535)return void _(new Error("glyphs > 65535 not supported"));if(v.ranges[D])return void _(null,{stack:h,id:m,glyph:C});let S=v.requests[D];S||(S=v.requests[D]=[],Ru.loadGlyphRange(h,D,this.url,this.requestManager,(I,P)=>{if(P){v.ascender=P.ascender,v.descender=P.descender;for(const F in P.glyphs)this._doesCharSupportLocalGlyph(+F)||(v.glyphs[+F]=P.glyphs[+F]);v.ranges[D]=!0}for(const F of S)F(I,P);delete v.requests[D]})),S.push((I,P)=>{I?_(I):P&&_(null,{stack:h,id:m,glyph:P.glyphs[m]||null})})},(h,m)=>{if(h)a(h);else if(m){const _={};for(const{stack:v,id:C,glyph:D}of m)void 0===_[v]&&(_[v]={}),void 0===_[v].glyphs&&(_[v].glyphs={}),_[v].glyphs[C]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},_[v].ascender=this.entries[v].ascender,_[v].descender=this.entries[v].descender;a(null,_)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==yo.none&&(this.localGlyphMode===yo.all?!!this.localFontFamily:!!this.localFontFamily&&(uc(r)||fp(r)||lc(r)||cl(r)||ni(r)))}_tinySDF(r,a,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let m=r.tinySDF;if(!m){let G="400";/bold/i.test(a)?G="900":/medium/i.test(a)?G="500":/light/i.test(a)&&(G="200"),m=r.tinySDF=new Ru.TinySDF({fontFamily:h,fontWeight:G,fontSize:48,buffer:6,radius:16}),m.fontWeight=G}if(this.localGlyphs[m.fontWeight][c])return this.localGlyphs[m.fontWeight][c];const _=String.fromCharCode(c),{data:v,width:C,height:D,glyphWidth:S,glyphHeight:I,glyphLeft:P,glyphTop:F,glyphAdvance:N}=m.draw(_);return this.localGlyphs[m.fontWeight][c]={id:c,bitmap:new yl({width:C,height:D},v),metrics:{width:S/2,height:I/2,left:P/2,top:F/2-27,advance:N/2,localGlyph:!0}}}}function Xp(s,r,a,c){const h=[],m=s.image,_=m.pixelRatio,v=m.paddedRect.w-2,C=m.paddedRect.h-2,D=s.right-s.left,S=s.bottom-s.top,I=m.stretchX||[[0,v]],P=m.stretchY||[[0,C]],F=(Ce,Ee)=>Ce+Ee[1]-Ee[0],N=I.reduce(F,0),G=P.reduce(F,0),Z=v-N,K=C-G;let se=0,le=N,he=0,de=G,fe=0,we=Z,Me=0,ke=K;if(m.content&&c){const Ce=m.content;se=Cf(I,0,Ce[0]),he=Cf(P,0,Ce[1]),le=Cf(I,Ce[0],Ce[2]),de=Cf(P,Ce[1],Ce[3]),fe=Ce[0]-se,Me=Ce[1]-he,we=Ce[2]-Ce[0]-le,ke=Ce[3]-Ce[1]-de}const ze=(Ce,Ee,Be,We)=>{const $e=Ef(Ce.stretch-se,le,D,s.left),qe=Df(Ce.fixed-fe,we,Ce.stretch,N),Et=Ef(Ee.stretch-he,de,S,s.top),jt=Df(Ee.fixed-Me,ke,Ee.stretch,G),Mt=Ef(Be.stretch-se,le,D,s.left),Rt=Df(Be.fixed-fe,we,Be.stretch,N),ct=Ef(We.stretch-he,de,S,s.top),et=Df(We.fixed-Me,ke,We.stretch,G),Qt=new Oe($e,Et),cn=new Oe(Mt,Et),vr=new Oe(Mt,ct),Rn=new Oe($e,ct),Dr=new Oe(qe/_,jt/_),pn=new Oe(Rt/_,et/_),Ht=r*Math.PI/180;if(Ht){const Qn=Math.sin(Ht),Tr=Math.cos(Ht),On=[Tr,-Qn,Qn,Tr];Qt._matMult(On),cn._matMult(On),Rn._matMult(On),vr._matMult(On)}const bn=Ce.stretch+Ce.fixed,Xn=Ee.stretch+Ee.fixed;return{tl:Qt,tr:cn,bl:Rn,br:vr,tex:{x:m.paddedRect.x+1+bn,y:m.paddedRect.y+1+Xn,w:Be.stretch+Be.fixed-bn,h:We.stretch+We.fixed-Xn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dr,pixelOffsetBR:pn,minFontScaleX:we/_/D,minFontScaleY:ke/_/S,isSDF:a}};if(c&&(m.stretchX||m.stretchY)){const Ce=Xg(I,Z,N),Ee=Xg(P,K,G);for(let Be=0;Be<Ce.length-1;Be++){const We=Ce[Be],$e=Ce[Be+1];for(let qe=0;qe<Ee.length-1;qe++)h.push(ze(We,Ee[qe],$e,Ee[qe+1]))}}else h.push(ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:C+1}));return h}function Cf(s,r,a){let c=0;for(const h of s)c+=Math.max(r,Math.min(a,h[1]))-Math.max(r,Math.min(a,h[0]));return c}function Xg(s,r,a){const c=[{fixed:-1,stretch:0}];for(const[h,m]of s){const _=c[c.length-1];c.push({fixed:h-_.stretch,stretch:_.stretch}),c.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return c.push({fixed:r+1,stretch:a}),c}function Ef(s,r,a,c){return s/r*a+c}function Df(s,r,a,c){return s-r*a/c}function Kg(s,r,a,c){const h=r+s.positionedLines[c].lineOffset;return 0===c?a+h/2:a+(h+(r+s.positionedLines[c-1].lineOffset))/2}Ru.loadGlyphRange=function(s,r,a,c,h){const m=256*r,_=m+255,v=c.transformRequest(c.normalizeGlyphsURL(a).replace("{fontstack}",s).replace("{range}",`${m}-${_}`),J.Glyphs);re(v,(C,D)=>{if(C)h(C);else if(D){const S={},I=new Tc(D).readFields(wv,{});for(const P of I.glyphs)S[P.id]=P;h(null,{glyphs:S,ascender:I.ascender,descender:I.descender})}})},Ru.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:a=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}){this.buffer=r,this.cutoff=c,this.radius=a;const v=this.size=s+4*r,C=this._createCanvas(v),D=this.ctx=C.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${m} ${s}px ${h}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(s),_=Math.floor(a),v=Math.min(this.size-this.buffer,Math.ceil(m-h)),C=Math.min(this.size-this.buffer,Math.ceil(a)+Math.ceil(c)),D=v+2*this.buffer,S=C+2*this.buffer,I=D*S,P=new Uint8ClampedArray(I),F={data:P,width:D,height:S,glyphWidth:v,glyphHeight:C,glyphTop:_,glyphLeft:0,glyphAdvance:r};if(0===v||0===C)return F;const{ctx:N,buffer:G,gridInner:Z,gridOuter:K}=this;N.clearRect(G,G,v,C),N.fillText(s,G,G+_+1);const se=N.getImageData(G,G,v,C);K.fill(ku,0,I),Z.fill(0,0,I);for(let le=0;le<C;le++)for(let he=0;he<v;he++){const de=se.data[4*(le*v+he)+3]/255;if(0===de)continue;const fe=(le+G)*D+he+G;if(1===de)K[fe]=0,Z[fe]=ku;else{const we=.5-de;K[fe]=we>0?we*we:0,Z[fe]=we<0?we*we:0}}Zg(K,0,0,D,S,D,this.f,this.v,this.z),Zg(Z,G,G,v,C,D,this.f,this.v,this.z);for(let le=0;le<I;le++){const he=Math.sqrt(K[le])-Math.sqrt(Z[le]);P[le]=Math.round(255-255*(he/this.radius+this.cutoff))}return F}};class Cv{constructor(r=[],a=Ev){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:c}=this,h=a[r];for(;r>0;){const m=r-1>>1,_=a[m];if(c(h,_)>=0)break;a[r]=_,r=m}a[r]=h}_down(r){const{data:a,compare:c}=this,h=this.length>>1,m=a[r];for(;r<h;){let _=1+(r<<1),v=a[_];const C=_+1;if(C<this.length&&c(a[C],v)<0&&(_=C,v=a[C]),c(v,m)>=0)break;a[r]=v,r=_}a[r]=m}}function Ev(s,r){return s<r?-1:s>r?1:0}function Dv(s,r=1,a=!1){let c=1/0,h=1/0,m=-1/0,_=-1/0;const v=s[0];for(let F=0;F<v.length;F++){const N=v[F];(!F||N.x<c)&&(c=N.x),(!F||N.y<h)&&(h=N.y),(!F||N.x>m)&&(m=N.x),(!F||N.y>_)&&(_=N.y)}const C=Math.min(m-c,_-h);let D=C/2;const S=new Cv([],Gt);if(0===C)return new Oe(c,h);for(let F=c;F<m;F+=C)for(let N=h;N<_;N+=C)S.push(new xn(F+D,N+D,D,s));let I=function(F){let N=0,G=0,Z=0;const K=F[0];for(let se=0,le=K.length,he=le-1;se<le;he=se++){const de=K[se],fe=K[he],we=de.x*fe.y-fe.x*de.y;G+=(de.x+fe.x)*we,Z+=(de.y+fe.y)*we,N+=3*we}return new xn(G/N,Z/N,0,F)}(s),P=S.length;for(;S.length;){const F=S.pop();(F.d>I.d||!I.d)&&(I=F,a&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,P)),F.max-I.d<=r||(D=F.h/2,S.push(new xn(F.p.x-D,F.p.y-D,D,s)),S.push(new xn(F.p.x+D,F.p.y-D,D,s)),S.push(new xn(F.p.x-D,F.p.y+D,D,s)),S.push(new xn(F.p.x+D,F.p.y+D,D,s)),P+=4)}return a&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function Gt(s,r){return r.max-s.max}function xn(s,r,a,c){this.p=new Oe(s,r),this.h=a,this.d=function(h,m){let _=!1,v=1/0;for(let C=0;C<m.length;C++){const D=m[C];for(let S=0,I=D.length,P=I-1;S<I;P=S++){const F=D[S],N=D[P];F.y>h.y!=N.y>h.y&&h.x<(N.x-F.x)*(h.y-F.y)/(N.y-F.y)+F.x&&(_=!_),v=Math.min(v,ag(h,F,N))}}return(_?1:-1)*Math.sqrt(v)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const Tf=Number.POSITIVE_INFINITY,Yg=Math.sqrt(2);function Yh(s,r){return r[1]!==Tf?function(a,c,h){let m=0,_=0;switch(c=Math.abs(c),h=Math.abs(h),a){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(a){case"top-right":case"bottom-right":case"right":m=-c;break;case"top-left":case"bottom-left":case"left":m=c}return[m,_]}(s,r[0],r[1]):function(a,c){let h=0,m=0;c<0&&(c=0);const _=c/Yg;switch(a){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-c;break;case"top":m=c-7}switch(a){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=c;break;case"right":h=-c}return[h,m]}(s,r[0])}function os(s,r,a,c,h,m,_,v,C,D){s.createArrays(),s.tilePixelRatio=kt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const S=s.layers[0].layout,I=s.layers[0]._unevaluatedLayout._values,P={};if("composite"===s.textSizeData.kind){const{minZoom:G,maxZoom:Z}=s.textSizeData;P.compositeTextSizes=[I["text-size"].possiblyEvaluate(new kn(G),v),I["text-size"].possiblyEvaluate(new kn(Z),v)]}if("composite"===s.iconSizeData.kind){const{minZoom:G,maxZoom:Z}=s.iconSizeData;P.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new kn(G),v),I["icon-size"].possiblyEvaluate(new kn(Z),v)]}P.layoutTextSize=I["text-size"].possiblyEvaluate(new kn(C+1),v),P.layoutIconSize=I["icon-size"].possiblyEvaluate(new kn(C+1),v),P.textMaxSize=I["text-size"].possiblyEvaluate(new kn(18),v);const F="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),N=S.get("text-size");for(const G of s.features){const Z=S.get("text-font").evaluate(G,{},v).join(","),K=N.evaluate(G,{},v),se=P.layoutTextSize.evaluate(G,{},v),le=(P.layoutIconSize.evaluate(G,{},v),{horizontal:{},vertical:void 0}),he=G.text;let de,fe=[0,0];if(he){const ke=he.toString(),ze=24*S.get("text-letter-spacing").evaluate(G,{},v),Ce=24*S.get("text-line-height").evaluate(G,{},v),Ee=yh(ke)?ze:0,Be=S.get("text-anchor").evaluate(G,{},v),We=S.get("text-variable-anchor");if(!We){const Rt=S.get("text-radial-offset").evaluate(G,{},v);fe=Rt?Yh(Be,[24*Rt,Tf]):S.get("text-offset").evaluate(G,{},v).map(ct=>24*ct)}let $e=F?"center":S.get("text-justify").evaluate(G,{},v);const qe=S.get("symbol-placement"),Et="point"===qe,jt="point"===qe?24*S.get("text-max-width").evaluate(G,{},v):0,Mt=Rt=>{s.allowVerticalPlacement&&rn(ke)&&(le.vertical=_f(he,r,a,h,Z,jt,Ce,Be,Rt,Ee,fe,_o.vertical,!0,qe,se,K))};if(!F&&We){const Rt="auto"===$e?We.map(et=>Mf(et)):[$e];let ct=!1;for(let et=0;et<Rt.length;et++){const Qt=Rt[et];if(!le.horizontal[Qt])if(ct)le.horizontal[Qt]=le.horizontal[0];else{const cn=_f(he,r,a,h,Z,jt,Ce,"center",Qt,Ee,fe,_o.horizontal,!1,qe,se,K);cn&&(le.horizontal[Qt]=cn,ct=1===cn.positionedLines.length)}}Mt("left")}else{if("auto"===$e&&($e=Mf(Be)),Et||S.get("text-writing-mode").indexOf("horizontal")>=0||!rn(ke)){const Rt=_f(he,r,a,h,Z,jt,Ce,Be,$e,Ee,fe,_o.horizontal,!1,qe,se,K);Rt&&(le.horizontal[$e]=Rt)}Mt("point"===qe?"left":$e)}}let we=!1;if(G.icon&&G.icon.name){const ke=c[G.icon.name];ke&&(de=Kh(h[G.icon.name],S.get("icon-offset").evaluate(G,{},v),S.get("icon-anchor").evaluate(G,{},v)),we=ke.sdf,void 0===s.sdfIcons?s.sdfIcons=ke.sdf:s.sdfIcons!==ke.sdf&&Tn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==s.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Me=Sf(le.horizontal)||le.vertical;s.iconsInText||(s.iconsInText=!!Me&&Me.iconsInText),(Me||de)&&Tv(s,G,le,de,c,P,se,0,fe,we,_,v,D)}m&&s.generateCollisionDebugBuffers(C,s.collisionBoxArray)}function Mf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Tv(s,r,a,c,h,m,_,v,C,D,S,I,P){let F=m.textMaxSize.evaluate(r,{},I);void 0===F&&(F=_);const N=s.layers[0].layout,G=N.get("icon-offset").evaluate(r,{},I),Z=Sf(a.horizontal)||a.vertical,K=_/24,se=s.tilePixelRatio*F/24,le=(Ce=s.overscaling,s.zoom>18&&Ce>2&&(Ce>>=1),Math.max(kt/(512*Ce),1)*N.get("symbol-spacing")),he=N.get("text-padding")*s.tilePixelRatio,de=N.get("icon-padding")*s.tilePixelRatio,fe=nn(N.get("text-max-angle")),we="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),Me="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),ke=N.get("symbol-placement"),ze=le/2;var Ce;const Ee=N.get("icon-text-fit");let Be;c&&"none"!==Ee&&(s.allowVerticalPlacement&&a.vertical&&(Be=jg(c,a.vertical,Ee,N.get("icon-text-fit-padding"),G,K)),Z&&(c=jg(c,Z,Ee,N.get("icon-text-fit-padding"),G,K)));const We=($e,qe,Et)=>{if(qe.x<0||qe.x>=kt||qe.y<0||qe.y>=kt)return;const{x:jt,y:Mt,z:Rt}=P.projectTilePoint(qe.x,qe.y,Et),ct=new js(jt,Mt,Rt,0,void 0);!function(et,Qt,cn,vr,Rn,Dr,pn,Ht,bn,Xn,Qn,Tr,On,wo,oo,wn,li,Li,Nr,Vr,Un,Ct,zi,Xr,dr){const Ci=et.addToLineVertexArray(Qt,vr);let ci,Pr,Bo,Pl,kl,Zs,__,Nu=0,y_=0,v_=0,Nf=0,No=-1,Fc=-1;const ir={};let Rl=zs(""),Vu=0,so=0;if(void 0===bn._unevaluatedLayout.getValue("text-radial-offset")?[Vu,so]=bn.layout.get("text-offset").evaluate(Un,{},dr).map(Ur=>24*Ur):(Vu=24*bn.layout.get("text-radial-offset").evaluate(Un,{},dr),so=Tf),et.allowVerticalPlacement&&Rn.vertical){const Ur=Rn.vertical;if(oo)Zs=Qh(Ur),Ht&&(__=Qh(Ht));else{const jr=bn.layout.get("text-rotate").evaluate(Un,{},dr)+90;Bo=Jh(Xn,cn,Qt,Qn,Tr,On,Ur,wo,jr,wn),Ht&&(Pl=Jh(Xn,cn,Qt,Qn,Tr,On,Ht,Li,jr))}}if(Dr){const Ur=bn.layout.get("icon-rotate").evaluate(Un,{},dr),jr="none"!==bn.layout.get("icon-text-fit"),Ws=Xp(Dr,Ur,zi,jr),Fl=Ht?Xp(Ht,Ur,zi,jr):void 0;Pr=Jh(Xn,cn,Qt,Qn,Tr,On,Dr,Li,Ur),Nu=4*Ws.length;const Lc=et.iconSizeData;let Vo=null;"source"===Lc.kind?(Vo=[Pa*bn.layout.get("icon-size").evaluate(Un,{},dr)],Vo[0]>$s&&Tn(`${et.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Lc.kind&&(Vo=[Pa*Ct.compositeIconSizes[0].evaluate(Un,{},dr),Pa*Ct.compositeIconSizes[1].evaluate(Un,{},dr)],(Vo[0]>$s||Vo[1]>$s)&&Tn(`${et.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),et.addSymbols(et.icon,Ws,Vo,Vr,Nr,Un,!1,cn,Qt,Ci.lineStartIndex,Ci.lineLength,-1,Xr,dr),No=et.icon.placedSymbolArray.length-1,Fl&&(y_=4*Fl.length,et.addSymbols(et.icon,Fl,Vo,Vr,Nr,Un,_o.vertical,cn,Qt,Ci.lineStartIndex,Ci.lineLength,-1,Xr,dr),Fc=et.icon.placedSymbolArray.length-1)}for(const Ur in Rn.horizontal){const jr=Rn.horizontal[Ur];ci||(Rl=zs(jr.text),oo?kl=Qh(jr):ci=Jh(Xn,cn,Qt,Qn,Tr,On,jr,wo,bn.layout.get("text-rotate").evaluate(Un,{},dr),wn));const Ws=1===jr.positionedLines.length;if(v_+=Gs(et,cn,Qt,jr,pn,bn,oo,Un,wn,Ci,Rn.vertical?_o.horizontal:_o.horizontalOnly,Ws?Object.keys(Rn.horizontal):[Ur],ir,No,Ct,Xr,dr),Ws)break}Rn.vertical&&(Nf+=Gs(et,cn,Qt,Rn.vertical,pn,bn,oo,Un,wn,Ci,_o.vertical,["vertical"],ir,Fc,Ct,Xr,dr));let ui=-1;const Ol=(Ur,jr)=>Ur?Math.max(Ur,jr):jr;ui=Ol(kl,ui),ui=Ol(Zs,ui),ui=Ol(__,ui);const Uu=ui>-1?1:0;et.glyphOffsetArray.length>=Ac.MAX_GLYPHS&&Tn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Un.sortKey&&et.addToSortKeyRanges(et.symbolInstances.length,Un.sortKey),et.symbolInstances.emplaceBack(cn.x,cn.y,cn.z,Qt.x,Qt.y,ir.right>=0?ir.right:-1,ir.center>=0?ir.center:-1,ir.left>=0?ir.left:-1,ir.vertical>=0?ir.vertical:-1,No,Fc,Rl,void 0!==ci?ci:et.collisionBoxArray.length,void 0!==ci?ci+1:et.collisionBoxArray.length,void 0!==Bo?Bo:et.collisionBoxArray.length,void 0!==Bo?Bo+1:et.collisionBoxArray.length,void 0!==Pr?Pr:et.collisionBoxArray.length,void 0!==Pr?Pr+1:et.collisionBoxArray.length,Pl||et.collisionBoxArray.length,Pl?Pl+1:et.collisionBoxArray.length,Qn,v_,Nf,Nu,y_,Uu,0,Vu,so,ui)}(s,qe,ct,$e,a,c,h,Be,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,he,we,C,0,de,Me,G,r,m,D,S,I)};if("line"===ke)for(const $e of qg(r.geometry,0,0,kt,kt)){const qe=M1($e,le,fe,a.vertical||Z,c,24,se,s.overscaling,kt);for(const Et of qe){const jt=Z;jt&&S1(s,jt.text,ze,Et)||We($e,Et,I)}}else if("line-center"===ke){for(const $e of r.geometry)if($e.length>1){const qe=Hg($e,fe,a.vertical||Z,c,24,se);qe&&We($e,qe,I)}}else if("Polygon"===r.type)for(const $e of kp(r.geometry,0)){const qe=Dv($e,16);We($e[0],new js(qe.x,qe.y,0,0,void 0),I)}else if("LineString"===r.type)for(const $e of r.geometry)We($e,new js($e[0].x,$e[0].y,0,0,void 0),I);else if("Point"===r.type)for(const $e of r.geometry)for(const qe of $e)We([qe],new js(qe.x,qe.y,0,0,void 0),I)}const $s=32640;function Gs(s,r,a,c,h,m,_,v,C,D,S,I,P,F,N,G,Z){const K=function(he,de,fe,we,Me,ke,ze,Ce){const Ee=[];if(0===de.positionedLines.length)return Ee;const Be=we.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,We=function(Mt){const Rt=Mt[0],ct=Mt[1],et=Rt*ct;return et>0?[Rt,-ct]:et<0?[-Rt,ct]:0===Rt?[ct,Rt]:[ct,-Rt]}(fe);let $e=Math.abs(de.top-de.bottom);for(const Mt of de.positionedLines)$e-=Mt.lineOffset;const qe=de.positionedLines.length,Et=$e/qe;let jt=de.top-fe[1];for(let Mt=0;Mt<qe;++Mt){const Rt=de.positionedLines[Mt];jt=Kg(de,Et,jt,Mt);for(const ct of Rt.positionedGlyphs){if(!ct.rect)continue;const et=ct.rect||{};let Qt=4,cn=!0,vr=1,Rn=0;if(ct.imageName){const Ct=ze[ct.imageName];if(!Ct)continue;if(Ct.sdf){Tn("SDF images are not supported in formatted text and will be ignored.");continue}cn=!1,vr=Ct.pixelRatio,Qt=1/vr}const Dr=(Me||Ce)&&ct.vertical,pn=ct.metrics.advance*ct.scale/2,Ht=ct.metrics,bn=ct.rect;if(null===bn)continue;Ce&&de.verticalizable&&(Rn=ct.imageName?pn-ct.metrics.width*ct.scale/2:0);const Xn=Me?[ct.x+pn,ct.y]:[0,0];let Qn=[0,0],Tr=[0,0],On=!1;Me||(Dr?(Tr=[ct.x+pn+We[0],ct.y+We[1]-Rn],On=!0):Qn=[ct.x+pn+fe[0],ct.y+fe[1]-Rn]);const wo=bn.w*ct.scale/(vr*(ct.localGlyph?2:1)),oo=bn.h*ct.scale/(vr*(ct.localGlyph?2:1));let wn,li,Li,Nr;if(Dr){const Ct=ct.y-jt,zi=new Oe(-pn,pn-Ct),Xr=-Math.PI/2,dr=new Oe(...Tr);wn=new Oe(-pn+Qn[0],Qn[1]),wn._rotateAround(Xr,zi)._add(dr),wn.x+=-Ct+pn,wn.y-=(Ht.left-Qt)*ct.scale;const Ci=ct.imageName?Ht.advance*ct.scale:24*ct.scale,ci=String.fromCharCode(ct.glyph);Fg(ci)?wn.x+=(1-Qt)*ct.scale:Hh(ci)?wn.x+=Ci-Ht.height*ct.scale+(-Qt-1)*ct.scale:wn.x+=ct.imageName||Ht.width+2*Qt===bn.w&&Ht.height+2*Qt===bn.h?(Ci-oo)/2:(Ci-(Ht.height+2*Qt)*ct.scale)/2,li=new Oe(wn.x,wn.y-wo),Li=new Oe(wn.x+oo,wn.y),Nr=new Oe(wn.x+oo,wn.y-wo)}else{const Ct=(Ht.left-Qt)*ct.scale-pn+Qn[0],zi=(-Ht.top-Qt)*ct.scale+Qn[1],Xr=Ct+wo,dr=zi+oo;wn=new Oe(Ct,zi),li=new Oe(Xr,zi),Li=new Oe(Ct,dr),Nr=new Oe(Xr,dr)}if(Be){let Ct;Ct=Me?new Oe(0,0):On?new Oe(We[0],We[1]):new Oe(fe[0],fe[1]),wn._rotateAround(Be,Ct),li._rotateAround(Be,Ct),Li._rotateAround(Be,Ct),Nr._rotateAround(Be,Ct)}const Vr=new Oe(0,0),Un=new Oe(0,0);Ee.push({tl:wn,tr:li,bl:Li,br:Nr,tex:et,writingMode:de.writingMode,glyphOffset:Xn,sectionIndex:ct.sectionIndex,isSDF:cn,pixelOffsetTL:Vr,pixelOffsetBR:Un,minFontScaleX:0,minFontScaleY:0})}}return Ee}(0,c,C,m,_,v,h,s.allowVerticalPlacement),se=s.textSizeData;let le=null;"source"===se.kind?(le=[Pa*m.layout.get("text-size").evaluate(v,{},Z)],le[0]>$s&&Tn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===se.kind&&(le=[Pa*N.compositeTextSizes[0].evaluate(v,{},Z),Pa*N.compositeTextSizes[1].evaluate(v,{},Z)],(le[0]>$s||le[1]>$s)&&Tn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,K,le,C,_,v,S,r,a,D.lineStartIndex,D.lineLength,F,G,Z);for(const he of I)P[he]=s.text.placedSymbolArray.length-1;return 4*K.length}function Sf(s){for(const r in s)return s[r];return null}function Jh(s,r,a,c,h,m,_,v,C,D){let S=_.top,I=_.bottom,P=_.left,F=_.right;const N=_.collisionPadding;if(N&&(P-=N[0],S-=N[1],F+=N[2],I+=N[3]),C){const G=new Oe(P,S),Z=new Oe(F,S),K=new Oe(P,I),se=new Oe(F,I),le=nn(C);let he=new Oe(0,0);D&&(he=new Oe(D[0],D[1])),G._rotateAround(le,he),Z._rotateAround(le,he),K._rotateAround(le,he),se._rotateAround(le,he),P=Math.min(G.x,Z.x,K.x,se.x),F=Math.max(G.x,Z.x,K.x,se.x),S=Math.min(G.y,Z.y,K.y,se.y),I=Math.max(G.y,Z.y,K.y,se.y)}return s.emplaceBack(r.x,r.y,r.z,a.x,a.y,P,S,F,I,v,c,h,m),s.length-1}function Qh(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function S1(s,r,a,c){const h=s.compareText;if(r in h){const m=h[r];for(let _=m.length-1;_>=0;_--)if(c.dist(m[_])<a)return!0}else h[r]=[];return h[r].push(c),!1}const Jg=Ec.VectorTileFeature.types,I1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ic(s,r,a,c,h,m,_,v,C,D,S,I,P,F,N,G){const Z=S?Math.min($s,Math.round(S[0])):0,K=S?Math.min($s,Math.round(S[1])):0;s.emplaceBack(r,a,Math.round(32*_),Math.round(32*v),C,D,(Z<<1)+(I?1:0),K,16*P,16*F,256*N,256*G,c,h,m,0)}function Ou(s,r,a){s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a)}function Kp(s){for(const r of s.sections)if(xh(r.text))return!0;return!1}class ed{constructor(r){this.layoutVertexArray=new Te,this.indexArray=new it,this.programConfigurations=r,this.segments=new Vn,this.dynamicLayoutVertexArray=new Ne,this.opacityVertexArray=new pe,this.placedSymbolArray=new Lo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,c,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,hv.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,dv.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,I1,!0),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tt(ed,"SymbolBuffers");class td{constructor(r,a,c){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new c,this.segments=new Vn,this.collisionVertexArray=new Ie,this.collisionVertexArrayExt=new Ne}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,fv.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,pv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}tt(td,"CollisionBuffers");class Ac{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(_=>_.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ns([]),this.placementViewportMatrix=Ns([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=pf(this.zoom,a["text-size"]),this.iconSizeData=pf(this.zoom,a["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),m=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>_o[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new ed(new vu(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new ed(new vu(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new hn,this.lineVertexArray=new Wn,this.symbolInstances=new nr}calculateGlyphDependencies(r,a,c,h,m){for(let _=0;_<r.length;_++)if(a[r.charCodeAt(_)]=!0,h&&m){const v=Gh[r.charAt(_)];v&&(a[v.charCodeAt(0)]=!0)}}populate(r,a,c,h){const m=this.layers[0],_=m.layout,v=_.get("text-font"),C=_.get("text-field"),D=_.get("icon-image"),S=("constant"!==C.value.kind||C.value.value instanceof Tt&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),I="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,P=_.get("symbol-sort-key");if(this.features=[],!S&&!I)return;const F=a.iconDependencies,N=a.glyphDependencies,G=a.availableImages,Z=new kn(this.zoom);for(const{feature:K,id:se,index:le,sourceLayerIndex:he}of r){const de=m._featureFilter.needGeometry,fe=gc(K,de);if(!m._featureFilter.filter(Z,fe,c))continue;let we,Me;if(de||(fe.geometry=Sa(K,c,h)),S){const ze=m.getValueAndResolveTokens("text-field",fe,c,G),Ce=Tt.factory(ze);Kp(Ce)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===fu()||this.hasRTLText&&Yi.isParsed())&&(we=Np(Ce,m,fe))}if(I){const ze=m.getValueAndResolveTokens("icon-image",fe,c,G);Me=ze instanceof Qr?ze:Qr.fromString(ze)}if(!we&&!Me)continue;const ke=this.sortFeaturesByKey?P.evaluate(fe,{},c):void 0;if(this.features.push({id:se,text:we,icon:Me,index:le,sourceLayerIndex:he,geometry:fe.geometry,properties:K.properties,type:Jg[K.type],sortKey:ke}),Me&&(F[Me.name]=!0),we){const ze=v.evaluate(fe,{},c).join(","),Ce="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_o.vertical)>=0;for(const Ee of we.sections)if(Ee.image)F[Ee.image.name]=!0;else{const Be=rn(we.toString()),We=Ee.fontStack||ze,$e=N[We]=N[We]||{};this.calculateGlyphDependencies(Ee.text,$e,Ce,this.allowVerticalPlacement,Be)}}}"line"===_.get("symbol-placement")&&(this.features=function(K){const se={},le={},he=[];let de=0;function fe(ze){he.push(K[ze]),de++}function we(ze,Ce,Ee){const Be=le[ze];return delete le[ze],le[Ce]=Be,he[Be].geometry[0].pop(),he[Be].geometry[0]=he[Be].geometry[0].concat(Ee[0]),Be}function Me(ze,Ce,Ee){const Be=se[Ce];return delete se[Ce],se[ze]=Be,he[Be].geometry[0].shift(),he[Be].geometry[0]=Ee[0].concat(he[Be].geometry[0]),Be}function ke(ze,Ce,Ee){const Be=Ee?Ce[0][Ce[0].length-1]:Ce[0][0];return`${ze}:${Be.x}:${Be.y}`}for(let ze=0;ze<K.length;ze++){const Ce=K[ze],Ee=Ce.geometry,Be=Ce.text?Ce.text.toString():null;if(!Be){fe(ze);continue}const We=ke(Be,Ee),$e=ke(Be,Ee,!0);if(We in le&&$e in se&&le[We]!==se[$e]){const qe=Me(We,$e,Ee),Et=we(We,$e,he[qe].geometry);delete se[We],delete le[$e],le[ke(Be,he[Et].geometry,!0)]=Et,he[qe].geometry=null}else We in le?we(We,$e,Ee):$e in se?Me(We,$e,Ee):(fe(ze),se[We]=de-1,le[$e]=de-1)}return he.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,se)=>K.sortKey-se.sortKey)}update(r,a,c,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,c,h),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,c,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const c=this.lineVertexArray.length,h=r.segment;if(void 0!==h){let m=r.dist(a[h+1]),_=r.dist(a[h]);const v={};for(let C=h+1;C<a.length;C++)v[C]={x:a[C].x,y:a[C].y,tileUnitDistanceFromAnchor:m},C<a.length-1&&(m+=a[C+1].dist(a[C]));for(let C=h||0;C>=0;C--)v[C]={x:a[C].x,y:a[C].y,tileUnitDistanceFromAnchor:_},C>0&&(_+=a[C-1].dist(a[C]));for(let C=0;C<a.length;C++){const D=v[C];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,a,c,h,m,_,v,C,D,S,I,P,F,N){const G=r.indexArray,Z=r.layoutVertexArray,K=r.segments.prepareSegment(4*a.length,Z,G,this.canOverlap?_.sortKey:void 0),se=this.glyphOffsetArray.length,le=K.vertexLength,he=this.allowVerticalPlacement&&v===_o.vertical?Math.PI/2:0,de=_.text&&_.text.sections;for(let fe=0;fe<a.length;fe++){const{tl:we,tr:Me,bl:ke,br:ze,tex:Ce,pixelOffsetTL:Ee,pixelOffsetBR:Be,minFontScaleX:We,minFontScaleY:$e,glyphOffset:qe,isSDF:Et,sectionIndex:jt}=a[fe],Mt=K.vertexLength,Rt=qe[1];Ic(Z,C.x,C.y,C.z,D.x,D.y,we.x,Rt+we.y,Ce.x,Ce.y,c,Et,Ee.x,Ee.y,We,$e),Ic(Z,C.x,C.y,C.z,D.x,D.y,Me.x,Rt+Me.y,Ce.x+Ce.w,Ce.y,c,Et,Be.x,Ee.y,We,$e),Ic(Z,C.x,C.y,C.z,D.x,D.y,ke.x,Rt+ke.y,Ce.x,Ce.y+Ce.h,c,Et,Ee.x,Be.y,We,$e),Ic(Z,C.x,C.y,C.z,D.x,D.y,ze.x,Rt+ze.y,Ce.x+Ce.w,Ce.y+Ce.h,c,Et,Be.x,Be.y,We,$e),Ou(r.dynamicLayoutVertexArray,C,he),G.emplaceBack(Mt,Mt+1,Mt+2),G.emplaceBack(Mt+1,Mt+2,Mt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qe[0]),fe!==a.length-1&&jt===a[fe+1].sectionIndex||r.programConfigurations.populatePaintArrays(Z.length,_,_.index,{},F,N,de&&de[jt])}r.placedSymbolArray.emplaceBack(C.x,C.y,C.z,D.x,D.y,se,this.glyphOffsetArray.length-se,le,S,I,D.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],v,0,!1,0,P,0)}_commitLayoutVertex(r,a,c,h,m,_,v){r.emplaceBack(a,c,h,m,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(r,a,c,h,m,_,v){const C=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),D=C.vertexLength,S=v.tileAnchorX,I=v.tileAnchorY;for(let F=0;F<4;F++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),c.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(c.layoutVertexArray,h,m,_,S,I,new Oe(r.x1,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,m,_,S,I,new Oe(r.x2,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,m,_,S,I,new Oe(r.x2,r.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,m,_,S,I,new Oe(r.x1,r.y2)),C.vertexLength+=4;const P=c.indexArray;P.emplaceBack(D,D+1),P.emplaceBack(D+1,D+2),P.emplaceBack(D+2,D+3),P.emplaceBack(D+3,D),C.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,c,h,m,_){for(let v=h;v<m;v++){const C=c.get(v),D=this.getSymbolInstanceTextSize(r,_,a,v);this._addCollisionDebugVertices(C,D,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(r,a,c,h,m,_){for(let v=h;v<m;v++){const C=c.get(v),D=this.getSymbolInstanceIconSize(r,a,v);this._addCollisionDebugVertices(C,D,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new td(Ve,Dc.members,vt),this.iconCollisionBox=new td(Ve,Dc.members,vt);const c=Wr(this.iconSizeData,r),h=Wr(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(r,a,c,h){const m=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:h),_=zp(this.textSizeData,r,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(r,a,c){const h=this.icon.placedSymbolArray.get(c),m=zp(this.iconSizeData,r,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(r,a,c){r.emplaceBack(a,-c,-c),r.emplaceBack(a,c,-c),r.emplaceBack(a,c,c),r.emplaceBack(a,-c,c)}_updateTextDebugCollisionBoxes(r,a,c,h,m,_){for(let v=h;v<m;v++){const C=c.get(v),D=this.getSymbolInstanceTextSize(r,_,a,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,C.padding)}}_updateIconDebugCollisionBoxes(r,a,c,h,m){for(let _=h;_<m;_++){const v=c.get(_),C=this.getSymbolInstanceIconSize(r,a,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,v.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Wr(this.iconSizeData,r),h=Wr(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,c,h,m,_,v,C,D){const S={};for(let I=a;I<c;I++){const P=r.get(I);S.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},S.textFeatureIndex=P.featureIndex;break}for(let I=h;I<m;I++){const P=r.get(I);S.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},S.verticalTextFeatureIndex=P.featureIndex;break}for(let I=_;I<v;I++){const P=r.get(I);S.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},S.iconFeatureIndex=P.featureIndex;break}for(let I=C;I<D;I++){const P=r.get(I);S.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},S.verticalIconFeatureIndex=P.featureIndex;break}return S}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const c=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const c=r.placedSymbolArray.get(a),h=c.vertexStartIndex+4*c.numGlyphs;for(let m=c.vertexStartIndex;m<h;m+=4)r.indexArray.emplaceBack(m,m+1,m+2),r.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),c=Math.cos(r),h=[],m=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const C=this.symbolInstances.get(v);h.push(0|Math.round(a*C.tileAnchorX+c*C.tileAnchorY)),m.push(C.featureIndex)}return _.sort((v,C)=>h[v]-h[C]||m[C]-m[v]),_}addToSortKeyRanges(r,a){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===a?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const c=this.symbolInstances.get(a);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((h,m,_)=>{h>=0&&_.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tt(Ac,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ac.MAX_GLYPHS=65535,Ac.addDynamicAttributes=Ou;const Mv=new B({"symbol-placement":new E(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new E(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new E(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new M(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new E(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new E(xe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new E(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new E(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new E(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new M(xe.layout_symbol["icon-size"]),"icon-text-fit":new E(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new E(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new M(xe.layout_symbol["icon-image"]),"icon-rotate":new M(xe.layout_symbol["icon-rotate"]),"icon-padding":new E(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new E(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new M(xe.layout_symbol["icon-offset"]),"icon-anchor":new M(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new E(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new E(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new E(xe.layout_symbol["text-rotation-alignment"]),"text-field":new M(xe.layout_symbol["text-field"]),"text-font":new M(xe.layout_symbol["text-font"]),"text-size":new M(xe.layout_symbol["text-size"]),"text-max-width":new M(xe.layout_symbol["text-max-width"]),"text-line-height":new M(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new M(xe.layout_symbol["text-letter-spacing"]),"text-justify":new M(xe.layout_symbol["text-justify"]),"text-radial-offset":new M(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new E(xe.layout_symbol["text-variable-anchor"]),"text-anchor":new M(xe.layout_symbol["text-anchor"]),"text-max-angle":new E(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new E(xe.layout_symbol["text-writing-mode"]),"text-rotate":new M(xe.layout_symbol["text-rotate"]),"text-padding":new E(xe.layout_symbol["text-padding"]),"text-keep-upright":new E(xe.layout_symbol["text-keep-upright"]),"text-transform":new M(xe.layout_symbol["text-transform"]),"text-offset":new M(xe.layout_symbol["text-offset"]),"text-allow-overlap":new E(xe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new E(xe.layout_symbol["text-ignore-placement"]),"text-optional":new E(xe.layout_symbol["text-optional"])});var Yp={paint:new B({"icon-opacity":new M(xe.paint_symbol["icon-opacity"]),"icon-color":new M(xe.paint_symbol["icon-color"]),"icon-halo-color":new M(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new M(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new M(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new E(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new E(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new M(xe.paint_symbol["text-opacity"]),"text-color":new M(xe.paint_symbol["text-color"],{runtimeType:fo,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new M(xe.paint_symbol["text-halo-color"]),"text-halo-width":new M(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new M(xe.paint_symbol["text-halo-blur"]),"text-translate":new E(xe.paint_symbol["text-translate"]),"text-translate-anchor":new E(xe.paint_symbol["text-translate-anchor"])}),layout:Mv};class Qg{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Ko,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tt(Qg,"FormatSectionOverride",{omit:["defaultValue"]});class If extends Bs{constructor(r){super(r,Yp)}recalculate(r,a){super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const m of c)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,c,h){const m=this.layout.get(r).evaluate(a,{},c,h),_=this._unevaluatedLayout._values[r];return _.isDataDriven()||Oo(_.value)||!m?m:(v=a.properties,m.replace(/{([^{}]+)}/g,(D,S)=>S in v?String(v[S]):""));var v}createBucket(r){return new Ac(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Yp.paint.overridableProperties){if(!If.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),c=new Qg(a),h=new Lr(c,a.property.specification);let m=null;m="constant"===a.value.kind||"source"===a.value.kind?new Ai("source",h):new An("composite",h,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new x(a.property,m,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven())&&If.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const c=r.get("text-field"),h=Yp.paint.properties[a];let m=!1;const _=v=>{for(const C of v)if(h.overrides&&h.overrides.hasOverride(C))return void(m=!0)};if("constant"===c.value.kind&&c.value.value instanceof Tt)_(c.value.value.sections);else if("source"===c.value.kind){const v=D=>{m||(D instanceof bs&&lr(D.value)===ys?_(D.value.sections):D instanceof Ja?_(D.sections):D.eachChild(v))},C=c.value;C._styleExpression&&v(C._styleExpression.expression)}return m}getProgramConfiguration(r){return new ml(this,r)}}var e_={paint:new B({"background-color":new E(xe.paint_background["background-color"]),"background-pattern":new R(xe.paint_background["background-pattern"]),"background-opacity":new E(xe.paint_background["background-opacity"])})},A1={paint:new B({"raster-opacity":new E(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new E(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new E(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new E(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new E(xe.paint_raster["raster-saturation"]),"raster-contrast":new E(xe.paint_raster["raster-contrast"]),"raster-resampling":new E(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new E(xe.paint_raster["raster-fade-duration"])})};class Sv extends Bs{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var P1={paint:new B({"sky-type":new E(xe.paint_sky["sky-type"]),"sky-atmosphere-sun":new E(xe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new E(xe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new E(xe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new E(xe.paint_sky["sky-gradient-radius"]),"sky-gradient":new O(xe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new E(xe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new E(xe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new E(xe.paint_sky["sky-opacity"])})};function Af(s,r,a){const c=[0,0,1],h=sf([]);return function(m,_,v){v*=.5;var C=_[0],D=_[1],S=_[2],I=_[3],P=Math.sin(v),F=Math.cos(v);m[0]=C*F-S*P,m[1]=D*F+I*P,m[2]=S*F+C*P,m[3]=I*F-D*P}(h,h,a?-nn(s)+Math.PI:nn(s)),Dp(h,h,-nn(r)),Ph(c,c,h),of(c,c)}const t_={circle:class extends Bs{constructor(s){super(s,xp)}createBucket(s){return new Qd(s)}queryRadius(s){const r=s;return yc("circle-radius",this,r)+yc("circle-stroke-width",this,r)+rf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,a,c,h,m,_,v){const C=vp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return Tp(s,c,m,_,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),C,D)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new ml(this,s)}},heatmap:class extends Bs{createBucket(s){return new gg(s)}constructor(s){super(s,b1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_g({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return yc("heatmap-radius",this,s)}queryIntersectsFeature(s,r,a,c,h,m,_,v){const C=this.paint.get("heatmap-radius").evaluate(r,a);return Tp(s,c,m,_,v,!0,!0,new Oe(0,0),C)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new ml(this,s)}},hillshade:class extends Bs{constructor(s){super(s,w1)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Bs{constructor(s){super(s,Qy)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(s){return new ml(this,s)}recalculate(s,r){super.recalculate(s,r);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new df(s)}queryRadius(){return rf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,a,c,h,m){return!s.queryGeometry.isAboveHorizon&&Vy(bt(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Bs{constructor(s){super(s,rv)}createBucket(s){return new Vh(s)}queryRadius(){return rf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new ml(this,s)}queryIntersectsFeature(s,r,a,c,h,m,_,v,C){const D=vp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(r,a),I=this.paint.get("fill-extrusion-base").evaluate(r,a),P=[0,0],F=v&&m.elevation,N=m.elevation?m.elevation.exaggeration():1,G=s.tile.getBucket(this);if(F&&G instanceof Vh){const se=G.centroidVertexArray,le=C+1;if(le<se.length){const he=se.get(le);P[0]=he.a_centroid_pos0,P[1]=he.a_centroid_pos1}}if(0===P[0]&&1===P[1])return!1;const Z=(se=c,le=I,he=S,de=D,fe=_,(we=F?v:null)?function(Ce,Ee,Be,We,$e,qe,Et,jt,Mt){const Rt=[],ct=[],et=[0,0,0,1];for(const Qt of Ce){const cn=[],vr=[];for(const Rn of Qt){const Dr=Rn.x+We.x,pn=Rn.y+We.y,Ht=iv(Dr,pn,Ee,Be,qe,Et,jt,Mt);et[0]=Dr,et[1]=pn,et[2]=Ht.base,et[3]=1,kh(et,et,$e),et[3]=Math.max(et[3],1e-5);const bn=Pg([et[0]/et[3],et[1]/et[3],et[2]/et[3]]);et[0]=Dr,et[1]=pn,et[2]=Ht.top,et[3]=1,kh(et,et,$e),et[3]=Math.max(et[3],1e-5);const Xn=Pg([et[0]/et[3],et[1]/et[3],et[2]/et[3]]);cn.push(bn),vr.push(Xn)}Rt.push(cn),ct.push(vr)}return[Rt,ct]}(se,le,he,de,fe,we,P,N,m.center.lat):function(Ce,Ee,Be,We,$e){const qe=[],Et=[],jt=$e[8]*Ee,Mt=$e[9]*Ee,Rt=$e[10]*Ee,ct=$e[11]*Ee,et=$e[8]*Be,Qt=$e[9]*Be,cn=$e[10]*Be,vr=$e[11]*Be;for(const Rn of Ce){const Dr=[],pn=[];for(const Ht of Rn){const bn=Ht.x+We.x,Xn=Ht.y+We.y,Qn=$e[0]*bn+$e[4]*Xn+$e[12],Tr=$e[1]*bn+$e[5]*Xn+$e[13],On=$e[2]*bn+$e[6]*Xn+$e[14],wo=$e[3]*bn+$e[7]*Xn+$e[15],oo=Qn+jt,wn=Tr+Mt,li=On+Rt,Li=Math.max(wo+ct,1e-5),Nr=Qn+et,Vr=Tr+Qt,Un=On+cn,Ct=Math.max(wo+vr,1e-5),zi=new Oe(oo/Li,wn/Li);zi.z=li/Li,Dr.push(zi);const Xr=new Oe(Nr/Ct,Vr/Ct);Xr.z=Un/Ct,pn.push(Xr)}qe.push(Dr),Et.push(pn)}return[qe,Et]}(se,le,he,de,fe)),K=s.queryGeometry;var se,le,he,de,fe,we;return function(se,le,he){let de=1/0;Vy(he,le)&&(de=ff(he,le[0]));for(let fe=0;fe<le.length;fe++){const we=le[fe],Me=se[fe];for(let ke=0;ke<we.length-1;ke++){const ze=we[ke],Ce=[ze,we[ke+1],Me[ke+1],Me[ke],ze];ef(he,Ce)&&(de=Math.min(de,ff(he,Ce)))}}return de!==1/0&&de}(Z[0],Z[1],K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends Bs{constructor(s){super(s,kg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof nl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=Rg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new $h(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new ml(this,s)}queryRadius(s){const r=s,a=Og(yc("line-width",this,r),yc("line-gap-width",this,r)),c=yc("line-offset",this,r);return a/2+Math.abs(c)+rf(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,a,c,h,m){if(s.queryGeometry.isAboveHorizon)return!1;const _=bt(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),v=s.pixelToTileUnitsFactor/2*Og(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),C=this.paint.get("line-offset").evaluate(r,a);return C&&(c=function(D,S){const I=[],P=new Oe(0,0);for(let F=0;F<D.length;F++){const N=D[F],G=[];for(let Z=0;Z<N.length;Z++){const K=N[Z-1],se=N[Z],le=N[Z+1],he=0===Z?P:se.sub(K)._unit()._perp(),de=Z===N.length-1?P:le.sub(se)._unit()._perp(),fe=he._add(de)._unit();fe._mult(1/(fe.x*de.x+fe.y*de.y)),G.push(fe._mult(S)._add(se))}I.push(G)}return I}(c,C*s.pixelToTileUnitsFactor)),function(D,S,I){for(let P=0;P<S.length;P++){const F=S[P];if(D.length>=3)for(let N=0;N<F.length;N++)if(_c(D,F[N]))return!0;if(Eh(D,F,I))return!0}return!1}(_,c,v)}isTileClipped(){return!0}},symbol:If,background:class extends Bs{constructor(s){super(s,e_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Bs{constructor(s){super(s,A1)}getProgramIds(){return["raster"]}},sky:class extends Bs{constructor(s){super(s,P1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=_g({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),h=!c,m=s.style.light,_=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&Tn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Af(_.azimuthal,90-_.polar,r):Af(c[0],90-c[1],r)}const a=this.paint.get("sky-gradient-center");return Af(a[0],90-a[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class nd{constructor(r,a,c,h){this.context=r,this.format=c,this.texture=r.gl.createTexture(),this.update(a,h)}update(r,a,c){const{width:h,height:m}=r,{context:_}=this,{gl:v}=_,{HTMLImageElement:C,HTMLCanvasElement:D,HTMLVideoElement:S,ImageData:I,ImageBitmap:P}=ft;if(v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!a||!1!==a.premultiply)),c||this.size&&this.size[0]===h&&this.size[1]===m){const{x:F,y:N}=c||{x:0,y:0};r instanceof C||r instanceof D||r instanceof S||r instanceof I||P&&r instanceof P?v.texSubImage2D(v.TEXTURE_2D,0,F,N,v.RGBA,v.UNSIGNED_BYTE,r):v.texSubImage2D(v.TEXTURE_2D,0,F,N,h,m,v.RGBA,v.UNSIGNED_BYTE,r.data)}else this.size=[h,m],r instanceof C||r instanceof D||r instanceof S||r instanceof I||P&&r instanceof P?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,r):v.texImage2D(v.TEXTURE_2D,0,this.format,h,m,0,this.format,v.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(r,a){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class rd{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new yl({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const c=this.getKey(r,a);return this.positions[c]}trim(){const r=this.width,a=this.height=Zc(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,c){const h=[];let m=r.length%2==1?-r[r.length-1]*c:0,_=r[0]*c,v=!0;h.push({left:m,right:_,isDash:v,zeroLength:0===r[0]});let C=r[0];for(let D=1;D<r.length;D++){v=!v;const S=r[D];m=C*c,C+=S,_=C*c,h.push({left:m,right:_,isDash:v,zeroLength:0===S})}return h}addRoundDash(r,a,c){const h=a/2;for(let m=-c;m<=c;m++){const _=this.width*(this.nextRow+c+m);let v=0,C=r[v];for(let D=0;D<this.width;D++){D/C.right>1&&(C=r[++v]);const S=Math.abs(D-C.left),I=Math.abs(D-C.right),P=Math.min(S,I);let F;const N=m/c*(h+1);if(C.isDash){const G=h-Math.abs(N);F=Math.sqrt(P*P+G*G)}else F=h-Math.sqrt(P*P+N*N);this.image.data[_+D]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(r,a){for(let C=r.length-1;C>=0;--C){const D=r[C],S=r[C+1];D.zeroLength?r.splice(C,1):S&&S.isDash===D.isDash&&(S.left=D.left,r.splice(C,1))}const c=r[0],h=r[r.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const m=this.width*this.nextRow;let _=0,v=r[_];for(let C=0;C<this.width;C++){C/v.right>1&&(v=r[++_]);const D=Math.abs(C-v.left),S=Math.abs(C-v.right),I=Math.min(D,S);this.image.data[m+C]=Math.max(0,Math.min(255,(v.isDash?I:-I)+a+128))}}addDash(r,a){const c=this.getKey(r,a);if(this.positions[c])return this.positions[c];const h="round"===a,m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return Tn("LineAtlas out of space"),null;0===r.length&&r.push(1);let v=0;for(let S=0;S<r.length;S++)r[S]<0&&(Tn("Negative value is found in line dasharray, replacing values with 0"),r[S]=0),v+=r[S];if(0!==v){const S=this.width/v,I=this.getDashRanges(r,this.width,S);h?this.addRoundDash(I,S,m):this.addRegularDash(I,"square"===a?.5*S:0)}const C=this.nextRow+m;this.nextRow+=_;const D={tl:[C,m],br:[v,0]};return this.positions[c]=D,D}}tt(rd,"LineAtlas");class k1{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const R1=ft.performance;function Iv(s){const r=s?s.url.toString():void 0;return R1.getEntriesByName(r)}class O1{constructor(){this.tasks={},this.taskQueue=[],Ni(["process"],this),this.invoker=new k1(this.process),this.nextId=0}add(r,a){const c=this.nextId++,h=function({type:m,isSymbolTile:_,zoom:v}){return v=v||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-v:"maybePrepare"===m&&_?400-v:500:200-v:100-v}(a);if(0===h){Vi();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:r,metadata:a,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Vi();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<a&&(a=m.priority,r=h)}if(null===r)return null;const c=this.taskQueue[r];return this.taskQueue.splice(r,1),c}remove(){this.invoker.remove()}}const F1=ne([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),L1=ne([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Av}=F1,Pv=ne([{name:"a_pos_3",components:3,type:"Int16"}]);var Pf=ne([{name:"a_pos",type:"Int16",components:2}]);const id=kt/Math.PI/2,Cr=-id,wi=id,kv=[new ro([Cr,Cr,Cr],[wi,wi,wi]),new ro([Cr,Cr,Cr],[0,0,wi]),new ro([0,Cr,Cr],[wi,0,wi]),new ro([Cr,0,Cr],[0,wi,wi]),new ro([0,0,Cr],[wi,wi,wi])];class n_{constructor(r,a,c){this.a=rs([],r,c),this.b=rs([],a,c),this.center=c;const h=of([],this.a),m=of([],this.b);this.angle=Math.acos(Ah(h,m))}}function od(s,r){if(0===s.angle)return null;let a;return a=0===s.a[r]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),a<0||a>1?null:function(c,h,m,_){const v=Math.sin(m);return c*(Math.sin((1-_)*m)/v)+h*(Math.sin(_*m)/v)}(s.a[r],s.b[r],s.angle,tn(a,0,1))+s.center[r]}function Fu(s){if(s.z<=1)return kv[s.z+2*s.y+s.x];const[r,a]=Qp(s),c=[Hs(r[0],r[1]),Hs(r[0],a[1]),Hs(a[0],r[1]),Hs(a[0],a[1])],h=[wi,wi,wi],m=[Cr,Cr,Cr];for(const _ of c)h[0]=Math.min(h[0],_[0]),h[1]=Math.min(h[1],_[1]),h[2]=Math.min(h[2],_[2]),m[0]=Math.max(m[0],_[0]),m[1]=Math.max(m[1],_[1]),m[2]=Math.max(m[2],_[2]);return new ro(h,m)}function Qp(s){const r=1<<s.z,a=s.x/r,c=(s.x+1)/r,h=(s.y+1)/r;return[[oi(s.y/r),zo(a)],[oi(h),zo(c)]]}function Ra(s,r,a,c=id){return a=nn(a),[s*Math.sin(a)*c,-r*c,s*Math.cos(a)*c]}function Hs(s,r,a){return Ra(Math.cos(nn(s)),Math.sin(nn(s)),r,a)}function r_(s,r,a){const c=Math.pow(2,a.z),h=(s/kt+a.x)/c;return Hs(oi((r/kt+a.y)/c),zo(h))}function sd(s){return 16383/Math.max(...rs([],s.max,s.min))}function i_(s){const r=Ns(new Float64Array(16)),a=sd(s);var c,h;return Ia(r,r,[a,a,a]),no(r,r,((c=[])[0]=-(h=s.min)[0],c[1]=-h[1],c[2]=-h[2],c)),r}function em(s,r,a,c,h){const m=function(C){const D=kt/(2*Math.PI);return C/(2*Math.PI)/D}(a),_=[s,r,-a/(2*Math.PI)],v=Ns(new Float64Array(16));return no(v,v,_),Ia(v,v,[m,m,m]),xc(v,v,nn(-h)),bp(v,v,nn(-c)),v}function o_(s){const{x:r,y:a}=s.point,{lng:c,lat:h}=s._center;return em(r,a,s.worldSize,c,h)}const s_=nn(85),ad=Math.cos(s_),Lu=Math.sin(s_);function kf(s,r,a){var c=2*Math.PI*6378137/256/Math.pow(2,a);return[s*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}class Oa{constructor(r,a,c){this.z=r,this.x=a,this.y=c,this.key=ld(0,r,r,a,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const c=(_=this.y,v=this.z,C=kf(256*(m=this.x),256*(_=Math.pow(2,v)-_-1),v),D=kf(256*(m+1),256*(_+1),v),C[0]+","+C[1]+","+D[0]+","+D[1]),h=function(m,_,v){let C,D="";for(let S=m;S>0;S--)C=1<<S-1,D+=(_&C?1:0)+(v&C?2:0);return D}(this.z,this.x,this.y);var m,_,v,C,D;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zu{constructor(r,a){this.wrap=r,this.canonical=a,this.key=ld(r,a.z,a.z,a.x,a.y)}}class Er{constructor(r,a,c,h,m){this.overscaledZ=r,this.wrap=a,this.canonical=new Oa(c,+h,+m),this.key=0===a&&r===c?this.canonical.key:ld(a,r,c,h,m)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Er(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Er(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return ld(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-r;return ld(this.wrap*+a,r,r,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Er(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new Er(a,this.wrap,a,c,h),new Er(a,this.wrap,a,c+1,h),new Er(a,this.wrap,a,c,h+1),new Er(a,this.wrap,a,c+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Er(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Er(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ld(s,r,a,c,h){const m=1<<Math.min(a,22);let _=m*(h%m)+c%m;return s&&a<22&&(_+=m*m*((s<0?-2*s-1:2*s)%(1<<2*(22-a)))),16*(32*_+a)+(r-a)}function Dl(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const a=Math.pow(2,-s.z),c=s.x*a,h=(s.x+1)*a,m=s.y*a,_=(s.y+1)*a,v=zo(c),C=zo(h),D=oi(m),S=oi(_),I=r.project(v,D),P=r.project(C,D),F=r.project(C,S),N=r.project(v,S);let G=Math.min(I.x,P.x,F.x,N.x),Z=Math.min(I.y,P.y,F.y,N.y),K=Math.max(I.x,P.x,F.x,N.x),se=Math.max(I.y,P.y,F.y,N.y);const le=a/16;function he(fe,we,Me,ke,ze,Ce){const Ee=(Me+ze)/2,Be=(ke+Ce)/2,We=r.project(zo(Ee),oi(Be)),$e=Math.max(0,G-We.x,Z-We.y,We.x-K,We.y-se);G=Math.min(G,We.x),K=Math.max(K,We.x),Z=Math.min(Z,We.y),se=Math.max(se,We.y),$e>le&&(he(fe,We,Me,ke,Ee,Be),he(We,we,Ee,Be,ze,Ce))}he(I,P,c,m,h,m),he(P,F,h,m,h,_),he(F,N,h,_,c,_),he(N,I,c,_,c,m),G-=le,Z-=le,K+=le,se+=le;const de=1/Math.max(K-G,se-Z);return{scale:de,x:G*de,y:Z*de,x2:K*de,y2:se*de,projection:r}}tt(Oa,"CanonicalTileID"),tt(Er,"OverscaledTileID",{omit:["projMatrix"]});class tm{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const c=r[a];this._stringToNumber[c]=a,this._numberToString[a]=c}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const nm=["tile","layer","source","sourceLayer","state"];class Rf{constructor(r,a,c,h,m){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=c,this._y=h,this.properties=r.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const a of nm)void 0!==this[a]&&(r[a]=this[a]);return r}}const Tl=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,a=0,c=0,h=0,m=0,_=0,v=0;for(1&r?h=m=_=32:a=c=v=32;(r>>=1)>1;){const D=a+h>>1,S=c+m>>1;1&r?(h=a,m=c,a=_,c=v):(a=h,c=m,h=_,m=v),_=D,v=S}const C=4*s;Tl[C+0]=a,Tl[C+1]=c,Tl[C+2]=h,Tl[C+3]=m}const ss=new Uint16Array(2178),Pc=new Uint8Array(1089),cd=new Uint16Array(1089);function rm(s){return 0===s?-.03125:32===s?.03125:0}var a_=ne([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const im={type:2,extent:kt,loadGeometry:()=>[[new Oe(0,0),new Oe(8193,0),new Oe(8193,8193),new Oe(0,8193),new Oe(0,0)]]};class om{constructor(r,a,c,h,m){this.tileID=r,this.uid=ja(),this.uses=0,this.tileSize=a,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<Si.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Dl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(h,m){const _={};if(!m)return _;for(const v of h){const C=v.layerIds.map(D=>m.getLayer(D)).filter(Boolean);if(0!==C.length){v.layers=C,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(D=>C.filter(S=>S.id===D)[0]));for(const D of C)_[D.id]=v}}return _}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof Ac){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof Ac&&m.hasRTLText){this.hasRTLText=!0,Yi.isLoading()||Yi.isLoaded()||"deferred"!==fu()||Ca();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(m))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Ji}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const c in this.buckets){const h=this.buckets[c];h.uploadPending()&&h.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new nd(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new nd(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new nd(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,c,h,m,_,v,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:_,params:m,tileTransform:this.tileTransform},r,a,c):{}}querySourceFeatures(r,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const h=c.loadVTLayers(),m=a?a.sourceLayer:"",_=h._geojsonTileLayer||h[m];if(!_)return;const v=_a(a&&a.filter),{z:C,x:D,y:S}=this.tileID.canonical,I={z:C,x:D,y:S};for(let P=0;P<_.length;P++){const F=_.feature(P);if(v.needGeometry){const Z=gc(F,!0);if(!v.filter(new kn(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!v.filter(new kn(this.tileID.overscaledZ),F))continue;const N=c.getId(F,m),G=new Rf(F,C,D,S,N);G.tile=I,r.push(G)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const c=Qs(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let h=!1;if(this.expirationTime>c)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const m=this.expirationTime-a;m?this.expirationTime=c+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!a)return;const c=this.latestFeatureIndex.loadVTLayers(),h=a.style.listImages();for(const m in this.buckets){if(!a.style.hasLayer(m))continue;const _=this.buckets[m],v=_.layers[0].sourceLayer||"_geojsonTileLayer",C=c[v],D=r[v];if(!C||!D||0===Object.keys(D).length)continue;if(_.update(D,C,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof $h||_ instanceof df){const I=a.style._getSourceCache(_.layers[0].source);a._terrain&&a._terrain.enabled&&I&&_.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(I.id,this.tileID)}const S=a&&a.style&&a.style.getLayer(m);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Si.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Si.now()+r}setTexture(r,a){const c=a.context,h=c.gl;this.texture=a.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new nd(c,r,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(r,a){const c={};for(const h of a)c[h]=!0;this.dependencies[r]=c}hasDependency(r,a){for(const c of r){const h=this.dependencies[c];if(h)for(const m of a)if(h[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const c=Sa(im,this.tileID.canonical,this.tileTransform)[0],h=new ee,m=new Yt;for(let _=0;_<c.length;_++){const{x:v,y:C}=c[_];h.emplaceBack(v,C),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(h,Pf.members),this._tileDebugSegments=Vn.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const c=Sa(im,this.tileID.canonical,this.tileTransform)[0];let h,m;if(this.isRaster){const _=function(v,C){const D=Dl(v,C),S=Math.pow(2,v.z);for(let Z=0;Z<33;Z++)for(let K=0;K<33;K++){const se=zo((v.x+(K+rm(K))/32)/S),le=oi((v.y+(Z+rm(Z))/32)/S),he=C.project(se,le),de=33*Z+K;ss[2*de+0]=Math.round((he.x*D.scale-D.x)*kt),ss[2*de+1]=Math.round((he.y*D.scale-D.y)*kt)}Pc.fill(0),cd.fill(0);for(let Z=2045;Z>=0;Z--){const K=4*Z,se=Tl[K+0],le=Tl[K+1],he=Tl[K+2],de=Tl[K+3],fe=se+he>>1,we=le+de>>1,Me=fe+we-le,ke=we+se-fe,ze=33*le+se,Ce=33*de+he,Ee=33*we+fe,Be=Math.hypot((ss[2*ze+0]+ss[2*Ce+0])/2-ss[2*Ee+0],(ss[2*ze+1]+ss[2*Ce+1])/2-ss[2*Ee+1])>=16;if(Pc[Ee]=Pc[Ee]||(Be?1:0),Z<1022){const We=33*(le+ke>>1)+(se+Me>>1),$e=33*(de+ke>>1)+(he+Me>>1);Pc[Ee]=Pc[Ee]||Pc[We]||Pc[$e]}}const I=new oe,P=new it;let F=0;function N(Z,K){const se=33*K+Z;return 0===cd[se]&&(I.emplaceBack(ss[2*se+0],ss[2*se+1],Z*kt/32,K*kt/32),cd[se]=++F),cd[se]-1}function G(Z,K,se,le,he,de){const fe=Z+se>>1,we=K+le>>1;if(Math.abs(Z-he)+Math.abs(K-de)>1&&Pc[33*we+fe])G(he,de,Z,K,fe,we),G(se,le,he,de,fe,we);else{const Me=N(Z,K),ke=N(se,le),ze=N(he,de);P.emplaceBack(Me,ke,ze)}}return G(0,0,32,32,32,0),G(32,32,0,0,0,32),{vertices:I,indices:P}}(this.tileID.canonical,a);h=_.vertices,m=_.indices}else{h=new oe,m=new it;for(const{x:v,y:C}of c)h.emplaceBack(v,C,0,0);const _=lf(h.int16,void 0,4);for(let v=0;v<_.length;v+=3)m.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=r.createVertexBuffer(h,a_.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(m),this._tileBoundsSegments=Vn.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugBuffers(r,a){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!a||"globe"!==a.name)return;const c=this.tileID.canonical,h=i_(Fu(c));this._makeGlobeTileDebugBorderBuffer(r,c,h),this._makeGlobeTileDebugTextBuffer(r,c,h)}_makeGlobeTileDebugBorderBuffer(r,a,c){const h=new ee,m=new Yt,_=new te,v=(D,S,I,P,F)=>{const N=(I-D)/(F-1),G=(P-S)/(F-1),Z=h.length;for(let K=0;K<F;K++){const se=D+K*N,le=S+K*G;h.emplaceBack(se,le);const he=r_(se,le,a),de=wc(he,he,c);_.emplaceBack(de[0],de[1],de[2]),m.emplaceBack(Z+K)}},C=kt;v(0,0,C,0,16),v(C,0,C,C,16),v(C,C,0,C,16),v(0,C,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(h,Pf.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(_,Pv.members),this._tileDebugSegments=Vn.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugTextBuffer(r,a,c){const h=new ee,m=new it,_=new te,v=25;m.reserve(32),h.reserve(v),_.reserve(v);const C=(D,S)=>v*D+S;for(let D=0;D<v;D++){const S=2048*D;for(let I=0;I<v;I++){const P=2048*I;h.emplaceBack(P,S);const F=r_(P,S,a),N=wc(F,F,c);_.emplaceBack(N[0],N[1],N[2])}}for(let D=0;D<4;D++)for(let S=0;S<4;S++){const I=C(D,S),P=C(D,S+1),F=C(D+1,S),N=C(D+1,S+1);m.emplaceBack(I,P,F),m.emplaceBack(F,P,N)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(m),this._tileDebugTextBuffer=r.createVertexBuffer(h,Pf.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(_,Pv.members),this._tileDebugTextSegments=Vn.simpleSegment(0,0,v,32)}}class Rv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,c){const h=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][h]=this.stateChanges[r][h]||{},or(this.stateChanges[r][h],c),null===this.deletedStates[r]){this.deletedStates[r]={};for(const m in this.state[r])m!==h&&(this.deletedStates[r][m]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][h]){this.deletedStates[r][h]={};for(const m in this.state[r][h])c[m]||(this.deletedStates[r][h][m]=null)}else for(const m in c)this.deletedStates[r]&&this.deletedStates[r][h]&&null===this.deletedStates[r][h][m]&&delete this.deletedStates[r][h][m]}removeFeatureState(r,a,c){if(null===this.deletedStates[r])return;const h=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&void 0!==a)null!==this.deletedStates[r][h]&&(this.deletedStates[r][h]=this.deletedStates[r][h]||{},this.deletedStates[r][h][c]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][h])for(c in this.deletedStates[r][h]={},this.stateChanges[r][h])this.deletedStates[r][h][c]=null;else this.deletedStates[r][h]=null;else this.deletedStates[r]=null}getState(r,a){const c=String(a),h=or({},(this.state[r]||{})[c],(this.stateChanges[r]||{})[c]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const m=this.deletedStates[r][a];if(null===m)return{};for(const _ in m)delete h[_]}return h}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const c={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),or(this.state[h][_],this.stateChanges[h][_]),m[_]=this.state[h][_];c[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(null===this.deletedStates[h])for(const _ in this.state[h])m[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const v of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][v];m[_]=this.state[h][_]}c[h]=c[h]||{},or(c[h],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const h in r)r[h].setFeatureState(c,a)}}class io{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const c=this.toIdx(r,a);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function l_(s,r,a,c){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(a[_]<s[_]||a[_]>r[_])return null}else{const v=1/c[_];let C=(s[_]-a[_])*v,D=(r[_]-a[_])*v;if(C>D){const S=C;C=D,D=S}if(C>h&&(h=C),D<m&&(m=D),h>m)return null}return h}function c_(s,r,a,c,h,m,_,v,C,D,S){const I=c-s,P=h-r,F=m-a,N=_-s,G=v-r,Z=C-a,K=S[1]*Z-S[2]*G,se=S[2]*N-S[0]*Z,le=S[0]*G-S[1]*N,he=I*K+P*se+F*le;if(Math.abs(he)<1e-15)return null;const de=1/he,fe=D[0]-s,we=D[1]-r,Me=D[2]-a,ke=(fe*K+we*se+Me*le)*de;if(ke<0||ke>1)return null;const ze=we*F-Me*P,Ce=Me*I-fe*F,Ee=fe*P-we*I,Be=(S[0]*ze+S[1]*Ce+S[2]*Ee)*de;return Be<0||ke+Be>1?null:(N*ze+G*Ce+Z*Ee)*de}function Ov(s,r,a){return(s-r)/(a-r)}function Fv(s,r,a,c,h,m,_,v,C){const D=1<<a,S=m-c,I=_-h,P=(s+1)/D*S+c,F=(r+0)/D*I+h,N=(r+1)/D*I+h;v[0]=(s+0)/D*S+c,v[1]=F,C[0]=P,C[1]=N}class sm{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(m){const _=Math.ceil(Math.log2(m.dim/8)),v=[];let C=Math.ceil(Math.pow(2,_));const D=1/C,S=(F,N,G,Z,K)=>{const se=Z?1:0,le=(F+1)*G-se,he=N*G,de=(N+1)*G-se;K[0]=F*G,K[1]=he,K[2]=le,K[3]=de};let I=new io(C);const P=[];for(let F=0;F<C*C;F++){S(F%C,Math.floor(F/C),D,!1,P);const N=Ml(P[0],P[1],m),G=Ml(P[2],P[1],m),Z=Ml(P[2],P[3],m),K=Ml(P[0],P[3],m);I.minimums.push(Math.min(N,G,Z,K)),I.maximums.push(Math.max(N,G,Z,K)),I.leaves.push(1)}for(v.push(I),C/=2;C>=1;C/=2){const F=v[v.length-1];I=new io(C);for(let N=0;N<C*C;N++){S(N%C,Math.floor(N/C),2,!0,P);const G=F.getElevation(P[0],P[1]),Z=F.getElevation(P[2],P[1]),K=F.getElevation(P[2],P[3]),se=F.getElevation(P[0],P[3]),le=F.isLeaf(P[0],P[1]),he=F.isLeaf(P[2],P[1]),de=F.isLeaf(P[2],P[3]),fe=F.isLeaf(P[0],P[3]),we=Math.min(G.min,Z.min,K.min,se.min),Me=Math.max(G.max,Z.max,K.max,se.max),ke=le&&he&&de&&fe;I.maximums.push(Me),I.minimums.push(we),I.leaves.push(Me-we<=5&&ke?1:0)}v.push(I)}return v}(this.dem),c=a.length-1,h=a[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(a,0,0,c,0)}raycastRoot(r,a,c,h,m,_,v=1){return l_([r,a,-100],[c,h,this.maximums[0]*v],m,_)}raycast(r,a,c,h,m,_,v=1){if(!this.nodeCount)return null;const C=this.raycastRoot(r,a,c,h,m,_,v);if(null==C)return null;const D=[],S=[],I=[],P=[],F=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:N,t:G,nodex:Z,nodey:K,depth:se}=F.pop();if(this.leaves[N]){Fv(Z,K,se,r,a,c,h,I,P);const he=1<<se,de=(Z+0)/he,fe=(Z+1)/he,we=(K+0)/he,Me=(K+1)/he,ke=Ml(de,we,this.dem)*v,ze=Ml(fe,we,this.dem)*v,Ce=Ml(fe,Me,this.dem)*v,Ee=Ml(de,Me,this.dem)*v,Be=c_(I[0],I[1],ke,P[0],I[1],ze,P[0],P[1],Ce,m,_),We=c_(P[0],P[1],Ce,I[0],P[1],Ee,I[0],I[1],ke,m,_),$e=Math.min(null!==Be?Be:Number.MAX_VALUE,null!==We?We:Number.MAX_VALUE);if($e!==Number.MAX_VALUE)return $e;{const qe=Ep([],m,_,G);if(Lv(ke,ze,Ee,Ce,Ov(qe[0],I[0],P[0]),Ov(qe[1],I[1],P[1]))>=qe[2])return G}continue}let le=0;for(let he=0;he<this._siblingOffset.length;he++){Fv((Z<<1)+this._siblingOffset[he][0],(K<<1)+this._siblingOffset[he][1],se+1,r,a,c,h,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[N]+he]*v;const de=l_(I,P,m,_);if(null!=de){const fe=de;D[he]=fe;let we=!1;for(let Me=0;Me<le&&!we;Me++)fe>=D[S[Me]]&&(S.splice(Me,0,he),we=!0);we||(S[le]=he),le++}}for(let he=0;he<le;he++){const de=S[he];F.push({idx:this.childOffsets[N]+de,t:D[de],nodex:(Z<<1)+this._siblingOffset[de][0],nodey:(K<<1)+this._siblingOffset[de][1],depth:se+1})}}return null}_addNode(r,a,c){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,c,h,m){if(1===r[h].isLeaf(a,c))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,v=r[_];let C=0,D=0;for(let S=0;S<this._siblingOffset.length;S++){const I=2*a+this._siblingOffset[S][0],P=2*c+this._siblingOffset[S][1],F=v.getElevation(I,P),N=v.isLeaf(I,P),G=this._addNode(F.min,F.max,N);N&&(C|=1<<S),D||(D=G)}for(let S=0;S<this._siblingOffset.length;S++)C&1<<S||this._construct(r,2*a+this._siblingOffset[S][0],2*c+this._siblingOffset[S][1],_,D+S)}}function Lv(s,r,a,c,h,m){return yt(yt(s,a,m),yt(r,c,m),h)}function Ml(s,r,a){const c=a.dim,h=tn(s*c-.5,0,c-1),m=tn(r*c-.5,0,c-1),_=Math.floor(h),v=Math.floor(m),C=Math.min(_+1,c-1),D=Math.min(v+1,c-1);return Lv(a.get(_,v),a.get(C,v),a.get(_,D),a.get(C,D),h-_,m-v)}const Of={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ud{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,c,h=!1,m=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return Tn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2,v=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=c||"mapbox",this.borderReady=h,!h){for(let C=0;C<_;C++)v[this._idx(-1,C)]=v[this._idx(0,C)],v[this._idx(_,C)]=v[this._idx(_-1,C)],v[this._idx(C,-1)]=v[this._idx(C,0)],v[this._idx(C,_)]=v[this._idx(C,_-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(_,-1)]=v[this._idx(_-1,0)],v[this._idx(-1,_)]=v[this._idx(0,_-1)],v[this._idx(_,_)]=v[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new sm(this)}get(r,a,c=!1){c&&(r=tn(r,-1,this.dim),a=tn(a,-1,this.dim));const h=4*this._idx(r,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(r){return Of[r]}get unpackVector(){return Of[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}_unpackMapbox(r,a,c){return(256*r*256+256*a+c)/10-1e4}_unpackTerrarium(r,a,c){return 256*r+a+c/256-32768}static pack(r,a){const c=[0,0,0,0],h=ud.getUnpackVector(a);let m=Math.floor((r+h[3])/h[2]);return c[2]=m%256,m=Math.floor(m/256),c[1]=m%256,m=Math.floor(m/256),c[0]=m,c}getPixels(){return new go({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=a*this.dim,m=a*this.dim+this.dim,_=c*this.dim,v=c*this.dim+this.dim;switch(a){case-1:h=m-1;break;case 1:m=h+1}switch(c){case-1:_=v-1;break;case 1:v=_+1}const C=-a*this.dim,D=-c*this.dim;for(let S=_;S<v;S++)for(let I=h;I<m;I++){const P=4*this._idx(I,S),F=4*this._idx(I+C,S+D);this.pixels[P+0]=r.pixels[F+0],this.pixels[P+1]=r.pixels[F+1],this.pixels[P+2]=r.pixels[F+2],this.pixels[P+3]=r.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}tt(ud,"DEMData"),tt(sm,"DemMinMaxQuadTree",{omit:["dem"]});class zv{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,c){const h=r.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:a,timeout:void 0};if(void 0!==c&&(m.timeout=setTimeout(()=>{this.remove(r,m)},c)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const c=r.wrapped().key,h=void 0===a?0:this.data[c].indexOf(a),m=this.data[c][h];return this.data[c].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const c in this.data)for(const h of this.data[c])r(h.value)||a.push(h);for(const c of a)this.remove(c.value.tileID,c)}}class Bu{constructor(r,a,c){this.func=r,this.mask=a,this.range=c}}Bu.ReadOnly=!1,Bu.ReadWrite=!0,Bu.disabled=new Bu(519,Bu.ReadOnly,[0,1]);class Ff{constructor(r,a,c,h,m,_){this.test=r,this.ref=a,this.mask=c,this.fail=h,this.depthFail=m,this.pass=_}}Ff.disabled=new Ff({func:519,mask:0},0,0,7680,7680,7680);class qs{constructor(r,a,c){this.blendFunction=r,this.blendColor=a,this.mask=c}}qs.Replace=[1,0],qs.disabled=new qs(qs.Replace,lt.transparent,[!1,!1,!1,!1]),qs.unblended=new qs(qs.Replace,lt.transparent,[!0,!0,!0,!0]),qs.alphaBlended=new qs([1,771],lt.transparent,[!0,!0,!0,!0]);class as{constructor(r,a,c){this.enable=r,this.mode=a,this.frontFace=c}}as.disabled=new as(!1,1029,2305),as.backCCW=new as(!0,1029,2305),as.backCW=new as(!0,1029,2304),as.frontCW=new as(!0,1028,2304),as.frontCCW=new as(!0,1028,2305);class Sl extends xt{constructor(r,a,c){super(),this.id=r,this._onlySymbols=c,a.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new zv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Rv,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const a in this._tiles){const c=this._tiles[a];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(r),c.prepare(this.map.style.imageManager)}else for(const a in this._tiles){const c=this._tiles[a];c.upload(r),c.prepare(this.map.style.imageManager)}}getIds(){return $l(this._tiles).map(r=>r.tileID).sort(cm).map(r=>r.key)}getRenderableIds(r){const a=[];for(const c in this._tiles)this._isIdRenderable(+c,r)&&a.push(this._tiles[c]);return r?a.sort((c,h)=>{const m=c.tileID,_=h.tileID,v=new Oe(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),C=new Oe(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||C.y-v.y||C.x-v.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(cm).map(c=>c.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const c=this._tiles[r];c&&("loading"!==c.state&&(c.state=a),this._loadTile(c,this._tileLoaded.bind(this,c,r,a)))}_tileLoaded(r,a,c,h){if(h)if(r.state="errored",404!==h.status)this._source.fire(new pt(h,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=Si.now(),"expired"===c&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new gt("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let h=0;h<a.length;h++){const m=a[h];if(r.neighboringTiles&&r.neighboringTiles[m]){const _=this.getTileByID(m);c(r,_),c(_,r)}}function c(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-h.tileID.canonical.x;const v=m.tileID.canonical.y-h.tileID.canonical.y,C=Math.pow(2,h.tileID.canonical.z),D=m.tileID.key;0===_&&0===v||Math.abs(v)>1||(Math.abs(_)>1&&(1===Math.abs(_+C)?_+=C:1===Math.abs(_-C)&&(_-=C)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,_,v),h.neighboringTiles&&h.neighboringTiles[D]&&(h.neighboringTiles[D].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,c,h){for(const m in this._tiles){let _=this._tiles[m];if(h[m]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>c)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const D=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[D.key],_&&_.hasData()&&(v=D)}let C=v;for(;C.overscaledZ>a;)if(C=C.scaledTo(C.overscaledZ-1),r[C.key]){h[v.key]=v;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=a?c:null}for(let c=r.overscaledZ-1;c>=a;c--){const h=r.scaledTo(c),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const c=Math.ceil(r.width/a)+1,h=Math.ceil(r.height/a)+1,m=Math.floor(c*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const c={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),c[m.tileID.key]=m}this._tiles=c;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(r,a,c){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let h;this.updateCacheSize(r,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new Er(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(h=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(v=>this._source.hasTile(v)))):h=[];const m=this._updateRetainedTiles(h);if(u_(this._source.type)&&0!==h.length){const v={},C={},D=Object.keys(m);for(const I of D){const P=m[I],F=this._tiles[I];if(!F||F.fadeEndTime&&F.fadeEndTime<=Si.now())continue;const N=this.findLoadedParent(P,Math.max(P.overscaledZ-Sl.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),v[N.tileID.key]=N.tileID),C[I]=P}const S=h[h.length-1].overscaledZ;for(const I in this._tiles){const P=this._tiles[I];if(m[I]||!P.hasData())continue;let F=P.tileID;for(;F.overscaledZ>S;){F=F.scaledTo(F.overscaledZ-1);const N=this._tiles[F.key];if(N&&N.hasData()&&C[F.key]){m[I]=P.tileID;break}}}for(const I in v)m[I]||(this._coveredTiles[I]=!0,m[I]=v[I])}for(const v in m)this._tiles[v].clearFadeHold();const _=function(v,C){const D=[];for(const S in v)S in C||D.push(S);return D}(this._tiles,m);for(const v of _){const C=this._tiles[v];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(0===r.length)return a;const c={},h=r.reduce((D,S)=>Math.min(D,S.overscaledZ),1/0),m=r[0].overscaledZ,_=Math.max(m-Sl.maxOverzooming,this._source.minzoom),v=Math.max(m+Sl.maxUnderzooming,this._source.minzoom),C={};for(const D of r){const S=this._addTile(D);a[D.key]=D,S.hasData()||h<this._source.maxzoom&&(C[D.key]=D)}this._retainLoadedChildren(C,h,v,a);for(const D of r){let S=this._tiles[D.key];if(S.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const P=D.children(this._source.maxzoom)[0],F=this.getTile(P);if(F&&F.hasData()){a[P.key]=P;continue}}else{const P=D.children(this._source.maxzoom);if(a[P[0].key]&&a[P[1].key]&&a[P[2].key]&&a[P[3].key])continue}let I=S.wasRequested();for(let P=D.overscaledZ-1;P>=_;--P){const F=D.scaledTo(P);if(c[F.key]||(c[F.key]=!0,S=this.getTile(F),!S&&I&&(S=this._addTile(F)),S&&(a[F.key]=F,I=S.wasRequested(),S.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let c,h=this._tiles[r].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){c=this._loadedParentTiles[h.key];break}a.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;h=m}for(const m of a)this._loadedParentTiles[m]=c}}_addTile(r){let a=this._tiles[r.key];if(a)return this._source.prepareTile&&this._source.prepareTile(a),a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const c=Boolean(a);if(!c){const h=this.map?this.map.painter:null;a=new om(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._source.prepareTile&&this._source.prepareTile(a)||this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,c||this._source.fire(new gt("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=a.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,c){const h=[],m=this.transform;if(!m)return h;for(const _ in this._tiles){const v=this._tiles[_];if(c&&v.clearQueryDebugViz(),v.holdingForFade())continue;const C=r.containsTile(v,m,a);C&&h.push(C)}return h}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(c=>this._tiles[c].tileID);for(const c of a)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(u_(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=Si.now())return!0}return!1}setFeatureState(r,a,c){this._state.updateState(r=r||"_geojsonTileLayer",a,c)}removeFeatureState(r,a,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,c)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,c){const h=this._tiles[r];h&&h.setDependencies(a,c)}reloadTilesForDependencies(r,a){for(const c in this._tiles)this._tiles[c].hasDependency(r,a)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,a))}_preloadTiles(r,a){const c=new Map,h=Array.isArray(r)?r:[r],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const v of h){const C=v.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of C)c.set(D.key,D);this.usedForTerrain&&v.updateElevation(!1)}fs(Array.from(c.values()),(v,C)=>{const D=new om(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,S=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),C(S,D)})},a)}}function cm(s,r){const a=Math.abs(2*s.wrap)-+(s.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||c-a||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function u_(s){return"raster"===s||"image"===s||"video"===s}Sl.maxOverzooming=10,Sl.maxUnderzooming=3;class bo{constructor(r,a,c){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=c}static create(r,a,c){const h=c||r.findDEMTileFor(a);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,v=1<<a.canonical.z-_.canonical.z;return new bo(h,h.tileSize/kt/v,[(a.canonical.x/v-_.canonical.x)*m.dim,(a.canonical.y/v-_.canonical.y)*m.dim])}tileCoordToPixel(r,a){const c=a*this._scale+this._offset[1],h=Math.floor(r*this._scale+this._offset[0]),m=Math.floor(c);return new Oe(h,m)}getElevationAt(r,a,c,h){const m=r*this._scale+this._offset[0],_=a*this._scale+this._offset[1],v=Math.floor(m),C=Math.floor(_),D=this._dem;return h=!!h,c?yt(yt(D.get(v,C,h),D.get(v,C+1,h),_-C),yt(D.get(v+1,C,h),D.get(v+1,C+1,h),_-C),m-v):D.get(v,C,h)}getElevationAtPixel(r,a,c){return this._dem.get(r,a,!!c)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*bu(1,r)*this._dem.stride}}class zf{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new ks(kt,16,0),this.featureIndexArray=new Nn,this.promoteId=a}insert(r,a,c,h,m,_=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,m,_);const C=this.grid;for(let D=0;D<a.length;D++){const S=a[D],I=[1/0,1/0,-1/0,-1/0];for(let P=0;P<S.length;P++){const F=S[P];I[0]=Math.min(I[0],F.x),I[1]=Math.min(I[1],F.y),I[2]=Math.max(I[2],F.x),I[3]=Math.max(I[3],F.y)}I[0]<kt&&I[1]<kt&&I[2]>=0&&I[3]>=0&&C.insert(v,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ec.VectorTile(new Tc(this.rawTileData)).layers,this.sourceLayerCoder=new tm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,c,h){this.loadVTLayers();const m=r.params||{},_=_a(m.filter),v=r.tileResult,C=r.transform,D=v.bufferedTilespaceBounds,S=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(N,G,Z,K)=>cg(v.bufferedTilespaceGeometry,N,G,Z,K));S.sort(Bv);let I=null;C.elevation&&S.length>0&&(I=bo.create(C.elevation,this.tileID));const P={};let F;for(let N=0;N<S.length;N++){const G=S[N];if(G===F)continue;F=G;const Z=this.featureIndexArray.get(G);let K=null;this.loadMatchingFeature(P,Z,_,m.layers,m.availableImages,a,c,h,(se,le,he,de=0)=>(K||(K=Sa(se,this.tileID.canonical,r.tileTransform)),le.queryIntersectsFeature(v,se,he,K,this.z,r.transform,r.pixelPosMatrix,I,de)))}return P}loadMatchingFeature(r,a,c,h,m,_,v,C,D){const{featureIndex:S,bucketIndex:I,sourceLayerIndex:P,layoutVertexArrayOffset:F}=a,N=this.bucketLayerIDs[I];if(h&&!function(se,le){for(let he=0;he<se.length;he++)if(le.indexOf(se[he])>=0)return!0;return!1}(h,N))return;const G=this.sourceLayerCoder.decode(P),Z=this.vtLayers[G].feature(S);if(c.needGeometry){const se=gc(Z,!0);if(!c.filter(new kn(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!c.filter(new kn(this.tileID.overscaledZ),Z))return;const K=this.getId(Z,G);for(let se=0;se<N.length;se++){const le=N[se];if(h&&h.indexOf(le)<0)continue;const he=_[le];if(!he)continue;let de={};void 0!==K&&C&&(de=C.getState(he.sourceLayer||"_geojsonTileLayer",K));const fe=or({},v[le]);fe.paint=h_(fe.paint,he.paint,Z,de,m),fe.layout=h_(fe.layout,he.layout,Z,de,m);const we=!D||D(Z,he,de,F);if(!we)continue;const Me=new Rf(Z,this.z,this.x,this.y,K);Me.layer=fe;let ke=r[le];void 0===ke&&(ke=r[le]=[]),ke.push({featureIndex:S,feature:Me,intersectionZ:we})}}lookupSymbolFeatures(r,a,c,h,m,_,v,C){const D={};this.loadVTLayers();const S=_a(m);for(const I of r)this.loadMatchingFeature(D,{bucketIndex:c,sourceLayerIndex:h,featureIndex:I,layoutVertexArrayOffset:0},S,_,v,C,a);return D}loadFeature(r){const{featureIndex:a,sourceLayerIndex:c}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),m=this.vtFeatures[h];if(m[a])return m[a];const _=this.vtLayers[h].feature(a);return m[a]=_,_}hasLayer(r){for(const a of this.bucketLayerIDs)for(const c of a)if(r===c)return!0;return!1}getId(r,a){let c=r.id;return this.promoteId&&(c=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[a]],"boolean"==typeof c&&(c=Number(c))),c}}function h_(s,r,a,c,h){return Zo(s,(m,_)=>{const v=r instanceof b?r.get(_):null;return v&&v.evaluate?v.evaluate(a,c,h):v})}function Bv(s,r){return r-s}tt(zf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Nv{constructor(r){const a={},c=[];for(const v in r){const C=r[v],D=a[v]={};for(const S in C.glyphs){const I=C.glyphs[+S];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const P=I.metrics.localGlyph?2:1,F={x:0,y:0,w:I.bitmap.width+2*P,h:I.bitmap.height+2*P};c.push(F),D[S]=F}}const{w:h,h:m}=ka(c),_=new yl({width:h||1,height:m||1});for(const v in r){const C=r[v];for(const D in C.glyphs){const S=C.glyphs[+D];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const I=a[v][D],P=S.metrics.localGlyph?2:1;yl.copy(S.bitmap,_,{x:0,y:0},{x:I.x+P,y:I.y+P},S.bitmap)}}this.image=_,this.positions=a}}tt(Nv,"GlyphAtlas");class d_{constructor(r){this.tileID=new Er(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Dl(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,c,h,m){this.status="parsing",this.data=r,this.collisionBoxArray=new Ji;const _=new tm(Object.keys(r.layers).sort()),v=new zf(this.tileID,this.promoteId);v.bucketLayerIDs=[];const C={},D=new rd(256,256),S={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:c},I=a.familiesBySource[this.source];for(const de in I){const fe=r.layers[de];if(!fe)continue;let we=!1,Me=!1;for(const Ce of I[de])"symbol"===Ce[0].type?we=!0:Me=!0;if(!0===this.isSymbolTile&&!we||!1===this.isSymbolTile&&!Me)continue;1===fe.version&&Tn(`Vector tile source "${this.source}" layer "${de}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ke=_.encode(de),ze=[];for(let Ce=0;Ce<fe.length;Ce++){const Ee=fe.feature(Ce),Be=v.getId(Ee,de);ze.push({feature:Ee,id:Be,index:Ce,sourceLayerIndex:ke})}for(const Ce of I[de]){const Ee=Ce[0];void 0!==this.isSymbolTile&&"symbol"===Ee.type!==this.isSymbolTile||Ee.minzoom&&this.zoom<Math.floor(Ee.minzoom)||Ee.maxzoom&&this.zoom>=Ee.maxzoom||"none"!==Ee.visibility&&(um(Ce,this.zoom,c),(C[Ee.id]=Ee.createBucket({index:v.bucketLayerIDs.length,layers:Ce,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ke,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:c})).populate(ze,S,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Ce.map(Be=>Be.id)))}}let P,F,N,G;D.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},K=Zo(S.glyphDependencies,de=>Object.keys(de).map(Number));Object.keys(K).length?h.send("getGlyphs",{uid:this.uid,stacks:K},(de,fe)=>{P||(P=de,F=fe,he.call(this))},void 0,!1,Z):F={};const se=Object.keys(S.iconDependencies);se.length?h.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"icons"},(de,fe)=>{P||(P=de,N=fe,he.call(this))},void 0,!1,Z):N={};const le=Object.keys(S.patternDependencies);function he(){if(P)return m(P);if(F&&N&&G){const de=new Nv(F),fe=new Gp(N,G);for(const we in C){const Me=C[we];Me instanceof Ac?(um(Me.layers,this.zoom,c),os(Me,F,de.positions,N,fe.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Me.hasPattern&&(Me instanceof $h||Me instanceof df||Me instanceof Vh)&&(um(Me.layers,this.zoom,c),Me.addFeatures(S,this.tileID.canonical,fe.patternPositions,c,this.tileTransform))}this.status="done",m(null,{buckets:$l(C).filter(we=>!we.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:de.image,lineAtlas:D,imageAtlas:fe,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?de.positions:null})}}le.length?h.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"patterns"},(de,fe)=>{P||(P=de,G=fe,he.call(this))},void 0,!1,Z):G={},he.call(this)}}function um(s,r,a){const c=new kn(r);for(const h of s)h.recalculate(c,a)}class f_{constructor(r){this.entries={},this.scheduler=r}request(r,a,c,h){const m=this.entries[r]=this.entries[r]||{callbacks:[]};if(m.result){const[_,v]=m.result;return this.scheduler?this.scheduler.add(()=>{h(_,v)},a):h(_,v),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=c((_,v)=>{m.result=[_,v];for(const C of m.callbacks)this.scheduler?this.scheduler.add(()=>{C(_,v)},a):C(_,v);setTimeout(()=>delete this.entries[r],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==h),m.callbacks.length||(m.cancel(),delete this.entries[r]))}}}function p_(s,r,a){const c=JSON.stringify(s.request);return s.data&&(this.deduped.entries[c]={result:[null,s.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},h=>{const m=re(s.request,(_,v,C,D)=>{_?h(_):v&&h(null,{vectorTile:a?void 0:new Ec.VectorTile(new Tc(v)),rawData:v,cacheControl:C,expires:D})});return()=>{m.cancel(),h()}},r)}const hm=Ns(new Float32Array(16));class Il{constructor(r){this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new Jt(0,0)}projectTilePoint(r,a,c){return{x:r,y:a,z:0}}locationPoint(r,a){return r._coordinatePoint(r.locationCoordinate(a),!1)}pixelsPerMeter(r,a){return bu(1,r)*a}farthestPixelDistance(r){return function(a,c){const h=a.fovAboveCenter,m=a.elevation?a.elevation.getMinElevationBelowMSL()*c:0,_=(a._camera.position[2]*a.worldSize-m)/Math.cos(a._pitch),v=Math.sin(h)*_/Math.sin(Math.max(Math.PI/2-a._pitch-h,.01)),C=Math.sin(a._pitch)*v+_;return Math.min(1.01*C,_*(1/a._horizonShift))}(r,r.pixelsPerMeter)}pointCoordinate(r,a,c,h){const m=r.horizonLineFromTop(!1),_=new Oe(a,Math.max(m,c));return r.rayIntersectionCoordinate(r.pointRayIntersection(_,h))}createInversionMatrix(r,a){return hm}createTileMatrix(r,a,c){let h,m,_;const v=c.canonical,C=Ns(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=Dl(v,this);h=1,m=D.x+c.wrap*D.scale,_=D.y,Ia(C,C,[h/D.scale,h/D.scale,r.pixelsPerMeter/a])}else h=a/r.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*c.wrap)*h,_=v.y*h;return no(C,C,[m,_,0]),Ia(C,C,[h/kt,h/kt,1]),C}upVector(r,a,c){return[0,0,1]}upVectorScale(r,a,c){return{metersToTile:1,metersToLabelSpace:1}}}class Vv extends Il{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:Ma(r),y:mc(a),z:0}}unproject(r,a){const c=zo(r),h=oi(a);return new Jt(c,h)}}class Bf extends Il{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,c]=this.parallels=r.parallels||[29.5,45.5],h=Math.sin(nn(a));this.n=(h+Math.sin(nn(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:c,c:h,r0:m}=this,_=nn(r-this.center[0]),v=nn(a),C=Math.sqrt(h-2*c*Math.sin(v))/c;return{x:C*Math.sin(_*c),y:C*Math.cos(_*c)-m,z:0}}unproject(r,a){const{n:c,c:h,r0:m}=this,_=m+a;let v=Math.atan2(r,Math.abs(_))*Math.sign(_);_*c<0&&(v-=Math.PI*Math.sign(r)*Math.sign(_));const C=nn(this.center[0])*c;v=So(v,-Math.PI-C,Math.PI-C);const D=pi(v/c)+this.center[0],S=Math.asin(tn((h-(r*r+_*_)*c*c)/(2*c),-1,1)),I=tn(pi(S),-85.051129,ns);return new Jt(D,I)}}const kc=1.340264,hd=-.081106,Rc=893e-6,Oc=.003796,dd=Math.sqrt(3)/2;class z1 extends Il{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const c=Math.asin(dd*Math.sin(a)),h=c*c,m=h*h*h;return{x:.5*(r*Math.cos(c)/(dd*(kc+3*hd*h+m*(7*Rc+9*Oc*h)))/Math.PI+.5),y:1-.5*(c*(kc+hd*h+m*(Rc+Oc*h))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let c=a=(2*(1-a)-1)*Math.PI,h=c*c,m=h*h*h;for(let S,I,P,F=0;F<12&&(I=c*(kc+hd*h+m*(Rc+Oc*h))-a,P=kc+3*hd*h+m*(7*Rc+9*Oc*h),S=I/P,c=tn(c-S,-Math.PI/3,Math.PI/3),h=c*c,m=h*h*h,!(Math.abs(S)<1e-12));++F);const _=dd*r*(kc+3*hd*h+m*(7*Rc+9*Oc*h))/Math.cos(c),v=Math.asin(Math.sin(c)/dd),C=tn(180*_/Math.PI,-180,180),D=tn(180*v/Math.PI,-85.051129,ns);return new Jt(C,D)}}class B1 extends Il{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const c=360*(r-.5),h=tn(360*(.5-a),-85.051129,ns);return new Jt(c,h)}}const Al=Math.PI/2;function dm(s){return Math.tan((Al+s)/2)}class Uv extends Il{constructor(r){super(r),this.center=r.center||[0,30];const[a,c]=this.parallels=r.parallels||[30,30],h=nn(a),m=nn(c),_=Math.cos(h);this.n=h===m?Math.sin(h):Math.log(_/Math.cos(m))/Math.log(dm(m)/dm(h)),this.f=_*Math.pow(dm(h),this.n)/this.n}project(r,a){a=nn(a),r=nn(r-this.center[0]);const c=1e-6,{n:h,f:m}=this;m>0?a<-Al+c&&(a=-Al+c):a>Al-c&&(a=Al-c);const _=m/Math.pow(dm(a),h),v=_*Math.sin(h*r),C=m-_*Math.cos(h*r);return{x:.5*(v/Math.PI+.5),y:1-.5*(C/Math.PI+.5),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,a=(2*(1-a)-.5)*Math.PI;const{n:c,f:h}=this,m=h-a,_=Math.sign(m),v=Math.sign(c)*Math.sqrt(r*r+m*m);let C=Math.atan2(r,Math.abs(m))*_;m*c<0&&(C-=Math.PI*Math.sign(r)*_);const D=tn(pi(C/c)+this.center[0],-180,180),S=tn(pi(2*Math.atan(Math.pow(h/v,1/c))-Al),-85.051129,ns);return new Jt(D,S)}}const fm=nn(ns);class m_ extends Il{project(r,a){const c=(a=nn(a))*a,h=c*c;return{x:.5*((r=nn(r))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let c=a=(2*(1-a)-1)*Math.PI,h=25,m=0,_=c*c;do{_=c*c;const D=_*_;m=(c*(1.007226+_*(.015085+D*(.028874*_-.044475-.005916*D)))-a)/(1.007226+_*(.045255+D*(.259866*_-.311325-.005916*11*D))),c=tn(c-m,-fm,fm)}while(Math.abs(m)>1e-6&&--h>0);_=c*c;const v=tn(pi(r/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),C=pi(c);return new Jt(v,C)}}const pm=nn(ns);class g_ extends Il{project(r,a){a=nn(a),r=nn(r);const c=Math.cos(a),h=2/Math.PI,m=Math.acos(c*Math.cos(r/2)),_=Math.sin(m)/m,v=.5*(r*h+2*c*Math.sin(r/2)/_)||0,C=.5*(a+Math.sin(a)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(r,a){let c=r=(2*r-.5)*Math.PI,h=a=(2*(1-a)-1)*Math.PI,m=25;const _=1e-6;let v=0,C=0;do{const D=Math.cos(h),S=Math.sin(h),I=2*S*D,P=S*S,F=D*D,N=Math.cos(c/2),G=Math.sin(c/2),Z=2*N*G,K=G*G,se=1-F*N*N,le=se?1/se:0,he=se?Math.acos(D*N)*Math.sqrt(1/se):0,de=.5*(2*he*D*G+2*c/Math.PI)-r,fe=.5*(he*S+h)-a,we=.5*le*(F*K+he*D*N*P)+1/Math.PI,Me=le*(Z*I/4-he*S*G),ke=.125*le*(I*G-he*S*F*Z),ze=.5*le*(P*N+he*K*D)+.5,Ce=Me*ke-ze*we;v=(fe*Me-de*ze)/Ce,C=(de*ke-fe*we)/Ce,c=tn(c-v,-Math.PI,Math.PI),h=tn(h-C,-pm,pm)}while((Math.abs(v)>_||Math.abs(C)>_)&&--m>0);return new Jt(pi(c),pi(h))}}class mm extends Il{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(nn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:c,cosPhi:h}=this;return{x:nn(r)*h*c+.5,y:-Math.sin(nn(a))/h*c+.5,z:0}}unproject(r,a){const{scale:c,cosPhi:h}=this,m=-(a-.5)/c,_=tn(pi((r-.5)/c)/h,-180,180),v=Math.asin(tn(m*h,-1,1)),C=tn(pi(v),-85.051129,ns);return new Jt(_,C)}}f.ARRAY_TYPE=to,f.AUTH_ERR_MSG=Za,f.Aabb=ro,f.Actor=class{constructor(s,r,a){this.target=s,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Ni(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Vi()?s:ft,this.scheduler=new O1}send(s,r,a,c,h=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[_]=a);const v=ta(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:s,hasCallback:!!a,targetMapId:c,mustQueue:h,sourceMapId:this.mapId,data:xa(r,v)},v),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(s){const r=s.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(r.mustQueue||Vi()){const c=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),c&&c.metadata||{type:"message"})}else this.processTask(a,r)}processTask(s,r){if("<response>"===r.type){const a=this.callbacks[s];delete this.callbacks[s],a&&(r.error?a(ac(r.error)):a(null,ac(r.data)))}else{const a=ta(this.globalScope)?void 0:[],c=r.hasCallback?(m,_)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:m?xa(m):null,data:xa(_,a)},a)}:m=>{},h=ac(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,c);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],h.source)[m[1]](h,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.CanonicalTileID=Oa,f.Color=lt,f.ColorMode=qs,f.CullFaceMode=as,f.DEMData=ud,f.DataConstantProperty=E,f.DedupedRequest=f_,f.DepthMode=Bu,f.EXTENT=kt,f.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(!r||s.y<0||s.y>1)return!1;const a=r.getSource().maxzoom,c=1<<a,h=Math.floor(s.x),m=Math.floor((s.x-h)*c),_=Math.floor(s.y*c),v=this.findDEMTileFor(new Er(a,h,a,m,_));return!(!v||!v.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,a=!0){null==r&&(r=null);const c=this._source();if(!c||s.y<0||s.y>1)return r;const h=c.getSource().maxzoom,m=1<<h,_=Math.floor(s.x),v=s.x-_,C=new Er(h,_,h,Math.floor(v*m),Math.floor(s.y*m)),D=this.findDEMTileFor(C);if(!D||!D.dem)return r;const S=D.dem,I=1<<D.tileID.canonical.z,P=(v*I-D.tileID.canonical.x)*S.dim,F=(s.y*I-D.tileID.canonical.y)*S.dim,N=Math.floor(P),G=Math.floor(F);return(a?this.exaggeration():1)*yt(yt(S.get(N,G),S.get(N,G+1),F-G),yt(S.get(N+1,G),S.get(N+1,G+1),F-G),P-N)}getAtTileOffset(s,r,a){const c=1<<s.canonical.z;return this.getAtPointOrZero(new xi(s.wrap+(s.canonical.x+r/kt)/c,(s.canonical.y+a/kt)/c))}getAtTileOffsetFunc(s,r,a,c){return h=>{const m=this.getAtTileOffset(s,h.x,h.y),_=c.upVector(s.canonical,h.x,h.y);return Du(_,_,m*c.upVectorScale(s.canonical,r,a).metersToTile),_}}getForTilePoints(s,r,a,c){const h=bo.create(this,s,c);return!!h&&(r.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],a)}),!0)}getMinMaxForTile(s){const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const a=r.dem.tree,c=r.tileID,h=1<<s.canonical.z-c.canonical.z;let m=s.canonical.x/h-c.canonical.x,_=s.canonical.y/h-c.canonical.y,v=0;for(let C=0;C<s.canonical.z-c.canonical.z&&!a.leaves[v];C++){m*=2,_*=2;const D=2*Math.floor(_)+Math.floor(m);v=a.childOffsets[v]+D,m%=1,_%=1}return{min:this.exaggeration()*a.minimums[v],max:this.exaggeration()*a.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},f.ErrorEvent=pt,f.EvaluationParameters=kn,f.Event=gt,f.Evented=xt,f.FillExtrusionBucket=Vh,f.Frustum=af,f.GLOBE_RADIUS=id,f.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s),this._createAtmosphere(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(s){const r=new ee,a=new it,c=65;for(let h=0;h<c;h++)for(let m=0;m<c;m++)r.emplaceBack(m,h);for(let h=0;h<64;h++)for(let m=0;m<64;m++){const _=h*c+m;a.emplaceBack(_+1,_,_+c),a.emplaceBack(_+c,_+c+1,_+1)}this._gridBuffer=s.createVertexBuffer(r,Pf.members),this._gridIndexBuffer=s.createIndexBuffer(a,!0),this._gridSegments=Vn.simpleSegment(0,0,4225,8192)}_createPoles(s){const r=new it;for(let h=0;h<=64;h++)r.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const a=new _t,c=new _t;this._poleSegments=[];for(let h=0,m=0;h<5;h++){const _=1<<h,v=512*_/Math.PI/2,C=360/_;a.emplaceBack(0,-v,0,0,0,.5,0),c.emplaceBack(0,-v,0,0,0,.5,1);for(let D=0;D<=64;D++){const S=D/64,I=yt(0,C,S),[P,F,N]=Ra(ad,Lu,I,v);a.emplaceBack(P,F,N,0,0,S,0),c.emplaceBack(P,F,N,0,0,S,1)}this._poleSegments.push(Vn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(a,Av,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(c,Av,!1)}_createAtmosphere(s){const r=new At;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const a=new it;a.emplaceBack(0,1,2),a.emplaceBack(2,3,0),this.atmosphereVertexBuffer=s.createVertexBuffer(r,L1.members),this.atmosphereIndexBuffer=s.createIndexBuffer(a),this.atmosphereSegments=Vn.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s){if(!this._wireframeSegments){const r=new vt,a=64,c=a+1;for(let h=0;h<a;h++)for(let m=0;m<a;m++){const _=h*c+m;r.emplaceBack(_,_+1),r.emplaceBack(_,_+c),r.emplaceBack(_,_+c+1)}this._wireframeIndexBuffer=s.createIndexBuffer(r),this._wireframeSegments=Vn.simpleSegment(0,0,a*a,r.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},f.GlyphManager=Ru,f.ImagePosition=gf,f.LineAtlas=rd,f.LngLat=Jt,f.LngLatBounds=_l,f.LocalGlyphMode=yo,f.MAX_MERCATOR_LATITUDE=ns,f.MercatorCoordinate=xi,f.ONE_EM=24,f.OverscaledTileID=Er,f.Properties=B,f.RGBAImage=go,f.Ray=class{constructor(s,r){this.pos=s,this.dir=r}intersectsPlane(s,r,a){const c=Ah(r,this.dir);if(Math.abs(c)<1e-6)return!1;const h=((s[0]-this.pos[0])*r[0]+(s[1]-this.pos[1])*r[1]+(s[2]-this.pos[2])*r[2])/c;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(s,r,a){if(N=(P=this.pos)[0],G=P[1],Z=P[2],K=(F=s)[0],se=F[1],le=F[2],Math.abs(N-K)<=vc*Math.max(1,Math.abs(N),Math.abs(K))&&Math.abs(G-se)<=vc*Math.max(1,Math.abs(G),Math.abs(se))&&Math.abs(Z-le)<=vc*Math.max(1,Math.abs(Z),Math.abs(le))||0===r)return a[0]=a[1]=a[2]=0,!1;var P,F,N,G,Z,K,se,le;const[c,h,m]=this.dir,_=this.pos[0]-s[0],v=this.pos[1]-s[1],C=this.pos[2]-s[2],D=c*c+h*h+m*m,S=2*(_*c+v*h+C*m),I=S*S-4*D*(_*_+v*v+C*C-r*r);if(I<0){const P=Math.max(-S/2,0),F=_+c*P,N=v+h*P,G=C+m*P,Z=Math.hypot(F,N,G);return a[0]=F*r/Z,a[1]=N*r/Z,a[2]=G*r/Z,!1}{const P=(-S-Math.sqrt(I))/(2*D);if(P<0){const F=Math.hypot(_,v,C);return a[0]=_*r/F,a[1]=v*r/F,a[2]=C*r/F,!1}return a[0]=_+c*P,a[1]=v+h*P,a[2]=C+m*P,!0}}},f.RequestManager=class{constructor(s,r,a){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const s=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qa,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!Io(s))return s;const a=ho(s);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!Io(s))return s;const a=ho(s);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(s,r){if(!Io(s))return s;const a=ho(s);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||r)}normalizeSpriteURL(s,r,a,c){const h=ho(s);return Io(s)?(h.path=`/styles/v1${h.path}/sprite${r}${a}`,this._makeAPIURL(h,this._customAccessToken||c)):(h.path+=`${r}${a}`,ia(h))}normalizeTileURL(s,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Io(s))return s;const c=ho(s);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==c.authority&&512===a?"@2x":""}${na.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${fn.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${fn.TILE_URL_VERSION}${c.path}`);const h=this._customAccessToken||function(m){for(const _ of m){const v=_.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(c.params)||fn.ACCESS_TOKEN;return fn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,h)}canonicalizeTileURL(s,r){const a=ho(s);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return s;let c="mapbox://";a.path.match(/^\/raster\/v1\//)?c+=`raster/${a.path.replace(`/${fn.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${a.path.replace(`/${fn.TILE_URL_VERSION}/`,"")}`;let h=a.params;return r&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(c+=`?${h.join("&")}`),c}canonicalizeTileset(s,r){const a=!!r&&Io(r),c=[];for(const h of s.tiles||[])Wa(h)?c.push(this.canonicalizeTileURL(h,a)):c.push(h);return c}_makeAPIURL(s,r){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=ho(fn.API_URL);if(s.protocol=c.protocol,s.authority=c.authority,"http"===s.protocol){const h=s.params.indexOf("secure");h>=0&&s.params.splice(h,1)}if("/"!==c.path&&(s.path=`${c.path}${s.path}`),!fn.REQUIRE_ACCESS_TOKEN)return ia(s);if(r=r||fn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return s.params=s.params.filter(h=>-1===h.indexOf("access_token")),s.params.push(`access_token=${r||""}`),ia(s)}},f.ResourceType=J,f.SegmentVector=Vn,f.SourceCache=Sl,f.StencilMode=Ff,f.StructArrayLayout1ui2=Yt,f.StructArrayLayout2f1f2i16=nt,f.StructArrayLayout2i4=ee,f.StructArrayLayout2ui4=vt,f.StructArrayLayout3f12=Ne,f.StructArrayLayout3ui6=it,f.StructArrayLayout4i8=oe,f.Texture=nd,f.Tile=om,f.Transitionable=p,f.Uniform1f=zr,f.Uniform1i=class extends Qi{constructor(s,r){super(s,r),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},f.Uniform2f=class extends Qi{constructor(s,r){super(s,r),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},f.Uniform3f=class extends Qi{constructor(s,r){super(s,r),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},f.Uniform4f=Xd,f.UniformColor=mu,f.UniformMatrix2f=class extends Qi{constructor(s,r){super(s,r),this.current=yu}set(s){for(let r=0;r<4;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},f.UniformMatrix3f=class extends Qi{constructor(s,r){super(s,r),this.current=_u}set(s){for(let r=0;r<9;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},f.UniformMatrix4f=class extends Qi{constructor(s,r){super(s,r),this.current=gu}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let r=1;r<16;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},f.UnwrappedTileID=zu,f.ValidationError=Ye,f.VectorTileWorkerSource=class extends xt{constructor(s,r,a,c,h){super(),this.actor=s,this.layerIndex=r,this.availableImages=a,this.loadVectorData=h||p_,this.loading={},this.loaded={},this.deduped=new f_(s.scheduler),this.isSpriteLoaded=c,this.scheduler=s.scheduler}loadTile(s,r){const a=s.uid,c=s&&s.request,h=c&&c.collectResourceTiming,m=this.loading[a]=new d_(s);m.abort=this.loadVectorData(s,(_,v)=>{const C=!this.loading[a];if(delete this.loading[a],C||_||!v)return m.status="done",C||(this.loaded[a]=m),r(_);const D=v.rawData,S={};v.expires&&(S.expires=v.expires),v.cacheControl&&(S.cacheControl=v.cacheControl),m.vectorTile=v.vectorTile||new Ec.VectorTile(new Tc(D));const I=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,F)=>{if(P||!F)return r(P);const N={};if(h){const G=Iv(c);G.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(G)))}r(null,or({rawTileData:D.slice(0)},F,S,N))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[a]=m})}reloadTile(s,r){const a=this.loaded,c=s.uid,h=this;if(a&&a[c]){const m=a[c];m.showCollisionBoxes=s.showCollisionBoxes,m.enableTerrain=!!s.enableTerrain,m.projection=s.projection,m.tileTransform=Dl(s.tileID.canonical,s.projection);const _=(v,C)=>{const D=m.reloadCallback;D&&(delete m.reloadCallback,m.parse(m.vectorTile,h.layerIndex,this.availableImages,h.actor,D)),r(v,C)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(s,r){const a=s.uid,c=this.loading[a];c&&(c.abort&&c.abort(),delete this.loading[a]),r()}removeTile(s,r){const a=this.loaded,c=s.uid;a&&a[c]&&delete a[c],r()}},f.WritingMode=_o,f.ZoomHistory=Yn,f.add=dg,f.addDynamicAttributes=Ou,f.adjoint=function(s,r){var a=r[0],c=r[1],h=r[2],m=r[3],_=r[4],v=r[5],C=r[6],D=r[7],S=r[8];return s[0]=_*S-v*D,s[1]=h*D-c*S,s[2]=c*v-h*_,s[3]=v*C-m*S,s[4]=a*S-h*C,s[5]=h*m-a*v,s[6]=m*D-_*C,s[7]=c*C-a*D,s[8]=a*_-c*m,s},f.asyncAll=fs,f.bezier=Di,f.bindAll=Ni,f.boundsAttributes=a_,f.bufferConvexPolygon=function(s,r){const a=[];for(let c=0;c<s.length;c++){const h=So(c-1,-1,s.length-1),m=So(c+1,-1,s.length-1),_=s[c],v=s[m],C=s[h].sub(_).unit(),D=v.sub(_).unit(),S=D.angleWithSep(C.x,C.y),I=C.add(D).unit().mult(-1*r/Math.sin(S/2));a.push(_.add(I))}return a},f.cacheEntryPossiblyAdded=function(s){aa++,aa>oa&&(s.getActor().send("enforceCacheSizeLimit",gs),aa=0)},f.calculateGlobeLabelMatrix=function(s,r){const{lng:a,lat:c}=s._center,h=em(0,0,s.worldSize/s._projectionScaler,a,c);return Cu(h,h,function(m){const _=Ns(new Float64Array(16)),v=1/sd(m);return no(_,_,m.min),Ia(_,_,[v,v,v]),_}(Fu(r)))},f.calculateGlobeMatrix=o_,f.calculateGlobeMercatorMatrix=function(s){const r=s.worldSize,a=s.point,c=bu(1,s.center.lat)*r,h=s.pixelsPerMeter,m=r/(c/s.pixelsPerMeter),_=Ns(new Float64Array(16));return no(_,_,[a.x,a.y,0]),Ia(_,_,[m,m,h]),Float32Array.from(_)},f.circumferenceAtLatitude=xu,f.clamp=tn,f.clearTileCache=function(s){const r=ft.caches.delete(Wl);s&&r.catch(s).then(()=>s())},f.clipLine=qg,f.clone=function(s){var r=new to(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},f.clone$1=Mi,f.collisionCircleLayout=Us,f.config=fn,f.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},f.create=function(){var s=new to(16);return to!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},f.create$1=ug,f.createExpression=Fo,f.createLayout=ne,f.createStyleLayer=function(s){return"custom"===s.type?new Sv(s):new t_[s.type](s)},f.cross=pg,f.degToRad=nn,f.div=function(s,r,a){return s[0]=r[0]/a[0],s[1]=r[1]/a[1],s[2]=r[2]/a[2],s},f.dot=Ah,f.earthRadius=eo,f.ease=Ti,f.easeCubicInOut=Go,f.emitValidationErrors=lu,f.endsWith=qo,f.enforceCacheSizeLimit=function(s){sa(),Ui&&Ui.then(r=>{r.keys().then(a=>{for(let c=0;c<a.length-s;c++)r.delete(a[c])})})},f.evaluateSizeForFeature=zp,f.evaluateSizeForZoom=Wr,f.evaluateVariableOffset=Yh,f.evented=mo,f.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},f.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},f.exported=Si,f.exported$1=na,f.extend=or,f.extend$1=sn,f.filterObject=Dn,f.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},f.fromQuat=function(s,r){var a=r[0],c=r[1],h=r[2],m=r[3],_=a+a,v=c+c,C=h+h,D=a*_,S=c*_,I=c*v,P=h*_,F=h*v,N=h*C,G=m*_,Z=m*v,K=m*C;return s[0]=1-I-N,s[1]=S+K,s[2]=P-Z,s[3]=0,s[4]=S-K,s[5]=1-D-N,s[6]=F+G,s[7]=0,s[8]=P+Z,s[9]=F-G,s[10]=1-D-I,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},f.fromRotation=function(s,r){var a=Math.sin(r),c=Math.cos(r);return s[0]=c,s[1]=a,s[2]=0,s[3]=-a,s[4]=c,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},f.fromScaling=function(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},f.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return qc[r]},f.getAABBPointSquareDist=function(s,r,a){let c=0;for(let h=0;h<2;++h){const m=a?a[h]:0;s[h]>m&&(c+=(s[h]-m)*(s[h]-m)),r[h]<m&&(c+=(m-r[h])*(m-r[h]))}return c},f.getAnchorAlignment=xf,f.getAnchorJustification=Mf,f.getBounds=function(s){let r=1/0,a=1/0,c=-1/0,h=-1/0;for(const m of s)r=Math.min(r,m.x),a=Math.min(a,m.y),c=Math.max(c,m.x),h=Math.max(h,m.y);return{min:new Oe(r,a),max:new Oe(c,h)}},f.getColumn=function(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]},f.getGridMatrix=function(s,r){const[a,c]=r,h=.015625;return[0,(c[1]-a[1])*h,1<<s.z,(c[0]-a[0])*h,0,s.y,a[0],a[1],h]},f.getImage=Ue,f.getJSON=function(s,r){return W(or(s,{type:"json"}),r)},f.getMapSessionAPI=eh,f.getPerformanceMeasurement=Iv,f.getProjection=function(s){const r=s.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new Vv(s);case"equirectangular":return new B1(s);case"naturalEarth":return new m_(s);case"equalEarth":return new z1(s);case"winkelTripel":return new g_(s);case"albers":return a?new mm(s):new Bf(s);case"lambertConformalConic":return a?new mm(s):new Uv(s)}throw new Error(`Invalid projection name: ${s.name}`)},f.getRTLTextPluginStatus=fu,f.getReferrer=V,f.getTilePoint=function(s,{x:r,y:a},c=0){return new Oe(((r-c)*s.scale-s.x)*kt,(a*s.scale-s.y)*kt)},f.getTileVec3=function(s,r,a=0){return Ih(((r.x-a)*s.scale-s.x)*kt,(r.y*s.scale-s.y)*kt,By(r.z,r.y))},f.getVideo=function(s,r){const a=ft.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let c=0;c<s.length;c++){const h=ft.document.createElement("source");_e(s[c])||(a.crossOrigin="Anonymous"),h.src=s[c],a.appendChild(h)}return{cancel:()=>{}}},f.globeECEFOrigin=function(s,r){const a=[0,0,0];return wc(a,a,i_(Fu(r.canonical))),wc(a,a,s),a},f.globePixelsToTileUnits=function(s,r){return kt/(512*Math.pow(2,s))*sd(Fu(r))},f.globePoleMatrixForTile=function(s,r,a){const c=Ns(new Float64Array(16)),h=1<<s,m=360*(r/h-.5),_=a.point,v=a.worldSize/(a.tileSize*h);return no(c,c,[_.x,_.y,-a.worldSize/Math.PI/2]),Ia(c,c,[v,v,v]),xc(c,c,nn(-a._center.lat)),bp(c,c,nn(-a._center.lng+m)),Float32Array.from(c)},f.globeTileLatLngCorners=Qp,f.globeToMercatorTransition=function(s){return Js(5,6,s)},f.identity=Ns,f.identity$1=sf,f.invert=function(s,r){var a=r[0],c=r[1],h=r[2],m=r[3],_=r[4],v=r[5],C=r[6],D=r[7],S=r[8],I=r[9],P=r[10],F=r[11],N=r[12],G=r[13],Z=r[14],K=r[15],se=a*v-c*_,le=a*C-h*_,he=a*D-m*_,de=c*C-h*v,fe=c*D-m*v,we=h*D-m*C,Me=S*G-I*N,ke=S*Z-P*N,ze=S*K-F*N,Ce=I*Z-P*G,Ee=I*K-F*G,Be=P*K-F*Z,We=se*Be-le*Ee+he*Ce+de*ze-fe*ke+we*Me;return We?(s[0]=(v*Be-C*Ee+D*Ce)*(We=1/We),s[1]=(h*Ee-c*Be-m*Ce)*We,s[2]=(G*we-Z*fe+K*de)*We,s[3]=(P*fe-I*we-F*de)*We,s[4]=(C*ze-_*Be-D*ke)*We,s[5]=(a*Be-h*ze+m*ke)*We,s[6]=(Z*he-N*we-K*le)*We,s[7]=(S*we-P*he+F*le)*We,s[8]=(_*Ee-v*ze+D*Me)*We,s[9]=(c*ze-a*Ee-m*Me)*We,s[10]=(N*fe-G*he+K*se)*We,s[11]=(I*he-S*fe-F*se)*We,s[12]=(v*ke-_*Ce-C*Me)*We,s[13]=(a*Ce-c*ke+h*Me)*We,s[14]=(G*le-N*de-Z*se)*We,s[15]=(S*de-I*le+P*se)*We,s):null},f.isMapAuthenticated=function(s){return Wo.has(s)},f.isMapboxURL=Io,f.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!ta(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.latFromMercatorY=oi,f.len=$y,f.length=wp,f.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},f.loadVectorTile=p_,f.makeRequest=W,f.mercatorXfromLng=Ma,f.mercatorYfromLat=mc,f.mercatorZfromAltitude=bu,f.mul=hg,f.mul$1=jy,f.multiply=function(s,r,a){var c=r[0],h=r[1],m=r[2],_=r[3],v=r[4],C=r[5],D=r[6],S=r[7],I=r[8],P=a[0],F=a[1],N=a[2],G=a[3],Z=a[4],K=a[5],se=a[6],le=a[7],he=a[8];return s[0]=P*c+F*_+N*D,s[1]=P*h+F*v+N*S,s[2]=P*m+F*C+N*I,s[3]=G*c+Z*_+K*D,s[4]=G*h+Z*v+K*S,s[5]=G*m+Z*C+K*I,s[6]=se*c+le*_+he*D,s[7]=se*h+le*v+he*S,s[8]=se*m+le*C+he*I,s},f.multiply$1=Cu,f.multiply$2=Eu,f.nextPowerOfTwo=Zc,f.normalize=of,f.normalize$1=function(s,r){var a=r[0],c=r[1],h=r[2],m=r[3],_=a*a+c*c+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),s[0]=a*_,s[1]=c*_,s[2]=h*_,s[3]=m*_,s},f.number=yt,f.ortho=function(s,r,a,c,h,m,_){var v=1/(r-a),C=1/(c-h),D=1/(m-_);return s[0]=-2*v,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*C,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*D,s[11]=0,s[12]=(r+a)*v,s[13]=(h+c)*C,s[14]=(_+m)*D,s[15]=1,s},f.pbf=Tc,f.perspective=function(s,r,a,c,h){var m,_=1/Math.tan(r/2);return s[0]=_/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=_,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=h&&h!==1/0?(s[10]=(h+c)*(m=1/(c-h)),s[14]=2*h*c*m):(s[10]=-1,s[14]=-2*c),s},f.pick=function(s,r){const a={};for(let c=0;c<r.length;c++){const h=r[c];h in s&&(a[h]=s[h])}return a},f.plugin=Yi,f.pointGeometry=Oe,f.polygonIntersectsBox=cg,f.polygonIntersectsPolygon=ef,f.polygonizeBounds=function(s,r,a=0,c=!0){const h=new Oe(a,a),m=s.sub(h),_=r.add(h),v=[m,new Oe(_.x,m.y),_,new Oe(m.x,_.y)];return c&&v.push(m),v},f.posAttributes=Pf,f.postMapLoadEvent=Qu,f.postTurnstileEvent=Ed,f.potpack=ka,f.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},f.radToDeg=pi,f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.registerForPluginStateChange=function(s){return s({pluginStatus:Pn,pluginURL:ur}),mo.on("pluginStateChange",s),s},f.removeAuthState=function(s){Wo.delete(s)},f.renderColorRamp=_g,f.rotateX=xc,f.rotateX$1=Dp,f.rotateY=bp,f.rotateZ=function(s,r,a){var c=Math.sin(a),h=Math.cos(a),m=r[0],_=r[1],v=r[2],C=r[3],D=r[4],S=r[5],I=r[6],P=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=m*h+D*c,s[1]=_*h+S*c,s[2]=v*h+I*c,s[3]=C*h+P*c,s[4]=D*h-m*c,s[5]=S*h-_*c,s[6]=I*h-v*c,s[7]=P*h-C*c,s},f.rotateZ$1=function(s,r,a){a*=.5;var c=r[0],h=r[1],m=r[2],_=r[3],v=Math.sin(a),C=Math.cos(a);return s[0]=c*C+h*v,s[1]=h*C-c*v,s[2]=m*C+_*v,s[3]=_*C-m*v,s},f.scale=Ia,f.scale$1=function(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s[3]=r[3]*a,s},f.scale$2=Du,f.scaleAndAdd=Ep,f.setCacheLimits=function(s,r){gs=s,oa=r},f.setColumn=function(s,r,a){s[4*r+0]=a[0],s[4*r+1]=a[1],s[4*r+2]=a[2],s[4*r+3]=a[3]},f.setRTLTextPlugin=function(s,r,a=!1){if(Pn===qd||Pn===fc||Pn===Zd)throw new Error("setRTLTextPlugin cannot be called multiple times.");ur=Si.resolveURL(s),Pn=qd,ul=r,Ki(),a||Ca()},f.smoothstep=Js,f.spec=xe,f.storeAuthState=function(s,r){r?Wo.add(s):Wo.delete(s)},f.sub=rs,f.subtract=bc,f.symbolSize=Bp,f.tileAABB=function(s,r,a,c,h,m,_,v,C){if("globe"===C.name)return function Jp(s,r,a){const c=r/s.worldSize,h=(Ee,Be)=>{Du(Ee,Ee,c),Du(Be,Be,c)},m=Number.MAX_VALUE,_=[-m,-m,-m],v=[m,m,m],C=o_(s);if(a.z<=1){const Ee=Fu(a).getCorners();for(let Be=0;Be<Ee.length;Be++)wc(Ee[Be],Ee[Be],C),Cp(v,v,Ee[Be]),fg(_,_,Ee[Be]);return h(v,_),new ro(v,_)}const[D,S]=Qp(a),I=new _l;I.setSouthWest([D[1],S[0]]),I.setNorthEast([S[1],D[0]]);const P=[Hs(I.getSouth(),I.getWest()),Hs(I.getSouth(),I.getEast()),Hs(I.getNorth(),I.getEast()),Hs(I.getNorth(),I.getWest())];for(let Ee=0;Ee<P.length;Ee++)wc(P[Ee],P[Ee],C),Cp(v,v,P[Ee]),fg(_,_,P[Ee]);if(I.contains(s.center))return _[2]=0,h(v,_),new ro(v,_);const F=[C[12],C[13],C[14]],N=s.center.lng,G=tn(s.center.lat,-85.051129,ns),Z=[Ma(N),mc(G)],K=I.getCenter().lng,se=tn(I.getCenter().lat,-85.051129,ns),le=[Ma(K),mc(se)];let he=new Array(3),de=0;const fe=Z[0]-le[0],we=Z[1]-le[1];if(Math.abs(fe)>Math.abs(we))de=fe>=0?1:3,he=F;else{de=we>=0?0:2;const Ee=[C[4],C[5],C[6]];let Be;Be=we>=0?-Math.sin(nn(I.getSouth()))*id:-Math.sin(nn(I.getNorth()))*id,he=Ep(he,F,Ee,Be)}const Me=P[de],ke=P[(de+1)%4],ze=new n_(Me,ke,he),Ce=[od(ze,0)||Me[0],od(ze,1)||Me[1],od(ze,2)||Me[2]];return v[2]=Math.min(Me[2],ke[2]),Cp(v,v,Ce),fg(_,_,Ce),h(v,_),new ro(v,_)}(s,r,new Oa(a,c,h));const D=Dl({z:a,x:c,y:h},C);return new ro([(m+D.x/D.scale)*r,r*(D.y/D.scale),_],[(m+D.x2/D.scale)*r,r*(D.y2/D.scale),v])},f.tileTransform=Dl,f.transformMat3=function(s,r,a){var c=r[0],h=r[1],m=r[2];return s[0]=c*a[0]+h*a[3]+m*a[6],s[1]=c*a[1]+h*a[4]+m*a[7],s[2]=c*a[2]+h*a[5]+m*a[8],s},f.transformMat4=wc,f.transformMat4$1=kh,f.transformQuat=Ph,f.translate=no,f.transpose=function(s,r){if(s===r){var a=r[1],c=r[2],h=r[5];s[1]=r[3],s[2]=r[6],s[3]=a,s[5]=r[7],s[6]=c,s[7]=h}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},f.triggerPluginCompletionEvent=hl,f.uniqueId=ja,f.validateCustomStyleLayer=function(s){const r=[],a=s.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===s.render&&r.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},f.validateFilter=s=>_r(va(s)),f.validateFog=s=>_r(jd(s)),f.validateLayer=s=>_r(up(s)),f.validateLight=s=>_r(ki(s)),f.validateSource=s=>_r(Ud(s)),f.validateStyle=sc,f.validateTerrain=s=>_r(uh(s)),f.values=$l,f.vectorTile=Ec,f.version="2.8.2",f.warnOnce=Tn,f.window=ft,f.wrap=So}),Yu(0,function(f){function er(J){if("number"==typeof J||"boolean"==typeof J||"string"==typeof J||null==J)return JSON.stringify(J);if(Array.isArray(J)){let V="[";for(const W of J)V+=`${er(W)},`;return`${V}]`}let z="{";for(const V of Object.keys(J).sort())z+=`${V}:${er(J[V])},`;return`${z}}`}function $o(J){let z="";for(const V of f.refProperties)z+=`/${er(J[V])}`;return z}class fi{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,V){for(const re of z)this._layerConfigs[re.id]=re,(this._layers[re.id]=f.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of V)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const W=function(re,ce){const ge={};for(let ue=0;ue<re.length;ue++){const ye=ce&&ce[re[ue].id]||$o(re[ue]);ce&&(ce[re[ue].id]=ye);let Re=ge[ye];Re||(Re=ge[ye]=[]),Re.push(re[ue])}const _e=[];for(const ue in ge)_e.push(ge[ue]);return _e}(f.values(this._layerConfigs),this.keyCache);for(const re of W){const ce=re.map(Ue=>this._layers[Ue.id]),ge=ce[0];if("none"===ge.visibility)continue;const _e=ge.source||"";let ue=this.familiesBySource[_e];ue||(ue=this.familiesBySource[_e]={});const ye=ge.sourceLayer||"_geojsonTileLayer";let Re=ue[ye];Re||(Re=ue[ye]=[]),Re.push(ce)}}}class Oe{loadTile(z,V){const{uid:W,encoding:re,rawImageData:ce,padding:ge,buildQuadTree:_e}=z,ue=f.window.ImageBitmap&&ce instanceof f.window.ImageBitmap?this.getImageData(ce,ge):ce;V(null,new f.DEMData(W,ue,re,ge<1,_e))}getImageData(z,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const W=this.offscreenCanvasContext.getImageData(-V,-V,z.width+2*V,z.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),W}}var Pt=function J(z,V){var W,re=z&&z.type;if("FeatureCollection"===re)for(W=0;W<z.features.length;W++)J(z.features[W],V);else if("GeometryCollection"===re)for(W=0;W<z.geometries.length;W++)J(z.geometries[W],V);else if("Feature"===re)J(z.geometry,V);else if("Polygon"===re)ft(z.coordinates,V);else if("MultiPolygon"===re)for(W=0;W<z.coordinates.length;W++)ft(z.coordinates[W],V);return z};function ft(J,z){if(0!==J.length){co(J[0],z);for(var V=1;V<J.length;V++)co(J[V],!z)}}function co(J,z){for(var V=0,W=0,re=0,ce=J.length,ge=ce-1;re<ce;ge=re++){var _e=(J[re][0]-J[ge][0])*(J[ge][1]+J[re][1]),ue=V+_e;W+=Math.abs(V)>=Math.abs(_e)?V-ue+_e:_e-ue+V,V=ue}V+W>=0!=!!z&&J.reverse()}const Mo=f.vectorTile.VectorTileFeature.prototype.toGeoJSON;class nn{constructor(z){this._feature=z,this.extent=f.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))}loadGeometry(){if(1===this._feature.type){const z=[];for(const V of this._feature.geometry)z.push([new f.pointGeometry(V[0],V[1])]);return z}{const z=[];for(const V of this._feature.geometry){const W=[];for(const re of V)W.push(new f.pointGeometry(re[0],re[1]));z.push(W)}return z}}toGeoJSON(z,V,W){return Mo.call(this,z,V,W)}}class pi{constructor(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=z.length,this._features=z}feature(z){return new nn(this._features[z])}}var qc=f.vectorTile.VectorTileFeature,Go=Di;function Di(J,z){this.options=z||{},this.features=J,this.length=J.length}function Ti(J,z){this.id="number"==typeof J.id?J.id:void 0,this.type=J.type,this.rawGeometry=1===J.type?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=z||4096}Di.prototype.feature=function(J){return new Ti(this.features[J],this.options.extent)},Ti.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var z=0;z<J.length;z++){for(var V=J[z],W=[],re=0;re<V.length;re++)W.push(new f.pointGeometry(V[re][0],V[re][1]));this.geometry.push(W)}return this.geometry},Ti.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,z=1/0,V=-1/0,W=1/0,re=-1/0,ce=0;ce<J.length;ce++)for(var ge=J[ce],_e=0;_e<ge.length;_e++){var ue=ge[_e];z=Math.min(z,ue.x),V=Math.max(V,ue.x),W=Math.min(W,ue.y),re=Math.max(re,ue.y)}return[z,W,V,re]},Ti.prototype.toGeoJSON=qc.prototype.toGeoJSON;var tn=So,Js=Go;function So(J){var z=new f.pbf;return function(V,W){for(var re in V.layers)W.writeMessage(3,fs,V.layers[re])}(J,z),z.finish()}function fs(J,z){var V;z.writeVarintField(15,J.version||1),z.writeStringField(1,J.name||""),z.writeVarintField(5,J.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<J.length;V++)W.feature=J.feature(V),z.writeMessage(2,$l,W);var re=W.keys;for(V=0;V<re.length;V++)z.writeStringField(3,re[V]);var ce=W.values;for(V=0;V<ce.length;V++)z.writeMessage(4,Zc,ce[V])}function $l(J,z){var V=J.feature;void 0!==V.id&&z.writeVarintField(1,V.id),z.writeMessage(2,or,J),z.writeVarintField(3,V.type),z.writeMessage(4,$a,V)}function or(J,z){var V=J.feature,W=J.keys,re=J.values,ce=J.keycache,ge=J.valuecache;for(var _e in V.properties){var ue=V.properties[_e],ye=ce[_e];if(null!==ue){void 0===ye&&(W.push(_e),ce[_e]=ye=W.length-1),z.writeVarint(ye);var Re=typeof ue;"string"!==Re&&"boolean"!==Re&&"number"!==Re&&(ue=JSON.stringify(ue));var Ue=Re+":"+ue,Le=ge[Ue];void 0===Le&&(re.push(ue),ge[Ue]=Le=re.length-1),z.writeVarint(Le)}}}function ps(J,z){return(z<<3)+(7&J)}function ja(J){return J<<1^J>>31}function $a(J,z){for(var V=J.loadGeometry(),W=J.type,re=0,ce=0,ge=V.length,_e=0;_e<ge;_e++){var ue=V[_e],ye=1;1===W&&(ye=ue.length),z.writeVarint(ps(1,ye));for(var Re=3===W?ue.length-1:ue.length,Ue=0;Ue<Re;Ue++){1===Ue&&1!==W&&z.writeVarint(ps(2,Re-1));var Le=ue[Ue].x-re,ut=ue[Ue].y-ce;z.writeVarint(ja(Le)),z.writeVarint(ja(ut)),re+=Le,ce+=ut}3===W&&z.writeVarint(ps(7,1))}}function Zc(J,z){var V=typeof J;"string"===V?z.writeStringField(1,J):"boolean"===V?z.writeBooleanField(7,J):"number"===V&&(J%1!=0?z.writeDoubleField(3,J):J<0?z.writeSVarintField(6,J):z.writeVarintField(5,J))}function Ho(J,z,V,W,re,ce){if(re-W<=V)return;const ge=W+re>>1;Ni(J,z,ge,W,re,ce%2),Ho(J,z,V,W,ge-1,ce+1),Ho(J,z,V,ge+1,re,ce+1)}function Ni(J,z,V,W,re,ce){for(;re>W;){if(re-W>600){const ye=re-W+1,Re=V-W+1,Ue=Math.log(ye),Le=.5*Math.exp(2*Ue/3),ut=.5*Math.sqrt(Ue*Le*(ye-Le)/ye)*(Re-ye/2<0?-1:1);Ni(J,z,V,Math.max(W,Math.floor(V-Re*Le/ye+ut)),Math.min(re,Math.floor(V+(ye-Re)*Le/ye+ut)),ce)}const ge=z[2*V+ce];let _e=W,ue=re;for(qo(J,z,W,V),z[2*re+ce]>ge&&qo(J,z,W,re);_e<ue;){for(qo(J,z,_e,ue),_e++,ue--;z[2*_e+ce]<ge;)_e++;for(;z[2*ue+ce]>ge;)ue--}z[2*W+ce]===ge?qo(J,z,W,ue):(ue++,qo(J,z,ue,re)),ue<=V&&(W=ue+1),V<=ue&&(re=ue-1)}}function qo(J,z,V,W){Zo(J,V,W),Zo(z,2*V,2*W),Zo(z,2*V+1,2*W+1)}function Zo(J,z,V){const W=J[z];J[z]=J[V],J[V]=W}function Dn(J,z,V,W){const re=J-V,ce=z-W;return re*re+ce*ce}tn.fromVectorTileJs=So,tn.fromGeojsonVt=function(J,z){z=z||{};var V={};for(var W in J)V[W]=new Go(J[W].features,z),V[W].name=W,V[W].version=z.version,V[W].extent=z.extent;return So({layers:V})},tn.GeoJSONWrapper=Js;const Mi=J=>J[0],Wc=J=>J[1];class Tn{constructor(z,V=Mi,W=Wc,re=64,ce=Float64Array){this.nodeSize=re,this.points=z;const ge=z.length<65536?Uint16Array:Uint32Array,_e=this.ids=new ge(z.length),ue=this.coords=new ce(2*z.length);for(let ye=0;ye<z.length;ye++)_e[ye]=ye,ue[2*ye]=V(z[ye]),ue[2*ye+1]=W(z[ye]);Ho(_e,ue,re,0,_e.length-1,0)}range(z,V,W,re){return function(ce,ge,_e,ue,ye,Re,Ue){const Le=[0,ce.length-1,0],ut=[];let gt,pt;for(;Le.length;){const xt=Le.pop(),xe=Le.pop(),sn=Le.pop();if(xe-sn<=Ue){for(let ln=sn;ln<=xe;ln++)gt=ge[2*ln],pt=ge[2*ln+1],gt>=_e&&gt<=ye&&pt>=ue&&pt<=Re&&ut.push(ce[ln]);continue}const rt=Math.floor((sn+xe)/2);gt=ge[2*rt],pt=ge[2*rt+1],gt>=_e&&gt<=ye&&pt>=ue&&pt<=Re&&ut.push(ce[rt]);const an=(xt+1)%2;(0===xt?_e<=gt:ue<=pt)&&(Le.push(sn),Le.push(rt-1),Le.push(an)),(0===xt?ye>=gt:Re>=pt)&&(Le.push(rt+1),Le.push(xe),Le.push(an))}return ut}(this.ids,this.coords,z,V,W,re,this.nodeSize)}within(z,V,W){return function(re,ce,ge,_e,ue,ye){const Re=[0,re.length-1,0],Ue=[],Le=ue*ue;for(;Re.length;){const ut=Re.pop(),gt=Re.pop(),pt=Re.pop();if(gt-pt<=ye){for(let an=pt;an<=gt;an++)Dn(ce[2*an],ce[2*an+1],ge,_e)<=Le&&Ue.push(re[an]);continue}const xt=Math.floor((pt+gt)/2),xe=ce[2*xt],sn=ce[2*xt+1];Dn(xe,sn,ge,_e)<=Le&&Ue.push(re[xt]);const rt=(ut+1)%2;(0===ut?ge-ue<=xe:_e-ue<=sn)&&(Re.push(pt),Re.push(xt-1),Re.push(rt)),(0===ut?ge+ue>=xe:_e+ue>=sn)&&(Re.push(xt+1),Re.push(gt),Re.push(rt))}return Ue}(this.ids,this.coords,z,V,W,this.nodeSize)}}const Gr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},br=Math.fround||(Vi=new Float32Array(1),J=>(Vi[0]=+J,Vi[0]));var Vi;class Qs{constructor(z){this.options=Si(Object.create(Gr),z),this.trees=new Array(this.options.maxZoom+1)}load(z){const{log:V,minZoom:W,maxZoom:re,nodeSize:ce}=this.options;V&&console.time("total time");const ge=`prepare ${z.length} points`;V&&console.time(ge),this.points=z;let _e=[];for(let ue=0;ue<z.length;ue++)z[ue].geometry&&_e.push(tr(z[ue],ue));this.trees[re+1]=new Tn(_e,Ga,fn,ce,Float32Array),V&&console.timeEnd(ge);for(let ue=re;ue>=W;ue--){const ye=+Date.now();_e=this._cluster(_e,ue),this.trees[ue]=new Tn(_e,Ga,fn,ce,Float32Array),V&&console.log("z%d: %d clusters in %dms",ue,_e.length,+Date.now()-ye)}return V&&console.timeEnd("total time"),this}getClusters(z,V){let W=((z[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,z[1]));let ce=180===z[2]?180:((z[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)W=-180,ce=180;else if(W>ce){const Re=this.getClusters([W,re,180,ge],V),Ue=this.getClusters([-180,re,ce,ge],V);return Re.concat(Ue)}const _e=this.trees[this._limitZoom(V)],ue=_e.range(qt(W),ta(ge),qt(ce),ta(re)),ye=[];for(const Re of ue){const Ue=_e.points[Re];ye.push(Ue.numPoints?ea(Ue):this.points[Ue.index])}return ye}getChildren(z){const V=this._getOriginId(z),W=this._getOriginZoom(z),re="No cluster with the specified id.",ce=this.trees[W];if(!ce)throw new Error(re);const ge=ce.points[V];if(!ge)throw new Error(re);const _e=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ue=ce.within(ge.x,ge.y,_e),ye=[];for(const Re of ue){const Ue=ce.points[Re];Ue.parentId===z&&ye.push(Ue.numPoints?ea(Ue):this.points[Ue.index])}if(0===ye.length)throw new Error(re);return ye}getLeaves(z,V,W){const re=[];return this._appendLeaves(re,z,V=V||10,W=W||0,0),re}getTile(z,V,W){const re=this.trees[this._limitZoom(z)],ce=Math.pow(2,z),{extent:ge,radius:_e}=this.options,ue=_e/ge,ye=(W-ue)/ce,Re=(W+1+ue)/ce,Ue={features:[]};return this._addTileFeatures(re.range((V-ue)/ce,ye,(V+1+ue)/ce,Re),re.points,V,W,ce,Ue),0===V&&this._addTileFeatures(re.range(1-ue/ce,ye,1,Re),re.points,ce,W,ce,Ue),V===ce-1&&this._addTileFeatures(re.range(0,ye,ue/ce,Re),re.points,-1,W,ce,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(z){let V=this._getOriginZoom(z)-1;for(;V<=this.options.maxZoom;){const W=this.getChildren(z);if(V++,1!==W.length)break;z=W[0].properties.cluster_id}return V}_appendLeaves(z,V,W,re,ce){const ge=this.getChildren(V);for(const _e of ge){const ue=_e.properties;if(ue&&ue.cluster?ce+ue.point_count<=re?ce+=ue.point_count:ce=this._appendLeaves(z,ue.cluster_id,W,re,ce):ce<re?ce++:z.push(_e),z.length===W)break}return ce}_addTileFeatures(z,V,W,re,ce,ge){for(const _e of z){const ue=V[_e],ye=ue.numPoints;let Re,Ue,Le;if(ye)Re=Ot(ue),Ue=ue.x,Le=ue.y;else{const pt=this.points[ue.index];Re=pt.properties,Ue=qt(pt.geometry.coordinates[0]),Le=ta(pt.geometry.coordinates[1])}const ut={type:1,geometry:[[Math.round(this.options.extent*(Ue*ce-W)),Math.round(this.options.extent*(Le*ce-re))]],tags:Re};let gt;ye?gt=ue.id:this.options.generateId?gt=ue.index:this.points[ue.index].id&&(gt=this.points[ue.index].id),void 0!==gt&&(ut.id=gt),ge.features.push(ut)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(+z,this.options.maxZoom+1))}_cluster(z,V){const W=[],{radius:re,extent:ce,reduce:ge,minPoints:_e}=this.options,ue=re/(ce*Math.pow(2,V));for(let ye=0;ye<z.length;ye++){const Re=z[ye];if(Re.zoom<=V)continue;Re.zoom=V;const Ue=this.trees[V+1],Le=Ue.within(Re.x,Re.y,ue),ut=Re.numPoints||1;let gt=ut;for(const pt of Le){const xt=Ue.points[pt];xt.zoom>V&&(gt+=xt.numPoints||1)}if(gt>ut&&gt>=_e){let pt=Re.x*ut,xt=Re.y*ut,xe=ge&&ut>1?this._map(Re,!0):null;const sn=(ye<<5)+(V+1)+this.points.length;for(const rt of Le){const an=Ue.points[rt];if(an.zoom<=V)continue;an.zoom=V;const ln=an.numPoints||1;pt+=an.x*ln,xt+=an.y*ln,an.parentId=sn,ge&&(xe||(xe=this._map(Re,!0)),ge(xe,this._map(an)))}Re.parentId=sn,W.push($n(pt/gt,xt/gt,sn,gt,xe))}else if(W.push(Re),gt>1)for(const pt of Le){const xt=Ue.points[pt];xt.zoom<=V||(xt.zoom=V,W.push(xt))}}return W}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,V){if(z.numPoints)return V?Si({},z.properties):z.properties;const W=this.points[z.index].properties,re=this.options.map(W);return V&&re===W?Si({},re):re}}function $n(J,z,V,W,re){return{x:br(J),y:br(z),zoom:1/0,id:V,parentId:-1,numPoints:W,properties:re}}function tr(J,z){const[V,W]=J.geometry.coordinates;return{x:br(qt(V)),y:br(ta(W)),zoom:1/0,index:z,parentId:-1}}function ea(J){return{type:"Feature",id:J.id,properties:Ot(J),geometry:{type:"Point",coordinates:[(z=J.x,360*(z-.5)),Gl(J.y)]}};var z}function Ot(J){const z=J.numPoints,V=z>=1e4?`${Math.round(z/1e3)}k`:z>=1e3?Math.round(z/100)/10+"k":z;return Si(Si({},J.properties),{cluster:!0,cluster_id:J.id,point_count:z,point_count_abbreviated:V})}function qt(J){return J/360+.5}function ta(J){const z=Math.sin(J*Math.PI/180),V=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return V<0?0:V>1?1:V}function Gl(J){const z=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function Si(J,z){for(const V in z)J[V]=z[V];return J}function Ga(J){return J.x}function fn(J){return J.y}function na(J,z,V,W){for(var re,ce=W,ge=V-z>>1,_e=V-z,ue=J[z],ye=J[z+1],Re=J[V],Ue=J[V+1],Le=z+3;Le<V;Le+=3){var ut=ra(J[Le],J[Le+1],ue,ye,Re,Ue);if(ut>ce)re=Le,ce=ut;else if(ut===ce){var gt=Math.abs(Le-ge);gt<_e&&(re=Le,_e=gt)}}ce>W&&(re-z>3&&na(J,z,re,W),J[re+2]=ce,V-re>3&&na(J,re,V,W))}function ra(J,z,V,W,re,ce){var ge=re-V,_e=ce-W;if(0!==ge||0!==_e){var ue=((J-V)*ge+(z-W)*_e)/(ge*ge+_e*_e);ue>1?(V=re,W=ce):ue>0&&(V+=ge*ue,W+=_e*ue)}return(ge=J-V)*ge+(_e=z-W)*_e}function uo(J,z,V,W){var re={id:void 0===J?null:J,type:z,geometry:V,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var ge=ce.geometry,_e=ce.type;if("Point"===_e||"MultiPoint"===_e||"LineString"===_e)ms(ce,ge);else if("Polygon"===_e||"MultiLineString"===_e)for(var ue=0;ue<ge.length;ue++)ms(ce,ge[ue]);else if("MultiPolygon"===_e)for(ue=0;ue<ge.length;ue++)for(var ye=0;ye<ge[ue].length;ye++)ms(ce,ge[ue][ye])}(re),re}function ms(J,z){for(var V=0;V<z.length;V+=3)J.minX=Math.min(J.minX,z[V]),J.minY=Math.min(J.minY,z[V+1]),J.maxX=Math.max(J.maxX,z[V]),J.maxY=Math.max(J.maxY,z[V+1])}function Hl(J,z,V,W){if(z.geometry){var re=z.geometry.coordinates,ce=z.geometry.type,ge=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),_e=[],ue=z.id;if(V.promoteId?ue=z.properties[V.promoteId]:V.generateId&&(ue=W||0),"Point"===ce)Ha(re,_e);else if("MultiPoint"===ce)for(var ye=0;ye<re.length;ye++)Ha(re[ye],_e);else if("LineString"===ce)qa(re,_e,ge,!1);else if("MultiLineString"===ce){if(V.lineMetrics){for(ye=0;ye<re.length;ye++)qa(re[ye],_e=[],ge,!1),J.push(uo(ue,"LineString",_e,z.properties));return}Za(re,_e,ge,!1)}else if("Polygon"===ce)Za(re,_e,ge,!0);else{if("MultiPolygon"!==ce){if("GeometryCollection"===ce){for(ye=0;ye<z.geometry.geometries.length;ye++)Hl(J,{id:ue,geometry:z.geometry.geometries[ye],properties:z.properties},V,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<re.length;ye++){var Re=[];Za(re[ye],Re,ge,!0),_e.push(Re)}}J.push(uo(ue,ce,_e,z.properties))}}function Ha(J,z){z.push(Io(J[0])),z.push(Wa(J[1])),z.push(0)}function qa(J,z,V,W){for(var re,ce,ge=0,_e=0;_e<J.length;_e++){var ue=Io(J[_e][0]),ye=Wa(J[_e][1]);z.push(ue),z.push(ye),z.push(0),_e>0&&(ge+=W?(re*ye-ue*ce)/2:Math.sqrt(Math.pow(ue-re,2)+Math.pow(ye-ce,2))),re=ue,ce=ye}var Re=z.length-3;z[2]=1,na(z,0,Re,V),z[Re+2]=1,z.size=Math.abs(ge),z.start=0,z.end=z.size}function Za(J,z,V,W){for(var re=0;re<J.length;re++){var ce=[];qa(J[re],ce,V,W),z.push(ce)}}function Io(J){return J/360+.5}function Wa(J){var z=Math.sin(J*Math.PI/180),V=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return V<0?0:V>1?1:V}function Or(J,z,V,W,re,ce,ge,_e){if(W/=z,ce>=(V/=z)&&ge<W)return J;if(ge<V||ce>=W)return null;for(var ue=[],ye=0;ye<J.length;ye++){var Re=J[ye],Ue=Re.geometry,Le=Re.type,ut=0===re?Re.minX:Re.minY,gt=0===re?Re.maxX:Re.maxY;if(ut>=V&&gt<W)ue.push(Re);else if(!(gt<V||ut>=W)){var pt=[];if("Point"===Le||"MultiPoint"===Le)ho(Ue,pt,V,W,re);else if("LineString"===Le)ia(Ue,pt,V,W,re,!1,_e.lineMetrics);else if("MultiLineString"===Le)Xa(Ue,pt,V,W,re,!1);else if("Polygon"===Le)Xa(Ue,pt,V,W,re,!0);else if("MultiPolygon"===Le)for(var xt=0;xt<Ue.length;xt++){var xe=[];Xa(Ue[xt],xe,V,W,re,!0),xe.length&&pt.push(xe)}if(pt.length){if(_e.lineMetrics&&"LineString"===Le){for(xt=0;xt<pt.length;xt++)ue.push(uo(Re.id,Le,pt[xt],Re.tags));continue}"LineString"!==Le&&"MultiLineString"!==Le||(1===pt.length?(Le="LineString",pt=pt[0]):Le="MultiLineString"),"Point"!==Le&&"MultiPoint"!==Le||(Le=3===pt.length?"Point":"MultiPoint"),ue.push(uo(Re.id,Le,pt,Re.tags))}}}return ue.length?ue:null}function ho(J,z,V,W,re){for(var ce=0;ce<J.length;ce+=3){var ge=J[ce+re];ge>=V&&ge<=W&&(z.push(J[ce]),z.push(J[ce+1]),z.push(J[ce+2]))}}function ia(J,z,V,W,re,ce,ge){for(var _e,ue,ye=ql(J),Re=0===re?Ed:Ju,Ue=J.start,Le=0;Le<J.length-3;Le+=3){var ut=J[Le],gt=J[Le+1],pt=J[Le+2],xt=J[Le+3],xe=J[Le+4],sn=0===re?ut:gt,rt=0===re?xt:xe,an=!1;ge&&(_e=Math.sqrt(Math.pow(ut-xt,2)+Math.pow(gt-xe,2))),sn<V?rt>V&&(ue=Re(ye,ut,gt,xt,xe,V),ge&&(ye.start=Ue+_e*ue)):sn>W?rt<W&&(ue=Re(ye,ut,gt,xt,xe,W),ge&&(ye.start=Ue+_e*ue)):Ka(ye,ut,gt,pt),rt<V&&sn>=V&&(ue=Re(ye,ut,gt,xt,xe,V),an=!0),rt>W&&sn<=W&&(ue=Re(ye,ut,gt,xt,xe,W),an=!0),!ce&&an&&(ge&&(ye.end=Ue+_e*ue),z.push(ye),ye=ql(J)),ge&&(Ue+=_e)}var ln=J.length-3;ut=J[ln],gt=J[ln+1],pt=J[ln+2],(sn=0===re?ut:gt)>=V&&sn<=W&&Ka(ye,ut,gt,pt),ln=ye.length-3,ce&&ln>=3&&(ye[ln]!==ye[0]||ye[ln+1]!==ye[1])&&Ka(ye,ye[0],ye[1],ye[2]),ye.length&&z.push(ye)}function ql(J){var z=[];return z.size=J.size,z.start=J.start,z.end=J.end,z}function Xa(J,z,V,W,re,ce){for(var ge=0;ge<J.length;ge++)ia(J[ge],z,V,W,re,ce,!1)}function Ka(J,z,V,W){J.push(z),J.push(V),J.push(W)}function Ed(J,z,V,W,re,ce){var ge=(ce-z)/(W-z);return J.push(ce),J.push(V+(re-V)*ge),J.push(1),ge}function Ju(J,z,V,W,re,ce){var ge=(ce-V)/(re-V);return J.push(z+(W-z)*ge),J.push(ce),J.push(1),ge}function Qu(J,z){for(var V=[],W=0;W<J.length;W++){var re,ce=J[W],ge=ce.type;if("Point"===ge||"MultiPoint"===ge||"LineString"===ge)re=Zl(ce.geometry,z);else if("MultiLineString"===ge||"Polygon"===ge){re=[];for(var _e=0;_e<ce.geometry.length;_e++)re.push(Zl(ce.geometry[_e],z))}else if("MultiPolygon"===ge)for(re=[],_e=0;_e<ce.geometry.length;_e++){for(var ue=[],ye=0;ye<ce.geometry[_e].length;ye++)ue.push(Zl(ce.geometry[_e][ye],z));re.push(ue)}V.push(uo(ce.id,ge,re,ce.tags))}return V}function Zl(J,z){var V=[];V.size=J.size,void 0!==J.start&&(V.start=J.start,V.end=J.end);for(var W=0;W<J.length;W+=3)V.push(J[W]+z,J[W+1],J[W+2]);return V}function eh(J,z){if(J.transformed)return J;var V,W,re,ce=1<<J.z,ge=J.x,_e=J.y;for(V=0;V<J.features.length;V++){var ue=J.features[V],ye=ue.geometry,Re=ue.type;if(ue.geometry=[],1===Re)for(W=0;W<ye.length;W+=2)ue.geometry.push(Wo(ye[W],ye[W+1],z,ce,ge,_e));else for(W=0;W<ye.length;W++){var Ue=[];for(re=0;re<ye[W].length;re+=2)Ue.push(Wo(ye[W][re],ye[W][re+1],z,ce,ge,_e));ue.geometry.push(Ue)}}return J.transformed=!0,J}function Wo(J,z,V,W,re,ce){return[Math.round(V*(J*W-re)),Math.round(V*(z*W-ce))]}function Wl(J,z,V,W,re){for(var ce=z===re.maxZoom?0:re.tolerance/((1<<z)*re.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:W,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<J.length;_e++){ge.numFeatures++,Ui(ge,J[_e],ce,re);var ue=J[_e].minX,ye=J[_e].minY,Re=J[_e].maxX,Ue=J[_e].maxY;ue<ge.minX&&(ge.minX=ue),ye<ge.minY&&(ge.minY=ye),Re>ge.maxX&&(ge.maxX=Re),Ue>ge.maxY&&(ge.maxY=Ue)}return ge}function Ui(J,z,V,W){var re=z.geometry,ce=z.type,ge=[];if("Point"===ce||"MultiPoint"===ce)for(var _e=0;_e<re.length;_e+=3)ge.push(re[_e]),ge.push(re[_e+1]),J.numPoints++,J.numSimplified++;else if("LineString"===ce)Xo(ge,re,J,V,!1,!1);else if("MultiLineString"===ce||"Polygon"===ce)for(_e=0;_e<re.length;_e++)Xo(ge,re[_e],J,V,"Polygon"===ce,0===_e);else if("MultiPolygon"===ce)for(var ue=0;ue<re.length;ue++){var ye=re[ue];for(_e=0;_e<ye.length;_e++)Xo(ge,ye[_e],J,V,!0,0===_e)}if(ge.length){var Re=z.tags||null;if("LineString"===ce&&W.lineMetrics){for(var Ue in Re={},z.tags)Re[Ue]=z.tags[Ue];Re.mapbox_clip_start=re.start/re.size,Re.mapbox_clip_end=re.end/re.size}var Le={geometry:ge,type:"Polygon"===ce||"MultiPolygon"===ce?3:"LineString"===ce||"MultiLineString"===ce?2:1,tags:Re};null!==z.id&&(Le.id=z.id),J.features.push(Le)}}function Xo(J,z,V,W,re,ce){var ge=W*W;if(W>0&&z.size<(re?ge:W))V.numPoints+=z.length/3;else{for(var _e=[],ue=0;ue<z.length;ue+=3)(0===W||z[ue+2]>ge)&&(V.numSimplified++,_e.push(z[ue]),_e.push(z[ue+1])),V.numPoints++;re&&function(ye,Re){for(var Ue=0,Le=0,ut=ye.length,gt=ut-2;Le<ut;gt=Le,Le+=2)Ue+=(ye[Le]-ye[gt])*(ye[Le+1]+ye[gt+1]);if(Ue>0===Re)for(Le=0,ut=ye.length;Le<ut/2;Le+=2){var pt=ye[Le],xt=ye[Le+1];ye[Le]=ye[ut-2-Le],ye[Le+1]=ye[ut-1-Le],ye[ut-2-Le]=pt,ye[ut-1-Le]=xt}}(_e,ce),J.push(_e)}}function gs(J,z){var V=(z=this.options=function(re,ce){for(var ge in ce)re[ge]=ce[ge];return re}(Object.create(this.options),z)).debug;if(V&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var re,ce,ge,_e,ue,ye,W=function(re,ce){var ge=[];if("FeatureCollection"===re.type)for(var _e=0;_e<re.features.length;_e++)Hl(ge,re.features[_e],ce,_e);else Hl(ge,"Feature"===re.type?re:{geometry:re},ce);return ge}(J,z);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(re=W,ce=z,ge=ce.buffer/ce.extent,_e=re,ue=Or(re,1,-1-ge,ge,0,-1,2,ce),ye=Or(re,1,1-ge,2+ge,0,-1,2,ce),(ue||ye)&&(_e=Or(re,1,-ge,1+ge,0,-1,2,ce)||[],ue&&(_e=Qu(ue,1).concat(_e)),ye&&(_e=_e.concat(Qu(ye,-1)))),W=_e).length&&this.splitTile(W,0,0,0),V&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oa(J,z,V){return 32*((1<<J)*V+z)+J}function sa(J,z){const V=J.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const W=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!W)return z(null,null);const re=new pi(W.features);let ce=tn(re);0===ce.byteOffset&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),z(null,{vectorTile:re,rawData:ce.buffer})}gs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gs.prototype.splitTile=function(J,z,V,W,re,ce,ge){for(var _e=[J,z,V,W],ue=this.options,ye=ue.debug;_e.length;){W=_e.pop(),V=_e.pop(),z=_e.pop(),J=_e.pop();var Re=1<<z,Ue=oa(z,V,W),Le=this.tiles[Ue];if(!Le&&(ye>1&&console.time("creation"),Le=this.tiles[Ue]=Wl(J,z,V,W,ue),this.tileCoords.push({z,x:V,y:W}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,V,W,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var ut="z"+z;this.stats[ut]=(this.stats[ut]||0)+1,this.total++}if(Le.source=J,re){if(z===ue.maxZoom||z===re)continue;var gt=1<<re-z;if(V!==Math.floor(ce/gt)||W!==Math.floor(ge/gt))continue}else if(z===ue.indexMaxZoom||Le.numPoints<=ue.indexMaxPoints)continue;if(Le.source=null,0!==J.length){ye>1&&console.time("clipping");var pt,xt,xe,sn,rt,an,ln=.5*ue.buffer/ue.extent,_s=.5-ln,Ko=.5+ln,Qe=1+ln;pt=xt=xe=sn=null,rt=Or(J,Re,V-ln,V+Ko,0,Le.minX,Le.maxX,ue),an=Or(J,Re,V+_s,V+Qe,0,Le.minX,Le.maxX,ue),J=null,rt&&(pt=Or(rt,Re,W-ln,W+Ko,1,Le.minY,Le.maxY,ue),xt=Or(rt,Re,W+_s,W+Qe,1,Le.minY,Le.maxY,ue),rt=null),an&&(xe=Or(an,Re,W-ln,W+Ko,1,Le.minY,Le.maxY,ue),sn=Or(an,Re,W+_s,W+Qe,1,Le.minY,Le.maxY,ue),an=null),ye>1&&console.timeEnd("clipping"),_e.push(pt||[],z+1,2*V,2*W),_e.push(xt||[],z+1,2*V,2*W+1),_e.push(xe||[],z+1,2*V+1,2*W),_e.push(sn||[],z+1,2*V+1,2*W+1)}}},gs.prototype.getTile=function(J,z,V){var W=this.options,re=W.extent,ce=W.debug;if(J<0||J>24)return null;var ge=1<<J,_e=oa(J,z=(z%ge+ge)%ge,V);if(this.tiles[_e])return eh(this.tiles[_e],re);ce>1&&console.log("drilling down to z%d-%d-%d",J,z,V);for(var ue,ye=J,Re=z,Ue=V;!ue&&ye>0;)ye--,Re=Math.floor(Re/2),Ue=Math.floor(Ue/2),ue=this.tiles[oa(ye,Re,Ue)];return ue&&ue.source?(ce>1&&console.log("found parent tile z%d-%d-%d",ye,Re,Ue),ce>1&&console.time("drilling down"),this.splitTile(ue.source,ye,Re,Ue,J,z,V),ce>1&&console.timeEnd("drilling down"),this.tiles[_e]?eh(this.tiles[_e],re):null):null};class Ya extends f.VectorTileWorkerSource{constructor(z,V,W,re,ce){super(z,V,W,re,sa),ce&&(this.loadGeoJSON=ce)}loadData(z,V){const W=z&&z.request,re=W&&W.collectResourceTiming;this.loadGeoJSON(z,(ce,ge)=>{if(ce||!ge)return V(ce);if("object"!=typeof ge)return V(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{Pt(ge,!0);try{if(z.filter){const ue=f.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ue.result)throw new Error(ue.value.map(Re=>`${Re.key}: ${Re.message}`).join(", "));const ye=ge.features.filter(Re=>ue.value.evaluate({zoom:0},Re));ge={type:"FeatureCollection",features:ye}}this._geoJSONIndex=z.cluster?new Qs(function({superclusterOptions:ue,clusterProperties:ye}){if(!ye||!ue)return ue;const Re={},Ue={},Le={accumulated:null,zoom:0},ut={properties:null},gt=Object.keys(ye);for(const pt of gt){const[xt,xe]=ye[pt],sn=f.createExpression(xe),rt=f.createExpression("string"==typeof xt?[xt,["accumulated"],["get",pt]]:xt);Re[pt]=sn.value,Ue[pt]=rt.value}return ue.map=pt=>{ut.properties=pt;const xt={};for(const xe of gt)xt[xe]=Re[xe].evaluate(Le,ut);return xt},ue.reduce=(pt,xt)=>{ut.properties=xt;for(const xe of gt)Le.accumulated=pt[xe],pt[xe]=Ue[xe].evaluate(Le,ut)},ue}(z)).load(ge.features):new gs(ue=ge,z.geojsonVtOptions)}catch(ue){return V(ue)}this.loaded={};const _e={};if(re){const ue=f.getPerformanceMeasurement(W);ue&&(_e.resourceTiming={},_e.resourceTiming[z.source]=JSON.parse(JSON.stringify(ue)))}V(null,_e)}var ue})}reloadTile(z,V){const W=this.loaded;return W&&W[z.uid]?super.reloadTile(z,V):this.loadTile(z,V)}loadGeoJSON(z,V){if(z.request)f.getJSON(z.request,V);else{if("string"!=typeof z.data)return V(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(z.data))}catch(W){return V(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(W){V(W)}}getClusterChildren(z,V){try{V(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(W){V(W)}}getClusterLeaves(z,V){try{V(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(W){V(W)}}}class aa{constructor(z){this.self=z,this.actor=new f.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.getProjection({name:"mercator"}),this.workerSourceTypes={vector:f.VectorTileWorkerSource,geojson:Ya},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,W)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=W},this.self.registerRTLTextPlugin=V=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=V.applyArabicShaping,f.plugin.processBidirectionalText=V.processBidirectionalText,f.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(z,V,W){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],W()}checkIfReady(z,V,W){W()}setReferrer(z,V){this.referrer=V}spriteLoaded(z,V){this.isSpriteLoaded[z]=V;for(const W in this.workerSources[z]){const re=this.workerSources[z][W];for(const ce in re)re[ce]instanceof f.VectorTileWorkerSource&&(re[ce].isSpriteLoaded=V,re[ce].fire(new f.Event("isSpriteLoaded")))}}setImages(z,V,W){this.availableImages[z]=V;for(const re in this.workerSources[z]){const ce=this.workerSources[z][re];for(const ge in ce)ce[ge].availableImages=V}W()}enableTerrain(z,V,W){this.terrain=V,W()}setProjection(z,V){this.projections[z]=f.getProjection(V)}setLayers(z,V,W){this.getLayerIndex(z).replace(V),W()}updateLayers(z,V,W){this.getLayerIndex(z).update(V.layers,V.removedIds),W()}loadTile(z,V,W){const re=this.enableTerrain?f.extend({enableTerrain:this.terrain},V):V;re.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,V.type,V.source).loadTile(re,W)}loadDEMTile(z,V,W){const re=this.enableTerrain?f.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(z,V.source).loadTile(re,W)}reloadTile(z,V,W){const re=this.enableTerrain?f.extend({enableTerrain:this.terrain},V):V;re.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,V.type,V.source).reloadTile(re,W)}abortTile(z,V,W){this.getWorkerSource(z,V.type,V.source).abortTile(V,W)}removeTile(z,V,W){this.getWorkerSource(z,V.type,V.source).removeTile(V,W)}removeSource(z,V,W){if(!this.workerSources[z]||!this.workerSources[z][V.type]||!this.workerSources[z][V.type][V.source])return;const re=this.workerSources[z][V.type][V.source];delete this.workerSources[z][V.type][V.source],void 0!==re.removeSource?re.removeSource(V,W):W()}loadWorkerSource(z,V,W){try{this.self.importScripts(V.url),W()}catch(re){W(re.toString())}}syncRTLPluginState(z,V,W){try{f.plugin.setState(V);const re=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=re){this.self.importScripts(re);const ce=f.plugin.isParsed();W(ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),ce)}}catch(re){W(re.toString())}}getAvailableImages(z){let V=this.availableImages[z];return V||(V=[]),V}getLayerIndex(z){let V=this.layerIndexes[z];return V||(V=this.layerIndexes[z]=new fi),V}getWorkerSource(z,V,W){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][V]||(this.workerSources[z][V]={}),this.workerSources[z][V][W]||(this.workerSources[z][V][W]=new this.workerSourceTypes[V]({send:(re,ce,ge,_e,ue,ye)=>{this.actor.send(re,ce,ge,z,ue,ye)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][V][W]}getDEMWorkerSource(z,V){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][V]||(this.demWorkerSources[z][V]=new Oe),this.demWorkerSources[z][V]}enforceCacheSizeLimit(z,V){f.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(z,V,W){W(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new aa(self)),aa}),Yu(0,function(f){var er=$o;function $o(p){return o=p,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{x=new Worker(E),g=!0}catch(M){g=!1}return x&&x.terminate(),URL.revokeObjectURL(E),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var b=x.getImageData(0,0,1,1);return b&&b.width===g.width}()||(void 0===fi[u=o&&o.failIfMajorPerformanceCaveat]&&(fi[u]=function(g){var x,E,M,A,b=(E=g,M=document.createElement("canvas"),(A=Object.create($o.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,M.getContext("webgl",A)||M.getContext("experimental-webgl",A));if(!b)return!1;try{x=b.createShader(b.VERTEX_SHADER)}catch(E){return!1}return!(!x||b.isContextLost())&&(b.shaderSource(x,"void main() {}"),b.compileShader(x),!0===b.getShaderParameter(x,b.COMPILE_STATUS))}(u)),!fi[u]||document.documentMode));var o,u}var fi={};function Oe(p,o){if(Array.isArray(p)){if(!Array.isArray(o)||p.length!==o.length)return!1;for(let u=0;u<p.length;u++)if(!Oe(p[u],o[u]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==o){if("object"!=typeof o||Object.keys(p).length!==Object.keys(o).length)return!1;for(const u in p)if(!Oe(p[u],o[u]))return!1;return!0}return p===o}function Pt(p,o,u){const g=f.window.document.createElement(p);return void 0!==o&&(g.className=o),u&&u.appendChild(g),g}function ft(p,o,u){const g=f.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const x of Object.keys(o))g.setAttributeNS(null,x,o[x]);return u&&u.appendChild(g),g}$o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const co=f.window.document&&f.window.document.documentElement.style,Mo=co&&void 0!==co.userSelect?"userSelect":"WebkitUserSelect";let nn;function pi(){co&&Mo&&(nn=co[Mo],co[Mo]="none")}function qc(){co&&Mo&&(co[Mo]=nn)}function Go(p){p.preventDefault(),p.stopPropagation(),f.window.removeEventListener("click",Go,!0)}function Di(){f.window.addEventListener("click",Go,!0),f.window.setTimeout(()=>{f.window.removeEventListener("click",Go,!0)},0)}function Ti(p,o){const u=p.getBoundingClientRect();return So(p,u,o)}function tn(p,o){const u=p.getBoundingClientRect(),g=[];for(let x=0;x<o.length;x++)g.push(So(p,u,o[x]));return g}function Js(p){return void 0!==f.window.InstallTrigger&&2===p.button&&p.ctrlKey&&f.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function So(p,o,u){const g=p.offsetWidth===o.width?1:p.offsetWidth/o.width;return new f.pointGeometry((u.clientX-o.left)*g,(u.clientY-o.top)*g)}function fs(p,o){var u=o[0],g=o[1],x=o[2],b=o[3],E=u*b-x*g;return E?(p[0]=b*(E=1/E),p[1]=-g*E,p[2]=-x*E,p[3]=u*E,p):null}function $l(p){const{userImage:o}=p;return!!(o&&o.render&&o.render())&&(p.data.replace(new Uint8Array(o.data.buffer)),!0)}class or extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,u){this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new f.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,u){if(!o)return!0;let g=0;for(const x of o){if(x[0]<g||x[1]<x[0]||u<x[1])return!1;g=x[1]}return!0}_validateContent(o,u){return!(o&&(4!==o.length||o[0]<0||u.data.width<o[0]||o[1]<0||u.data.height<o[1]||o[2]<0||u.data.width<o[2]||o[3]<0||u.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,u){u.version=this.images[o].version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){const u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,u){let g=!0;if(!this.isLoaded())for(const x of o)this.images[x]||(g=!1);this.isLoaded()||g?this._notify(o,u):this.requestors.push({ids:o,callback:u})}_notify(o,u){const g={};for(const x of o){this.images[x]||this.fire(new f.Event("styleimagemissing",{id:x}));const b=this.images[x];b?g[x]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:f.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){const u=this.patterns[o],g=this.getImage(o);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const x={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new f.ImagePosition(x,g);this.patterns[o]={bin:x,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.Texture(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:u,h:g}=f.potpack(o),x=this.atlasImage;x.resize({width:u||1,height:g||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],M=E.x+1,A=E.y+1,R=this.images[b].data,O=R.width,B=R.height;f.RGBAImage.copy(R,x,{x:0,y:0},{x:M,y:A},{width:O,height:B}),f.RGBAImage.copy(R,x,{x:0,y:B-1},{x:M,y:A-1},{width:O,height:1}),f.RGBAImage.copy(R,x,{x:0,y:0},{x:M,y:A+B},{width:O,height:1}),f.RGBAImage.copy(R,x,{x:O-1,y:0},{x:M-1,y:A},{width:1,height:B}),f.RGBAImage.copy(R,x,{x:0,y:0},{x:M+O,y:A},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];$l(g)&&this.updateImage(u,g)}}}const ps=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(p,o){return function([u,g,x]){const b=f.degToRad(g+90),E=f.degToRad(x);return{x:u*Math.cos(b)*Math.sin(E),y:u*Math.sin(b)*Math.sin(E),z:u*Math.cos(E),azimuthal:g,polar:x}}(p.expression.evaluate(o))}interpolate(p,o,u){return{x:f.number(p.x,o.x,u),y:f.number(p.y,o.y,u),z:f.number(p.z,o.z,u),azimuthal:f.number(p.azimuthal,o.azimuthal,u),polar:f.number(p.polar,o.polar,u)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)}),ja="-transition";class $a extends f.Evented{constructor(o){super(),this._transitionable=new f.Transitionable(ps),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(f.validateLight,o,u))for(const g in o){const x=o[g];f.endsWith(g,ja)?this._transitionable.setTransition(g.slice(0,-ja.length),x):this._transitionable.setValue(g,x)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&f.emitValidationErrors(this,o.call(f.validateStyle,f.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}const Zc=new f.Properties({source:new f.DataConstantProperty(f.spec.terrain.source),exaggeration:new f.DataConstantProperty(f.spec.terrain.exaggeration)}),Ho="-transition";class Ni extends f.Evented{constructor(o,u){super(),this._transitionable=new f.Transitionable(Zc),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(o){for(const u in o){const g=o[u];f.endsWith(u,Ho)?this._transitionable.setTransition(u.slice(0,-Ho.length),g):this._transitionable.setValue(u,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function qo(p,o,u,g){const x=f.smoothstep(45,65,u),[b,E]=Zo(p,g),M=f.length(o);let A=1-Math.min(1,Math.exp((M-b)/(E-b)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*x*p.alpha}function Zo(p,o){const u=.5/Math.tan(.5*o);return[p.range[0]+u,p.range[1]+u]}const Dn=new f.Properties({range:new f.DataConstantProperty(f.spec.fog.range),color:new f.DataConstantProperty(f.spec.fog.color),"horizon-blend":new f.DataConstantProperty(f.spec.fog["horizon-blend"])}),Mi="-transition";class Wc extends f.Evented{constructor(o,u){super(),this._transitionable=new f.Transitionable(Dn),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,u={}){if(!this._validate(f.validateFog,o,u))for(const g in o){const x=o[g];f.endsWith(g,Mi)?this._transitionable.setTransition(g.slice(0,-Mi.length),x):this._transitionable.setValue(g,x)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return f.smoothstep(45,65,o)*u.a}getOpacityAtLatLng(o,u){return this._transform.projection.supportsFog?function(g,x,b){const E=f.MercatorCoordinate.fromLngLat(x),M=b.elevation?b.elevation.getAtPointOrZero(E):0,A=[E.x,E.y,M];return f.transformMat4(A,A,b.mercatorFogMatrix),qo(g,A,b.pitch,b._fov)}(this.state,o,u):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Zo(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&f.emitValidationErrors(this,o.call(f.validateStyle,f.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class Tn{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const g=this.workerPool.acquire(this.id);for(let x=0;x<g.length;x++){const b=new Tn.Actor(g[x],u,this.id);b.name=`Worker ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,u,g){f.asyncAll(this.actors,(x,b)=>{x.send(o,u,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Gr(p,o,u){return o*(f.EXTENT/(p.tileSize*Math.pow(2,u-p.tileID.overscaledZ)))}Tn.Actor=f.Actor;class br{constructor(o,u,g,x){this.screenBounds=o,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>x.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,u){let g,x;if(o instanceof f.pointGeometry||"number"==typeof o[0]){const b=f.pointGeometry.convert(o);g=[f.pointGeometry.convert(o)],x=u.isPointAboveHorizon(b)}else{const b=f.pointGeometry.convert(o[0]),E=f.pointGeometry.convert(o[1]);g=[b,E],x=f.polygonizeBounds(b,E).every(M=>u.isPointAboveHorizon(M))}return new br(g,u.getCameraPoint(),x,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return f.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new f.pointGeometry(1,1)):this.screenBounds[1],x=f.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(x[3]=this.cameraPoint)),f.bufferConvexPolygon(x,o)}containsTile(o,u,g){const x=o.queryPadding+1,b=o.tileID.wrap,E=g?this._bufferedCameraMercator(x,u).map(H=>f.getTilePoint(o.tileTransform,H,b)):this._bufferedScreenMercator(x,u).map(H=>f.getTilePoint(o.tileTransform,H,b)),M=this.screenGeometryMercator.map(H=>f.getTileVec3(o.tileTransform,H,b)),A=M.map(H=>new f.pointGeometry(H[0],H[1])),R=u.getFreeCameraOptions().position||new f.MercatorCoordinate(0,0,0),O=f.getTileVec3(o.tileTransform,R,b),B=M.map(H=>{const $=f.sub(H,H,O);return f.normalize($,$),new f.Ray(O,$)}),j=Gr(o,1,u.zoom);if(f.polygonIntersectsBox(E,0,0,f.EXTENT,f.EXTENT))return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:B,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(q=f.getBounds(E),q.min.x=f.clamp(q.min.x,0,f.EXTENT),q.min.y=f.clamp(q.min.y,0,f.EXTENT),q.max.x=f.clamp(q.max.x,0,f.EXTENT),q.max.y=f.clamp(q.max.y,0,f.EXTENT),q),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:j};var q}_bufferedScreenMercator(o,u){const g=Vi(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{const x=this.bufferedScreenGeometry(o).map(b=>u.pointCoordinate3D(b));return this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(o,u){const g=Vi(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{const x=this.bufferedCameraGeometry(o).map(b=>u.pointCoordinate3D(b));return this._cameraRaycastCache[g]=x,x}}}function Vi(p){return 100*p|0}function Qs(p,o,u){const g=function(x,b){if(x)return u(x);if(b){const E=f.pick(f.extend(b,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(M=>M.id)),E.tiles=o.canonicalizeTileset(E,p.url),u(null,E)}};return p.url?f.getJSON(o.transformRequest(o.normalizeSourceURL(p.url),f.ResourceType.Source),g):f.exported.frame(()=>g(null,p))}class $n{constructor(o,u,g){this.bounds=f.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),g=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*u),x=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*u),E=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*u);return o.x>=g&&o.x<b&&o.y>=x&&o.y<E}}class tr{constructor(o,u,g){this.context=o;const x=o.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ea={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ot{constructor(o,u,g,x){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=x,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let g=0;g<this.attributes.length;g++){const x=u.attributes[this.attributes[g].name];void 0!==x&&o.enableVertexAttribArray(x)}}setVertexAttribPointers(o,u,g){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],E=u.attributes[b.name];void 0!==E&&o.vertexAttribPointer(E,b.components,o[ea[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ta extends qt{getDefault(){return f.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Gl extends qt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Si extends qt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ga extends qt{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class fn extends qt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class na extends qt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ra extends qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class uo extends qt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class ms extends qt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class Hl extends qt{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ha extends qt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class qa extends qt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Za extends qt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class Io extends qt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Wa extends qt{getDefault(){return f.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Or extends qt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class ho extends qt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class ia extends qt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class ql extends qt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Xa extends qt{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Ka extends qt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ed extends qt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ju extends qt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Qu extends qt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Zl extends qt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class eh extends qt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Wo extends qt{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Wl extends qt{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Ui extends qt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Xo extends qt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class gs extends qt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class oa extends qt{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class sa extends oa{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Ya extends oa{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class aa extends Ya{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class J{constructor(o,u,g,x){this.context=o,this.width=u,this.height=g;const b=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new sa(o,b),x&&(this.depthAttachment=new Ya(o,b))}destroy(){const o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}o.deleteFramebuffer(this.framebuffer)}}class z{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ta(this),this.clearDepth=new Gl(this),this.clearStencil=new Si(this),this.colorMask=new Ga(this),this.depthMask=new fn(this),this.stencilMask=new na(this),this.stencilFunc=new ra(this),this.stencilOp=new uo(this),this.stencilTest=new ms(this),this.depthRange=new Hl(this),this.depthTest=new Ha(this),this.depthFunc=new qa(this),this.blend=new Za(this),this.blendFunc=new Io(this),this.blendColor=new Wa(this),this.blendEquation=new Or(this),this.cullFace=new ho(this),this.cullFaceSide=new ia(this),this.frontFace=new ql(this),this.program=new Xa(this),this.activeTexture=new Ka(this),this.viewport=new Ed(this),this.bindFramebuffer=new Ju(this),this.bindRenderbuffer=new Qu(this),this.bindTexture=new Zl(this),this.bindVertexBuffer=new eh(this),this.bindElementBuffer=new Wo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wl(this),this.pixelStoreUnpack=new Ui(this),this.pixelStoreUnpackPremultiplyAlpha=new Xo(this),this.pixelStoreUnpackFlipY=new gs(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new tr(this,o,u)}createVertexBuffer(o,u,g){return new Ot(this,o,u,g)}createRenderbuffer(o,u,g){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,o,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(o,u,g){return new J(this,o,u,g)}clear({color:o,depth:u,stencil:g}){const x=this.gl;let b=0;o&&(b|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(b|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(b)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){Oe(o.blendFunction,f.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class V extends f.Evented{constructor(o,u,g,x){super(),this.id=o,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},u),f.extend(this,f.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qs(this._options,this.map._requestManager,(o,u)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new f.ErrorEvent(o)):u&&(f.extend(this,u),u.bounds&&(this.tileBounds=new $n(u.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(u.tiles),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,u){const g=f.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=f.getImage(this.map._requestManager.transformRequest(x,f.ResourceType.Tile),(b,E,M,A)=>(delete o.request,o.aborted?(o.state="unloaded",u(null)):b?(o.state="errored",u(b)):E?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:M,expires:A}),o.setTexture(E,this.map.painter),o.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(o,u,g){o.setTexture(u,g)}static unloadTileData(o,u){o.texture&&u.saveTileTexture(o.texture)}abortTile(o,u){o.request&&(o.request.cancel(),delete o.request),u()}unloadTile(o,u){o.texture&&this.map.painter.saveTileTexture(o.texture),u()}hasTransition(){return!1}}let W;function re(p,o,u,g,x,b,E,M){const A=[p,u,x,o,g,b,1,1,1],R=[E,M,1],O=f.adjoint([],A),[B,j,q]=f.transformMat3(R,R,f.transpose(O,O));return f.multiply(A,[B,0,0,0,j,0,0,0,q],A)}class ce extends f.Evented{constructor(o,u,g,x){super(),this.id=o,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=u}load(o){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(u,g)=>{if(this._loaded=!0,u)this.fire(new f.ErrorEvent(u));else if(g){const{HTMLImageElement:x}=f.window;this.image=g instanceof x?f.exported.getImageData(g):g,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const u=o.map(f.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let x=1/0,b=1/0,E=-1/0,M=-1/0;for(const B of g)x=Math.min(x,B.x),b=Math.min(b,B.y),E=Math.max(E,B.x),M=Math.max(M,B.y);const A=Math.max(E-x,M-b),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),O=Math.pow(2,R);return new f.CanonicalTileID(R,Math.floor((x+E)/2*O),Math.floor((b+M)/2*O))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const A in this.tiles){const R=this.tiles[A];"loaded"!==R.state&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;const u=f.tileTransform(this.tileID,this.map.transform.projection),[g,x,b,E]=this.coordinates.map(A=>{const R=u.projection.project(A[0],A[1]);return f.getTilePoint(u,R)._round()});this.perspectiveTransform=function(A,R,O,B,j,q,H,$,ne,X){const ee=re(0,0,A,0,0,R,A,R),te=re(O,B,j,q,H,$,ne,X);return f.multiply(te,f.adjoint(ee,ee),te),[te[6]/te[8]*A/f.EXTENT,te[7]/te[8]*R/f.EXTENT]}(this.width,this.height,g.x,g.y,x.x,x.y,E.x,E.y,b.x,b.y);const M=this._boundsArray=new f.StructArrayLayout4i8;M.emplaceBack(g.x,g.y,0,0),M.emplaceBack(x.x,x.y,f.EXTENT,0),M.emplaceBack(E.x,E.y,0,f.EXTENT),M.emplaceBack(b.x,b.y,f.EXTENT,f.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(M,f.boundsAttributes.members),this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,u=o.gl;this.texture?this.texture.update(this.image):(this.texture=new f.Texture(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._prepareData(o)}loadTile(o,u){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},u(null)):(o.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ge={vector:class extends f.Evented{constructor(p,o,u,g){if(super(),this.id=p,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(o,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new f.DedupedRequest}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qs(this._options,this.map._requestManager,(p,o)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new f.ErrorEvent(p)):o&&(f.extend(this,o),o.bounds&&(this.tileBounds=new $n(o.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const o=this.map.style._getSourceCaches(this.id);for(const u of o)u.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}loadTile(p,o){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,f.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=o:p.request=p.actor.send("reloadTile",g,x.bind(this));else if(p.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",g,x.bind(this),void 0,!0);else{const b=f.loadVectorTile.call({deduped:this._deduped},g,(E,M)=>{E||!M?x.call(this,E):(g.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},p.actor&&p.actor.send("loadTile",g,x.bind(this),void 0,!0))},!0);p.request={cancel:b}}function x(b,E){return delete p.request,p.aborted?o(null):b&&404!==b.status?o(b):(E&&E.resourceTiming&&(p.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&p.setExpiryData(E),p.loadVectorData(E,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:V,"raster-dem":class extends V{constructor(p,o,u,g){super(p,o,u,g),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(p,o){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,b){x&&(p.state="errored",o(x)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",o(null))}p.request=f.getImage(this.map._requestManager.transformRequest(u,f.ResourceType.Tile),function(x,b,E,M){if(delete p.request,p.aborted)p.state="unloaded",o(null);else if(x)p.state="errored",o(x);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:E,expires:M});const A=f.window.ImageBitmap&&b instanceof f.window.ImageBitmap&&(null==W&&(W=f.window.OffscreenCanvas&&new f.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof f.window.createImageBitmap),W),R=1-(b.width-f.prevPowerOfTwo(b.width))/2;R<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const O=A?b:f.exported.getImageData(b,R),B={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:R};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",B,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const o=p.canonical,u=Math.pow(2,o.z),g=(o.x-1+u)%u,x=0===o.x?p.wrap-1:p.wrap,b=(o.x+1+u)%u,E=o.x+1===u?p.wrap+1:p.wrap,M={};return M[new f.OverscaledTileID(p.overscaledZ,x,o.z,g,o.y).key]={backfilled:!1},M[new f.OverscaledTileID(p.overscaledZ,E,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(M[new f.OverscaledTileID(p.overscaledZ,x,o.z,g,o.y-1).key]={backfilled:!1},M[new f.OverscaledTileID(p.overscaledZ,p.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},M[new f.OverscaledTileID(p.overscaledZ,E,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<u&&(M[new f.OverscaledTileID(p.overscaledZ,x,o.z,g,o.y+1).key]={backfilled:!1},M[new f.OverscaledTileID(p.overscaledZ,p.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},M[new f.OverscaledTileID(p.overscaledZ,E,o.z,b,o.y+1).key]={backfilled:!1}),M}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends f.Evented{constructor(p,o,u,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=o.data,this._options=f.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const x=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*x,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*x,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:f.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*x,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},o),this}getClusterChildren(p,o){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},o),this}getClusterLeaves(p,o,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:o,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=f.extend({},this.workerOptions),o=this._data;"string"==typeof o?(p.request=this.map._requestManager.transformRequest(f.exported.resolveURL(o),f.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new f.ErrorEvent(u));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x.resourceTiming=g.resourceTiming[this.id]),this.fire(new f.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,o){const u=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(u,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,x)=>(delete p.request,p.unloadVectorData(),p.aborted?o(null):g?o(g):(p.loadVectorData(x,this.map.painter,"reloadTile"===u),o(null))),void 0,"loadTile"===u)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ce{constructor(p,o,u,g){super(p,o,u,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const o of p.urls)this.urls.push(this.map._requestManager.transformRequest(o,f.ResourceType.Source).url);f.getVideo(this.urls,(o,u)=>{this._loaded=!0,o?this.fire(new f.ErrorEvent(o)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const o=this.video.seekable;p<o.start(0)||p>o.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,o=p.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new f.Texture(p,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ce,canvas:class extends ce{constructor(p,o,u,g){super(p,o,u,g),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(b=>"number"!=typeof b))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof f.window.HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof f.window.HTMLCanvasElement?this.options.canvas:f.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends f.Evented{constructor(p,o,u,g){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new $n(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.coveringTiles=this._coveringTiles.bind(this),f.extend(this,f.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:o,y:u,z:g}=p.canonical;return this._implementation.hasTile({x:o,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,o){const{x:u,y:g,z:x}=p.tileID.canonical,b=new f.window.AbortController,E=this._implementation.loadTile({x:u,y:g,z:x},{signal:b.signal});if(!E)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",o(null);E.cancel=()=>b.abort(),p.request=E.then(function(M){return delete p.request,p.aborted?(p.state="unloaded",o(null)):M?(A=M)instanceof f.window.ImageData||A instanceof f.window.ImageBitmap||A instanceof f.window.HTMLCanvasElement?(this.loadTileData(p,M),p.state="loaded",void o(null)):(p.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",o(null));var A}.bind(this)).catch(M=>{20!==M.code&&(p.state="errored",o(M))})}loadTileData(p,o){V.loadTileData(p,o,this._map.painter)}unloadTileData(p){V.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:o,y:u,z:g}=p.tileID.canonical,x=this._implementation.prepareTile({x:o,y:u,z:g});return x?(this.loadTileData(p,x),p.state="loaded",x):null}unloadTile(p,o){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:u,y:g,z:x}=p.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:x})}o()}abortTile(p,o){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}}},_e=function(p,o,u,g){const x=new ge[o.type](p,o,u,g);if(x.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${x.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],x),x};function ue(p,o){const u=f.identity([]);return f.scale(u,u,[.5*p.width,.5*-p.height,1]),f.translate(u,u,[1,-1,0]),f.multiply$1(u,u,p.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(u)}function ye(p,o,u,g,x,b,E,M=!1){const A=p.tilesIn(g,E,M);A.sort(Ue);const R=[];for(const B of A)R.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,u,p._state,B,x,b,ue(p.transform,B.tile.tileID),M)});const O=function(B){const j={},q={};for(const H of B){const $=H.queryResults,ne=H.wrappedTileID,X=q[ne]=q[ne]||{};for(const ee in $){const te=$[ee],oe=X[ee]=X[ee]||{},Q=j[ee]=j[ee]||[];for(const ae of te)oe[ae.featureIndex]||(oe[ae.featureIndex]=!0,Q.push(ae))}}return j}(R);for(const B in O)O[B].forEach(j=>{const q=j.feature,H=q.layer;H&&"background"!==H.type&&"sky"!==H.type&&(q.source=H.source,H["source-layer"]&&(q.sourceLayer=H["source-layer"]),q.state=void 0!==q.id?p.getFeatureState(H["source-layer"],q.id):{})});return O}function Re(p,o){const u=p.getRenderableIds().map(b=>p.getTileByID(b)),g=[],x={};for(let b=0;b<u.length;b++){const E=u[b],M=E.tileID.canonical.key;x[M]||(x[M]=!0,E.querySourceFeatures(g,o))}return g}function Ue(p,o){const u=p.tileID,g=o.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function Le(){return null!=Os.workerClass?new Os.workerClass:new f.window.Worker(Os.workerUrl)}const ut="mapboxgl_preloaded_worker_pool";class gt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<gt.workerCount;)this.workers.push(new Le);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ut]}numActive(){return Object.keys(this.active).length}}let pt;function xt(){return pt||(pt=new gt),pt}function xe(p,o){const u={};for(const g in p)"ref"!==g&&(u[g]=p[g]);return f.refProperties.forEach(g=>{g in o&&(u[g]=o[g])}),u}function sn(p){p=p.slice();const o=Object.create(null);for(let u=0;u<p.length;u++)o[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=xe(p[u],o[p[u].ref]));return p}gt.workerCount=2;const rt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function an(p,o,u){u.push({command:rt.addSource,args:[p,o[p]]})}function ln(p,o,u){o.push({command:rt.removeSource,args:[p]}),u[p]=!0}function _s(p,o,u,g){ln(p,u,g),an(p,o,u)}function Ko(p,o,u){let g;for(g in p[u])if(p[u].hasOwnProperty(g)&&"data"!==g&&!Oe(p[u][g],o[u][g]))return!1;for(g in o[u])if(o[u].hasOwnProperty(g)&&"data"!==g&&!Oe(p[u][g],o[u][g]))return!1;return!0}function Qe(p,o,u,g,x,b){let E;for(E in o=o||{},p=p||{})p.hasOwnProperty(E)&&(Oe(p[E],o[E])||u.push({command:b,args:[g,E,o[E],x]}));for(E in o)o.hasOwnProperty(E)&&!p.hasOwnProperty(E)&&(Oe(p[E],o[E])||u.push({command:b,args:[g,E,o[E],x]}))}function Wt(p){return p.id}function Ut(p,o){return p[o.id]=o,p}class fo{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=f.clamp(o,0,1);let u=1,g=this._distances[u];const x=o*this.paddedLength+this.padding;for(;g<x&&u<this._distances.length;)g=this._distances[++u];const b=u-1,E=this._distances[b],M=g-E,A=M>0?(x-E)/M:0;return this.points[b].mult(1-A).add(this.points[u].mult(A))}}class la{constructor(o,u,g){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(u/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,g,x,b){this._forEachCell(u,g,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(o,u,g,x){this._forEachCell(u-x,g-x,u+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(g),this.circles.push(x)}_insertBoxCell(o,u,g,x,b,E){this.boxCells[b].push(E)}_insertCircleCell(o,u,g,x,b,E){this.circleCells[b].push(E)}_query(o,u,g,x,b,E){if(g<0||o>this.width||x<0||u>this.height)return!b&&[];const M=[];if(o<=0&&u<=0&&this.width<=g&&this.height<=x){if(b)return!0;for(let A=0;A<this.boxKeys.length;A++)M.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],O=this.circles[3*A+1],B=this.circles[3*A+2];M.push({key:this.circleKeys[A],x1:R-B,y1:O-B,x2:R+B,y2:O+B})}return E?M.filter(E):M}return this._forEachCell(o,u,g,x,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?M.length>0:M}_queryCircle(o,u,g,x,b){const E=o-g,M=o+g,A=u-g,R=u+g;if(M<0||E>this.width||R<0||A>this.height)return!x&&[];const O=[];return this._forEachCell(E,A,M,R,this._queryCellCircle,O,{hitTest:x,circle:{x:o,y:u,radius:g},seenUids:{box:{},circle:{}}},b),x?O.length>0:O}query(o,u,g,x,b){return this._query(o,u,g,x,!1,b)}hitTest(o,u,g,x,b){return this._query(o,u,g,x,!0,b)}hitTestCircle(o,u,g,x){return this._queryCircle(o,u,g,!0,x)}_queryCell(o,u,g,x,b,E,M,A){const R=M.seenUids,O=this.boxCells[b];if(null!==O){const j=this.bboxes;for(const q of O)if(!R.box[q]){R.box[q]=!0;const H=4*q;if(o<=j[H+2]&&u<=j[H+3]&&g>=j[H+0]&&x>=j[H+1]&&(!A||A(this.boxKeys[q]))){if(M.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[q],x1:j[H],y1:j[H+1],x2:j[H+2],y2:j[H+3]})}}}const B=this.circleCells[b];if(null!==B){const j=this.circles;for(const q of B)if(!R.circle[q]){R.circle[q]=!0;const H=3*q;if(this._circleAndRectCollide(j[H],j[H+1],j[H+2],o,u,g,x)&&(!A||A(this.circleKeys[q]))){if(M.hitTest)return E.push(!0),!0;{const $=j[H],ne=j[H+1],X=j[H+2];E.push({key:this.circleKeys[q],x1:$-X,y1:ne-X,x2:$+X,y2:ne+X})}}}}}_queryCellCircle(o,u,g,x,b,E,M,A){const R=M.circle,O=M.seenUids,B=this.boxCells[b];if(null!==B){const q=this.bboxes;for(const H of B)if(!O.box[H]){O.box[H]=!0;const $=4*H;if(this._circleAndRectCollide(R.x,R.y,R.radius,q[$+0],q[$+1],q[$+2],q[$+3])&&(!A||A(this.boxKeys[H])))return E.push(!0),!0}}const j=this.circleCells[b];if(null!==j){const q=this.circles;for(const H of j)if(!O.circle[H]){O.circle[H]=!0;const $=3*H;if(this._circlesCollide(q[$],q[$+1],q[$+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[H])))return E.push(!0),!0}}}_forEachCell(o,u,g,x,b,E,M,A){const R=this._convertToXCellCoord(o),O=this._convertToYCellCoord(u),B=this._convertToXCellCoord(g),j=this._convertToYCellCoord(x);for(let q=R;q<=B;q++)for(let H=O;H<=j;H++)if(b.call(this,o,u,g,x,this.xCellCount*H+q,E,M,A))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,g,x,b,E){const M=x-o,A=b-u,R=g+E;return R*R>M*M+A*A}_circleAndRectCollide(o,u,g,x,b,E,M){const A=(E-x)/2,R=Math.abs(o-(x+A));if(R>A+g)return!1;const O=(M-b)/2,B=Math.abs(u-(b+O));if(B>O+g)return!1;if(R<=A||B<=O)return!0;const j=R-A,q=B-O;return j*j+q*q<=g*g}}const $t=Math.tan(85*Math.PI/180);function qn(p,o,u,g,x,b){const E=f.create();if(u){if("globe"===x.projection.name)f.multiply$1(E,E,f.calculateGlobeLabelMatrix(x,o));else{const M=fs([],b);E[0]=M[0],E[1]=M[1],E[4]=M[2],E[5]=M[3]}g||f.rotateZ(E,E,x.angle)}else f.multiply$1(E,x.labelPlaneMatrix,p);return E}function ys(p,o,u,g,x,b){if(u){if("globe"===x.projection.name){const E=qn(p,o,u,g,x,b);return f.invert(E,E),f.multiply$1(E,p,E),E}{const E=f.clone(p),M=f.identity([]);return M[0]=b[0],M[1]=b[1],M[4]=b[2],M[5]=b[3],f.multiply$1(E,E,M),g||f.rotateZ(E,E,-x.angle),E}}return x.glCoordMatrix}function Gn(p,o,u=0){const g=[p.x,p.y,u,1];u?f.transformMat4$1(g,g,o):Qr(g,g,o);const x=g[3];return{point:new f.pointGeometry(g[0]/x,g[1]/x),signedDistanceFromCamera:x}}function ji(p,o){const u=[p[0],p[1],p[2],1];f.transformMat4$1(u,u,o);const g=u[3];return{point:new f.pointGeometry(u[0]/g,u[1]/g),signedDistanceFromCamera:g}}function Fn(p,o){return Math.min(.5+p/o*.5,1.5)}function Ln(p,o){const u=p[0]/p[3],g=p[1]/p[3];return u>=-o[0]&&u<=o[0]&&g>=-o[1]&&g<=o[1]}function ca(p,o,u,g,x,b,E,M,A,R){const O=u.transform,B=g?p.textSizeData:p.iconSizeData,j=f.evaluateSizeForZoom(B,u.transform.zoom),q=[256/u.width*2+1,256/u.height*2+1],H=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;H.clear();const $=p.lineVertexArray,ne=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,X=u.transform.width/u.transform.height;let ee=!1;for(let te=0;te<ne.length;te++){const oe=ne.get(te);if(oe.writingMode!==f.WritingMode.vertical||ee||0!==te&&ne.get(te-1).writingMode===f.WritingMode.horizontal||(ee=!0),(oe.hidden||oe.writingMode===f.WritingMode.vertical)&&!ee){Tt(oe.numGlyphs,H);continue}ee=!1;const Q=new f.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),ae=A?A(Q):[0,0,0],me=O.projection.projectTilePoint(Q.x,Q.y,R.canonical),be=[me.x+ae[0],me.y+ae[1],me.z+ae[2]],Se=[...be,1];if(f.transformMat4$1(Se,Se,o),!Ln(Se,q)){Tt(oe.numGlyphs,H);continue}const Te=Fn(u.transform.cameraToCenterDistance,Se[3]),Ne=f.evaluateSizeForFeature(B,j,oe),pe=E?Ne/Te:Ne*Te,He=Gn(new f.pointGeometry(be[0],be[1]),x,be[2]);if(He.signedDistanceFromCamera<=0){Tt(oe.numGlyphs,H);continue}let Ve={};const nt=E?null:A,Ie=Xc(oe,pe,!1,M,o,x,b,p.glyphOffsetArray,$,H,He.point,Q,Ve,X,nt,O.projection,R);ee=Ie.useVertical,nt&&Ie.needsFlipping&&(Ve={}),(Ie.notEnoughRoom||ee||Ie.needsFlipping&&Xc(oe,pe,!0,M,o,x,b,p.glyphOffsetArray,$,H,He.point,Q,Ve,X,nt,O.projection,R).notEnoughRoom)&&Tt(oe.numGlyphs,H)}g?p.text.dynamicLayoutVertexBuffer.updateData(H):p.icon.dynamicLayoutVertexBuffer.updateData(H)}function _n(p,o,u,g,x,b,E,M,A,R,O,B,j,q,H){const $=M.glyphStartIndex+M.numGlyphs,ne=M.lineStartIndex,X=M.lineStartIndex+M.lineLength,ee=o.getoffsetX(M.glyphStartIndex),te=o.getoffsetX($-1),oe=ua(p*ee,u,g,x,b,E,M.segment,ne,X,A,R,O,B,j,!0,q,H);if(!oe)return null;const Q=ua(p*te,u,g,x,b,E,M.segment,ne,X,A,R,O,B,j,!0,q,H);return Q?{first:oe,last:Q}:null}function vs(p,o,u,g){return p.writingMode===f.WritingMode.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*g?{useVertical:!0}:p.writingMode===f.WritingMode.vertical?o.y<u.y?{needsFlipping:!0}:null:0!==p.flipState&&function(x,b,E){const M=(b.x-x.x)*E;return 0===M||Math.abs((b.y-x.y)/M)>$t}(o,u,g)?1===p.flipState?{needsFlipping:!0}:null:o.x>u.x?{needsFlipping:!0}:null}function Xc(p,o,u,g,x,b,E,M,A,R,O,B,j,q,H,$,ne){const X=o/24,ee=p.lineOffsetX*X,te=p.lineOffsetY*X;let oe;if(p.numGlyphs>1){const Q=p.glyphStartIndex+p.numGlyphs,ae=p.lineStartIndex,me=p.lineStartIndex+p.lineLength,be=_n(X,M,ee,te,u,O,B,p,A,b,j,H,!1,$,ne);if(!be)return{notEnoughRoom:!0};const Se=Gn(be.first.point,E).point,Te=Gn(be.last.point,E).point;if(g&&!u){const Ne=vs(p,Se,Te,q);if(p.flipState=Ne&&Ne.needsFlipping?1:2,Ne)return Ne}oe=[be.first];for(let Ne=p.glyphStartIndex+1;Ne<Q-1;Ne++)oe.push(ua(X*M.getoffsetX(Ne),ee,te,u,O,B,p.segment,ae,me,A,b,j,H,!1,!1,$,ne));oe.push(be.last)}else{if(g&&!u){const ae=Gn(B,x).point,me=p.lineStartIndex+p.segment+1,be=new f.pointGeometry(A.getx(me),A.gety(me)),Se=Gn(be,x),Te=vs(p,ae,Se.signedDistanceFromCamera>0?Se.point:lt(B,be,ae,1,x,void 0,$,ne.canonical),q);if(p.flipState=Te&&Te.needsFlipping?1:2,Te)return Te}const Q=ua(X*M.getoffsetX(p.glyphStartIndex),ee,te,u,O,B,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,A,b,j,H,!1,!1,$,ne);if(!Q)return{notEnoughRoom:!0};oe=[Q]}for(const Q of oe)f.addDynamicAttributes(R,Q.point,Q.angle);return{}}function In(p,o,u,g,x){const b=g.projectTilePoint(p.x,p.y,o);if(!x)return Gn(b,u,b.z);const E=x(p);return Gn(new f.pointGeometry(b.x+E[0],b.y+E[1]),u,b.z+E[2])}function lt(p,o,u,g,x,b,E,M){const A=In(p.add(p.sub(o)._unit()),M,x,E,b).point,R=u.sub(A);return u.add(R._mult(g/R.mag()))}function ua(p,o,u,g,x,b,E,M,A,R,O,B,j,q,H,$,ne){const X=g?p-o:p+o;let ee=X>0?1:-1,te=0;g&&(ee*=-1,te=Math.PI),ee<0&&(te+=Math.PI);let oe=ee>0?M+E:M+E+1,Q=x,ae=x,me=0,be=0;const Se=Math.abs(X),Te=[],Ne=[];let pe=b;const He=()=>{const st=oe-ee;return 0===me?b:new f.pointGeometry(R.getx(st),R.gety(st))},Ve=()=>lt(He(),pe,ae,Se-me+1,O,j,$,ne.canonical);for(;me+be<=Se;){if(oe+=ee,oe<M||oe>=A)return null;if(ae=Q,Te.push(Q),q&&Ne.push(pe||He()),Q=B[oe],void 0===Q){pe=new f.pointGeometry(R.getx(oe),R.gety(oe));const st=In(pe,ne.canonical,O,$,j);Q=st.signedDistanceFromCamera>0?B[oe]=st.point:Ve()}else pe=null;me+=be,be=ae.dist(Q)}H&&j&&(pe=pe||new f.pointGeometry(R.getx(oe),R.gety(oe)),B[oe]=Q=void 0===B[oe]?Q:Ve(),be=ae.dist(Q));const nt=(Se-me)/be,Ie=Q.sub(ae),it=Ie.mult(nt)._add(ae);u&&it._add(Ie._unit()._perp()._mult(u*ee));const mt=te+Math.atan2(Q.y-ae.y,Q.x-ae.x);return Te.push(it),q&&(pe=pe||new f.pointGeometry(R.getx(oe),R.gety(oe)),Ne.push(function(st,at,_t){const At=1-_t;return new f.pointGeometry(st.x*At+at.x*_t,st.y*At+at.y*_t)}(Ne.length>0?Ne[Ne.length-1]:pe,pe,nt))),{point:it,angle:mt,path:Te,tilePath:Ne}}const Dd=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Tt(p,o){for(let u=0;u<p;u++){const g=o.length;o.resize(g+4),o.float32.set(Dd,3*g)}}function Qr(p,o,u){const g=o[0],x=o[1];return p[0]=u[0]*g+u[4]*x+u[12],p[1]=u[1]*g+u[5]*x+u[13],p[3]=u[3]*g+u[7]*x+u[15],p}const Dt=100;class fr{constructor(o,u,g=new la(o.width+200,o.height+200,25),x=new la(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Dt,this.screenBottomBoundary=o.height+Dt,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=u}placeCollisionBox(o,u,g,x,b,E,M){let A=u.projectedAnchorX,R=u.projectedAnchorY,O=u.projectedAnchorZ;const B=u.elevation,j=u.tileID;if(B&&j){const oe=this.transform.projection.upVector(j.canonical,u.tileAnchorX,u.tileAnchorY),Q=this.transform.projection.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=oe[0]*B*Q,R+=oe[1]*B*Q,O+=oe[2]*B*Q}const q=this.projectAndGetPerspectiveRatio(E,[A,R,O],u.tileID,"globe"===this.transform.projection.name||!!B||this.transform.pitch>0),H=b*q.perspectiveRatio,$=(u.x1*o+g.x-u.padding)*H+q.point.x,ne=(u.y1*o+g.y-u.padding)*H+q.point.y,X=(u.x2*o+g.x+u.padding)*H+q.point.x,ee=(u.y2*o+g.y+u.padding)*H+q.point.y,te=q.perspectiveRatio<=.55||q.occluded;return!this.isInsideGrid($,ne,X,ee)||!x&&this.grid.hitTest($,ne,X,ee,M)||te?{box:[],offscreen:!1,occluded:q.occluded}:{box:[$,ne,X,ee],offscreen:this.isOffscreen($,ne,X,ee),occluded:!1}}placeCollisionCircles(o,u,g,x,b,E,M,A,R,O,B,j,q,H){const $=[],ne=this.transform.elevation,X=ne?ne.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,this.transform.projection):Ve=>[0,0,0],ee=new f.pointGeometry(u.tileAnchorX,u.tileAnchorY),te=this.transform.projection.projectTilePoint(u.tileAnchorX,u.tileAnchorY,H.canonical),oe=X(ee),Q=[te.x+oe[0],te.y+oe[1],te.z+oe[2]],ae=this.projectAndGetPerspectiveRatio(E,[Q[0],Q[1],Q[2]],H,"globe"===this.transform.projection.name||!!ne||this.transform.pitch>0),{perspectiveRatio:me}=ae,be=(O?b/me:b*me)/f.ONE_EM,Se=Gn(new f.pointGeometry(Q[0],Q[1]),M,Q[2]).point,Te=ae.signedDistanceFromCamera>0?_n(be,x,u.lineOffsetX*be,u.lineOffsetY*be,!1,Se,ee,u,g,M,{},ne&&!O?X:null,O&&!!ne,this.transform.projection,H):null;let Ne=!1,pe=!1,He=!0;if(Te&&!ae.occluded){const Ve=.5*j*me+q,nt=new f.pointGeometry(-100,-100),Ie=new f.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),it=new fo,mt=Te.first,st=Te.last;let at=[];for(let ht=mt.path.length-1;ht>=1;ht--)at.push(mt.path[ht]);for(let ht=1;ht<st.path.length;ht++)at.push(st.path[ht]);const _t=2.5*Ve;if(A){const ht=at.map(ne?(vt,Yt)=>{const Hn=X(Yt<mt.path.length-1?mt.tilePath[mt.path.length-1-Yt]:st.tilePath[Yt-mt.path.length+2]);return Gn(vt,A,Hn[2])}:vt=>Gn(vt,A));at=ht.some(vt=>vt.signedDistanceFromCamera<=0)?[]:ht.map(vt=>vt.point)}let At=[];if(at.length>0){const ht=at[0].clone(),vt=at[0].clone();for(let Yt=1;Yt<at.length;Yt++)ht.x=Math.min(ht.x,at[Yt].x),ht.y=Math.min(ht.y,at[Yt].y),vt.x=Math.max(vt.x,at[Yt].x),vt.y=Math.max(vt.y,at[Yt].y);At=ht.x>=nt.x&&vt.x<=Ie.x&&ht.y>=nt.y&&vt.y<=Ie.y?[at]:vt.x<nt.x||ht.x>Ie.x||vt.y<nt.y||ht.y>Ie.y?[]:f.clipLine([at],nt.x,nt.y,Ie.x,Ie.y)}for(const ht of At){it.reset(ht,.25*Ve);let vt=0;vt=it.length<=.5*Ve?1:Math.ceil(it.paddedLength/_t)+1;for(let Yt=0;Yt<vt;Yt++){const Hn=Yt/Math.max(vt-1,1),hr=it.lerp(Hn),Zr=hr.x+Dt,Ar=hr.y+Dt;$.push(Zr,Ar,Ve,0);const Oi=Zr-Ve,Ji=Ar-Ve,Da=Zr+Ve,Lo=Ar+Ve;if(He=He&&this.isOffscreen(Oi,Ji,Da,Lo),pe=pe||this.isInsideGrid(Oi,Ji,Da,Lo),!o&&this.grid.hitTestCircle(Zr,Ar,Ve,B)&&(Ne=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ne,occluded:!1}}}}return{circles:!R&&Ne||!pe?[]:$,offscreen:He,collisionDetected:Ne,occluded:ae.occluded}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let g=1/0,x=1/0,b=-1/0,E=-1/0;for(const O of o){const B=new f.pointGeometry(O.x+Dt,O.y+Dt);g=Math.min(g,B.x),x=Math.min(x,B.y),b=Math.max(b,B.x),E=Math.max(E,B.y),u.push(B)}const M=this.grid.query(g,x,b,E).concat(this.ignoredGrid.query(g,x,b,E)),A={},R={};for(const O of M){const B=O.key;if(void 0===A[B.bucketInstanceId]&&(A[B.bucketInstanceId]={}),A[B.bucketInstanceId][B.featureIndex])continue;const j=[new f.pointGeometry(O.x1,O.y1),new f.pointGeometry(O.x2,O.y1),new f.pointGeometry(O.x2,O.y2),new f.pointGeometry(O.x1,O.y2)];f.polygonIntersectsPolygon(u,j)&&(A[B.bucketInstanceId][B.featureIndex]=!0,void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(o,u,g,x,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,g,x,b){const E=u?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:x,collisionGroupID:b};for(let A=0;A<o.length;A+=4)E.insertCircle(M,o[A],o[A+1],o[A+2])}projectAndGetPerspectiveRatio(o,u,g,x){const b=[u[0],u[1],u[2],1];let E=!1;return u[2]||this.transform.pitch>0?(f.transformMat4$1(b,b,o),this.fogState&&g&&(E=function(M,A,R,O,B,j){const q=j.calculateFogTileMatrix(B),H=[A,R,O];return f.transformMat4(H,H,q),qo(M,H,j.pitch,j._fov)}(this.fogState,u[0],u[1],u[2],g.toUnwrapped(),this.transform)>.9)):Qr(b,b,o),{point:new f.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+Dt,(-b[1]/b[3]+1)/2*this.transform.height+Dt),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/b[3]*.5,1.5),signedDistanceFromCamera:b[3],occluded:x&&b[2]>b[3]||E}}isOffscreen(o,u,g,x){return g<Dt||o>=this.screenRightBoundary||x<Dt||u>this.screenBottomBoundary}isInsideGrid(o,u,g,x){return g>=0&&o<this.gridRightBoundary&&x>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=f.identity([]);return f.translate(o,o,[-100,-100,0]),o}}class lr{constructor(o,u,g,x){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):x&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class xs{constructor(o,u,g,x,b,E=!1){this.text=new lr(o?o.text:null,u,g,b),this.icon=new lr(o?o.icon:null,u,x,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bs{constructor(o,u,g,x=!1){this.text=o,this.icon=u,this.skipFade=g,this.clipped=x}}class pr{constructor(){this.invProjMatrix=f.create(),this.viewportMatrix=f.create(),this.circles=[]}}class ei{constructor(o,u,g,x,b){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=b}}class Ao{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[o]}}function Ja(p,o,u,g,x){const{horizontalAlign:b,verticalAlign:E}=f.getAnchorAlignment(p),M=-(b-.5)*o,A=-(E-.5)*u,R=f.evaluateVariableOffset(p,g);return new f.pointGeometry(M+R[0]*x,A+R[1]*x)}function Xl(p,o,u,g,x){const b=new f.pointGeometry(p,o);return u&&b._rotate(g?x:-x),b}class Yo{constructor(o,u,g,x,b){this.transform=o.clone(),this.collisionIndex=new fr(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ao(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,u,g,x){const b=g.getBucket(u),E=g.latestFeatureIndex;if(!b||!E||u.id!==b.layerIds[0])return;const M=b.layers[0].layout,A=g.collisionBoxArray,R=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),O=g.tileSize/f.EXTENT,B=g.tileID.toUnwrapped(),j=this.transform.calculateProjMatrix(B),q="map"===M.get("text-pitch-alignment"),H="map"===M.get("text-rotation-alignment");u.compileFilter();const $=u.dynamicFilter(),ne=u.dynamicFilterNeedsFeature(),X=this.transform.calculatePixelsToTileUnitsMatrix(g),ee=qn(j,g.tileID.canonical,q,H,this.transform,X);let te=null;if(q){const ae=ys(j,g.tileID.canonical,q,H,this.transform,X);te=f.multiply$1([],this.transform.labelPlaneMatrix,ae)}let oe=null;$&&g.latestFeatureIndex&&(oe={unwrappedTileID:B,dynamicFilter:$,dynamicFilterNeedsFeature:ne,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new ei(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,g.tileID);const Q={bucket:b,layout:M,posMatrix:j,textLabelPlaneMatrix:ee,labelToScreenMatrix:te,clippingData:oe,scale:R,textPixelRatio:O,holdingForFade:g.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(x)for(const ae of b.sortKeyRanges){const{sortKey:me,symbolInstanceStart:be,symbolInstanceEnd:Se}=ae;o.push({sortKey:me,symbolInstanceStart:be,symbolInstanceEnd:Se,parameters:Q})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(o,u,g,x,b,E,M,A,R,O,B,j,q,H,$,ne,X,ee){const te=[j.textOffset0,j.textOffset1],oe=Ja(o,g,x,te,b),Q=this.collisionIndex.placeCollisionBox(b,u,Xl(oe.x,oe.y,E,M,this.transform.angle),B,A,R,O.predicate);if((!ne||0!==this.collisionIndex.placeCollisionBox(H.getSymbolInstanceIconSize(ee,this.transform.zoom,q),ne,Xl(oe.x,oe.y,E,M,this.transform.angle),B,A,R,O.predicate).box.length)&&Q.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:te,width:g,height:x,anchor:o,textScale:b,prevAnchor:ae},this.markUsedJustification(H,o,j,$),H.allowVerticalPlacement&&(this.markUsedOrientation(H,$,j),this.placedOrientations[j.crossTileID]=$),{shift:oe,placedGlyphBoxes:Q}}}placeLayerBucketPart(o,u,g,x){const{bucket:b,layout:E,posMatrix:M,textLabelPlaneMatrix:A,labelToScreenMatrix:R,clippingData:O,textPixelRatio:B,holdingForFade:j,collisionBoxArray:q,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:$,collisionGroup:ne}=o.parameters,X=E.get("text-optional"),ee=E.get("icon-optional"),te=E.get("text-allow-overlap"),oe=E.get("icon-allow-overlap"),Q="map"===E.get("text-rotation-alignment"),ae="map"===E.get("text-pitch-alignment"),me="none"!==E.get("icon-text-fit"),be="viewport-y"===E.get("symbol-z-order");let Se=te&&(oe||!b.hasIconData()||ee),Te=oe&&(te||!b.hasTextData()||X);!b.collisionArrays&&q&&b.deserializeCollisionBoxes(q),g&&x&&b.updateCollisionDebugBuffers(this.transform.zoom,q);const Ne=(pe,He,Ve)=>{if(O){const Zn={zoom:this.transform.zoom,pitch:this.transform.pitch};let nr=null;if(O.dynamicFilterNeedsFeature){const hn=this.retainedQueryData[b.bucketInstanceId];nr=O.featureIndex.loadFeature({featureIndex:pe.featureIndex,bucketIndex:hn.bucketIndex,sourceLayerIndex:hn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(Zn,nr,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new f.pointGeometry(pe.tileAnchorX,pe.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[pe.crossTileID]=new bs(!1,!1,!1,!0),void(u[pe.crossTileID]=!0)}if(u[pe.crossTileID])return;if(j)return void(this.placements[pe.crossTileID]=new bs(!1,!1,!1));let nt=!1,Ie=!1,it=!0,mt=!1,st=!1,at=null,_t={box:null,offscreen:null,occluded:null},At={box:null,offscreen:null,occluded:null},ht=null,vt=null,Yt=null,Hn=0,hr=0,Zr=0;Ve.textFeatureIndex?Hn=Ve.textFeatureIndex:pe.useRuntimeCollisionCircles&&(Hn=pe.featureIndex),Ve.verticalTextFeatureIndex&&(hr=Ve.verticalTextFeatureIndex);const Ar=Zn=>{Zn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||Zn.elevation)&&(Zn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,Zn.tileAnchorX,Zn.tileAnchorY):0)},Oi=Ve.textBox;if(Oi){Ar(Oi);const Zn=hn=>{let Wn=f.WritingMode.horizontal;if(b.allowVerticalPlacement&&!hn&&this.prevPlacement){const ri=this.prevPlacement.placedOrientations[pe.crossTileID];ri&&(this.placedOrientations[pe.crossTileID]=ri,Wn=ri,this.markUsedOrientation(b,Wn,pe))}return Wn},nr=(hn,Wn)=>{if(b.allowVerticalPlacement&&pe.numVerticalGlyphVertices>0&&Ve.verticalTextBox){for(const ri of b.writingModes)if(ri===f.WritingMode.vertical?(_t=Wn(),At=_t):_t=hn(),_t&&_t.box&&_t.box.length)break}else _t=hn()};if(E.get("text-variable-anchor")){let hn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[pe.crossTileID]){const Nn=this.prevPlacement.variableOffsets[pe.crossTileID];hn.indexOf(Nn.anchor)>0&&(hn=hn.filter(ii=>ii!==Nn.anchor),hn.unshift(Nn.anchor))}const Wn=(Nn,ii,Fs)=>{const Fi=b.getSymbolInstanceTextSize(H,pe,this.transform.zoom,He),Ls=(Nn.x2-Nn.x1)*Fi+2*Nn.padding,bh=(Nn.y2-Nn.y1)*Fi+2*Nn.padding,pu=me&&!oe?ii:null;pu&&Ar(pu);let Ta={box:[],offscreen:!1,occluded:!1};const pp=te?2*hn.length:hn.length;for(let zs=0;zs<pp;++zs){const dl=this.attemptAnchorPlacement(hn[zs%hn.length],Nn,Ls,bh,Fi,Q,ae,B,M,ne,zs>=hn.length,pe,He,b,Fs,pu,H,$);if(dl&&(Ta=dl.placedGlyphBoxes,Ta&&Ta.box&&Ta.box.length)){nt=!0,at=dl.shift;break}}return Ta};nr(()=>Wn(Oi,Ve.iconBox,f.WritingMode.horizontal),()=>{const Nn=Ve.verticalTextBox;return Nn&&Ar(Nn),b.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&pe.numVerticalGlyphVertices>0&&Nn?Wn(Nn,Ve.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),_t&&(nt=_t.box,it=_t.offscreen,mt=_t.occluded);const ri=Zn(_t&&_t.box);if(!nt&&this.prevPlacement){const Nn=this.prevPlacement.variableOffsets[pe.crossTileID];Nn&&(this.variableOffsets[pe.crossTileID]=Nn,this.markUsedJustification(b,Nn.anchor,pe,ri))}}else{const hn=(Wn,ri)=>{const Nn=b.getSymbolInstanceTextSize(H,pe,this.transform.zoom,He),ii=this.collisionIndex.placeCollisionBox(Nn,Wn,new f.pointGeometry(0,0),te,B,M,ne.predicate);return ii&&ii.box&&ii.box.length&&(this.markUsedOrientation(b,ri,pe),this.placedOrientations[pe.crossTileID]=ri),ii};nr(()=>hn(Oi,f.WritingMode.horizontal),()=>{const Wn=Ve.verticalTextBox;return b.allowVerticalPlacement&&pe.numVerticalGlyphVertices>0&&Wn?(Ar(Wn),hn(Wn,f.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Zn(_t&&_t.box&&_t.box.length)}}if(ht=_t,nt=ht&&ht.box&&ht.box.length>0,it=ht&&ht.offscreen,mt=ht&&ht.occluded,pe.useRuntimeCollisionCircles){const Zn=b.text.placedSymbolArray.get(pe.centerJustifiedTextSymbolIndex>=0?pe.centerJustifiedTextSymbolIndex:pe.verticalPlacedTextSymbolIndex),nr=f.evaluateSizeForFeature(b.textSizeData,H,Zn),hn=E.get("text-padding");vt=this.collisionIndex.placeCollisionCircles(te,Zn,b.lineVertexArray,b.glyphOffsetArray,nr,M,A,R,g,ae,ne.predicate,pe.collisionCircleDiameter*nr/f.ONE_EM,hn,this.retainedQueryData[b.bucketInstanceId].tileID),nt=te||vt.circles.length>0&&!vt.collisionDetected,it=it&&vt.offscreen,mt=vt.occluded}if(Ve.iconFeatureIndex&&(Zr=Ve.iconFeatureIndex),Ve.iconBox){const Zn=nr=>{Ar(nr);const hn=me&&at?Xl(at.x,at.y,Q,ae,this.transform.angle):new f.pointGeometry(0,0),Wn=b.getSymbolInstanceIconSize($,this.transform.zoom,He);return this.collisionIndex.placeCollisionBox(Wn,nr,hn,oe,B,M,ne.predicate)};At&&At.box&&At.box.length&&Ve.verticalIconBox?(Yt=Zn(Ve.verticalIconBox),Ie=Yt.box.length>0):(Yt=Zn(Ve.iconBox),Ie=Yt.box.length>0),it=it&&Yt.offscreen,st=Yt.occluded}const Ji=X||0===pe.numHorizontalGlyphVertices&&0===pe.numVerticalGlyphVertices,Da=ee||0===pe.numIconVertices;if(Ji||Da?Da?Ji||(Ie=Ie&&nt):nt=Ie&&nt:Ie=nt=Ie&&nt,nt&&ht&&ht.box&&this.collisionIndex.insertCollisionBox(ht.box,E.get("text-ignore-placement"),b.bucketInstanceId,At&&At.box&&hr?hr:Hn,ne.ID),Ie&&Yt&&this.collisionIndex.insertCollisionBox(Yt.box,E.get("icon-ignore-placement"),b.bucketInstanceId,Zr,ne.ID),vt&&(nt&&this.collisionIndex.insertCollisionCircles(vt.circles,E.get("text-ignore-placement"),b.bucketInstanceId,Hn,ne.ID),g)){const Zn=b.bucketInstanceId;let nr=this.collisionCircleArrays[Zn];void 0===nr&&(nr=this.collisionCircleArrays[Zn]=new pr);for(let hn=0;hn<vt.circles.length;hn+=4)nr.circles.push(vt.circles[hn+0]),nr.circles.push(vt.circles[hn+1]),nr.circles.push(vt.circles[hn+2]),nr.circles.push(vt.collisionDetected?1:0)}const Lo="globe"!==this.transform.projection.name;Se=Se&&(Lo||!mt),Te=Te&&(Lo||!st),this.placements[pe.crossTileID]=new bs(nt||Se,Ie||Te,it||b.justReloaded),u[pe.crossTileID]=!0};if(be){const pe=b.getSortedSymbolIndexes(this.transform.angle);for(let He=pe.length-1;He>=0;--He){const Ve=pe[He];Ne(b.symbolInstances.get(Ve),Ve,b.collisionArrays[Ve])}}else for(let pe=o.symbolInstanceStart;pe<o.symbolInstanceEnd;pe++)Ne(b.symbolInstances.get(pe),pe,b.collisionArrays[pe]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[b.bucketInstanceId];f.invert(pe.invProjMatrix,M),pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(o,u,g,x){let b;b=x===f.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[f.getAnchorJustification(u)];const E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const M of E)M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=b>=0&&M!==b?0:g.crossTileID)}markUsedOrientation(o,u,g){const x=u===f.WritingMode.horizontal||u===f.WritingMode.horizontalOnly?u:0,b=u===f.WritingMode.vertical?u:0,E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const M of E)o.text.placedSymbolArray.get(M).placedOrientation=x;g.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const x=u?u.symbolFadeChange(o):1,b=u?u.opacities:{},E=u?u.variableOffsets:{},M=u?u.placedOrientations:{};for(const A in this.placements){const R=this.placements[A],O=b[A];O?(this.opacities[A]=new xs(O,x,R.text,R.icon,null,R.clipped),g=g||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[A]=new xs(null,x,R.text,R.icon,R.skipFade,R.clipped),g=g||R.text||R.icon)}for(const A in b){const R=b[A];if(!this.opacities[A]){const O=new xs(R,x,!1,!1);O.isHidden()||(this.opacities[A]=O,g=g||R.text.placed||R.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in M)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=M[A]);g?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){const g={};for(const x of u){const b=x.getBucket(o);b&&x.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,x.collisionBoxArray)}}updateBucketOpacities(o,u,g){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const x=o.layers[0].layout,b=!!o.layers[0].dynamicFilter(),E=new xs(null,0,!1,!1,!0),M=x.get("text-allow-overlap"),A=x.get("icon-allow-overlap"),R=x.get("text-variable-anchor"),O="map"===x.get("text-rotation-alignment"),B="map"===x.get("text-pitch-alignment"),j="none"!==x.get("icon-text-fit"),q=new xs(null,0,M&&(A||!o.hasIconData()||x.get("icon-optional")),A&&(M||!o.hasTextData()||x.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);const H=(ne,X,ee)=>{for(let te=0;te<X/4;te++)ne.opacityVertexArray.emplaceBack(ee)};let $=0;for(let ne=0;ne<o.symbolInstances.length;ne++){const X=o.symbolInstances.get(ne),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:te,crossTileID:oe}=X;let Q=this.opacities[oe];u[oe]?Q=E:Q||(Q=q,this.opacities[oe]=Q),u[oe]=!0;const ae=ee>0||te>0,me=X.numIconVertices>0,be=this.placedOrientations[X.crossTileID],Se=be===f.WritingMode.vertical,Te=be===f.WritingMode.horizontal||be===f.WritingMode.horizontalOnly;if(!ae&&!me||Q.isHidden()||$++,ae){const Ne=mi(Q.text);H(o.text,ee,Se?Cn:Ne),H(o.text,te,Te?Cn:Ne);const pe=Q.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(nt=>{nt>=0&&(o.text.placedSymbolArray.get(nt).hidden=pe||Se?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=pe||Te?1:0);const He=this.variableOffsets[X.crossTileID];He&&this.markUsedJustification(o,He.anchor,X,be);const Ve=this.placedOrientations[X.crossTileID];Ve&&(this.markUsedJustification(o,"left",X,Ve),this.markUsedOrientation(o,Ve,X))}if(me){const Ne=mi(Q.icon);X.placedIconSymbolIndex>=0&&(H(o.icon,X.numIconVertices,Se?Cn:Ne),o.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=Q.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(H(o.icon,X.numVerticalIconVertices,Te?Cn:Ne),o.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=Q.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ne=o.collisionArrays[ne];if(Ne){let pe=new f.pointGeometry(0,0),He=!0;if(Ne.textBox||Ne.verticalTextBox){if(R){const nt=this.variableOffsets[oe];nt?(pe=Ja(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textScale),O&&pe._rotate(B?this.transform.angle:-this.transform.angle)):He=!1}b&&(He=!Q.clipped),Ne.textBox&&Po(o.textCollisionBox.collisionVertexArray,Q.text.placed,!He||Se,pe.x,pe.y),Ne.verticalTextBox&&Po(o.textCollisionBox.collisionVertexArray,Q.text.placed,!He||Te,pe.x,pe.y)}const Ve=He&&Boolean(!Te&&Ne.verticalIconBox);Ne.iconBox&&Po(o.iconCollisionBox.collisionVertexArray,Q.icon.placed,Ve,j?pe.x:0,j?pe.y:0),Ne.verticalIconBox&&Po(o.iconCollisionBox.collisionVertexArray,Q.icon.placed,!Ve,j?pe.x:0,j?pe.y:0)}}}if(o.fullyClipped=0===$,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ne.invProjMatrix,o.placementViewportMatrix=ne.viewportMatrix,o.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function Po(p,o,u,g,x){p.emplaceBack(o?1:0,u?1:0,g||0,x||0),p.emplaceBack(o?1:0,u?1:0,g||0,x||0),p.emplaceBack(o?1:0,u?1:0,g||0,x||0),p.emplaceBack(o?1:0,u?1:0,g||0,x||0)}const rg=Math.pow(2,25),ip=Math.pow(2,24),$i=Math.pow(2,17),Kc=Math.pow(2,16),ha=Math.pow(2,9),th=Math.pow(2,8),nh=Math.pow(2,1);function mi(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const o=p.placed?1:0,u=Math.floor(127*p.opacity);return u*rg+o*ip+u*$i+o*Kc+u*ha+o*th+u*nh+o}const Cn=0;class Td{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,g,x,b){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(E,x,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((M,A)=>M.sortKey-A.sortKey));this._currentPartIndex<E.length;){const M=E[this._currentPartIndex];if(u.placeLayerBucketPart(M,this._seenCrossTileIDs,g,0===M.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class ig{constructor(o,u,g,x,b,E,M,A){this.placement=new Yo(o,b,E,M,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,u,g){const x=f.exported.now(),b=()=>{const E=f.exported.now()-x;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=u[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=M)&&(!E.maxzoom||E.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Td(E)),this._inProgressLayer.continuePlacement(g[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const op=512/f.EXTENT/2;class zt{constructor(o,u,g){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let x=0;x<u.length;x++){const b=u.get(x),E=b.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,u){const g=op/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*f.EXTENT+o.tileAnchorX)*g),y:Math.floor((u.canonical.y*f.EXTENT+o.tileAnchorY)*g)}}findMatches(o,u,g){const x=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<o.length;b++){const E=o.get(b);if(E.crossTileID)continue;const M=this.indexedSymbolInstances[E.key];if(!M)continue;const A=this.getScaledCoordinates(E,u);for(const R of M)if(Math.abs(R.coord.x-A.x)<=x&&Math.abs(R.coord.y-A.y)<=x&&!g[R.crossTileID]){g[R.crossTileID]=!0,E.crossTileID=R.crossTileID;break}}}}class sp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ti{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(0!==u)for(const g in this.indexes){const x=this.indexes[g],b={};for(const E in x){const M=x[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+u),b[M.tileID.key]=M}this.indexes[g]=b}this.lng=o}addBucket(o,u,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const x=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>o.overscaledZ)for(const M in E){const A=E[M];A.tileID.isChildOf(o)&&A.findMatches(u.symbolInstances,o,x)}else{const M=E[o.scaledTo(Number(b)).key];M&&M.findMatches(u.symbolInstances,o,x)}}for(let b=0;b<u.symbolInstances.length;b++){const E=u.symbolInstances.get(b);E.crossTileID||(E.crossTileID=g.generate(),x[E.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new zt(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const g in u.indexedSymbolInstances)for(const x of u.indexedSymbolInstances[g])delete this.usedCrossTileIDs[o][x.crossTileID]}removeStaleBuckets(o){let u=!1;for(const g in this.indexes){const x=this.indexes[g];for(const b in x)o[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[b]),delete x[b],u=!0)}return u}}class Qa{constructor(){this.layerIndexes={},this.crossTileIDs=new sp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,g,x){let b=this.layerIndexes[o.id];void 0===b&&(b=this.layerIndexes[o.id]=new ti);let E=!1;const M={};"globe"!==x.name&&b.handleWrapJump(g);for(const A of u){const R=A.getBucket(o);R&&o.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(A.tileID,R,this.crossTileIDs)&&(E=!0),M[R.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(E=!0),E}pruneUnusedLayers(o){const u={};o.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const el=(p,o)=>f.emitValidationErrors(p,o&&o.filter(u=>"source.canvas"!==u.identifier)),Md=f.pick(rt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Sd=f.pick(rt,["setCenter","setZoom","setBearing","setPitch"]),rh={version:8,layers:[],sources:{}},ko={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Hr extends f.Evented{constructor(o,u={}){super(),this.map=o,this.dispatcher=new Tn(xt(),this),this.imageManager=new or,this.imageManager.setEventedParent(this),this.glyphManager=new f.GlyphManager(o._requestManager,u.localFontFamily?f.LocalGlyphMode.all:u.localIdeographFontFamily?f.LocalGlyphMode.ideographs:f.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new f.LineAtlas(256,512),this.crossTileSymbolIndex=new Qa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new f.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const g=this;this._rtlTextPluginCallback=Hr.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,E)=>{if(f.triggerPluginCompletionEvent(b),E&&E.every(M=>M))for(const M in g._sourceCaches){const A=g._sourceCaches[M],R=A.getSource().type;"vector"!==R&&"geojson"!==R||A.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const b=this.getSource(x.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===b.id&&this._validateLayer(M)}})}loadURL(o,u={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof u.validate?u.validate:!f.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,u.accessToken);const x=this.map._requestManager.transformRequest(o,f.ResourceType.Style);this._request=f.getJSON(x,(b,E)=>{this._request=null,b?this.fire(new f.ErrorEvent(b)):E&&this._load(E,g)})}loadJSON(o,u={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(o,!1!==u.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(rh,!1)}_updateLayerCount(o,u){const g=u?1:-1;o.is3D()&&(this._num3DLayers+=g),"circle"===o.type&&(this._numCircleLayers+=g),"symbol"===o.type&&(this._numSymbolLayers+=g)}_load(o,u){if(u&&el(this,f.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this._updateMapProjection();for(const x in o.sources)this.addSource(x,o.sources[x],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const g=sn(this.stylesheet.layers);this._order=g.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of g)x=f.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new $a(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(o){this._spriteRequest=function(u,g,x){let b,E,M;const A=f.exported.devicePixelRatio>1?"@2x":"";let R=f.getJSON(g.transformRequest(g.normalizeSpriteURL(u,A,".json"),f.ResourceType.SpriteJSON),(j,q)=>{R=null,M||(M=j,b=q,B())}),O=f.getImage(g.transformRequest(g.normalizeSpriteURL(u,A,".png"),f.ResourceType.SpriteImage),(j,q)=>{O=null,M||(M=j,E=q,B())});function B(){if(M)x(M);else if(b&&E){const j=f.exported.getImageData(E),q={};for(const H in b){const{width:$,height:ne,x:X,y:ee,sdf:te,pixelRatio:oe,stretchX:Q,stretchY:ae,content:me}=b[H],be=new f.RGBAImage({width:$,height:ne});f.RGBAImage.copy(j,be,{x:X,y:ee},{x:0,y:0},{width:$,height:ne}),q[H]={data:be,pixelRatio:oe,sdf:te,stretchX:Q,stretchY:ae,content:me}}x(null,q)}}return{cancel(){R&&(R.cancel(),R=null),O&&(O.cancel(),O=null)}}}(o,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new f.ErrorEvent(u));else if(g)for(const x in g)this.imageManager.addImage(x,g[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(o){const u=this.getSource(o.source);if(!u)return;const g=o.sourceLayer;g&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(g))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const u=[];for(const g of o){const x=this._layers[g];"custom"!==x.type&&u.push(x.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&ko[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const u=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(x.length||b.length)&&this._updateWorkerLayers(x,b);for(const E in this._updatedSources){const M=this._updatedSources[E];"reload"===M?this._reloadSource(E):"clear"===M&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const g={};for(const x in this._sourceCaches){const b=this._sourceCaches[x];g[x]=b.used,b.used=!1}for(const x of this._order){const b=this._layers[x];if(b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)){const M=this._getLayerSourceCache(b);M&&(M.used=!0)}const E=this.map.painter;if(E){const M=b.getProgramIds();if(!M)continue;const A=b.getProgramConfiguration(o.zoom);for(const R of M)E.useProgram(R,A)}}for(const x in g){const b=this._sourceCaches[x];g[x]!==b.used&&b.getSource().fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),el(this,f.validateStyle(o)))return!1;(o=f.clone$1(o)).layers=sn(o.layers);const u=function(x,b){if(!x)return[{command:rt.setStyle,args:[b]}];let E=[];try{if(!Oe(x.version,b.version))return[{command:rt.setStyle,args:[b]}];Oe(x.center,b.center)||E.push({command:rt.setCenter,args:[b.center]}),Oe(x.zoom,b.zoom)||E.push({command:rt.setZoom,args:[b.zoom]}),Oe(x.bearing,b.bearing)||E.push({command:rt.setBearing,args:[b.bearing]}),Oe(x.pitch,b.pitch)||E.push({command:rt.setPitch,args:[b.pitch]}),Oe(x.sprite,b.sprite)||E.push({command:rt.setSprite,args:[b.sprite]}),Oe(x.glyphs,b.glyphs)||E.push({command:rt.setGlyphs,args:[b.glyphs]}),Oe(x.transition,b.transition)||E.push({command:rt.setTransition,args:[b.transition]}),Oe(x.light,b.light)||E.push({command:rt.setLight,args:[b.light]}),Oe(x.fog,b.fog)||E.push({command:rt.setFog,args:[b.fog]}),Oe(x.projection,b.projection)||E.push({command:rt.setProjection,args:[b.projection]});const M={},A=[];!function(B,j,q,H){let $;for($ in j=j||{},B=B||{})B.hasOwnProperty($)&&(j.hasOwnProperty($)||ln($,q,H));for($ in j)j.hasOwnProperty($)&&(B.hasOwnProperty($)?Oe(B[$],j[$])||("geojson"===B[$].type&&"geojson"===j[$].type&&Ko(B,j,$)?q.push({command:rt.setGeoJSONSourceData,args:[$,j[$].data]}):_s($,j,q,H)):an($,j,q))}(x.sources,b.sources,A,M);const R=[];x.layers&&x.layers.forEach(B=>{B.source&&M[B.source]?E.push({command:rt.removeLayer,args:[B.id]}):R.push(B)});let O=x.terrain;O&&M[O.source]&&(E.push({command:rt.setTerrain,args:[void 0]}),O=void 0),E=E.concat(A),Oe(O,b.terrain)||E.push({command:rt.setTerrain,args:[b.terrain]}),function(B,j,q){j=j||[];const H=(B=B||[]).map(Wt),$=j.map(Wt),ne=B.reduce(Ut,{}),X=j.reduce(Ut,{}),ee=H.slice(),te=Object.create(null);let oe,Q,ae,me,be,Se,Te;for(oe=0,Q=0;oe<H.length;oe++)ae=H[oe],X.hasOwnProperty(ae)?Q++:(q.push({command:rt.removeLayer,args:[ae]}),ee.splice(ee.indexOf(ae,Q),1));for(oe=0,Q=0;oe<$.length;oe++)ae=$[$.length-1-oe],ee[ee.length-1-oe]!==ae&&(ne.hasOwnProperty(ae)?(q.push({command:rt.removeLayer,args:[ae]}),ee.splice(ee.lastIndexOf(ae,ee.length-Q),1)):Q++,Se=ee[ee.length-oe],q.push({command:rt.addLayer,args:[X[ae],Se]}),ee.splice(ee.length-oe,0,ae),te[ae]=!0);for(oe=0;oe<$.length;oe++)if(ae=$[oe],me=ne[ae],be=X[ae],!te[ae]&&!Oe(me,be))if(Oe(me.source,be.source)&&Oe(me["source-layer"],be["source-layer"])&&Oe(me.type,be.type)){for(Te in Qe(me.layout,be.layout,q,ae,null,rt.setLayoutProperty),Qe(me.paint,be.paint,q,ae,null,rt.setPaintProperty),Oe(me.filter,be.filter)||q.push({command:rt.setFilter,args:[ae,be.filter]}),Oe(me.minzoom,be.minzoom)&&Oe(me.maxzoom,be.maxzoom)||q.push({command:rt.setLayerZoomRange,args:[ae,be.minzoom,be.maxzoom]}),me)me.hasOwnProperty(Te)&&"layout"!==Te&&"paint"!==Te&&"filter"!==Te&&"metadata"!==Te&&"minzoom"!==Te&&"maxzoom"!==Te&&(0===Te.indexOf("paint.")?Qe(me[Te],be[Te],q,ae,Te.slice(6),rt.setPaintProperty):Oe(me[Te],be[Te])||q.push({command:rt.setLayerProperty,args:[ae,Te,be[Te]]}));for(Te in be)be.hasOwnProperty(Te)&&!me.hasOwnProperty(Te)&&"layout"!==Te&&"paint"!==Te&&"filter"!==Te&&"metadata"!==Te&&"minzoom"!==Te&&"maxzoom"!==Te&&(0===Te.indexOf("paint.")?Qe(me[Te],be[Te],q,ae,Te.slice(6),rt.setPaintProperty):Oe(me[Te],be[Te])||q.push({command:rt.setLayerProperty,args:[ae,Te,be[Te]]}))}else q.push({command:rt.removeLayer,args:[ae]}),Se=ee[ee.lastIndexOf(ae)+1],q.push({command:rt.addLayer,args:[be,Se]})}(R,b.layers,E)}catch(M){console.warn("Unable to compute style diff:",M),E=[{command:rt.setStyle,args:[b]}]}return E}(this.serialize(),o).filter(x=>!(x.command in Sd));if(0===u.length)return!1;const g=u.filter(x=>!(x.command in Md));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);return u.forEach(x=>{"setTransition"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,u){return this.getImage(o)?this.fire(new f.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,u),this._afterImageUpdated(o),this)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new f.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,u,g={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(f.validateSource,`sources.${o}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const x=_e(o,u,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:x.serialize(),sourceId:o}));const b=E=>{const M=(E?"symbol:":"other:")+o,A=this._sourceCaches[M]=new f.SourceCache(M,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[o]=A,A.style=this,A.onAdd(this.map)};b(!1),"vector"!==u.type&&"geojson"!==u.type||b(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const u=this.getSource(o);if(!u)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===o)return this.fire(new f.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new f.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(o);for(const x of g)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,u){this._checkLoaded(),this.getSource(o).setData(u),this._changed=!0}getSource(o){const u=this._getSourceCache(o);return u&&u.getSource()}addLayer(o,u,g={}){this._checkLoaded();const x=o.id;if(this.getLayer(x))return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let b;if("custom"===o.type){if(el(this,f.validateCustomStyleLayer(o)))return;b=f.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(x,o.source),o=f.clone$1(o),o=f.extend(o,{source:x})),this._validate(f.validateLayer,`layers.${x}`,o,{arrayIndex:-1},g))return;b=f.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const E=u?this._order.indexOf(u):this._order.length;if(u&&-1===E)return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const M=this._getLayerSourceCache(b);if(this._removedLayers[x]&&b.source&&M&&"custom"!==b.type){const A=this._removedLayers[x];delete this._removedLayers[x],A.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new f.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;const g=this._order.indexOf(o);this._order.splice(g,1);const x=u?this._order.indexOf(u):this._order.length;u&&-1===x?this.fire(new f.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(x,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const u=this._layers[o];if(!u)return void this.fire(new f.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const u in this._layers)if(this._layers[u].type===o)return!0;return!1}setLayerZoomRange(o,u,g){this._checkLoaded();const x=this.getLayer(o);x?x.minzoom===u&&x.maxzoom===g||(null!=u&&(x.minzoom=u),null!=g&&(x.maxzoom=g),this._updateLayer(x)):this.fire(new f.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,u,g={}){this._checkLoaded();const x=this.getLayer(o);if(x){if(!Oe(x.filter,u))return null==u?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(f.validateFilter,`layers.${x.id}.filter`,u,{layerType:x.type},g)||(x.filter=f.clone$1(u),this._updateLayer(x)))}else this.fire(new f.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const u=this.getLayer(o);return u&&f.clone$1(u.filter)}setLayoutProperty(o,u,g,x={}){this._checkLoaded();const b=this.getLayer(o);b?Oe(b.getLayoutProperty(u),g)||(b.setLayoutProperty(u,g,x),this._updateLayer(b)):this.fire(new f.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,u){const g=this.getLayer(o);if(g)return g.getLayoutProperty(u);this.fire(new f.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,u,g,x={}){this._checkLoaded();const b=this.getLayer(o);b?Oe(b.getPaintProperty(u),g)||(b.setPaintProperty(u,g,x)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new f.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,u){const g=this.getLayer(o);return g&&g.getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();const g=o.source,x=o.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new f.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const E=b.type;if("geojson"===E&&x)return void this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!x)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(g);for(const A of M)A.setFeatureState(x,o.id,u)}removeFeatureState(o,u){this._checkLoaded();const g=o.source,x=this.getSource(g);if(!x)return void this.fire(new f.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=x.type,E="vector"===b?o.sourceLayer:void 0;if("vector"===b&&!E)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(g);for(const A of M)A.removeFeatureState(E,o.id,u)}getFeatureState(o){this._checkLoaded();const u=o.source,g=o.sourceLayer,x=this.getSource(u);if(x){if("vector"!==x.type||g)return void 0===o.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,o.id);this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new f.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();o[g.id]||(o[g.id]=g.serialize())}return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(o){this._updatedLayers[o.id]=!0;const u=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[o.source]="reload",u.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const u=E=>"fill-extrusion"===this._layers[E].type,g={},x=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(u(M)){g[M]=E;for(const A of o){const R=A[M];if(R)for(const O of R)x.push(O)}}}x.sort((E,M)=>M.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(u(M))for(let A=x.length-1;A>=0;A--){const R=x[A].feature;if(g[R.layer.id]<E)break;b.push(R),x.pop()}else for(const A of o){const R=A[M];if(R)for(const O of R)b.push(O.feature)}}return b}queryRenderedFeatures(o,u,g){u&&u.filter&&this._validate(f.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const x={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of u.layers){const R=this._layers[A];if(!R)return this.fire(new f.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];x[R.source]=!0}}const b=[];u.availableImages=this._availableImages;const E=u&&u.layers?u.layers.some(A=>{const R=this.getLayer(A);return R&&R.is3D()}):this.has3DLayers(),M=br.createFromScreenPoints(o,g);for(const A in this._sourceCaches){const R=this._sourceCaches[A].getSource().id;u.layers&&!x[R]||b.push(ye(this._sourceCaches[A],this._layers,this._serializedLayers,M,u,g,E,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(A,R,O,B,j,q,H){const $={},ne=q.queryRenderedSymbols(B),X=[];for(const ee of Object.keys(ne).map(Number))X.push(H[ee]);X.sort(Ue);for(const ee of X){const te=ee.featureIndex.lookupSymbolFeatures(ne[ee.bucketInstanceId],R,ee.bucketIndex,ee.sourceLayerIndex,j.filter,j.layers,j.availableImages,A);for(const oe in te){const Q=$[oe]=$[oe]||[],ae=te[oe];ae.sort((me,be)=>{const Se=ee.featureSortOrder;if(Se){const Te=Se.indexOf(me.featureIndex);return Se.indexOf(be.featureIndex)-Te}return be.featureIndex-me.featureIndex});for(const me of ae)Q.push(me)}}for(const ee in $)$[ee].forEach(te=>{const oe=te.feature,Q=O(A[ee]).getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=Q});return $}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,u){u&&u.filter&&this._validate(f.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(o);let x=[];for(const b of g)x=x.concat(Re(b,u));return x}addSourceType(o,u,g){return Hr.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(Hr.setSourceType(o,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();const g=this.light.getLight();let x=!1;for(const E in o)if(!Oe(o[E],g[E])){x=!0;break}if(!x)return;const b={now:f.exported.now(),transition:f.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,u=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof o.source){const g="terrain-dem-src";this.addSource(g,o.source),o=f.clone$1(o),o=f.extend(o,{source:g})}if(this._validate(f.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(o,u);else{const g=this.terrain,x=g.get();for(const b in o)if(!Oe(o[b],x[b])){g.set(o),this.stylesheet.terrain=o;const E={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const u=this.fog=new Wc(o,this.map.transform);this.stylesheet.fog=o;const g={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();for(const x in o)if(!Oe(o[x],g[x])){u.set(o),this.stylesheet.fog=o;const b={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(b);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...u)}_createTerrain(o,u){const g=this.terrain=new Ni(o,u);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(x)}_force3DLayerUpdate(){for(const o in this._layers){const u=this._layers[o];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const u=this._layers[o];"symbol"===u.type&&this._updateLayer(u)}}_validate(o,u,g,x,b={}){return(!b||!1!==b.validate)&&el(this,o.call(f.validateStyle,f.extend({key:u,style:this.serialize(),value:g,styleSpec:f.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const u=this._getSourceCaches(o);for(const g of u)g.clearTiles()}_reloadSource(o){const u=this._getSourceCaches(o);for(const g of u)g.resume(),g.reload()}_updateSources(o){for(const u in this._sourceCaches)this._sourceCaches[u].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const u=this._sourceCaches[o];u.resume(),u.reload()}}_updatePlacement(o,u,g,x,b=!1){let E=!1,M=!1;const A={};for(const R of this._order){const O=this._layers[R];if("symbol"!==O.type)continue;if(!A[O.source]){const j=this._getLayerSourceCache(O);if(!j)continue;A[O.source]=j.getRenderableIds(!0).map(q=>j.getTileByID(q)).sort((q,H)=>H.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(H.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(O,A[O.source],o.center.lng,o.projection);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new f.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),o.zoom))&&(this.pauseablePlacement=new ig(o,this._order,b,u,g,x,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),M=!0),E&&this.pauseablePlacement.placement.setStale()),M||E)for(const R of this._order){const O=this._layers[R];"symbol"===O.type&&this.placement.updateLayerOpacities(O,A[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const x=b=>{b&&b.setDependencies(u.tileID.key,u.type,u.icons)};x(this._otherSourceCaches[u.source]),x(this._symbolSourceCaches[u.source])}getGlyphs(o,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(o,u,g){return f.makeRequest(u,g)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const u=[];return this._otherSourceCaches[o]&&u.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&u.push(this._symbolSourceCaches[o]),u}_isSourceCacheLoaded(o){const u=this._getSourceCaches(o);return 0===u.length?(this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Hr.getSourceType=function(p){return ge[p]},Hr.setSourceType=function(p,o){ge[p]=o},Hr.registerForPluginStateChange=f.registerForPluginStateChange;var tl="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Kl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let St={},Ro={};St=yt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Ro=yt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Yc=yt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Gi=tl;var nl={background:yt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:yt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:yt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:yt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:yt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:yt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:yt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:yt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:yt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:yt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:yt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:yt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:yt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:yt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:yt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:yt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:yt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:yt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:yt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:yt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:yt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:yt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Kl),skyboxGradient:yt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Kl),skyboxCapture:yt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:yt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:yt("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function yt(p,o,u){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=p.match(x),M=o.match(x),A=tl.match(x);let R=M?M.concat(E):E;u||(St.staticUniforms&&(R=St.staticUniforms.concat(R)),Ro.staticUniforms&&(R=Ro.staticUniforms.concat(R))),R&&(R=R.concat(A));const O={};return{fragmentSource:p=p.replace(g,(B,j,q,H,$)=>(O[$]=!0,"define"===j?`\n#ifndef HAS_UNIFORM_u_${$}\nvarying ${q} ${H} ${$};\n#else\nuniform ${q} ${H} u_${$};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${$}\n    ${q} ${H} ${$} = u_${$};\n#endif\n`)),vertexSource:o=o.replace(g,(B,j,q,H,$)=>{const ne="float"===H?"vec2":"vec4",X=$.match(/color/)?"color":ne;return O[$]?"define"===j?`\n#ifndef HAS_UNIFORM_u_${$}\nuniform lowp float u_${$}_t;\nattribute ${q} ${ne} a_${$};\nvarying ${q} ${H} ${$};\n#else\nuniform ${q} ${H} u_${$};\n#endif\n`:"vec4"===X?`\n#ifndef HAS_UNIFORM_u_${$}\n    ${$} = a_${$};\n#else\n    ${q} ${H} ${$} = u_${$};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${$}\n    ${$} = unpack_mix_${X}(a_${$}, u_${$}_t);\n#else\n    ${q} ${H} ${$} = u_${$};\n#endif\n`:"define"===j?`\n#ifndef HAS_UNIFORM_u_${$}\nuniform lowp float u_${$}_t;\nattribute ${q} ${ne} a_${$};\n#else\nuniform ${q} ${H} u_${$};\n#endif\n`:"vec4"===X?`\n#ifndef HAS_UNIFORM_u_${$}\n    ${q} ${H} ${$} = a_${$};\n#else\n    ${q} ${H} ${$} = u_${$};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${$}\n    ${q} ${H} ${$} = unpack_mix_${X}(a_${$}, u_${$}_t);\n#else\n    ${q} ${H} ${$} = u_${$};\n#endif\n`}),staticAttributes:b,staticUniforms:R}}class po{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,g,x,b,E,M,A){this.context=o;let R=this.boundPaintVertexBuffers.length!==x.length;for(let O=0;!R&&O<x.length;O++)this.boundPaintVertexBuffers[O]!==x[O]&&(R=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===g&&!R&&this.boundIndexBuffer===b&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===A?(o.bindVertexArrayOES.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),A&&A.bind()):this.freshBind(u,g,x,b,E,M,A)}freshBind(o,u,g,x,b,E,M){let A;const R=o.numAttributes,O=this.context,B=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=M;else{A=O.currentNumAttributes||0;for(let j=R;j<A;j++)B.disableVertexAttribArray(j)}u.enableAttributes(B,o);for(const j of g)j.enableAttributes(B,o);E&&E.enableAttributes(B,o),M&&M.enableAttributes(B,o),u.bind(),u.setVertexAttribPointers(B,o,b);for(const j of g)j.bind(),j.setVertexAttribPointers(B,o,b);E&&(E.bind(),E.setVertexAttribPointers(B,o,b)),x&&x.bind(),M&&(M.bind(),M.setVertexAttribPointers(B,o,b)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hi(p,o){const u=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new f.MercatorCoordinate(0,g/u).toLngLat().lat,new f.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function ap(p,o,u,g,x,b,E){const M=p.context,A=M.gl,R=u.fbo;if(!R)return;p.prepareDrawTile();const O=p.useProgram("hillshade");M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());const B=(($,ne,X,ee)=>{const te=X.paint.get("hillshade-shadow-color"),oe=X.paint.get("hillshade-highlight-color"),Q=X.paint.get("hillshade-accent-color");let ae=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===X.paint.get("hillshade-illumination-anchor")&&(ae-=$.transform.angle);const me=!$.options.moving;return{u_matrix:ee||$.transform.calculateProjMatrix(ne.tileID.toUnwrapped(),me),u_image:0,u_latrange:Hi(0,ne.tileID),u_light:[X.paint.get("hillshade-exaggeration"),ae],u_shadow:te,u_highlight:oe,u_accent:Q}})(p,u,g,p.terrain?o.projMatrix:null);p.prepareDrawProgram(M,O,o.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:q,tileBoundsSegments:H}=p.getTileBoundsBuffers(u);O.draw(M,A.TRIANGLES,x,b,E,f.CullFaceMode.disabled,B,g.id,j,q,H)}function Id(p,o,u){if(!o.needsDEMTextureUpload)return;const g=p.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||p.getTileTexture(u.stride);const b=u.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new f.Texture(g,b,x.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function qi(p,o,u,g,x,b){const E=p.context,M=E.gl;if(!o.dem)return;const A=o.dem;if(E.activeTexture.set(M.TEXTURE1),Id(p,o,A),!o.demTexture)return;o.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const R=A.dim;E.activeTexture.set(M.TEXTURE0);let O=o.fbo;if(!O){const H=new f.Texture(E,{width:R,height:R,data:null},M.RGBA);H.bind(M.LINEAR,M.CLAMP_TO_EDGE),O=o.fbo=E.createFramebuffer(R,R,!0),O.colorAttachment.set(H.texture)}E.bindFramebuffer.set(O.framebuffer),E.viewport.set([0,0,R,R]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:j,tileBoundsSegments:q}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(E,M.TRIANGLES,g,x,b,f.CullFaceMode.disabled,((H,$)=>{const ne=$.stride,X=f.create();return f.ortho(X,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(X,X,[0,-f.EXTENT,0]),{u_matrix:X,u_image:1,u_dimension:[ne,ne],u_zoom:H.overscaledZ,u_unpack:$.unpackVector}})(o.tileID,A),u.id,B,j,q),o.needsHillshadePrepare=!1}const ih=(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_image0:new f.Uniform1i(p,o.u_image0),u_skirt_height:new f.Uniform1f(p,o.u_skirt_height)}),Ad=(p,o)=>({u_matrix:p,u_image0:0,u_skirt_height:o}),Pd=(p,o,u,g,x,b)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:o,u_merc_matrix:u,u_zoom_transition:g,u_merc_center:x,u_image0:0,u_grid_matrix:b?Float32Array.from(b):new Float32Array(9)});function oh(p,o){return null!=p&&null!=o&&!(!p.hasData()||!o.hasData())&&null!=p.demTexture&&null!=o.demTexture&&p.tileID.key!==o.tileID.key}const un=new class{constructor(){this.operations={}}newMorphing(p,o,u,g,x){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[p]={startTime:g,phase:0,duration:x,from:o,to:u,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const o=this.operations[p];return{from:o.from,to:o.to,phase:o.phase}}update(p){for(const o in this.operations){const u=this.operations[o];for(u.phase=(p-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,p)){delete this.operations[o];break}}}_nextOp(p,o){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=o,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Yl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function kd(p,o){const u=1<<p.z;return!o&&(0===p.x||p.x===u-1)||0===p.y||p.y===u-1}const Jo=p=>({u_matrix:p});function Mn(p,o,u,g,x){if(x>0){const b=f.exported.now(),E=(b-p.timeAdded)/x,M=o?(b-o.timeAdded)/x:-1,A=u.getSource(),R=g.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),O=!o||Math.abs(o.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),B=O&&p.refreshedUponExpiration?1:f.clamp(O?E:1-M,0,1);return p.refreshedUponExpiration&&E>=1&&(p.refreshedUponExpiration=!1),o?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}const Jc=2*f.mercatorZfromAltitude(1,0)*f.GLOBE_RADIUS*Math.PI;class da extends f.SourceCache{constructor(o){const u={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new Tn(xt(),null),x=_e("mock-dem",u,g,o.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,u){o.state="loaded",u(null)}}class fa extends f.SourceCache{constructor(o){const u=_e("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new Tn(xt(),null),o.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,u,g){if(o.freezeTileCoverage)return;this.transform=o;const x=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const M=new f.Tile(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom);M.state="loaded",this._tiles[E.key]=M}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){const u=this.proxyCachedFBO[o];if(void 0!==u){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Qc extends f.OverscaledTileID{constructor(o,u,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class cr extends f.Elevation{constructor(o,u){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,b]=function(A){const R=new f.StructArrayLayout4i8,O=new f.StructArrayLayout3ui6,B=131;R.reserve(17161),O.reserve(33800);const j=f.EXTENT/128,q=f.EXTENT+j/2,H=q+j;for(let ne=-j;ne<H;ne+=j)for(let X=-j;X<H;X+=j){const ee=X<0||X>q||ne<0||ne>q?24575:0,te=f.clamp(Math.round(X),0,f.EXTENT),oe=f.clamp(Math.round(ne),0,f.EXTENT);R.emplaceBack(te+ee,oe,te,oe)}const $=(ne,X)=>{const ee=X*B+ne;O.emplaceBack(ee+1,ee,ee+B),O.emplaceBack(ee+B,ee+B+1,ee+1)};for(let ne=1;ne<129;ne++)for(let X=1;X<129;X++)$(X,ne);return[0,129].forEach(ne=>{for(let X=0;X<130;X++)$(X,ne),$(ne,X)}),[R,O,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(g,f.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=f.SegmentVector.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=f.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new fa(u.map),this.orthoMatrix=f.create(),f.ortho(this.orthoMatrix,0,f.EXTENT,0,f.EXTENT,0,1);const M=E.gl;this._overlapStencilMode=new f.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new da(u.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,u,g){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const x=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const b=()=>{this.sourceCache.used&&f.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(u,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),u.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&f.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=u.getIds().map(A=>{const R=u.getTileByID(A).tileID;return R.projMatrix=g.calculateProjMatrix(R.toUnwrapped()),R});(function(A,R){const O=R.transform.pointCoordinate(R.transform.getCameraPoint()),B=new f.pointGeometry(O.x,O.y);A.sort((j,q)=>{if(q.overscaledZ-j.overscaledZ)return q.overscaledZ-j.overscaledZ;const H=new f.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),$=new f.pointGeometry(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ne=B.mult(1<<j.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(H)-ne.distSqr($)})})(x,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const A in E){const R=E[A];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,o[A],b),R.usedForTerrain))continue;const O=o[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[u.id]=x.map(A=>new Qc(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=f.exported.now();const M={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const R=this.terrainTileForTile[A.key];if(!R)continue;const O=R.tileID.key;O in M||(this._visibleDemTiles.push(R),M[O]=O)}}_assignTerrainTiles(o){this._initializing||o.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,u=o.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(o.activeTexture.set(u.TEXTURE1),Id(this.painter,x,b))}}_prepareDemTileUniforms(o,u,g,x){if(!u||null==u.demTexture)return!1;const b=o.tileID.canonical,E=Math.pow(2,u.tileID.canonical.z-b.z),M=x||"";return g[`u_dem_tl${M}`]=[b.x*E%1,b.y*E%1],g[`u_dem_scale${M}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,u=o.gl;if(!this._emptyDepthBufferTexture){const g=new f.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new f.Texture(o,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const u=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const b=x.dem.tree.minimums[0];return b>0&&o++,g+b},0);return o?u/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,u=o.gl;o.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new f.RGBAImage({width:1,height:1},new Uint8Array(f.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new f.Texture(o,x,u.RGBA,{premultiply:!1}),b}setupElevationDraw(o,u,g){const x=this.painter.context,b=x.gl,E=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:f.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var M;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const A=this.painter.transform,R=A.projection,O=o.tileID.canonical;E.u_tile_tl_up=R.upVector(O,0,0),E.u_tile_tr_up=R.upVector(O,f.EXTENT,0),E.u_tile_br_up=R.upVector(O,f.EXTENT,f.EXTENT),E.u_tile_bl_up=R.upVector(O,0,f.EXTENT),E.u_tile_up_scale=g&&g.useDenormalizedUpVectorScale?Jc:R.upVectorScale(O,A.center.lat,A.worldSize).metersToTile;let B=null,j=null,q=1;if(g&&g.morphing&&this._useVertexMorphing){const H=g.morphing.srcDemTile,$=g.morphing.dstDemTile;q=g.morphing.phase,H&&$&&(this._prepareDemTileUniforms(o,H,E,"_prev")&&(j=H),this._prepareDemTileUniforms(o,$,E)&&(B=$))}if(j&&B?(x.activeTexture.set(b.TEXTURE2),B.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),x.activeTexture.set(b.TEXTURE4),j.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),E.u_dem_lerp=q):(B=this.terrainTileForTile[o.tileID.key],x.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(o,B,E)?B.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),x.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&B){const H=(1<<B.tileID.canonical.z)*f.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=H}g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(x,E)}renderToBackBuffer(o){const u=this.painter,g=this.painter.context;0!==o.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),this.renderingToTexture=!1,function(x,b,E,M,A){if("globe"===x.transform.projection.name)!function(R,O,B,j,q){const H=R.context,$=H.gl;let ne,X;const ee=R.options.showTerrainWireframe?2:0,te=(Te,Ne)=>{if(X===Te)return;const pe=[Yl[Te],"PROJECTION_GLOBE_VIEW"];Ne&&pe.push(Yl[ee]),ne=R.useProgram("globeRaster",null,pe),X=Te},oe=R.colorModeForRenderPass(),Q=new f.DepthMode($.LEQUAL,f.DepthMode.ReadWrite,R.depthRangeFor3D);un.update(q);const ae=R.transform,me=f.calculateGlobeMercatorMatrix(ae),be=[f.mercatorXfromLng(ae.center.lng),f.mercatorYfromLat(ae.center.lat)],Se=R.globeSharedBuffers;if((ee?[!1,!0]:[!1]).forEach(Te=>{X=-1;const Ne=Te?$.LINES:$.TRIANGLES;for(const pe of j){const He=B.getTile(pe),Ve=f.StencilMode.disabled,nt=O.prevTerrainTileForTile[pe.key],Ie=O.terrainTileForTile[pe.key];oh(nt,Ie)&&un.newMorphing(pe.key,nt,Ie,q,250),H.activeTexture.set($.TEXTURE0),He.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const it=un.getMorphValuesForProxy(pe.key),mt=it?1:0,st={useDenormalizedUpVectorScale:!0};it&&f.extend$1(st,{morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:f.easeCubicInOut(it.phase)}});const at=Float32Array.from(ae.globeMatrix),_t=f.globeTileLatLngCorners(pe.canonical),At=f.getGridMatrix(pe.canonical,_t),ht=Pd(ae.projMatrix,at,me,f.globeToMercatorTransition(ae.zoom),be,At);if(te(mt,Te),O.setupElevationDraw(He,ne,st),R.prepareDrawProgram(H,ne,pe.toUnwrapped()),Se){const[vt,Yt,Hn]=Te?Se.getWirefameBuffers(R.context):Se.getGridBuffers();ne.draw(H,Ne,Q,Ve,oe,f.CullFaceMode.backCCW,ht,"globe_raster",vt,Yt,Hn)}}}),Se){ne=R.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const Te of j){const{x:Ne,y:pe,z:He}=Te.canonical,Ve=0===pe,nt=pe===(1<<He)-1,[Ie,it,mt,st]=Se.getPoleBuffers(He);if(st&&(Ve||nt)){const at=B.getTile(Te);H.activeTexture.set($.TEXTURE0),at.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let _t=f.globePoleMatrixForTile(He,Ne,ae);const At=(ht,vt)=>ht.draw(H,$.TRIANGLES,Q,f.StencilMode.disabled,oe,f.CullFaceMode.disabled,Pd(ae.projMatrix,_t,_t,0,be),"globe_pole_raster",vt,mt,st);O.setupElevationDraw(at,ne,{}),R.prepareDrawProgram(H,ne,Te.toUnwrapped()),Ve&&At(ne,Ie),nt&&(_t=f.scale(f.create(),_t,[1,-1,1]),At(ne,it))}}}}(x,b,E,M,A);else{const R=x.context,O=R.gl;let B,j;const q=x.options.showTerrainWireframe?2:0,H=(te,oe)=>{if(j===te)return;const Q=[Yl[te]];oe&&Q.push(Yl[q]),B=x.useProgram("terrainRaster",null,Q),j=te},$=x.colorModeForRenderPass(),ne=new f.DepthMode(O.LEQUAL,f.DepthMode.ReadWrite,x.depthRangeFor3D);un.update(A);const X=x.transform,ee=6*Math.pow(1.5,22-X.zoom)*b.exaggeration();(q?[!1,!0]:[!1]).forEach(te=>{j=-1;const oe=te?O.LINES:O.TRIANGLES,[Q,ae]=te?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const me of M){const be=E.getTile(me),Se=f.StencilMode.disabled,Te=b.prevTerrainTileForTile[me.key],Ne=b.terrainTileForTile[me.key];oh(Te,Ne)&&un.newMorphing(me.key,Te,Ne,A,250),R.activeTexture.set(O.TEXTURE0),be.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const pe=un.getMorphValuesForProxy(me.key),He=pe?1:0;let Ve;pe&&(Ve={morphing:{srcDemTile:pe.from,dstDemTile:pe.to,phase:f.easeCubicInOut(pe.phase)}});const nt=Ad(me.projMatrix,kd(me.canonical,X.renderWorldCopies)?ee/10:ee);H(He,te),b.setupElevationDraw(be,B,Ve),x.prepareDrawProgram(R,B,me.toUnwrapped()),B.draw(R,oe,ne,Se,$,f.CullFaceMode.backCCW,nt,"terrain_raster",b.gridBuffer,Q,ae)}})}}(u,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),M=[],A=u.style.order;let R=0;for(const O of b){const B=x.getTileByID(O.proxyTileKey),j=x.proxyCachedFBO[O.key]?x.proxyCachedFBO[O.key][o]:void 0,q=void 0!==j?x.renderCache[j]:this.pool[R++],H=void 0!==j;if(B.texture=q.tex,H&&!q.dirty){M.push(B.tileID);continue}let $;g.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(g.clear({color:f.Color.transparent,stencil:0}),q.dirty=!1);for(let ne=E.start;ne<=E.end;++ne){const X=u.style._layers[A[ne]];if(X.isHidden(u.transform.zoom))continue;const ee=u.style._getLayerSourceCache(X),te=ee?this.proxyToSource[O.key][ee.id]:[O];if(!te)continue;const oe=te;g.viewport.set([0,0,q.fb.width,q.fb.height]),$!==(ee?ee.id:null)&&(this._setupStencil(q,te,X,ee),$=ee?ee.id:null),u.renderLayer(u,ee,X,oe)}this.renderedToTile?(q.dirty=!0,M.push(B.tileID)):H||--R,5===R&&(R=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),E.end+1}postRender(){}renderCacheEfficiency(o){const u=o.order.length;if(0===u)return{efficiency:100};let g,x=0,b=0,E=!1;for(let M=0;M<u;++M){const A=o._layers[o.order[M]];this._style.isLayerDraped(A)?(E&&++x,++b):E||(E=!0,g=A.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-x/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{o=Math.min(o,u.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,u,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,M=Math.pow(2,E.overscaledZ),{x:A,y:R}=E.canonical,O=A/M,B=(A+1)/M,j=R/M,q=(R+1)/M;return{minx:O,miny:j,maxx:B,maxy:q,t:b.dem.tree.raycastRoot(O,j,B,q,o,u,g),tile:b}});x.sort((b,E)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const b of x){if(null==b.t)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,u,g);if(null!=E)return E}return null}_createFBO(){const o=this.painter.context,u=o.gl,g=this.drapeBufferSize;o.activeTexture.set(u.TEXTURE0);const x=new f.Texture(o,{width:g[0],height:g[1],data:null},u.RGBA);x.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=o.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(x.texture),b.depthAttachment=new aa(o,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const u=this._style._layers[o],g=u.isHidden(this.painter.transform.zoom),x=u.getCrossfadeParameters(),b=!!x&&1!==x.t,E=u.hasTransition();return"custom"!==u.type&&!g&&(b||E)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof V){o=!0;break}if(o)for(let u=0;u<this._style.order.length;++u){const g=this._style._layers[this._style.order[u]],x=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if("raster"!==g.type||x||!b)continue;const E=g.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const A=this.proxyToSource[M.key][b.id];if(A)for(const R of A){const O=Mn(b.getTile(R),b.findLoadedParent(R,0),b,this.painter.transform,E);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(b.id,R)}}}}_setupDrapedRenderBatches(){const o=this._style.order,u=o.length;if(0===u)return;const g=[];let x,b=0,E=this._style._layers[o[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<u;)E=this._style._layers[o[b]];for(;b<u;++b){const M=this._style._layers[o[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===x&&(x=b):void 0!==x&&(g.push({start:x,end:b-1}),x=void 0))}void 0!==x&&g.push({start:x,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(o){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const E=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let M=0;M<E.length;++M){const A=Object.values(E[M]);u.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const M=g[E];if(u.getTileByID(M.key),void 0!==u.proxyCachedFBO[M.key]){const A=o[M.key],R=this.proxyToSource[M.key];let O=0;for(const B in R){const j=R[B],q=A[B];if(!q||q.length!==j.length||j.some((H,$)=>H!==q[$]||x[B]&&x[B].hasOwnProperty(H.key))){O=-1;break}++O}for(const B in u.proxyCachedFBO[M.key])u.renderCache[u.proxyCachedFBO[M.key][B]].dirty=O<0||O!==Object.values(A).length}}const b=[...this._drapedRenderBatches];b.sort((E,M)=>M.end-M.start-(E.end-E.start));for(const E of b)for(const M of g){if(u.proxyCachedFBO[M.key])continue;let A=u.renderCachePool.pop();void 0===A&&u.renderCache.length<50&&(A=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==A&&(u.proxyCachedFBO[M.key]={},u.proxyCachedFBO[M.key][E.start]=A,u.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(o,u,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let M;if(g.isTileClipped())M=u.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(o.key)||0),this._overlapStencilMode):f.StencilMode.disabled}_renderTileClippingMasks(o,u){const g=this.painter,x=this.painter.context,b=x.gl;g._tileClippingMaskIDs.clear(),x.setColorMode(f.ColorMode.disabled),x.setDepthMode(f.DepthMode.disabled);const E=g.useProgram("clippingMask");for(const M of o){const A=--u;g._tileClippingMaskIDs.set(M.key,A),E.draw(x,b.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:b.ALWAYS,mask:0},A,255,b.KEEP,b.KEEP,b.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,Jo(M.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const u=this.painter.transform;if(o.x<0||o.x>u.width||o.y<0||o.y>u.height)return null;const g=[o.x,o.y,1,1];f.transformMat4$1(g,g,u.pixelMatrixInverse),f.scale$1(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const x=u._camera.position,b=f.mercatorZfromAltitude(1,u.center.lat),E=[x[0],x[1],x[2]/b,0],M=f.subtract([],g.slice(0,3),E);f.normalize(M,M);const A=this.raycast(E,M,this._exaggeration);return null!==A&&A?(f.scaleAndAdd(E,E,M,A),E[3]=E[2],E[2]*=b,E):null}drawDepth(){const o=this.painter,u=o.context,g=this.proxySourceCache,x=Math.ceil(o.width),b=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=u.gl,M=u.createFramebuffer(x,b,!0);u.activeTexture.set(E.TEXTURE0);const A=new f.Texture(u,{width:x,height:b,data:null},E.RGBA);A.bind(E.NEAREST,E.CLAMP_TO_EDGE),M.colorAttachment.set(A.texture);const R=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,x,b);M.depthAttachment.set(R),this._depthFBO=M,this._depthTexture=A}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,x,b]),function(E,M,A,R){if("globe"===E.transform.projection.name)return;const O=E.context,B=O.gl;O.clear({depth:1});const j=E.useProgram("terrainDepth"),q=new f.DepthMode(B.LESS,f.DepthMode.ReadWrite,E.depthRangeFor3D);for(const H of R){const $=A.getTile(H),ne=Ad(H.projMatrix,0);M.setupElevationDraw($,j),j.draw(O,B.TRIANGLES,q,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.backCCW,ne,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,u,g){if(o.getSource()instanceof ce)return this._setupProxiedCoordsForImageSource(o,u,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const x=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const A=b[M],R=this._findTileCoveringTileID(A,o);if(R){const O=this._createProxiedId(A,R,g[A.key]&&g[A.key][o.id]);x.push(O),this.proxyToSource[A.key][o.id]=[O]}}let E=!1;for(let M=0;M<u.length;M++){const A=o.getTile(u[M]);if(!A||!A.hasData())continue;const R=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==A.tileID.canonical.z){const O=this.proxyToSource[R.tileID.key][o.id],B=this._createProxiedId(R.tileID,A,g[R.tileID.key]&&g[R.tileID.key][o.id]);O?O.splice(O.length-1,0,B):this.proxyToSource[R.tileID.key][o.id]=[B],x.push(B),E=!0}}this._sourceTilesOverlap[o.id]=E}_setupProxiedCoordsForImageSource(o,u,g){if(!o.getSource().loaded())return;const x=this.proxiedCoords[o.id]=[],b=this.proxyCoords,E=o.getSource(),M=new f.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),A=E.coordinates.map(f.MercatorCoordinate.fromLngLat).reduce((O,B)=>(O.min.x=Math.min(O.min.x,B.x-M.x),O.min.y=Math.min(O.min.y,B.y-M.y),O.max.x=Math.max(O.max.x,B.x-M.x),O.max.y=Math.max(O.max.y,B.y-M.y),O),{min:new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(O,B)=>{const j=O.wrap+O.canonical.x/(1<<O.canonical.z),q=O.canonical.y/(1<<O.canonical.z),H=f.EXTENT/(1<<O.canonical.z),$=B.wrap+B.canonical.x/(1<<B.canonical.z),ne=B.canonical.y/(1<<B.canonical.z);return j+H<$+A.min.x||j>$+A.max.x||q+H<ne+A.min.y||q>ne+A.max.y};for(let O=0;O<b.length;O++){const B=b[O];for(let j=0;j<u.length;j++){const q=o.getTile(u[j]);if(!q||!q.hasData()||R(B,q.tileID))continue;const H=this._createProxiedId(B,q,g[B.key]&&g[B.key][o.id]),$=this.proxyToSource[B.key][o.id];$?$.push(H):this.proxyToSource[B.key][o.id]=[H],x.push(H)}}}_createProxiedId(o,u,g){let x=this.orthoMatrix;if(g){const b=g.find(E=>E.key===u.tileID.key);if(b)return b}if(u.tileID.key!==o.key){const b=o.canonical.z-u.tileID.canonical.z;let E,M,A;x=f.create();const R=u.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(E=f.EXTENT>>b,M=E*((u.tileID.canonical.x<<b)-o.canonical.x+R),A=E*((u.tileID.canonical.y<<b)-o.canonical.y)):(E=f.EXTENT<<-b,M=f.EXTENT*(u.tileID.canonical.x-(o.canonical.x+R<<-b)),A=f.EXTENT*(u.tileID.canonical.y-(o.canonical.y<<-b))),f.ortho(x,0,E,0,E,0,1),f.translate(x,x,[M,A,0])}return new Qc(u.tileID,o.key,x)}_findTileCoveringTileID(o,u){let g=u.getTile(o);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[u.id],b=x[o.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||null===b)return g;let E=g?g.tileID:o,M=E.overscaledZ;const A=u.getSource().minzoom,R=[];if(!b){const B=u.getSource().maxzoom;if(o.canonical.z>=B){const j=o.canonical.z-B;u.getSource().reparseOverscaled?(M=Math.max(o.canonical.z+2,u.transform.tileZoom),E=new f.OverscaledTileID(M,o.wrap,B,o.canonical.x>>j,o.canonical.y>>j)):0!==j&&(M=B,E=new f.OverscaledTileID(M,o.wrap,B,o.canonical.x>>j,o.canonical.y>>j))}E.key!==o.key&&(R.push(E.key),g=u.getTile(E))}const O=B=>{R.forEach(j=>{x[j]=B}),R.length=0};for(M-=1;M>=A&&(!g||!g.hasData());M--){g&&O(g.tileID.key);const B=E.calculateScaledKey(M);if(g=u.getTileByID(B),g&&g.hasData())break;const j=x[B];if(null===j)break;void 0===j?R.push(B):g=u.getTileByID(j)}return O(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,u){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(u){let g=0;const x=new f.StructArrayLayout2ui4,b=131;for(let E=1;E<129;E++){for(let M=1;M<129;M++)g=E*b+M,x.emplaceBack(g,g+1),x.emplaceBack(g,g+b),x.emplaceBack(g+1,g+b),128===E&&x.emplaceBack(g+b,g+b+1);x.emplaceBack(g+1,g+1+b)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=f.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ws(p){const o=[];for(let u=0;u<p.length;u++){if(null===p[u])continue;const g=p[u].split(" ");o.push(g.pop())}return o}class Jl{static cacheKey(o,u,g){let x=`${o}${g?g.cacheKey:""}`;for(const b of u)x+=`/${b}`;return x}constructor(o,u,g,x,b,E){const M=o.gl;this.program=M.createProgram();const A=ws(g.staticAttributes),R=x?x.getBinderAttributes():[],O=A.concat(R),B=g.staticUniforms?ws(g.staticUniforms):[],j=x?x.getBinderUniforms():[],q=B.concat(j),H=[];for(const Q of q)H.indexOf(Q)<0&&H.push(Q);let $=x?x.defines():[];$=$.concat(E.map(Q=>`#define ${Q}`));const ne=$.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Gi,Yc.fragmentSource,Ro.fragmentSource,g.fragmentSource).join("\n"),X=$.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Gi,Yc.vertexSource,Ro.vertexSource,St.vertexSource,g.vertexSource).join("\n"),ee=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ee,ne),M.compileShader(ee),M.attachShader(this.program,ee);const te=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(te,X),M.compileShader(te),M.attachShader(this.program,te),this.attributes={};const oe={};this.numAttributes=O.length;for(let Q=0;Q<this.numAttributes;Q++)O[Q]&&(M.bindAttribLocation(this.program,Q,O[Q]),this.attributes[O[Q]]=Q);M.linkProgram(this.program),M.deleteShader(te),M.deleteShader(ee);for(let Q=0;Q<H.length;Q++){const ae=H[Q];if(ae&&!oe[ae]){const me=M.getUniformLocation(this.program,ae);me&&(oe[ae]=me)}}var Q,ae;this.fixedUniforms=b(o,oe),this.binderUniforms=x?x.getUniforms(o,oe):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new f.Uniform1i(Q=o,(ae=oe).u_dem),u_dem_prev:new f.Uniform1i(Q,ae.u_dem_prev),u_dem_unpack:new f.Uniform4f(Q,ae.u_dem_unpack),u_dem_tl:new f.Uniform2f(Q,ae.u_dem_tl),u_dem_scale:new f.Uniform1f(Q,ae.u_dem_scale),u_dem_tl_prev:new f.Uniform2f(Q,ae.u_dem_tl_prev),u_dem_scale_prev:new f.Uniform1f(Q,ae.u_dem_scale_prev),u_dem_size:new f.Uniform1f(Q,ae.u_dem_size),u_dem_lerp:new f.Uniform1f(Q,ae.u_dem_lerp),u_exaggeration:new f.Uniform1f(Q,ae.u_exaggeration),u_depth:new f.Uniform1i(Q,ae.u_depth),u_depth_size_inv:new f.Uniform2f(Q,ae.u_depth_size_inv),u_meter_to_dem:new f.Uniform1f(Q,ae.u_meter_to_dem),u_label_plane_matrix_inv:new f.UniformMatrix4f(Q,ae.u_label_plane_matrix_inv),u_tile_tl_up:new f.Uniform3f(Q,ae.u_tile_tl_up),u_tile_tr_up:new f.Uniform3f(Q,ae.u_tile_tr_up),u_tile_br_up:new f.Uniform3f(Q,ae.u_tile_br_up),u_tile_bl_up:new f.Uniform3f(Q,ae.u_tile_bl_up),u_tile_up_scale:new f.Uniform1f(Q,ae.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((Q,ae)=>({u_fog_matrix:new f.UniformMatrix4f(Q,ae.u_fog_matrix),u_fog_range:new f.Uniform2f(Q,ae.u_fog_range),u_fog_color:new f.Uniform4f(Q,ae.u_fog_color),u_fog_horizon_blend:new f.Uniform1f(Q,ae.u_fog_horizon_blend),u_fog_temporal_offset:new f.Uniform1f(Q,ae.u_fog_temporal_offset)}))(o,oe))}setTerrainUniformValues(o,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in u)g[x].set(u[x])}}setFogUniformValues(o,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in u)g[x].location&&g[x].set(u[x])}}draw(o,u,g,x,b,E,M,A,R,O,B,j,q,H,$,ne){const X=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(g),o.setStencilMode(x),o.setColorMode(b),o.setCullFace(E);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(M[te]);H&&H.setUniforms(o,this.binderUniforms,j,{zoom:q});const ee={[X.LINES]:2,[X.TRIANGLES]:3,[X.LINE_STRIP]:1}[u];for(const te of B.get()){const oe=te.vaos||(te.vaos={});(oe[A]||(oe[A]=new po)).bind(o,this,R,H?H.getPaintVertexBuffers():[],O,te.vertexOffset,$,ne),X.drawElements(u,te.primitiveLength*ee,X.UNSIGNED_SHORT,te.primitiveOffset*ee*2)}}}function zn(p,o,u){const g=1/Gr(u,1,o.transform.tileZoom),x=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,o.transform.tileZoom)/x,E=b*(u.tileID.canonical.x+u.tileID.wrap*x),M=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[g,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[E>>16,M>>16],u_pixel_coord_lower:[65535&E,65535&M]}}const sh=f.create(),Ql=(p,o,u,g,x,b,E,M,A)=>{const R=o.style.light,O=R.properties.get("position"),B=[O.x,O.y,O.z],j=f.create$1();"viewport"===R.properties.get("anchor")&&(f.fromRotation(j,-o.transform.angle),f.transformMat3(B,B,j));const q=R.properties.get("color"),H=o.transform,$={u_matrix:p,u_lightpos:B,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===H.projection.name&&($.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],$.u_zoom_transition=E,$.u_inv_rot_matrix=A,$.u_merc_center=M,$.u_up_dir=H.projection.upVector(new f.CanonicalTileID(0,0,0),M[0]*f.EXTENT,M[1]*f.EXTENT),$.u_height_lift=b),$},ec=(p,o,u,g,x,b,E,M,A,R,O)=>{const B=Ql(p,o,u,g,x,M,A,R,O),j={u_height_factor:-Math.pow(2,x.overscaledZ)/E.tileSize/8};return f.extend(B,zn(b,o,E),j)},tc=p=>({u_matrix:p}),Fr=(p,o,u,g)=>f.extend(tc(p),zn(u,o,g)),eu=(p,o)=>({u_matrix:p,u_world:o}),ah=(p,o,u,g,x)=>f.extend(Fr(p,o,u,g),{u_world:x}),It=f.create(),wr=(p,o,u,g,x,b)=>{const E=p.transform,M="globe"===E.projection.name;let A;if("map"===b.paint.get("circle-pitch-alignment"))if(M){const O=f.globePixelsToTileUnits(E.zoom,o.canonical);A=Float32Array.from([O,0,0,O])}else A=E.calculatePixelsToTileUnitsMatrix(u);else A=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:p.translatePosMatrix(o.projMatrix,u,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:f.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:It,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return M&&(R.u_inv_rot_matrix=g,R.u_merc_center=x,R.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],R.u_zoom_transition=f.globeToMercatorTransition(E.zoom),R.u_up_dir=E.projection.upVector(o.canonical,x[0],x[1])),R},qr=p=>{const o=[];return"map"===p.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},Cs=(p,o,u)=>{const g=f.EXTENT/u.tileSize;return{u_matrix:p,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/g,o.pixelsToGLUnits[1]/g]}},Es=(p,o,u=1)=>({u_matrix:p,u_color:o,u_overlay:0,u_overlay_scale:u}),Zi=f.create(),tu=(p,o,u,g,x,b,E)=>{const M=p.transform,A="globe"===M.projection.name,R=A?f.globePixelsToTileUnits(M.zoom,o.canonical):Gr(u,1,b),O={u_matrix:o.projMatrix,u_extrude_scale:R,u_intensity:E,u_inv_rot_matrix:Zi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return A&&(O.u_inv_rot_matrix=g,O.u_merc_center=x,O.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],O.u_zoom_transition=f.globeToMercatorTransition(M.zoom),O.u_up_dir=M.projection.upVector(o.canonical,x[0],x[1])),O},lh=(p,o,u,g,x,b,E)=>{const M=p.transform,A=M.calculatePixelsToTileUnitsMatrix(o),R={u_matrix:Ii(p,o,u,x),u_pixels_to_tile_units:A,u_device_pixel_ratio:E,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Sr(u)){const O=ma(o,p.transform);R.u_texsize=o.lineAtlasTexture.size,R.u_scale=[O,g.fromScale,g.toScale],R.u_mix=g.t}return R},pa=(p,o,u,g,x,b)=>{const E=p.transform,M=ma(o,E);return{u_matrix:Ii(p,o,u,x),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:b,u_image:0,u_scale:[M,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ma(p,o){return 1/Gr(p,1,o.tileZoom)}function Ii(p,o,u,g){return p.translatePosMatrix(g||o.tileID.projMatrix,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function Sr(p){const o=p.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Rd=(p,o,u,g,x,b)=>{return{u_matrix:p,u_tl_parent:o,u_scale_parent:u,u_fade_t:g.mix,u_opacity:g.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(M=x.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(E=x.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:gi(x.paint.get("raster-hue-rotate")),u_perspective_transform:b};var E,M};function gi(p){p*=Math.PI/180;const o=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const ot=f.create(),Xt=(p,o,u,g,x,b,E,M,A,R,O,B,j,q)=>{const H=x.transform,$={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:H.width/H.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+A,u_pitch_with_map:+g,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ot,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ot};return"globe"===H.projection.name&&($.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],$.u_zoom_transition=B,$.u_inv_rot_matrix=q,$.u_merc_center=j,$.u_camera_forward=H._camera.forward(),$.u_ecef_origin=f.globeECEFOrigin(H.globeMatrix,O.toUnwrapped()),$.u_tile_matrix=Float32Array.from(H.globeMatrix)),$},En=(p,o,u,g,x,b,E,M,A,R,O,B,j,q,H)=>{const{cameraToCenterDistance:$,_pitch:ne}=x.transform;return f.extend(Xt(p,o,u,g,x,b,E,M,A,R,B,j,q,H),{u_gamma_scale:g?$*Math.cos(x.terrain?0:ne):1,u_device_pixel_ratio:f.exported.devicePixelRatio,u_is_halo:+O})},Ir=(p,o,u,g,x,b,E,M,A,R,O,B,j,q)=>f.extend(En(p,o,u,g,x,b,E,M,!0,A,!0,O,B,j,q),{u_texsize_icon:R,u_texture_icon:1}),Ds=(p,o,u)=>({u_matrix:p,u_opacity:o,u_color:u}),mr=(p,o,u,g,x,b)=>f.extend(function(E,M,A,R){const O=A.imageManager.getPattern(E.from.toString()),B=A.imageManager.getPattern(E.to.toString()),{width:j,height:q}=A.imageManager.getPixelSize(),H=Math.pow(2,R.tileID.overscaledZ),$=R.tileSize*Math.pow(2,A.transform.tileZoom)/H,ne=$*(R.tileID.canonical.x+R.tileID.wrap*H),X=$*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[j,q],u_mix:M.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Gr(R,1,A.transform.tileZoom),u_pixel_coord_upper:[ne>>16,X>>16],u_pixel_coord_lower:[65535&ne,65535&X]}}(g,b,u,x),{u_matrix:p,u_opacity:o}),Kt={fillExtrusion:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_lightpos:new f.Uniform3f(p,o.u_lightpos),u_lightintensity:new f.Uniform1f(p,o.u_lightintensity),u_lightcolor:new f.Uniform3f(p,o.u_lightcolor),u_vertical_gradient:new f.Uniform1f(p,o.u_vertical_gradient),u_opacity:new f.Uniform1f(p,o.u_opacity),u_tile_id:new f.Uniform3f(p,o.u_tile_id),u_zoom_transition:new f.Uniform1f(p,o.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,o.u_merc_center),u_up_dir:new f.Uniform3f(p,o.u_up_dir),u_height_lift:new f.Uniform1f(p,o.u_height_lift)}),fillExtrusionPattern:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_lightpos:new f.Uniform3f(p,o.u_lightpos),u_lightintensity:new f.Uniform1f(p,o.u_lightintensity),u_lightcolor:new f.Uniform3f(p,o.u_lightcolor),u_vertical_gradient:new f.Uniform1f(p,o.u_vertical_gradient),u_height_factor:new f.Uniform1f(p,o.u_height_factor),u_tile_id:new f.Uniform3f(p,o.u_tile_id),u_zoom_transition:new f.Uniform1f(p,o.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,o.u_merc_center),u_up_dir:new f.Uniform3f(p,o.u_up_dir),u_height_lift:new f.Uniform1f(p,o.u_height_lift),u_image:new f.Uniform1i(p,o.u_image),u_texsize:new f.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,o.u_scale),u_fade:new f.Uniform1f(p,o.u_fade),u_opacity:new f.Uniform1f(p,o.u_opacity)}),fill:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix)}),fillPattern:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_image:new f.Uniform1i(p,o.u_image),u_texsize:new f.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,o.u_scale),u_fade:new f.Uniform1f(p,o.u_fade)}),fillOutline:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_world:new f.Uniform2f(p,o.u_world)}),fillOutlinePattern:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_world:new f.Uniform2f(p,o.u_world),u_image:new f.Uniform1i(p,o.u_image),u_texsize:new f.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,o.u_scale),u_fade:new f.Uniform1f(p,o.u_fade)}),circle:(p,o)=>({u_camera_to_center_distance:new f.Uniform1f(p,o.u_camera_to_center_distance),u_extrude_scale:new f.UniformMatrix2f(p,o.u_extrude_scale),u_device_pixel_ratio:new f.Uniform1f(p,o.u_device_pixel_ratio),u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,o.u_merc_center),u_tile_id:new f.Uniform3f(p,o.u_tile_id),u_zoom_transition:new f.Uniform1f(p,o.u_zoom_transition),u_up_dir:new f.Uniform3f(p,o.u_up_dir)}),collisionBox:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_camera_to_center_distance:new f.Uniform1f(p,o.u_camera_to_center_distance),u_extrude_scale:new f.Uniform2f(p,o.u_extrude_scale)}),collisionCircle:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_inv_matrix:new f.UniformMatrix4f(p,o.u_inv_matrix),u_camera_to_center_distance:new f.Uniform1f(p,o.u_camera_to_center_distance),u_viewport_size:new f.Uniform2f(p,o.u_viewport_size)}),debug:(p,o)=>({u_color:new f.UniformColor(p,o.u_color),u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_overlay:new f.Uniform1i(p,o.u_overlay),u_overlay_scale:new f.Uniform1f(p,o.u_overlay_scale)}),clippingMask:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix)}),heatmap:(p,o)=>({u_extrude_scale:new f.Uniform1f(p,o.u_extrude_scale),u_intensity:new f.Uniform1f(p,o.u_intensity),u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,o.u_merc_center),u_tile_id:new f.Uniform3f(p,o.u_tile_id),u_zoom_transition:new f.Uniform1f(p,o.u_zoom_transition),u_up_dir:new f.Uniform3f(p,o.u_up_dir)}),heatmapTexture:(p,o)=>({u_image:new f.Uniform1i(p,o.u_image),u_color_ramp:new f.Uniform1i(p,o.u_color_ramp),u_opacity:new f.Uniform1f(p,o.u_opacity)}),hillshade:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_image:new f.Uniform1i(p,o.u_image),u_latrange:new f.Uniform2f(p,o.u_latrange),u_light:new f.Uniform2f(p,o.u_light),u_shadow:new f.UniformColor(p,o.u_shadow),u_highlight:new f.UniformColor(p,o.u_highlight),u_accent:new f.UniformColor(p,o.u_accent)}),hillshadePrepare:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_image:new f.Uniform1i(p,o.u_image),u_dimension:new f.Uniform2f(p,o.u_dimension),u_zoom:new f.Uniform1f(p,o.u_zoom),u_unpack:new f.Uniform4f(p,o.u_unpack)}),line:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_pixels_to_tile_units:new f.UniformMatrix2f(p,o.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(p,o.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(p,o.u_units_to_pixels),u_dash_image:new f.Uniform1i(p,o.u_dash_image),u_gradient_image:new f.Uniform1i(p,o.u_gradient_image),u_image_height:new f.Uniform1f(p,o.u_image_height),u_texsize:new f.Uniform2f(p,o.u_texsize),u_scale:new f.Uniform3f(p,o.u_scale),u_mix:new f.Uniform1f(p,o.u_mix),u_alpha_discard_threshold:new f.Uniform1f(p,o.u_alpha_discard_threshold)}),linePattern:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_texsize:new f.Uniform2f(p,o.u_texsize),u_pixels_to_tile_units:new f.UniformMatrix2f(p,o.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(p,o.u_device_pixel_ratio),u_image:new f.Uniform1i(p,o.u_image),u_units_to_pixels:new f.Uniform2f(p,o.u_units_to_pixels),u_scale:new f.Uniform3f(p,o.u_scale),u_fade:new f.Uniform1f(p,o.u_fade),u_alpha_discard_threshold:new f.Uniform1f(p,o.u_alpha_discard_threshold)}),raster:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_tl_parent:new f.Uniform2f(p,o.u_tl_parent),u_scale_parent:new f.Uniform1f(p,o.u_scale_parent),u_fade_t:new f.Uniform1f(p,o.u_fade_t),u_opacity:new f.Uniform1f(p,o.u_opacity),u_image0:new f.Uniform1i(p,o.u_image0),u_image1:new f.Uniform1i(p,o.u_image1),u_brightness_low:new f.Uniform1f(p,o.u_brightness_low),u_brightness_high:new f.Uniform1f(p,o.u_brightness_high),u_saturation_factor:new f.Uniform1f(p,o.u_saturation_factor),u_contrast_factor:new f.Uniform1f(p,o.u_contrast_factor),u_spin_weights:new f.Uniform3f(p,o.u_spin_weights),u_perspective_transform:new f.Uniform2f(p,o.u_perspective_transform)}),symbolIcon:(p,o)=>({u_is_size_zoom_constant:new f.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,o.u_size_t),u_size:new f.Uniform1f(p,o.u_size),u_camera_to_center_distance:new f.Uniform1f(p,o.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,o.u_fade_change),u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new f.Uniform1i(p,o.u_is_text),u_pitch_with_map:new f.Uniform1i(p,o.u_pitch_with_map),u_texsize:new f.Uniform2f(p,o.u_texsize),u_tile_id:new f.Uniform3f(p,o.u_tile_id),u_zoom_transition:new f.Uniform1f(p,o.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,o.u_merc_center),u_camera_forward:new f.Uniform3f(p,o.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(p,o.u_tile_matrix),u_ecef_origin:new f.Uniform3f(p,o.u_ecef_origin),u_texture:new f.Uniform1i(p,o.u_texture)}),symbolSDF:(p,o)=>({u_is_size_zoom_constant:new f.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,o.u_size_t),u_size:new f.Uniform1f(p,o.u_size),u_camera_to_center_distance:new f.Uniform1f(p,o.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,o.u_fade_change),u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new f.Uniform1i(p,o.u_is_text),u_pitch_with_map:new f.Uniform1i(p,o.u_pitch_with_map),u_texsize:new f.Uniform2f(p,o.u_texsize),u_texture:new f.Uniform1i(p,o.u_texture),u_gamma_scale:new f.Uniform1f(p,o.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(p,o.u_device_pixel_ratio),u_tile_id:new f.Uniform3f(p,o.u_tile_id),u_zoom_transition:new f.Uniform1f(p,o.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,o.u_merc_center),u_camera_forward:new f.Uniform3f(p,o.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(p,o.u_tile_matrix),u_ecef_origin:new f.Uniform3f(p,o.u_ecef_origin),u_is_halo:new f.Uniform1i(p,o.u_is_halo)}),symbolTextAndIcon:(p,o)=>({u_is_size_zoom_constant:new f.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,o.u_size_t),u_size:new f.Uniform1f(p,o.u_size),u_camera_to_center_distance:new f.Uniform1f(p,o.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,o.u_fade_change),u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new f.Uniform1i(p,o.u_is_text),u_pitch_with_map:new f.Uniform1i(p,o.u_pitch_with_map),u_texsize:new f.Uniform2f(p,o.u_texsize),u_texsize_icon:new f.Uniform2f(p,o.u_texsize_icon),u_texture:new f.Uniform1i(p,o.u_texture),u_texture_icon:new f.Uniform1i(p,o.u_texture_icon),u_gamma_scale:new f.Uniform1f(p,o.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(p,o.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(p,o.u_is_halo)}),background:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_opacity:new f.Uniform1f(p,o.u_opacity),u_color:new f.UniformColor(p,o.u_color)}),backgroundPattern:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_opacity:new f.Uniform1f(p,o.u_opacity),u_image:new f.Uniform1i(p,o.u_image),u_pattern_tl_a:new f.Uniform2f(p,o.u_pattern_tl_a),u_pattern_br_a:new f.Uniform2f(p,o.u_pattern_br_a),u_pattern_tl_b:new f.Uniform2f(p,o.u_pattern_tl_b),u_pattern_br_b:new f.Uniform2f(p,o.u_pattern_br_b),u_texsize:new f.Uniform2f(p,o.u_texsize),u_mix:new f.Uniform1f(p,o.u_mix),u_pattern_size_a:new f.Uniform2f(p,o.u_pattern_size_a),u_pattern_size_b:new f.Uniform2f(p,o.u_pattern_size_b),u_scale_a:new f.Uniform1f(p,o.u_scale_a),u_scale_b:new f.Uniform1f(p,o.u_scale_b),u_pixel_coord_upper:new f.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,o.u_pixel_coord_lower),u_tile_units_to_pixels:new f.Uniform1f(p,o.u_tile_units_to_pixels)}),terrainRaster:ih,terrainDepth:ih,skybox:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_sun_direction:new f.Uniform3f(p,o.u_sun_direction),u_cubemap:new f.Uniform1i(p,o.u_cubemap),u_opacity:new f.Uniform1f(p,o.u_opacity),u_temporal_offset:new f.Uniform1f(p,o.u_temporal_offset)}),skyboxGradient:(p,o)=>({u_matrix:new f.UniformMatrix4f(p,o.u_matrix),u_color_ramp:new f.Uniform1i(p,o.u_color_ramp),u_center_direction:new f.Uniform3f(p,o.u_center_direction),u_radius:new f.Uniform1f(p,o.u_radius),u_opacity:new f.Uniform1f(p,o.u_opacity),u_temporal_offset:new f.Uniform1f(p,o.u_temporal_offset)}),skyboxCapture:(p,o)=>({u_matrix_3f:new f.UniformMatrix3f(p,o.u_matrix_3f),u_sun_direction:new f.Uniform3f(p,o.u_sun_direction),u_sun_intensity:new f.Uniform1f(p,o.u_sun_intensity),u_color_tint_r:new f.Uniform4f(p,o.u_color_tint_r),u_color_tint_m:new f.Uniform4f(p,o.u_color_tint_m),u_luminance:new f.Uniform1f(p,o.u_luminance)}),globeRaster:(p,o)=>({u_proj_matrix:new f.UniformMatrix4f(p,o.u_proj_matrix),u_globe_matrix:new f.UniformMatrix4f(p,o.u_globe_matrix),u_merc_matrix:new f.UniformMatrix4f(p,o.u_merc_matrix),u_zoom_transition:new f.Uniform1f(p,o.u_zoom_transition),u_merc_center:new f.Uniform2f(p,o.u_merc_center),u_image0:new f.Uniform1i(p,o.u_image0),u_grid_matrix:new f.UniformMatrix3f(p,o.u_grid_matrix)}),globeAtmosphere:(p,o)=>({u_frustum_tl:new f.Uniform3f(p,o.u_frustum_tl),u_frustum_tr:new f.Uniform3f(p,o.u_frustum_tr),u_frustum_br:new f.Uniform3f(p,o.u_frustum_br),u_frustum_bl:new f.Uniform3f(p,o.u_frustum_bl),u_globe_pos:new f.Uniform3f(p,o.u_globe_pos),u_globe_radius:new f.Uniform1f(p,o.u_globe_radius),u_opacity:new f.Uniform1f(p,o.u_opacity),u_fadeout_range:new f.Uniform1f(p,o.u_fadeout_range),u_start_color:new f.Uniform3f(p,o.u_start_color),u_end_color:new f.Uniform3f(p,o.u_end_color)})};let Bn;function rl(p,o,u,g,x,b,E){const M=p.context,A=M.gl,R=p.useProgram("collisionBox"),O=[];let B=0,j=0;for(let te=0;te<g.length;te++){const oe=g[te],Q=o.getTile(oe),ae=Q.getBucket(u);if(!ae)continue;let me=oe.projMatrix;0===x[0]&&0===x[1]||(me=p.translatePosMatrix(oe.projMatrix,Q,x,b));const be=E?ae.textCollisionBox:ae.iconCollisionBox,Se=ae.collisionCircleArray;if(Se.length>0){const Te=f.create(),Ne=me;f.mul(Te,ae.placementInvProjMatrix,p.transform.glCoordMatrix),f.mul(Te,Te,ae.placementViewportMatrix),O.push({circleArray:Se,circleOffset:j,transform:Ne,invTransform:Te}),B+=Se.length/4,j=B}be&&(p.terrain&&p.terrain.setupElevationDraw(Q,R),R.draw(M,A.LINES,f.DepthMode.disabled,f.StencilMode.disabled,p.colorModeForRenderPass(),f.CullFaceMode.disabled,Cs(me,p.transform,Q),u.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,p.transform.zoom,null,be.collisionVertexBuffer,be.collisionVertexBufferExt))}if(!E||!O.length)return;const q=p.useProgram("collisionCircle"),H=new f.StructArrayLayout2f1f2i16;H.resize(4*B),H._trim();let $=0;for(const te of O)for(let oe=0;oe<te.circleArray.length/4;oe++){const Q=4*oe,ae=te.circleArray[Q+0],me=te.circleArray[Q+1],be=te.circleArray[Q+2],Se=te.circleArray[Q+3];H.emplace($++,ae,me,be,Se,0),H.emplace($++,ae,me,be,Se,1),H.emplace($++,ae,me,be,Se,2),H.emplace($++,ae,me,be,Se,3)}(!Bn||Bn.length<2*B)&&(Bn=function(te){const oe=2*te,Q=new f.StructArrayLayout3ui6;Q.resize(oe),Q._trim();for(let ae=0;ae<oe;ae++){const me=6*ae;Q.uint16[me+0]=4*ae+0,Q.uint16[me+1]=4*ae+1,Q.uint16[me+2]=4*ae+2,Q.uint16[me+3]=4*ae+2,Q.uint16[me+4]=4*ae+3,Q.uint16[me+5]=4*ae+0}return Q}(B));const ne=M.createIndexBuffer(Bn,!0),X=M.createVertexBuffer(H,f.collisionCircleLayout.members,!0);for(const te of O){const oe={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ee=p.transform).cameraToCenterDistance,u_viewport_size:[ee.width,ee.height]};q.draw(M,A.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,p.colorModeForRenderPass(),f.CullFaceMode.disabled,oe,u.id,X,ne,f.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,p.transform.zoom,null,null,null)}var ee;X.destroy(),ne.destroy()}const Ts=f.create();function Bt(p,o,u,g,x,b){const{horizontalAlign:E,verticalAlign:M}=f.getAnchorAlignment(p),A=-(E-.5)*o,R=-(M-.5)*u,O=f.evaluateVariableOffset(p,g);return new f.pointGeometry((A/x+O[0])*b,(R/x+O[1])*b)}function nu(p,o,u,g,x,b,E,M,A,R,O,B){const j=p.text.placedSymbolArray,q=p.text.dynamicLayoutVertexArray,H=p.icon.dynamicLayoutVertexArray,$={},ne=M.projMatrix,X=b.elevation,ee=B.upVectorScale(M.canonical,b.center.lat,b.worldSize);q.clear();for(let te=0;te<j.length;te++){const oe=j.get(te),Q=p.allowVerticalPlacement&&!oe.placedOrientation,ae=oe.hidden||!oe.crossTileID||Q?null:g[oe.crossTileID];if(ae){const me=new f.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),be=B.upVector(M.canonical,me.x,me.y),Se=X?X.getAtTileOffset(M,me.x,me.y):0,Te=ji([oe.projectedAnchorX+Se*be[0]*ee.metersToTile,oe.projectedAnchorY+Se*be[1]*ee.metersToTile,oe.projectedAnchorZ+Se*be[2]*ee.metersToTile],u?ne:E),Ne=Fn(b.cameraToCenterDistance,Te.signedDistanceFromCamera);let pe=x.evaluateSizeForFeature(p.textSizeData,R,oe)*Ne/f.ONE_EM;u&&(pe*=p.tilePixelRatio/A);const{width:He,height:Ve,anchor:nt,textOffset:Ie,textScale:it}=ae,mt=Bt(nt,He,Ve,Ie,it,pe),st=u?Gn(me.add(mt),E,Se*ee.metersToLabelSpace).point:Te.point.add(o?mt.rotate(-b.angle):mt),at=p.allowVerticalPlacement&&oe.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<oe.numGlyphs;_t++)f.addDynamicAttributes(q,st,at);O&&oe.associatedIconIndex>=0&&($[oe.associatedIconIndex]={shiftedAnchor:st,angle:at})}else Tt(oe.numGlyphs,q)}if(O){H.clear();const te=p.icon.placedSymbolArray;for(let oe=0;oe<te.length;oe++){const Q=te.get(oe);if(Q.hidden)Tt(Q.numGlyphs,H);else{const ae=$[oe];if(ae)for(let me=0;me<Q.numGlyphs;me++)f.addDynamicAttributes(H,ae.shiftedAnchor,ae.angle);else Tt(Q.numGlyphs,H)}}p.icon.dynamicLayoutVertexBuffer.updateData(H)}p.text.dynamicLayoutVertexBuffer.updateData(q)}function il(p,o,u){return u.iconsInText&&o?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function nc(p,o,u,g,x,b,E,M,A,R,O,B){const j=p.context,q=j.gl,H=p.transform,$="map"===M,ne="map"===A,X=$&&"point"!==u.layout.get("symbol-placement"),ee=$&&!ne&&!X,te=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let oe=!1;const Q=p.depthModeForSublayer(0,f.DepthMode.ReadOnly),ae=[f.mercatorXfromLng(H.center.lng),f.mercatorYfromLat(H.center.lat)],me=u.layout.get("text-variable-anchor"),be="globe"===H.projection.name,Se=be?f.globeToMercatorTransition(H.zoom):0,Te=[],Ne=[];p.terrain&&ne&&Ne.push("PITCH_WITH_MAP_TERRAIN"),be&&Ne.push("PROJECTION_GLOBE_VIEW");for(const pe of g){const He=o.getTile(pe),Ve=He.getBucket(u);if(!Ve||Ve.projection!==H.projection.name)continue;const nt=x?Ve.text:Ve.icon;if(!nt||Ve.fullyClipped||!nt.segments.get().length)continue;const Ie=nt.programConfigurations.get(u.id),it=x||Ve.sdfIcons,mt=x?Ve.textSizeData:Ve.iconSizeData,st=ne||0!==H.pitch,at=f.evaluateSizeForZoom(mt,H.zoom);let _t,At,ht,vt,Yt=[0,0],Hn=null;if(x){if(At=He.glyphAtlasTexture,ht=q.LINEAR,_t=He.glyphAtlasTexture.size,Ve.iconsInText){Yt=He.imageAtlasTexture.size,Hn=He.imageAtlasTexture;const Fi="composite"===mt.kind||"camera"===mt.kind;vt=st||p.options.rotating||p.options.zooming||Fi?q.LINEAR:q.NEAREST}}else{const Fi=1!==u.layout.get("icon-size").constantOr(0)||Ve.iconsNeedLinear;At=He.imageAtlasTexture,ht=it||p.options.rotating||p.options.zooming||Fi||st?q.LINEAR:q.NEAREST,_t=He.imageAtlasTexture.size}const hr=p.transform.calculatePixelsToTileUnitsMatrix(He),Zr=qn(pe.projMatrix,He.tileID.canonical,ne,$,p.transform,hr),Ar=p.terrain&&ne&&X?f.invert(f.create(),Zr):Ts,Oi=ys(pe.projMatrix,He.tileID.canonical,ne,$,p.transform,hr),Ji=me&&Ve.hasTextData(),Da="none"!==u.layout.get("icon-text-fit")&&Ji&&Ve.hasIconData();if(X){const Fi=H.elevation,Ls=Fi?Fi.getAtTileOffsetFunc(pe,H.center.lat,H.worldSize,H.projection):bh=>[0,0,0];ca(Ve,pe.projMatrix,p,x,Zr,Oi,ne,R,Ls,pe)}const Lo=X||x&&me||Da,Zn=p.translatePosMatrix(pe.projMatrix,He,b,E),nr=Lo?Ts:Zr,hn=p.translatePosMatrix(Oi,He,b,E,!0),Wn=H.projection.createInversionMatrix(H,pe.canonical),ri=Lo?Ne.concat(["PROJECTED_POS_ON_VIEWPORT"]):Ne,Nn=it&&0!==u.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let ii;ii=it?Ve.iconsInText?Ir(mt.kind,at,ee,ne,p,Zn,nr,hn,_t,Yt,pe,Se,ae,Wn):En(mt.kind,at,ee,ne,p,Zn,nr,hn,x,_t,!0,pe,Se,ae,Wn):Xt(mt.kind,at,ee,ne,p,Zn,nr,hn,x,_t,pe,Se,ae,Wn);const Fs={program:p.useProgram(il(it,x,Ve),Ie,ri),buffers:nt,uniformValues:ii,atlasTexture:At,atlasTextureIcon:Hn,atlasInterpolation:ht,atlasInterpolationIcon:vt,isSDF:it,hasHalo:Nn,tile:He,labelPlaneMatrixInv:Ar};if(te&&Ve.canOverlap){oe=!0;const Fi=nt.segments.get();for(const Ls of Fi)Te.push({segments:new f.SegmentVector([Ls]),sortKey:Ls.sortKey,state:Fs})}else Te.push({segments:nt.segments,sortKey:0,state:Fs})}oe&&Te.sort((pe,He)=>pe.sortKey-He.sortKey);for(const pe of Te){const He=pe.state;if(p.terrain&&p.terrain.setupElevationDraw(He.tile,He.program,{useDepthForOcclusion:!be,labelPlaneMatrixInv:He.labelPlaneMatrixInv}),j.activeTexture.set(q.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,q.CLAMP_TO_EDGE),He.atlasTextureIcon&&(j.activeTexture.set(q.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),He.isSDF){const Ve=He.uniformValues;He.hasHalo&&(Ve.u_is_halo=1,ga(He.buffers,pe.segments,u,p,He.program,Q,O,B,Ve)),Ve.u_is_halo=0}ga(He.buffers,pe.segments,u,p,He.program,Q,O,B,He.uniformValues)}}function ga(p,o,u,g,x,b,E,M,A){const R=g.context;x.draw(R,R.gl.TRIANGLES,b,E,M,f.CullFaceMode.disabled,A,u.id,p.layoutVertexBuffer,p.indexBuffer,o,u.paint,g.transform.zoom,p.programConfigurations.get(u.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Lr(p,o,u,g,x,b,E){const M=p.context.gl,A=u.paint.get("fill-pattern"),R=A&&A.constantOr(1),O=u.getCrossfadeParameters();let B,j,q,H,$;E?(j=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=M.LINES):(j=R?"fillPattern":"fill",B=M.TRIANGLES);for(const ne of g){const X=o.getTile(ne);if(R&&!X.patternsLoaded())continue;const ee=X.getBucket(u);if(!ee)continue;p.prepareDrawTile();const te=ee.programConfigurations.get(u.id),oe=p.useProgram(j,te);R&&(p.context.activeTexture.set(M.TEXTURE0),X.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),te.updatePaintBuffers(O));const Q=A.constantOr(null);if(Q&&X.imageAtlas){const me=X.imageAtlas,be=me.patternPositions[Q.to.toString()],Se=me.patternPositions[Q.from.toString()];be&&Se&&te.setConstantPatternPositions(be,Se)}const ae=p.translatePosMatrix(ne.projMatrix,X,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(E){H=ee.indexBuffer2,$=ee.segments2;const me=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];q="fillOutlinePattern"===j&&R?ah(ae,p,O,X,me):eu(ae,me)}else H=ee.indexBuffer,$=ee.segments,q=R?Fr(ae,p,O,X):tc(ae);p.prepareDrawProgram(p.context,oe,ne.toUnwrapped()),oe.draw(p.context,B,x,p.stencilModeForClipping(ne),b,f.CullFaceMode.disabled,q,u.id,ee.layoutVertexBuffer,H,$,u.paint,p.transform.zoom,te)}}function Oo(p,o,u,g,x,b,E){const M=p.context,A=M.gl,R=p.transform,O=u.paint.get("fill-extrusion-pattern"),B=O.constantOr(1),j=u.getCrossfadeParameters(),q=u.paint.get("fill-extrusion-opacity"),H=function(te){if("globe"!==te.projection.name)return 0;const oe=Math.PI/32,Q=Math.tan(oe),ae=f.earthRadius;return ae*Math.sqrt(1+2*Q*Q)-ae}(R),$="globe"===R.projection.name,ne=$?f.globeToMercatorTransition(R.zoom):0,X=[f.mercatorXfromLng(R.center.lng),f.mercatorYfromLat(R.center.lat)],ee=[];$&&ee.push("PROJECTION_GLOBE_VIEW");for(const te of g){const oe=o.getTile(te),Q=oe.getBucket(u);if(!Q||Q.projection!==R.projection.name)continue;const ae=Q.programConfigurations.get(u.id),me=p.useProgram(B?"fillExtrusionPattern":"fillExtrusion",ae,ee);if(p.terrain){const He=p.terrain;if(p.style.terrainSetForDrapingOnly())He.setupElevationDraw(oe,me,{useMeterToDem:!0});else{if(!Q.enableTerrain)continue;if(He.setupElevationDraw(oe,me,{useMeterToDem:!0}),Fo(M,o,te,Q,u,He),!Q.centroidVertexBuffer){const Ve=me.attributes.a_centroid_pos;void 0!==Ve&&A.vertexAttrib2f(Ve,0,0)}}}B&&(p.context.activeTexture.set(A.TEXTURE0),oe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ae.updatePaintBuffers(j));const be=O.constantOr(null);if(be&&oe.imageAtlas){const He=oe.imageAtlas,Ve=He.patternPositions[be.to.toString()],nt=He.patternPositions[be.from.toString()];Ve&&nt&&ae.setConstantPatternPositions(Ve,nt)}const Se=p.translatePosMatrix(te.projMatrix,oe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Te=R.projection.createInversionMatrix(R,te.canonical),Ne=u.paint.get("fill-extrusion-vertical-gradient"),pe=B?ec(Se,p,Ne,q,te,j,oe,H,ne,X,Te):Ql(Se,p,Ne,q,te,H,ne,X,Te);p.prepareDrawProgram(M,me,te.toUnwrapped()),me.draw(M,M.gl.TRIANGLES,x,b,E,f.CullFaceMode.backCCW,pe,u.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,u.paint,p.transform.zoom,ae,p.terrain?Q.centroidVertexBuffer:null,$?Q.layoutVertexExtBuffer:null)}}function Fo(p,o,u,g,x,b){const E=[X=>{let ee=X.canonical.x-1,te=X.wrap;return ee<0&&(ee=(1<<X.canonical.z)-1,te--),new f.OverscaledTileID(X.overscaledZ,te,X.canonical.z,ee,X.canonical.y)},X=>{let ee=X.canonical.x+1,te=X.wrap;return ee===1<<X.canonical.z&&(ee=0,te++),new f.OverscaledTileID(X.overscaledZ,te,X.canonical.z,ee,X.canonical.y)},X=>new f.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,(0===X.canonical.y?1<<X.canonical.z:X.canonical.y)-1),X=>new f.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y===(1<<X.canonical.z)-1?0:X.canonical.y+1)],M=X=>{const ee=o.getSource().minzoom,te=Q=>{const ae=o.getTileByID(Q);if(ae&&ae.hasData())return ae.getBucket(x)},oe=[0,-1,1];for(const Q of oe){if(X.overscaledZ+Q<ee)continue;const ae=te(X.calculateScaledKey(X.overscaledZ+Q));if(ae)return ae}},A=[0,0,0],R=(X,ee)=>(A[0]=Math.min(X.min.y,ee.min.y),A[1]=Math.max(X.max.y,ee.max.y),A[2]=f.EXTENT-ee.min.x>X.max.x?ee.min.x-f.EXTENT:X.max.x,A),O=(X,ee)=>(A[0]=Math.min(X.min.x,ee.min.x),A[1]=Math.max(X.max.x,ee.max.x),A[2]=f.EXTENT-ee.min.y>X.max.y?ee.min.y-f.EXTENT:X.max.y,A),B=[(X,ee)=>R(X,ee),(X,ee)=>R(ee,X),(X,ee)=>O(X,ee),(X,ee)=>O(ee,X)],j=new f.pointGeometry(0,0);let q,H,$;const ne=(X,ee,te,oe,Q)=>{const ae=[[oe?te:X,oe?X:te,0],[oe?te:ee,oe?ee:te,0]],me=Q<0?f.EXTENT+Q:Q,be=[oe?me:(X+ee)/2,oe?(X+ee)/2:me,0];return 0===te&&Q<0||0!==te&&Q>0?b.getForTilePoints($,[be],!0,H):ae.push(be),b.getForTilePoints(u,ae,!0,q),Math.max(ae[0][2],ae[1][2],be[2])/b.exaggeration()};for(let X=0;X<4;X++){const ee=(X<2?1:5)-X,te=g.borders[X];if(0===te.length)continue;const oe=$=E[X](u),Q=M(oe);if(!(Q&&Q instanceof f.FillExtrusionBucket&&Q.enableTerrain)||g.borderDoneWithNeighborZ[X]===Q.canonical.z&&Q.borderDoneWithNeighborZ[ee]===g.canonical.z||(H=b.findDEMTileFor(oe),!H||!H.dem))continue;if(!q){const Se=b.findDEMTileFor(u);if(!Se||!Se.dem)return;q=Se}const ae=Q.borders[ee];let me=0;const be=Q.borderDoneWithNeighborZ[ee]!==g.canonical.z;if(g.canonical.z===Q.canonical.z){for(let Se=0;Se<te.length;Se++){const Te=g.featuresOnBorder[te[Se]],Ne=Te.borders[X];let pe;for(;me<ae.length&&(pe=Q.featuresOnBorder[ae[me]],!(pe.borders[ee][1]>Ne[0]+3));)be&&Q.encodeCentroid(void 0,pe,!1),me++;if(pe&&me<ae.length){const He=me;let Ve=0;for(;!(pe.borders[ee][0]>Ne[1]-3)&&(Ve++,++me!==ae.length);)pe=Q.featuresOnBorder[ae[me]];if(pe=Q.featuresOnBorder[ae[He]],Te.intersectsCount()>1||pe.intersectsCount()>1||1!==Ve){1!==Ve&&(me=He),g.encodeCentroid(void 0,Te,!1),be&&Q.encodeCentroid(void 0,pe,!1);continue}const nt=B[X](Te,pe),Ie=X%2?f.EXTENT-1:0;j.x=ne(nt[0],Math.min(f.EXTENT-1,nt[1]),Ie,X<2,nt[2]),j.y=0,g.encodeCentroid(j,Te,!1),be&&Q.encodeCentroid(j,pe,!1)}else g.encodeCentroid(void 0,Te,!1)}g.borderDoneWithNeighborZ[X]=Q.canonical.z,g.needsCentroidUpdate=!0,be&&(Q.borderDoneWithNeighborZ[ee]=g.canonical.z,Q.needsCentroidUpdate=!0)}else{for(const Se of te)g.encodeCentroid(void 0,g.featuresOnBorder[Se],!1);if(be){for(const Se of ae)Q.encodeCentroid(void 0,Q.featuresOnBorder[Se],!1);Q.borderDoneWithNeighborZ[ee]=g.canonical.z,Q.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[X]=Q.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(p)}const Ai=new f.Color(1,0,0,1),An=new f.Color(0,1,0,1),Od=new f.Color(0,0,1,1),ru=new f.Color(1,0,1,1),Pi=new f.Color(0,1,1,1);function Ye(p,o,u,g){Ms(p,0,o+u/2,p.transform.width,u,g)}function _i(p,o,u,g){Ms(p,o-u/2,0,u,p.transform.height,g)}function Ms(p,o,u,g,x,b){const E=p.context,M=E.gl;M.enable(M.SCISSOR_TEST),M.scissor(o*f.exported.devicePixelRatio,u*f.exported.devicePixelRatio,g*f.exported.devicePixelRatio,x*f.exported.devicePixelRatio),E.clear({color:b}),M.disable(M.SCISSOR_TEST)}function rc(p,o,u){const g=p.context,x=g.gl,b="globe"===p.transform.projection.name,E=u.projMatrix,M=p.useProgram("debug",null,b?["PROJECTION_GLOBE_VIEW"]:null),A=o.getTileByID(u.key);p.terrain&&p.terrain.setupElevationDraw(A,M);const R=f.DepthMode.disabled,O=f.StencilMode.disabled,B=p.colorModeForRenderPass(),j="$debug";g.activeTexture.set(x.TEXTURE0),p.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),b?A._makeGlobeTileDebugBuffers(p.context,p.transform.projection):A._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const q=A._tileDebugBuffer||p.debugBuffer,H=A._tileDebugIndexBuffer||p.debugIndexBuffer,$=A._tileDebugSegments||p.debugSegments;M.draw(g,x.LINE_STRIP,R,O,B,f.CullFaceMode.disabled,Es(E,f.Color.red),j,q,H,$,null,null,null,A._globeTileDebugBorderBuffer);const ne=A.latestRawTileData,X=Math.floor((ne&&ne.byteLength||0)/1024),ee=o.getTile(u).tileSize,te=512/Math.min(ee,512)*(u.overscaledZ/p.transform.zoom)*.5;let oe=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(oe+=` => ${u.overscaledZ}`),function(be,Se){be.initDebugOverlayCanvas();const Te=be.debugOverlayCanvas,Ne=be.context.gl,pe=be.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,Te.width,Te.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(Se,5,5),pe.strokeText(Se,5,5),be.debugOverlayTexture.update(Te),be.debugOverlayTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}(p,`${oe} ${X}kb`);const Q=A._tileDebugTextBuffer||p.debugBuffer,ae=A._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,me=A._tileDebugTextSegments||p.debugSegments;M.draw(g,x.TRIANGLES,R,O,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,Es(E,f.Color.transparent,te),j,Q,ae,me,null,null,null,A._globeTileDebugTextBuffer)}const Wi=f.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ol}=Wi;function Ss(p,o,u,g){p.emplaceBack(o,u,g)}class ic{constructor(o){this.vertexArray=new f.StructArrayLayout3f12,this.indices=new f.StructArrayLayout3ui6,Ss(this.vertexArray,-1,-1,1),Ss(this.vertexArray,1,-1,1),Ss(this.vertexArray,-1,1,1),Ss(this.vertexArray,1,1,1),Ss(this.vertexArray,-1,-1,-1),Ss(this.vertexArray,1,-1,-1),Ss(this.vertexArray,-1,1,-1),Ss(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,ol),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=f.SegmentVector.simpleSegment(0,0,36,12)}}function Is(p,o,u,g,x,b){const E=p.gl,M=o.paint.get("sky-atmosphere-color"),A=o.paint.get("sky-atmosphere-halo-color"),R=o.paint.get("sky-atmosphere-sun-intensity"),O={u_matrix_3f:f.fromMat4(f.create$1(),g),u_sun_direction:x,u_sun_intensity:R,u_color_tint_r:[(H=M).r,H.g,H.b,H.a],u_color_tint_m:[($=A).r,$.g,$.b,$.a],u_luminance:5e-5};var H,$;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),u.draw(p,E.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.frontCW,O,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}function _a(p,o){return f.transformMat4(p,p,o)}const Fd={symbol:function(p,o,u,g,x){if("translucent"!==p.renderPass)return;const b=f.StencilMode.disabled,E=p.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(M,A,R,O,B,j,q){const H=A.transform,$="map"===B,ne="map"===j;for(const X of M){const ee=O.getTile(X),te=ee.getBucket(R);if(!te||te.projection!==H.projection.name||!te.text||!te.text.segments.get().length)continue;const oe=f.evaluateSizeForZoom(te.textSizeData,H.zoom),Q=A.transform.calculatePixelsToTileUnitsMatrix(ee),ae=qn(X.projMatrix,ee.tileID.canonical,ne,$,A.transform,Q),me="none"!==R.layout.get("icon-text-fit")&&te.hasIconData();if(oe){const be=Math.pow(2,H.zoom-ee.tileID.overscaledZ);nu(te,$,ne,q,f.symbolSize,H,ae,X,be,oe,me,H.projection)}}}(g,p,u,o,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),x),0!==u.paint.get("icon-opacity").constantOr(1)&&nc(p,o,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,E),0!==u.paint.get("text-opacity").constantOr(1)&&nc(p,o,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,E),o.map.showCollisionBoxes&&(rl(p,o,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),rl(p,o,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,o,u,g){if("translucent"!==p.renderPass)return;const x=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),E=u.paint.get("circle-stroke-opacity"),M=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===b.constantOr(1)||0===E.constantOr(1)))return;const A=p.context,R=A.gl,O=p.transform,B=p.depthModeForSublayer(0,f.DepthMode.ReadOnly),j=f.StencilMode.disabled,q=p.colorModeForRenderPass(),H="globe"===O.projection.name,$=[f.mercatorXfromLng(O.center.lng),f.mercatorYfromLat(O.center.lat)],ne=[];for(let ee=0;ee<g.length;ee++){const te=g[ee],oe=o.getTile(te),Q=oe.getBucket(u);if(!Q)continue;const ae=Q.programConfigurations.get(u.id),me=qr(u);H&&me.push("PROJECTION_GLOBE_VIEW");const be=p.useProgram("circle",ae,me),Se=Q.layoutVertexBuffer,Te=Q.globeExtVertexBuffer,Ne=Q.indexBuffer,pe=O.projection.createInversionMatrix(O,te.canonical),He={programConfiguration:ae,program:be,layoutVertexBuffer:Se,globeExtVertexBuffer:Te,indexBuffer:Ne,uniformValues:wr(p,te,oe,pe,$,u),tile:oe};if(M){const Ve=Q.segments.get();for(const nt of Ve)ne.push({segments:new f.SegmentVector([nt]),sortKey:nt.sortKey,state:He})}else ne.push({segments:Q.segments,sortKey:0,state:He})}M&&ne.sort((ee,te)=>ee.sortKey-te.sortKey);const X={useDepthForOcclusion:!H};for(const ee of ne){const{programConfiguration:te,program:oe,layoutVertexBuffer:Q,globeExtVertexBuffer:ae,indexBuffer:me,uniformValues:be,tile:Se}=ee.state,Te=ee.segments;p.terrain&&p.terrain.setupElevationDraw(Se,oe,X),p.prepareDrawProgram(A,oe,Se.tileID.toUnwrapped()),oe.draw(A,R.TRIANGLES,B,j,q,f.CullFaceMode.disabled,be,u.id,Q,me,Te,u.paint,O.zoom,te,H?ae:null)}},heatmap:function(p,o,u,g){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const x=p.context,b=x.gl,E=f.StencilMode.disabled,M=new f.ColorMode([b.ONE,b.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function(j,q,H){const $=j.gl;j.activeTexture.set($.TEXTURE1),j.viewport.set([0,0,q.width/4,q.height/4]);let ne=H.heatmapFbo;if(ne)$.bindTexture($.TEXTURE_2D,ne.colorAttachment.get()),j.bindFramebuffer.set(ne.framebuffer);else{const X=$.createTexture();$.bindTexture($.TEXTURE_2D,X),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),ne=H.heatmapFbo=j.createFramebuffer(q.width/4,q.height/4,!1),function(ee,te,oe,Q){const ae=ee.gl;ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,te.width/4,te.height/4,0,ae.RGBA,ee.extRenderToTextureHalfFloat?ee.extTextureHalfFloat.HALF_FLOAT_OES:ae.UNSIGNED_BYTE,null),Q.colorAttachment.set(oe)}(j,q,X,ne)}})(x,p,u),x.clear({color:f.Color.transparent});const A=p.transform,R="globe"===A.projection.name,O=R?["PROJECTION_GLOBE_VIEW"]:null,B=[f.mercatorXfromLng(A.center.lng),f.mercatorYfromLat(A.center.lat)];for(let j=0;j<g.length;j++){const q=g[j];if(o.hasRenderableParent(q))continue;const H=o.getTile(q),$=H.getBucket(u);if(!$)continue;const ne=$.programConfigurations.get(u.id),X=p.useProgram("heatmap",ne,O),{zoom:ee}=p.transform;p.terrain&&p.terrain.setupElevationDraw(H,X),p.prepareDrawProgram(x,X,q.toUnwrapped());const te=A.projection.createInversionMatrix(A,q.canonical);X.draw(x,b.TRIANGLES,f.DepthMode.disabled,E,M,f.CullFaceMode.disabled,tu(p,q,H,te,B,ee,u.paint.get("heatmap-intensity")),u.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,u.paint,p.transform.zoom,ne,R?$.globeExtVertexBuffer:null)}x.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(x,b){const E=x.context,M=E.gl,A=b.heatmapFbo;if(!A)return;E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,A.colorAttachment.get()),E.activeTexture.set(M.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new f.Texture(E,b.colorRamp,M.RGBA)),R.bind(M.LINEAR,M.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(E,M.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,x.colorModeForRenderPass(),f.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(p,u))},line:function(p,o,u,g){if("translucent"!==p.renderPass)return;const x=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===x.constantOr(1)||0===b.constantOr(1))return;const E=p.depthModeForSublayer(0,f.DepthMode.ReadOnly),M=p.colorModeForRenderPass(),A=p.terrain&&p.terrain.renderingToTexture?1:f.exported.devicePixelRatio,R=u.paint.get("line-dasharray"),O=R.constantOr(1),B=u.layout.get("line-cap"),j=u.paint.get("line-pattern"),q=j.constantOr(1),H=u.paint.get("line-gradient"),$=u.getCrossfadeParameters(),ne=q?"linePattern":"line",X=p.context,ee=X.gl,te=(Q=>{const ae=[];Sr(Q)&&ae.push("RENDER_LINE_DASH"),Q.paint.get("line-gradient")&&ae.push("RENDER_LINE_GRADIENT");const me=Q.paint.get("line-pattern").constantOr(1),be=1!==Q.paint.get("line-opacity").constantOr(1);return!me&&be&&ae.push("RENDER_LINE_ALPHA_DISCARD"),ae})(u);let oe=te.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(oe=!1);for(const Q of g){const ae=o.getTile(Q);if(q&&!ae.patternsLoaded())continue;const me=ae.getBucket(u);if(!me)continue;p.prepareDrawTile();const be=me.programConfigurations.get(u.id),Se=p.useProgram(ne,be,te),Te=j.constantOr(null);if(Te&&ae.imageAtlas){const Ie=ae.imageAtlas,it=Ie.patternPositions[Te.to.toString()],mt=Ie.patternPositions[Te.from.toString()];it&&mt&&be.setConstantPatternPositions(it,mt)}const Ne=R.constantOr(null),pe=B.constantOr(null);if(!q&&Ne&&pe&&ae.lineAtlas){const Ie=ae.lineAtlas,it=Ie.getDash(Ne.to,pe),mt=Ie.getDash(Ne.from,pe);it&&mt&&be.setConstantPatternPositions(it,mt)}const He=p.terrain?Q.projMatrix:null,Ve=q?pa(p,ae,u,$,He,A):lh(p,ae,u,$,He,me.lineClipsArray.length,A);if(H){const Ie=me.gradients[u.id];let it=Ie.texture;if(u.gradientVersion!==Ie.version){let mt=256;if(u.stepInterpolant){const st=o.getSource().maxzoom,at=Q.canonical.z===st?Math.ceil(1<<p.transform.maxZoom-Q.canonical.z):1;mt=f.clamp(f.nextPowerOfTwo(me.maxLineLength/f.EXTENT*1024*at),256,X.maxTextureSize)}Ie.gradient=f.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:mt,image:Ie.gradient||void 0,clips:me.lineClipsArray}),Ie.texture?Ie.texture.update(Ie.gradient):Ie.texture=new f.Texture(X,Ie.gradient,ee.RGBA),Ie.version=u.gradientVersion,it=Ie.texture}X.activeTexture.set(ee.TEXTURE1),it.bind(u.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}O&&(X.activeTexture.set(ee.TEXTURE0),ae.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),be.updatePaintBuffers($)),q&&(X.activeTexture.set(ee.TEXTURE0),ae.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),be.updatePaintBuffers($)),p.prepareDrawProgram(X,Se,Q.toUnwrapped());const nt=Ie=>{Se.draw(X,ee.TRIANGLES,E,Ie,M,f.CullFaceMode.disabled,Ve,u.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,u.paint,p.transform.zoom,be,me.layoutVertexBuffer2)};if(oe){const Ie=p.stencilModeForClipping(Q).ref;0===Ie&&p.terrain&&X.clear({stencil:0});const it={func:ee.EQUAL,mask:255};Ve.u_alpha_discard_threshold=.8,nt(new f.StencilMode(it,Ie,255,ee.KEEP,ee.KEEP,ee.INVERT)),Ve.u_alpha_discard_threshold=0,nt(new f.StencilMode(it,Ie,255,ee.KEEP,ee.KEEP,ee.KEEP))}else nt(p.stencilModeForClipping(Q))}oe&&(p.resetStencilClippingMasks(),p.terrain&&X.clear({stencil:0}))},fill:function(p,o,u,g){const x=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const E=p.colorModeForRenderPass(),M=u.paint.get("fill-pattern"),A=p.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===x.constantOr(f.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(p.renderPass===A){const R=p.depthModeForSublayer(1,"opaque"===p.renderPass?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly);Lr(p,o,u,g,R,E,!1)}if("translucent"===p.renderPass&&u.paint.get("fill-antialias")){const R=p.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,f.DepthMode.ReadOnly);Lr(p,o,u,g,R,E,!0)}},"fill-extrusion":function(p,o,u,g){const x=u.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===p.renderPass){const b=new f.DepthMode(p.context.gl.LEQUAL,f.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==x||u.paint.get("fill-extrusion-pattern").constantOr(1))Oo(p,o,u,g,b,f.StencilMode.disabled,f.ColorMode.disabled),Oo(p,o,u,g,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const E=p.colorModeForRenderPass();Oo(p,o,u,g,b,f.StencilMode.disabled,E)}}},hillshade:function(p,o,u,g){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const x=p.context,b=p.depthModeForSublayer(0,f.DepthMode.ReadOnly),E=p.colorModeForRenderPass(),M=p.terrain&&p.terrain.renderingToTexture,[A,R]="translucent"!==p.renderPass||M?[{},g]:p.stencilConfigForOverlap(g);for(const O of R){const B=o.getTile(O);if(B.needsHillshadePrepare&&"offscreen"===p.renderPass)qi(p,B,u,b,f.StencilMode.disabled,E);else if("translucent"===p.renderPass){const j=M&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):A[O.overscaledZ];ap(p,O,B,u,b,j,E)}}x.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,o,u,g,x,b){if("translucent"!==p.renderPass||0===u.paint.get("raster-opacity")||!g.length)return;const E=p.context,M=E.gl,A=o.getSource(),R=p.useProgram("raster"),O=p.colorModeForRenderPass(),B=p.terrain&&p.terrain.renderingToTexture,[j,q]=A instanceof ce||B?[{},g]:p.stencilConfigForOverlap(g),H=q[q.length-1].overscaledZ,$=!p.options.moving;for(const ne of q){const X=B?f.DepthMode.disabled:p.depthModeForSublayer(ne.overscaledZ-H,1===u.paint.get("raster-opacity")?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly,M.LESS),ee=ne.toUnwrapped(),te=o.getTile(ne);if(B&&(!te||!te.hasData()))continue;const oe=B?ne.projMatrix:p.transform.calculateProjMatrix(ee,$),Q=p.terrain&&B?p.terrain.stencilModeForRTTOverlap(ne):j[ne.overscaledZ],ae=b?0:u.paint.get("raster-fade-duration");te.registerFadeDuration(ae);const me=o.findLoadedParent(ne,0),be=Mn(te,me,o,p.transform,ae);let Se,Te;p.terrain&&p.terrain.prepareDrawTile();const Ne="nearest"===u.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;E.activeTexture.set(M.TEXTURE0),te.texture.bind(Ne,M.CLAMP_TO_EDGE),E.activeTexture.set(M.TEXTURE1),me?(me.texture.bind(Ne,M.CLAMP_TO_EDGE),Se=Math.pow(2,me.tileID.overscaledZ-te.tileID.overscaledZ),Te=[te.tileID.canonical.x*Se%1,te.tileID.canonical.y*Se%1]):te.texture.bind(Ne,M.CLAMP_TO_EDGE);const pe=Rd(oe,Te||[0,0],Se||1,be,u,A instanceof ce?A.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(E,R,ee),A instanceof ce)A.boundsBuffer&&A.boundsSegments&&R.draw(E,M.TRIANGLES,X,f.StencilMode.disabled,O,f.CullFaceMode.disabled,pe,u.id,A.boundsBuffer,p.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:He,tileBoundsIndexBuffer:Ve,tileBoundsSegments:nt}=p.getTileBoundsBuffers(te);R.draw(E,M.TRIANGLES,X,Q,O,f.CullFaceMode.disabled,pe,u.id,He,Ve,nt)}}p.resetStencilClippingMasks()},background:function(p,o,u,g){const x=u.paint.get("background-color"),b=u.paint.get("background-opacity");if(0===b)return;const E=p.context,M=E.gl,A=p.transform,R=A.tileSize,O=u.paint.get("background-pattern");if(p.isPatternMissing(O))return;const B=!O&&1===x.a&&1===b&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==B)return;const j=f.StencilMode.disabled,q=p.depthModeForSublayer(0,"opaque"===B?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly),H=p.colorModeForRenderPass(),$=p.useProgram(O?"backgroundPattern":"background");let ne,X=g;X||(ne=p.getBackgroundTiles(),X=Object.values(ne).map(te=>te.tileID)),O&&(E.activeTexture.set(M.TEXTURE0),p.imageManager.bind(p.context));const ee=u.getCrossfadeParameters();for(const te of X){const oe=te.toUnwrapped(),Q=g?te.projMatrix:p.transform.calculateProjMatrix(oe);p.prepareDrawTile();const ae=o?o.getTile(te):ne?ne[te.key]:new f.Tile(te,R,A.zoom,p),me=O?mr(Q,b,p,O,{tileID:te,tileSize:R},ee):Ds(Q,b,x);p.prepareDrawProgram(E,$,oe);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:Se,tileBoundsSegments:Te}=p.getTileBoundsBuffers(ae);$.draw(E,M.TRIANGLES,q,j,H,f.CullFaceMode.disabled,me,u.id,be,Se,Te)}},sky:function(p,o,u){const g=p.transform,x="mercator"===g.projection.name||"globe"===g.projection.name?1:f.smoothstep(7,8,g.zoom),b=u.paint.get("sky-opacity")*x;if(0===b)return;const E=p.context,M=u.paint.get("sky-type"),A=new f.DepthMode(E.gl.LEQUAL,f.DepthMode.ReadOnly,[0,1]),R=p.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===p.renderPass?u.needsSkyboxCapture(p)&&(function(O,B,j,q){const H=O.context,$=H.gl;let ne=B.skyboxFbo;if(!ne){ne=B.skyboxFbo=H.createFramebuffer(32,32,!1),B.skyboxGeometry=new ic(H),B.skyboxTexture=H.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,B.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let oe=0;oe<6;++oe)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(ne.framebuffer),H.viewport.set([0,0,32,32]);const X=B.getCenter(O,!0),ee=O.useProgram("skyboxCapture"),te=new Float64Array(16);f.identity(te),f.rotateY(te,te,.5*-Math.PI),Is(H,B,ee,te,X,0),f.identity(te),f.rotateY(te,te,.5*Math.PI),Is(H,B,ee,te,X,1),f.identity(te),f.rotateX(te,te,.5*-Math.PI),Is(H,B,ee,te,X,2),f.identity(te),f.rotateX(te,te,.5*Math.PI),Is(H,B,ee,te,X,3),f.identity(te),Is(H,B,ee,te,X,4),f.identity(te),f.rotateY(te,te,Math.PI),Is(H,B,ee,te,X,5),H.viewport.set([0,0,O.width,O.height])}(p,u),u.markSkyboxValid(p)):"sky"===p.renderPass&&function(O,B,j,q,H){const $=O.context,ne=$.gl,X=O.transform,ee=O.useProgram("skybox");$.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_CUBE_MAP,B.skyboxTexture);const te={u_matrix:X.skyboxMatrix,u_sun_direction:B.getCenter(O,!1),u_cubemap:0,u_opacity:q,u_temporal_offset:H};O.prepareDrawProgram($,ee),ee.draw($,ne.TRIANGLES,j,f.StencilMode.disabled,O.colorModeForRenderPass(),f.CullFaceMode.backCW,te,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(p,u,A,b,R):"gradient"===M&&"sky"===p.renderPass&&function(O,B,j,q,H){const $=O.context,ne=$.gl,X=O.transform,ee=O.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new ic($)),$.activeTexture.set(ne.TEXTURE0);let te=B.colorRampTexture;te||(te=B.colorRampTexture=new f.Texture($,B.colorRamp,ne.RGBA)),te.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const oe=(Q=X.skyboxMatrix,ae=B.getCenter(O,!1),me=B.paint.get("sky-gradient-radius"),be=q,Se=H,{u_matrix:Q,u_color_ramp:0,u_center_direction:ae,u_radius:f.degToRad(me),u_opacity:be,u_temporal_offset:Se});var Q,ae,me,be,Se;O.prepareDrawProgram($,ee),ee.draw($,ne.TRIANGLES,j,f.StencilMode.disabled,O.colorModeForRenderPass(),f.CullFaceMode.backCW,oe,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(p,u,A,b,R)},debug:function(p,o,u){for(let g=0;g<u.length;g++)rc(p,o,u[g])},custom:function(p,o,u){const g=p.context,x=u.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))f.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const b=x.prerender;b&&(p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),b.call(x,g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),g.setStencilMode(f.StencilMode.disabled);const b="3d"===x.renderingMode?new f.DepthMode(p.context.gl.LEQUAL,f.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,f.DepthMode.ReadOnly);g.setDepthMode(b),x.render(g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState(),g.bindFramebuffer.set(null)}}};class lp{constructor(o,u){this.context=new z(o),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=f.SourceCache.maxUnderzooming+f.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qa,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(o,u){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cr(this,o));const x=this._terrain;this.transform.elevation=g?x:null,x.update(o,this.transform,u)}_updateFog(o){const u=o.fog;if(!u||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=u.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const b=g+.78*(x-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,u){if(this.width=o*f.exported.devicePixelRatio,this.height=u*f.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const o=this.context,u=new f.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(f.EXTENT,0),u.emplaceBack(0,f.EXTENT),u.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(u,f.posAttributes.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const g=new f.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(f.EXTENT,0),g.emplaceBack(0,f.EXTENT),g.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=o.createVertexBuffer(g,f.posAttributes.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const x=new f.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,f.posAttributes.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const b=new f.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(f.EXTENT,0,f.EXTENT,0),b.emplaceBack(0,f.EXTENT,0,f.EXTENT),b.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(b,f.boundsAttributes.members),this.mercatorBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const E=new f.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const M=new f.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])M.emplaceBack(R);this.debugIndexBuffer=o.createIndexBuffer(M),this.emptyTexture=new f.Texture(o,new f.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=f.create();const A=this.context.gl;this.stencilClearMode=new f.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(f.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(o,u.TRIANGLES,f.DepthMode.disabled,this.stencilClearMode,f.ColorMode.disabled,f.CullFaceMode.disabled,Jo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(o,u,g){if(!u||this.currentStencilSource===u.id||!o.isTileClipped()||!g||0===g.length)return;const x=[];let b=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const O of g)if(this._tileClippingMaskIDs.has(O.key)||(b=!0),this._skippedStencilTileIDs.has(O.key)){if(!u.getTile(O).getBucket(o))continue;this._skippedStencilTileIDs.delete(O.key),x.push(O)}if(!b&&0===x.length)return}const E=this.context,M=E.gl;E.setColorMode(f.ColorMode.disabled),E.setDepthMode(f.DepthMode.disabled);const A=this.useProgram("clippingMask"),R=O=>{const B=u.getTile(O),{tileBoundsBuffer:j,tileBoundsIndexBuffer:q,tileBoundsSegments:H}=this.getTileBoundsBuffers(B);A.draw(E,M.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:M.GREATER,mask:255},this._tileClippingMaskIDs.get(O.key)||0,255,M.KEEP,M.KEEP,M.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,Jo(O.projMatrix),"$clipping",j,q,H)};if(!b&&x.length>0)for(const O of x)R(O);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+g.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const O of g)this._tileClippingMaskIDs.set(O.key,this.nextStencilID++),u.getTile(O).getBucket(o)?R(O):this._skippedStencilTileIDs.add(O.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=u.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new f.StencilMode({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const u=this.context.gl;return new f.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs.get(o.key)||0,0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(o){const u=this.context.gl,g=o.sort((E,M)=>M.overscaledZ-E.overscaledZ),x=g[g.length-1].overscaledZ,b=g[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let M=0;M<b;M++)E[M+x]=new f.StencilMode({func:u.GEQUAL,mask:255},M+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[E,g]}return[{[x]:f.StencilMode.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new f.ColorMode([o.CONSTANT_COLOR,o.ONE],new f.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.ColorMode.unblended:f.ColorMode.alphaBlended}depthModeForSublayer(o,u,g){if(!this.opaquePassEnabledForLayer())return f.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new f.DepthMode(g||this.context.gl.LEQUAL,u,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const g=this.style.order,x=this.style._sourceCaches;for(const R in x){const O=x[R];O.used&&O.prepare(this.context)}const b={},E={},M={};for(const R in x){const O=x[R];b[R]=O.getVisibleCoordinates(),E[R]=b[R].slice().reverse(),M[R]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<g.length;R++)if(this.style._layers[g[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.GlobeSharedBuffers(this.context)),!f.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of g){const O=this.style._layers[R],B=o._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const j=B?E[B.id]:void 0;("custom"===O.type||O.isSky()||j&&j.length)&&this.renderLayer(this,B,O,j)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let A=f.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(A=this.style.fog.properties.get("color")),this.context.clear({color:u.showOverdrawInspector?f.Color.black:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[g[this.currentLayer]],O=o._getLayerSourceCache(R);if(R.isSky())continue;const B=O?E[O.id]:void 0;this._renderTileClippingMasks(R,O,B),this.renderLayer(this,O,R,B)}if(this.renderPass="sky",(f.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const R=this.style._layers[g[this.currentLayer]],O=o._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,O,R,O?E[O.id]:void 0)}for("globe"===this.transform.projection.name&&function(R){const O=R.context,B=O.gl,j=R.transform,q=new f.DepthMode(B.LEQUAL,f.DepthMode.ReadOnly,[0,1]),H=R.useProgram("globeAtmosphere"),$=j.centerOffset,ne=j._camera.getCameraToClipPerspective(j._fov,j.width/j.height,j._nearZ,j._farZ);ne[8]=2*-$.x/j.width,ne[9]=2*$.y/j.height;const X=f.invert([],ne),ee=f.mul([],X,j.projMatrix),te={u_frustum_tl:_a([-1,1,1],X),u_frustum_tr:_a([1,1,1],X),u_frustum_br:_a([1,-1,1],X),u_frustum_bl:_a([-1,-1,1],X),u_globe_pos:_a([j.globeMatrix[12],j.globeMatrix[13],j.globeMatrix[14]],ee),u_globe_radius:j.worldSize/2/Math.PI-1,u_opacity:1-f.globeToMercatorTransition(j.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};R.prepareDrawProgram(O,H);const oe=R.globeSharedBuffers;oe&&H.draw(O,B.TRIANGLES,q,f.StencilMode.disabled,f.ColorMode.alphaBlended,f.CullFaceMode.backCW,te,"skybox",oe.atmosphereVertexBuffer,oe.atmosphereIndexBuffer,oe.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const R=this.style._layers[g[this.currentLayer]],O=o._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=O?("symbol"===R.type?M:E)[O.id]:void 0;this._renderTileClippingMasks(R,O,O?b[O.id]:void 0),this.renderLayer(this,O,R,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;f.values(this.style._layers).forEach(O=>{const B=o._getLayerSourceCache(O);B&&!O.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<B.getSource().maxzoom)&&(R=B)}),R&&this.options.showTileBoundaries&&Fd.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const O=R.transform.padding;Ye(R,R.transform.height-(O.top||0),3,Ai),Ye(R,O.bottom||0,3,An),_i(R,O.left||0,3,Od),_i(R,R.transform.width-(O.right||0),3,ru);const B=R.transform.centerPoint;var j,q,H,$;Ms(j=R,(q=B.x)-1,(H=R.transform.height-B.y)-10,2,20,$=Pi),Ms(j,q-10,H-1,20,2,$)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(f.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,u,g,x){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)||Fd[g.type](o,u,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[o.id];g||(g=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const u={};for(const g in o){const x=o[g],b=this.context.extTimerQuery,E=b.getQueryObjectEXT(x.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(x.query),u[g]=E}return u}translatePosMatrix(o,u,g,x,b){if(!g[0]&&!g[1])return o;const E=b?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(E){const R=Math.sin(E),O=Math.cos(E);g=[g[0]*O-g[1]*R,g[0]*R+g[1]*O]}const M=[b?g[0]:Gr(u,g[0],this.transform.zoom),b?g[1]:Gr(u,g[1],this.transform.zoom),0],A=new Float32Array(16);return f.translate(A,o,M),A}saveTileTexture(o){const u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const u=this.imageManager.getPattern(o.from.toString()),g=this.imageManager.getPattern(o.to.toString());return!u||!g}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),u&&!o&&0!==u.getOpacity(this.transform.pitch)&&g.push("FOG"),o&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(o,u,g){this.cache=this.cache||{};const x=g||[],b=this.currentGlobalDefines().concat(x),E=Jl.cacheKey(o,b,u);return this.cache[E]||(this.cache[E]=new Jl(this.context,o,nl[o],u,Kt[o],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=f.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const b=x.getOpacity(this.transform.pitch);0!==b&&u.setFogUniformValues(o,((E,M,A,R)=>{const O=M.properties.get("color"),B=E.frameCounter/1e3%1,j=[O.r/O.a,O.g/O.a,O.b/O.a,R];return{u_fog_matrix:A?E.transform.calculateFogTileMatrix(A):E.identityMat,u_fog_range:M.getFovAdjustedRange(E.transform._fov),u_fog_color:j,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:B}})(this,x,g,b))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,u=o.createTexture();return o.bindTexture(o.TEXTURE_2D,u),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)u[x.key]=o[x.key]||new f.Tile(x,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class ya{constructor(o=0,u=0,g=0,x=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=g,this.right=x}interpolate(o,u,g){return null!=u.top&&null!=o.top&&(this.top=f.number(o.top,u.top,g)),null!=u.bottom&&null!=o.bottom&&(this.bottom=f.number(o.bottom,u.bottom,g)),null!=u.left&&null!=o.left&&(this.left=f.number(o.left,u.left,g)),null!=u.right&&null!=o.right&&(this.right=f.number(o.right,u.right,g)),this}getCenter(o,u){const g=f.clamp((this.left+o-this.right)/2,0,o),x=f.clamp((this.top+u-this.bottom)/2,0,u);return new f.pointGeometry(g,x)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ya(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function cp(p,o){const u=f.getColumn(p,3);f.fromQuat(p,o),f.setColumn(p,3,u)}function Ld(p,o){const u=f.identity$1([]);return f.rotateZ$1(u,u,-o),f.rotateX$1(u,u,-p),u}function ch(p,o){const u=[p[0],p[1],0],g=[o[0],o[1],0];if(f.length(u)>=1e-15){const E=f.normalize([],u);f.scale$2(g,E,f.dot(g,E)),o[0]=g[0],o[1]=g[1]}const x=f.cross([],o,p);if(f.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Ld(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class iu{constructor(o,u){this.position=o,this.orientation=u}get position(){return this._position}set position(o){if(o){const u=o instanceof f.MercatorCoordinate?o:new f.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(u.x=f.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(o,u){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(o)):0,x=this.position,b=f.MercatorCoordinate.fromLngLat(o,g),E=[b.x-x.x,b.y-x.y,b.z-x.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=ch(E,u)}setPitchBearing(o,u){this.orientation=Ld(f.degToRad(o),f.degToRad(-u))}}class ou{constructor(o,u){this._transform=f.identity([]),this.orientation=u,this.position=o}get mercatorPosition(){const o=this.position;return new f.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=f.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var u;o&&f.setColumn(this._transform,3,[(u=o)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||f.identity$1([]),o&&cp(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,u){this._orientation=Ld(o,u),cp(this._transform,this._orientation)}forward(){const o=f.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=f.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=f.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,u){const g=new Float64Array(16);return f.invert(g,this.getWorldToCamera(o,u)),g}getWorldToCameraPosition(o,u,g){const x=this.position;f.scale$2(x,x,-o);const b=new Float64Array(16);return f.fromScaling(b,[g,g,g]),f.translate(b,b,x),b[10]*=u,b}getWorldToCamera(o,u){const g=new Float64Array(16),x=new Float64Array(4),b=this.position;return f.conjugate(x,this._orientation),f.scale$2(b,b,-o),f.fromQuat(g,x),f.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(o,u,g,x){const b=new Float64Array(16);return f.perspective(b,o,u,g,x),b}getDistanceToElevation(o){const u=0===o?0:f.mercatorZfromAltitude(o,this.position[1]),g=this.forward();return(u-this.position[2])/g[2]}clone(){return new ou([...this.position],[...this.orientation])}}function zd(p,o){const u=su(p),g=function(b,E,M,A,R){const O=new f.LngLat(M.lng-180*va,M.lat),B=new f.LngLat(M.lng+180*va,M.lat),j=b.project(O.lng,O.lat),q=b.project(B.lng,B.lat),H=-Math.atan2(q.y-j.y,q.x-j.x),$=f.MercatorCoordinate.fromLngLat(M);$.y=f.clamp($.y,-.999975,.999975);const ne=$.toLngLat(),X=b.project(ne.lng,ne.lat),ee=f.MercatorCoordinate.fromLngLat(ne);ee.x+=va;const te=ee.toLngLat(),oe=b.project(te.lng,te.lat),Q=au(oe.x-X.x,oe.y-X.y,H),ae=f.MercatorCoordinate.fromLngLat(ne);ae.y+=va;const me=ae.toLngLat(),be=b.project(me.lng,me.lat),Se=au(be.x-X.x,be.y-X.y,H),Te=Math.abs(Q.x)/Math.abs(Se.y),Ne=f.identity([]);f.rotateZ(Ne,Ne,-H*(1-(R?0:A)));const pe=f.identity([]);return f.scale(pe,pe,[1,1-(1-Te)*A,1]),pe[4]=-Se.x/Se.y*A,f.rotateZ(pe,pe,H),f.multiply$1(pe,Ne,pe),pe}(p.projection,0,p.center,u,o),x=Bd(p);return f.scale(g,g,[x,x,1]),g}function Bd(p){const o=p.projection,u=su(p),g=Nd(o,p.center),x=Nd(o,f.LngLat.convert(o.center));return Math.pow(2,g*u+(1-u)*x)}function su(p){const o=p.projection.range;if(!o)return 0;const u=Math.max(p.width,p.height),g=Math.log(u/1024)/Math.LN2;return f.smoothstep(o[0]+g,o[1]+g,p.zoom)}const va=1/4e4;function Nd(p,o){const u=f.clamp(o.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),g=new f.LngLat(o.lng-180*va,u),x=new f.LngLat(o.lng+180*va,u),b=p.project(g.lng,u),E=p.project(x.lng,u),M=f.MercatorCoordinate.fromLngLat(g),A=f.MercatorCoordinate.fromLngLat(x),R=E.x-b.x,O=E.y-b.y,B=A.x-M.x,j=A.y-M.y,q=Math.sqrt((B*B+j*j)/(R*R+O*O));return Math.log(q)/Math.LN2}function au(p,o,u){const g=Math.cos(u),x=Math.sin(u);return{x:p*g-o*x,y:p*x+o*g}}class sl{constructor(o,u,g,x,b,E,M){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=null==g?0:g,this._maxPitch=null==x?60:x,this.setProjection(E),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ya,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ou,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new sl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||u)&&this._updateCameraOnTerrain(),(o||u)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return f.pick(this.projection,["name","center","parallels"])}setProjection(o){null==o&&(o={name:"mercator"}),this.projectionOptions=o;const u=this.projection?this.getProjection():void 0;this.projection=f.getProjection(o);const g=this.getProjection();return Oe(u,g)?null:(this._calcMatrices(),g)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.pointGeometry(this.width,this.height)}get bearing(){return f.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const u=-o*Math.PI/180;var g,x,b,E,M,A,R,O,B,j;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),x=this.rotationMatrix,E=this.angle,M=(b=this.rotationMatrix)[0],A=b[1],R=b[2],O=b[3],B=Math.sin(E),j=Math.cos(E),x[0]=M*j+R*B,x[1]=A*j+O*B,x[2]=M*-B+R*j,x[3]=A*-B+O*j)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const u=f.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const u=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,b=0;for(let E=0;E<u.length;E++){const M=new f.pointGeometry(u[E][0]*this.width,g+u[E][1]*(this.height-g)),A=o.pointCoordinate(M);if(!A)continue;const R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);x+=A[3]*R,b+=R}return 0===b?NaN:x/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const o=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,x=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-g,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[u.x,u.y,u.z]:[o.x,o.y,o.z];const x=f.length(f.sub([],this._camera.position,g));return f.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let u=!1;if(o.orientation&&!f.exactEquals(o.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];f.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,u=new iu;return u.position=new f.MercatorCoordinate(o[0],o[1],o[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(o){if(!f.length$1(o))return!1;f.normalize$1(o,o);const u=f.transformQuat([],[0,0,-1],o),g=f.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;const x=ch(u,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(o){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;o[2]=f.clamp(o[2],x/g,x/u),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,g){this._unmodified=!1,this._edgeInsets.interpolate(o,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const u=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(o){const u=[new f.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new f.pointGeometry(0,0)),x=this.pointCoordinate(new f.pointGeometry(this.width,0)),b=this.pointCoordinate(new f.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new f.pointGeometry(0,this.height)),M=Math.floor(Math.min(g.x,x.x,b.x,E.x)),A=Math.floor(Math.max(g.x,x.x,b.x,E.x)),R=1;for(let O=M-R;O<=A+R;O++)0!==O&&u.push(new f.UnwrappedTileID(O,o))}return u}coveringTiles(o){let u=this.coveringZoomLevel(o);const g=u,x=this.elevation&&!o.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==o.minzoom&&u<o.minzoom)return[];void 0!==o.maxzoom&&u>o.maxzoom&&(u=o.maxzoom);const E=this.locationCoordinate(this.center),M=this.center.lat,A=1<<u,R=[A*E.x,A*E.y,0],O="globe"===this.projection.name,B=!O,j=f.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,B),q=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=A*f.mercatorZfromAltitude(1,this.center.lat),$=this._camera.position[2]/f.mercatorZfromAltitude(1,this.center.lat),ne=[A*q.x,A*q.y,$*(B?1:H)],X=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ee=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,te=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,oe=o.isTerrainDEM?-te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Q=this.projection.isReprojectedInTileSpace?Bd(this):1,ae=Ie=>{const mt=new f.MercatorCoordinate(Ie.x+25e-6,Ie.y,Ie.z),st=new f.MercatorCoordinate(Ie.x,Ie.y+25e-6,Ie.z),at=Ie.toLngLat(),_t=mt.toLngLat(),At=st.toLngLat(),ht=this.locationCoordinate(at),vt=this.locationCoordinate(_t),Yt=this.locationCoordinate(At),Hn=Math.hypot(vt.x-ht.x,vt.y-ht.y),hr=Math.hypot(Yt.x-ht.x,Yt.y-ht.y);return Math.sqrt(Hn*hr)*Q/25e-6},me=Ie=>{const it=te,mt=oe;return{aabb:f.tileAABB(this,A,0,0,0,Ie,mt,it,this.projection),zoom:0,x:0,y:0,minZ:mt,maxZ:it,wrap:Ie,fullyVisible:!1}},be=[];let Se=[];const Te=u,Ne=o.reparseOverscaled?g:u,pe=Ie=>Ie*Ie,He=pe(($-this._centerAltitude)*H),Ve=Ie=>{if(!this._elevation||!Ie.tileID||!b)return;const it=this._elevation.getMinMaxForTile(Ie.tileID),mt=Ie.aabb;it?(mt.min[2]=it.min,mt.max[2]=it.max,mt.center[2]=(mt.min[2]+mt.max[2])/2):(Ie.shouldSplit=nt(Ie),Ie.shouldSplit||(mt.min[2]=mt.max[2]=mt.center[2]=this._centerAltitude))},nt=Ie=>{if(Ie.zoom<ee)return!0;if(Ie.zoom===Te)return!1;if(null!=Ie.shouldSplit)return Ie.shouldSplit;const it=Ie.aabb.distanceX(ne),mt=Ie.aabb.distanceY(ne);let st=He,at=1;if(O){st=pe(Ie.aabb.distanceZ(ne));const At=Math.pow(2,Ie.zoom),ht=f.latFromMercatorY((Ie.y+1)/At),vt=f.latFromMercatorY(Ie.y/At),Yt=Math.min(Math.max(M,ht),vt),Hn=f.circumferenceAtLatitude(Yt)/f.circumferenceAtLatitude(M);at=Math.min(Hn,1)}else if(x&&(st=pe(Ie.aabb.distanceZ(ne)*H)),this.projection.isReprojectedInTileSpace&&g<=5){const At=Math.pow(2,Ie.zoom),ht=ae(new f.MercatorCoordinate((Ie.x+.5)/At,(Ie.y+.5)/At));at=ht>.85?1:ht}const _t=it*it+mt*mt+st;return _t<pe((1<<Te-Ie.zoom)*X*at*((At,ht)=>{if(ht*pe(.707)<At)return 1;const vt=Math.sqrt(ht/At);return vt/(1.4144271570014144+(Math.pow(1.1,vt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(st,He),_t))};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)be.push(me(-Ie)),be.push(me(Ie));for(be.push(me(0));be.length>0;){const Ie=be.pop(),it=Ie.x,mt=Ie.y;let st=Ie.fullyVisible;if(!st){const at=Ie.aabb.intersects(j);if(0===at)continue;st=2===at}if(Ie.zoom!==Te&&nt(Ie))for(let at=0;at<4;at++){const _t=(it<<1)+at%2,At=(mt<<1)+(at>>1),ht={aabb:b?Ie.aabb.quadrant(at):f.tileAABB(this,A,Ie.zoom+1,_t,At,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:_t,y:At,wrap:Ie.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};x&&!O&&(ht.tileID=new f.OverscaledTileID(Ie.zoom+1===Te?Ne:Ie.zoom+1,Ie.wrap,Ie.zoom+1,_t,At),Ve(ht)),be.push(ht)}else{const at=Ie.zoom===Te?Ne:Ie.zoom;if(o.minzoom&&o.minzoom>at)continue;const _t=R[0]-(.5+it+(Ie.wrap<<Ie.zoom))*(1<<u-Ie.zoom),At=R[1]-.5-mt,ht=Ie.tileID?Ie.tileID:new f.OverscaledTileID(at,Ie.wrap,Ie.zoom,it,mt);Se.push({tileID:ht,distanceSq:_t*_t+At*At})}}if(this.fogCullDistSq){const Ie=this.fogCullDistSq,it=this.horizonLineFromTop();Se=Se.filter(mt=>{const st=[0,0,0,1],at=[f.EXTENT,f.EXTENT,0,1],_t=this.calculateFogTileMatrix(mt.tileID.toUnwrapped());f.transformMat4$1(st,st,_t),f.transformMat4$1(at,at,_t);const At=f.getAABBPointSquareDist(st,at);if(0===At)return!0;let ht=!1;const vt=this._elevation;if(vt&&At>Ie&&0!==it){const Yt=this.calculateProjMatrix(mt.tileID.toUnwrapped());let Hn;o.isTerrainDEM||(Hn=vt.getMinMaxForTile(mt.tileID)),Hn||(Hn={min:oe,max:te});const hr=f.furthestTileCorner(this.rotation),Zr=[hr[0]*f.EXTENT,hr[1]*f.EXTENT,Hn.max];f.transformMat4(Zr,Zr,Yt),ht=(1-Zr[1])*this.height*.5<it}return At<Ie||ht})}return Se.sort((Ie,it)=>Ie.distanceSq-it.distanceSq).map(Ie=>Ie.tileID)}resize(o,u){this.width=o,this.height=u,this.pixelsToGLUnits=[2/o,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const u=f.clamp(o.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),g=this.projection.project(o.lng,u);return new f.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,u){let g,x;const b=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;g=(u.x-b.x)/M,x=(u.y-b.y)/M}else{const M=this.pointCoordinate(u),A=this.pointCoordinate(b);g=M.x-A.x,x=M.y-A.y}const E=this.locationCoordinate(o);this.setLocation(new f.MercatorCoordinate(E.x-g,E.y-x))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,u){const g=u?f.mercatorZfromAltitude(u,o.lat):void 0,x=this.projection.project(o.lng,o.lat);return new f.MercatorCoordinate(x.x,x.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,u){const g=null!=u?u:this._centerAltitude,x=[o.x,o.y,0,1],b=[o.x,o.y,1,1];f.transformMat4$1(x,x,this.pixelMatrixInverse),f.transformMat4$1(b,b,this.pixelMatrixInverse);const E=b[3];f.scale$1(x,x,1/x[3]),f.scale$1(b,b,1/E);const M=x[2],A=b[2];return{p0:x,p1:b,t:M===A?0:(g-M)/(A-M)}}screenPointToMercatorRay(o){const u=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return f.transformMat4$1(u,u,this.pixelMatrixInverse),f.transformMat4$1(g,g,this.pixelMatrixInverse),f.scale$1(u,u,1/u[3]),f.scale$1(g,g,1/g[3]),u[2]=f.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=f.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,f.scale$1(u,u,1/this.worldSize),f.scale$1(g,g,1/this.worldSize),new f.Ray([u[0],u[1],u[2]],f.normalize([],f.sub([],g,u)))}rayIntersectionCoordinate(o){const{p0:u,p1:g,t:x}=o,b=f.mercatorZfromAltitude(u[2],this._center.lat),E=f.mercatorZfromAltitude(g[2],this._center.lat);return new f.MercatorCoordinate(f.number(u[0],g[0],x)/this.worldSize,f.number(u[1],g[1],x)/this.worldSize,f.number(b,E,x))}pointCoordinate(o,u=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,u)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const u=this.elevation;let g=this.elevation.pointCoordinate(o);if(g)return new f.MercatorCoordinate(g[0],g[1],g[2]);let x=0,b=this.horizonLineFromTop();if(o.y>b)return this.pointCoordinate(o);const E=.02*b,M=o.clone();for(let A=0;A<10&&b-x>E;A++){M.y=f.number(x,b,.66);const R=u.pointCoordinate(M);R?(b=M.y,g=R):x=M.y}return g?new f.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const u=this.horizonLineFromTop();return o.y<u}}_coordinatePoint(o,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,x=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return f.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new f.pointGeometry(x[0]/x[3],x[1]/x[3]):new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,u){const g=new f.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new f.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new f.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new f.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let M=this.pointCoordinate(g,o),A=this.pointCoordinate(x,o);const R=this.pointCoordinate(b,u),O=this.pointCoordinate(E,u),B=(j,q)=>(q.y-j.y)/(q.x-j.x);return M.y>1&&A.y>=0?M=new f.MercatorCoordinate((1-O.y)/B(O,M)+O.x,1):M.y<0&&A.y<=1&&(M=new f.MercatorCoordinate(-O.y/B(O,M)+O.x,0)),A.y>1&&M.y>=0?A=new f.MercatorCoordinate((1-R.y)/B(R,A)+R.x,1):A.y<0&&M.y<=1&&(A=new f.MercatorCoordinate(-R.y/B(R,A)+R.x,0)),(new f.LngLatBounds).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(R))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const u=o.visibleDemTiles.reduce((g,x)=>{if(x.dem){const b=x.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*o.exaggeration(),u.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-f.MAX_MERCATOR_LATITUDE,this.maxLat=f.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=f.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=f.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=f.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,u){return this.projection.createTileMatrix(this,u,o)}calculateDistanceTileData(o){const u=o.key,g=this._distanceTileDataCache;if(g[u])return g[u];const x=o.canonical,b=1/this.height,E=this.cameraWorldSize/this.zoomScale(x.z),M=(x.x+Math.pow(2,x.z)*o.wrap)*E,A=x.y*E,R=this.point,O=this.angle,B=Math.sin(-O),j=-Math.cos(-O);return g[u]={bearing:[B,j],center:[(R.x-M)*b,(R.y-A)*b],scale:E/f.EXTENT*b},g[u]}calculateFogTileMatrix(o){const u=o.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const x=this.calculatePosMatrix(o,this.cameraWorldSize);return f.multiply$1(x,this.worldToFogMatrix,x),g[u]=new Float32Array(x),g[u]}calculateProjMatrix(o,u=!1){const g=o.key,x=u?this._alignedProjMatrixCache:this._projMatrixCache;if(x[g])return x[g];const b=this.calculatePosMatrix(o,this.worldSize);return f.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,b),x[g]=new Float32Array(b),x[g]}calculatePixelsToTileUnitsMatrix(o){const u=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const x=function(b,E){const{scale:M}=b.tileTransform,A=M*f.EXTENT/(b.tileSize*Math.pow(2,E.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return R=new Float32Array(4),j=(O=E.inverseAdjustmentMatrix)[1],q=O[2],H=O[3],ne=(B=[A,A])[1],R[0]=O[0]*($=B[0]),R[1]=j*$,R[2]=q*ne,R[3]=H*ne,R;var R,O,B,j,q,H,$,ne}(o,this);return g[u]=x,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const u=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),x=this._camera.forward(),b=f.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,x[2]/=b,f.normalize(x,x);const E=o.raycast(g,x,o.exaggeration());if(E){const M=f.scaleAndAdd([],g,x,E),A=new f.MercatorCoordinate(M[0],M[1],f.mercatorZfromAltitude(M[2],f.latFromMercatorY(M[1]))),R=(A.z+f.length([A.x-g[0],A.y-g[1],A.z-g[2]*b]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const u=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),x=o.getAtPointOrZero(new f.MercatorCoordinate(...g)),b=this._minimumHeightOverTerrain()*Math.cos(f.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(E<b){const M=this.locationCoordinate(this._center,this._centerAltitude),A=[M.x-g[0],M.y-g[1],M.z-g[2]],R=f.length(A);A[2]-=(b-E)/this._projectionScaler;const O=f.length(A);if(0===O)return;f.scale$2(A,A,R/O*this._projectionScaler),this._camera.position=[M.x-A[0],M.y-A[1],M.z*this._projectionScaler-A[2]],this._camera.orientation=ch(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const B=this.center;return B.lat=f.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=f.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:g}=this.point;let x=0,b=u,E=g;const M=this.width/2,A=this.height/2,R=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(g-A<R&&(E=R+A),g+A>O&&(E=O-A),O-R<this.height&&(x=Math.max(x,this.height/(O-R)),E=(O+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,q=this.worldSize/2-(B+j)/2;b=(u+q+this.worldSize)%this.worldSize-q,b-M<B&&(b=B+M),b+M>j&&(b=j-M),j-B<this.width&&(x=Math.max(x,this.width/(j-B)),b=(j+B)/2)}b===u&&E===g||(this.center=this.unproject(new f.pointGeometry(b,E))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,u=this.centerOffset,g=this.pixelsPerMeter;this._projectionScaler=g/(f.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?g:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-u.x/this.width,b[9]=2*u.y/this.height;let E=f.mul([],b,x);if(this.projection.isReprojectedInTileSpace){const oe=this.locationCoordinate(this.center),Q=f.identity([]);f.translate(Q,Q,[oe.x*this.worldSize,oe.y*this.worldSize,0]),f.multiply$1(Q,Q,zd(this)),f.translate(Q,Q,[-oe.x*this.worldSize,-oe.y*this.worldSize,0]),f.multiply$1(E,E,Q),this.inverseAdjustmentMatrix=function(ae){const me=zd(ae,!0);return fs([],[me[0],me[1],me[4],me[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=f.scale([],E,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=E,this.invProjMatrix=f.invert(new Float64Array(16),this.projMatrix);const M=new Float32Array(16);f.identity(M),f.scale(M,M,[1,-1,1]),f.rotateX(M,M,this._pitch),f.rotateZ(M,M,this.angle);const A=f.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;A[8]=2*-u.x/this.width,A[9]=2*(u.y+R)/this.height,this.skyboxMatrix=f.multiply$1(M,A,M);const O=this.point,B=O.x,j=O.y,q=this.width%2/2,H=this.height%2/2,$=Math.cos(this.angle),ne=Math.sin(this.angle),X=B-Math.round(B)+$*q+ne*H,ee=j-Math.round(j)+$*H+ne*q,te=new Float64Array(E);if(f.translate(te,te,[X>.5?X-1:X,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=te,E=f.create(),f.scale(E,E,[this.width/2,-this.height/2,1]),f.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=f.create(),f.scale(E,E,[1,-1,1]),f.translate(E,E,[-1,-1,0]),f.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=f.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=f.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");this.pixelMatrixInverse=E,this.globeMatrix="globe"===this.projection.name?f.calculateGlobeMatrix(this):E,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,u=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height,b=[o,o,u];f.scale$2(b,b,x),f.scale$2(g,g,-1),f.multiply$2(g,g,b);const E=f.create();f.translate(E,E,g),f.scale(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,u,x)}_computeCameraPosition(o){const u=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-o/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*b,x.y/this.worldSize-g[1]*b,o/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=o[2];let x=1;g>0&&(x=Math.min((u-this._camera.position[2])/g,1)),this._camera.position=f.scaleAndAdd([],this._camera.position,o,x),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const o=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),b=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.degToRad(this._maxPitch)),M=Math.max((o[2]-b)/Math.cos(g),E),A=this._zoomFromMercatorZ(M);f.scaleAndAdd(o,o,u,M),this._pitch=f.clamp(g,f.degToRad(this.minPitch),f.degToRad(this.maxPitch)),this.angle=f.wrap(x,-Math.PI,Math.PI),this._setZoom(f.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,u){const g=Math.min(o.x,u.x),x=Math.max(o.x,u.x),b=Math.min(o.y,u.y),E=Math.max(o.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new f.pointGeometry(g,b),new f.pointGeometry(x,E),new f.pointGeometry(g,E),new f.pointGeometry(x,b)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const O of M){const B=this.pointRayIntersection(O);if(B.t<0)return!0;const j=this.rayIntersectionCoordinate(B);if(j.x<A||j.y<0||j.x>R||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.pointGeometry(0,0),new f.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,u){const g=f.length(f.sub([],this._camera.position,o)),x=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(x)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.pointGeometry(0,o))}}function Vd(p,o){let u=!1,g=null;const x=()=>{g=null,u&&(p(),g=setTimeout(x,o),u=!1)};return()=>(u=!0,g||x(),g)}class up{constructor(o){this._hashName=o&&encodeURIComponent(o),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Vd(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,f.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),f.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(o){const u=this._map;if(!u)return"";const g=u.getCenter(),x=Math.round(100*u.getZoom())/100,b=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),M=Math.round(g.lng*E)/E,A=Math.round(g.lat*E)/E,R=u.getBearing(),O=u.getPitch();let B="";if(B+=o?`/${M}/${A}/${x}`:`${x}/${A}/${M}`,(R||O)&&(B+="/"+Math.round(10*R)/10),O&&(B+=`/${Math.round(O)}`),this._hashName){const j=this._hashName;let q=!1;const H=f.window.location.hash.slice(1).split("&").map($=>{const ne=$.split("=")[0];return ne===j?(q=!0,`${ne}=${B}`):$}).filter($=>$);return q||H.push(`${j}=${B}`),`#${H.join("&")}`}return`#${B}`}_getCurrentHash(){const o=f.window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(g))){const g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(u[3]||0):o.getBearing();return o.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=f.window.location.href.replace(/(#.+)?$/,this.getHashString());f.window.history.replaceState(f.window.history.state,null,o)}}const As={linearity:.3,easing:f.bezier(0,0,.3,1)},Ps=f.extend({deceleration:2500,maxSpeed:1400},As),Ud=f.extend({deceleration:20,maxSpeed:1400},As),ki=f.extend({deceleration:1e3,maxSpeed:360},As),uh=f.extend({deceleration:1e3,maxSpeed:90},As);class jd{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=f.exported.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new f.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(u.pan.mag()){const b=gr(u.pan.mag(),g,f.extend({},Ps,o||{}));x.offset=u.pan.mult(b.amount/u.pan.mag()),x.center=this._map.transform.center,oc(x,b)}if(u.zoom){const b=gr(u.zoom,g,Ud);x.zoom=this._map.transform.zoom+b.amount,oc(x,b)}if(u.bearing){const b=gr(u.bearing,g,ki);x.bearing=this._map.transform.bearing+f.clamp(b.amount,-179,179),oc(x,b)}if(u.pitch){const b=gr(u.pitch,g,uh);x.pitch=this._map.transform.pitch+b.amount,oc(x,b)}if(x.zoom||x.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function oc(p,o){(!p.duration||p.duration<o.duration)&&(p.duration=o.duration,p.easing=o.easing)}function gr(p,o,u){const{maxSpeed:g,linearity:x,deceleration:b}=u,E=f.clamp(p*x/(o/1e3),-g,g),M=Math.abs(E)/(b*x);return{easing:u.easing,duration:1e3*M,amount:E*(M/2)}}class yi extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g,x={}){const b=Ti(u.getCanvasContainer(),g),E=u.unproject(b);super(o,f.extend({point:b,lngLat:E,originalEvent:g},x)),this._defaultPrevented=!1,this.target=u}}class sc extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){const x="touchend"===o?g.changedTouches:g.touches,b=tn(u.getCanvasContainer(),x),E=b.map(A=>u.unproject(A)),M=b.reduce((A,R,O,B)=>A.add(R.div(B.length)),new f.pointGeometry(0,0));super(o,{points:b,point:M,lngLats:E,lngLat:u.unproject(M),originalEvent:g}),this._defaultPrevented=!1}}class hh extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class hp{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new hh(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new yi(o.type,this._map,o))}mouseup(o){this._map.fire(new yi(o.type,this._map,o))}preclick(o){const u=f.extend({},o);u.type="preclick",this._map.fire(new yi(u.type,this._map,u))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(o),this._map.fire(new yi(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new yi(o.type,this._map,o))}mouseover(o){this._map.fire(new yi(o.type,this._map,o))}mouseout(o){this._map.fire(new yi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new sc(o.type,this._map,o))}touchmove(o){this._map.fire(new sc(o.type,this._map,o))}touchend(o){this._map.fire(new sc(o.type,this._map,o))}touchcancel(o){this._map.fire(new sc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _r{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new yi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new yi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lu{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&0===o.button&&(pi(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const g=u;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=g,this._box||(this._box=Pt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(x.x,g.x),E=Math.max(x.x,g.x),M=Math.min(x.y,g.y),A=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${M}px)`,this._box.style.width=E-b+"px",this._box.style.height=A-M+"px")})}mouseupWindow(o,u){if(!this._active||0!==o.button)return;const g=this._startPos,x=u;if(this.reset(),Di(),g.x!==x.x||g.y!==x.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),qc(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new f.Event(o,{originalEvent:u}))}}function ks(p,o){const u={};for(let g=0;g<p.length;g++)u[p[g].identifier]=o[g];return u}class Xi{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const b=new f.pointGeometry(0,0);for(const E of x)b._add(E);return b.div(x.length)}(u),this.touches=ks(g,u)))}touchmove(o,u,g){if(this.aborted||!this.centroid)return;const x=ks(g,u);for(const b in this.touches){const E=this.touches[b],M=x[b];(!M||M.dist(E)>30)&&(this.aborted=!0)}}touchend(o,u,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class al{constructor(o){this.singleTap=new Xi(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,u,g){this.singleTap.touchstart(o,u,g)}touchmove(o,u,g){this.singleTap.touchmove(o,u,g)}touchend(o,u,g){const x=this.singleTap.touchend(o,u,g);if(x){const b=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(b&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class tt{constructor(){this._zoomIn=new al({numTouches:1,numTaps:2}),this._zoomOut=new al({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,g){this._zoomIn.touchstart(o,u,g),this._zoomOut.touchstart(o,u,g)}touchmove(o,u,g){this._zoomIn.touchmove(o,u,g),this._zoomOut.touchmove(o,u,g)}touchend(o,u,g){const x=this._zoomIn.touchend(o,u,g),b=this._zoomOut.touchend(o,u,g);return x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const cu={0:1,2:2};class uu{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,u){return!1}_move(o,u){return{}}mousedown(o,u){if(this._lastPoint)return;const g=Js(o);this._correctButton(o,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(o,u){const g=this._lastPoint;if(g)if(o.preventDefault(),null!=this._eventButton&&function(x,b){const E=cu[b];return void 0===x.buttons||(x.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}mouseupWindow(o){this._lastPoint&&Js(o)===this._eventButton&&(this._moved&&Di(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xa extends uu{mousedown(o,u){super.mousedown(o,u),this._lastPoint&&(this._active=!0)}_correctButton(o,u){return 0===u&&!o.ctrlKey}_move(o,u){return{around:u,panDelta:u.sub(o)}}}class ac extends uu{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const g=.8*(u.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class Yn extends uu{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const g=-.5*(u.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class dh{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),f.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.pointGeometry(0,0)}touchstart(o,u,g){return this._calculateTransform(o,u,g)}touchmove(o,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,u,g)}}touchend(o,u,g){this._calculateTransform(o,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,g){g.length>0&&(this._active=!0);const x=ks(g,u),b=new f.pointGeometry(0,0),E=new f.pointGeometry(0,0);let M=0;for(const R in x){const O=x[R],B=this._touches[R];B&&(b._add(O),E._add(O.sub(B)),M++,x[R]=O)}if(this._touches=x,M<this._minTouches||!E.mag())return;const A=E.div(M);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class hu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,u,g){return{}}touchstart(o,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,g){const x=this._firstTwoTouches;if(!x)return;o.preventDefault();const[b,E]=x,M=Jn(g,u,b),A=Jn(g,u,E);if(!M||!A)return;const R=this._aroundCenter?null:M.add(A).div(2);return this._move([M,A],R,o)}touchend(o,u,g){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,E=Jn(g,u,x),M=Jn(g,u,b);E&&M||(this._active&&Di(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jn(p,o,u){for(let g=0;g<p.length;g++)if(p[g].identifier===u)return o[g]}function fh(p,o){return Math.log(p/o)/Math.LN2}class dp extends hu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(fh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fh(this._distance,g),pinchAround:u}}}function ll(p,o){return 180*p.angleWith(o)/Math.PI}class ni extends hu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ll(this._vector,g),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,g=ll(o,this._startVector);return Math.abs(g)<u}}function lc(p){return Math.abs(p.y)>Math.abs(p.x)}class cl extends hu{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,lc(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,g){const x=this._lastPoints;if(!x)return;const b=o[0].sub(x[0]),E=o[1].sub(x[1]);return this._map._cooperativeGestures&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(o,u,g){if(void 0!==this._valid)return this._valid;const x=o.mag()>=2,b=u.mag()>=2;if(!x&&!b)return;if(!x||!b)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=o.y>0==u.y>0;return lc(o)&&lc(u)&&E}}const ba={panStep:100,bearingStep:15,pitchStep:10};class vi{constructor(){const o=ba;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,g=0,x=0,b=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?x=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?x=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:M=>{const A=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:ph,zoom:u?Math.round(A)+u*(o.shiftKey?2:1):A,bearing:M.getBearing()+g*this._bearingStep,pitch:M.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:M.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ph(p){return p*(2-p)}const cc=4.000244140625;class $d{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=o.deltaMode===f.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=f.exported.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%cc==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(x*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Ti(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,u=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const A="wheel"===this._type&&Math.abs(this._delta)>cc?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&0!==R&&(R=1/R);const O=u(),B=Math.pow(2,O),j="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(j*R))),"wheel"===this._type&&(this._startZoom=u(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:u(),x=this._startZoom,b=this._easing;let E,M=!1;if("wheel"===this._type&&x&&b){const A=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),R=b(A);E=f.number(x,g,R),A<1?this._frameId||(this._frameId=!0):M=!0}else E=g,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:E-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=f.ease;if(this._prevEase){const g=this._prevEase,x=(f.exported.now()-g.start)/g.duration,b=g.easing(x+.01)-g.easing(x),E=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-E*E);u=f.bezier(E,M,.25,1)}return this._prevEase={start:f.exported.now(),duration:o,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(f.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!f.window.document.fullscreenElement||!!f.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Qo{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class mh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,u){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uc{constructor(){this._tap=new al({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,u,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,u,g))}touchmove(o,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=u[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,u,g)}touchend(o,u,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(o,u,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nt{constructor(o,u,g){this._el=o,this._mousePan=u,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gh{constructor(o,u,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fp{constructor(o,u,g,x){this._el=o,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const hc=p=>p.zoom||p.drag||p.pitch||p.rotate;class _h extends f.Event{}class Gd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,u){const g=f.sub([],u,o);this.radius=f.length(g[2]<0?f.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){f.div(o,o,this.constants),f.normalize(o,o),f.mul$1(o,o,this.constants);const u=f.scale$2([],o,this.radius);if(u[2]>0){const g=f.scale$2([],[0,0,1],f.dot(u,[0,0,1])),x=f.scale$2([],f.normalize([],[u[0],u[1],0]),this.radius),b=f.add([],u,f.scale$2([],f.sub([],f.add([],x,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function wa(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Hd{constructor(o,u){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jd(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Gd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),f.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[f.window.document,"mousemove",{capture:!0}],[f.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[f.window,"blur",void 0]];for(const[x,b,E]of this._listeners)x.addEventListener(b,x===f.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,u,g]of this._listeners)o.removeEventListener(u,o===f.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(o){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new hp(u,o));const x=u.boxZoom=new lu(u,o);this._add("boxZoom",x);const b=new tt,E=new mh;u.doubleClickZoom=new Qo(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const M=new uc;this._add("tapDragZoom",M);const A=u.touchPitch=new cl(u);this._add("touchPitch",A);const R=new ac(o),O=new Yn(o);u.dragRotate=new gh(o,R,O),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const B=new xa(o),j=new dh(u,o);u.dragPan=new Nt(g,B,j),this._add("mousePan",B),this._add("touchPan",j,["touchZoom","touchRotate"]);const q=new ni,H=new dp;u.touchZoomRotate=new fp(g,H,q,M),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new _r(u));const $=u.scrollZoom=new $d(u,this);this._add("scrollZoom",$,["mousePan"]);const ne=u.keyboard=new vi;this._add("keyboard",ne);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[X]&&u[X].enable(o[X])}_add(o,u,g){this._handlers.push({handlerName:o,handler:u,allowed:g}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hc(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,u,g){for(const x in o)if(x!==g&&(!u||u.indexOf(x)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const u=[];for(const g of o)this._el.contains(g.target)&&u.push(g);return u}handleEvent(o,u){this._updatingCamera=!0;const g="renderFrame"===o.type,x=g?void 0:o,b={needsRenderFrame:!1},E={},M={},A=o.touches?this._getMapTouches(o.touches):void 0,R=A?tn(this._el,A):g?void 0:Ti(this._el,o);for(const{handlerName:j,handler:q,allowed:H}of this._handlers){if(!q.isEnabled())continue;let $;this._blockedByActive(M,H,j)?q.reset():q[u||o.type]&&($=q[u||o.type](o,R,A),this.mergeHandlerResult(b,E,$,j,x),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||q.isActive())&&(M[j]=q)}const O={};for(const j in this._previousActiveHandlers)M[j]||(O[j]=x);this._previousActiveHandlers=M,(Object.keys(O).length||wa(b))&&(this._changes.push([b,E,O]),this._triggerRenderFrame()),(Object.keys(M).length||wa(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=b;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,u,g,x,b){if(!g)return;f.extend(o,g);const E={handlerName:x,originalEvent:g.originalEvent||b};void 0!==g.zoomDelta&&(u.zoom=E),void 0!==g.panDelta&&(u.drag=E),void 0!==g.pitchDelta&&(u.pitch=E),void 0!==g.bearingDelta&&(u.rotate=E)}_applyChanges(){const o={},u={},g={};for(const[x,b,E]of this._changes)x.panDelta&&(o.panDelta=(o.panDelta||new f.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(o.around=x.around),void 0!==x.aroundCoord&&(o.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(o.pinchAround=x.pinchAround),x.noInertia&&(o.noInertia=x.noInertia),f.extend(u,b),f.extend(g,E);this._updateMapTransform(o,u,g),this._changes=[]}_updateMapTransform(o,u,g){const x=this._map,b=x.transform,E=ee=>[ee.x,ee.y,ee.z];if((ee=>{const te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!wa(o)){const ee=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",ee!==b.zoom&&this._map._update(!0)}if(!wa(o))return void this._fireEvents(u,g,!0);let{panDelta:M,zoomDelta:A,bearingDelta:R,pitchDelta:O,around:B,aroundCoord:j,pinchAround:q}=o;void 0!==q&&(B=q),(ee=>u.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=E(b.pointCoordinate3D(B)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),B=B||x.transform.centerPoint,R&&(b.bearing+=R),O&&(b.pitch+=O),b._updateCameraState();const H=[0,0,0];if(M){const ee=b.pointCoordinate(B);if("globe"===b.projection.name){const te=f.latFromMercatorY(ee.y),oe=b.center.lat,Q=Math.min(f.mercatorZfromAltitude(1,te)/f.mercatorZfromAltitude(1,oe),2);M=M.rotate(-b.angle),H[0]=-M.x/b.worldSize*Q,H[1]=-M.y/b.worldSize*Q}else{const te=b.pointCoordinate(B.sub(M));ee&&te&&(H[0]=te.x-ee.x,H[1]=te.y-ee.y)}}const $=b.zoom,ne=[0,0,0];if(A){const ee=E(j||b.pointCoordinate3D(B)),te={dir:f.normalize([],f.sub([],ee,b._camera.position))};if(te.dir[2]<0){const oe=b.zoomDeltaToMovement(ee,A);f.scale$2(ne,te.dir,oe)}}const X=f.add(H,H,ne);b._translateCameraConstrained(X),A&&Math.abs(b.zoom-$)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,g,!0)}_fireEvents(o,u,g){const x=hc(this._eventsInProgress),b=hc(o),E={};for(const O in o){const{originalEvent:B}=o[O];this._eventsInProgress[O]||(E[`${O}start`]=B),this._eventsInProgress[O]=o[O]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const O in E)this._fireEvent(O,E[O]);b&&this._fireEvent("move",b.originalEvent);for(const O in o){const{originalEvent:B}=o[O];this._fireEvent(O,B)}const M={};let A;for(const O in this._eventsInProgress){const{handlerName:B,originalEvent:j}=this._eventsInProgress[O];this._handlersById[B].isActive()||(delete this._eventsInProgress[O],A=u[B]||j,M[`${O}end`]=A)}for(const O in M)this._fireEvent(O,M[O]);const R=hc(this._eventsInProgress);if(g&&(x||b)&&!R){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;O?(B(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:A})):(this._map.fire(new f.Event("moveend",{originalEvent:A})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new f.Event(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new _h("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const du="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class je extends f.Evented{constructor(o,u){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=u.bearingSnap,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}panBy(o,u,g){return o=f.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,f.extend({offset:o},u),g)}panTo(o,u,g){return this.easeTo(f.extend({center:o},u),g)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,g){return this.easeTo(f.extend({zoom:o},u),g)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,g){return this.easeTo(f.extend({bearing:o},u),g)}resetNorth(o,u){return this.rotateTo(0,f.extend({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}cameraForBounds(o,u){o=f.LngLatBounds.convert(o);const g=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,u)}_extendCameraOptions(o){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=f.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const g=o.padding;o.padding={top:g,bottom:g,right:g,left:g}}return o.padding=f.extend(u,o.padding),o}_cameraForBoxAndBearing(o,u,g,x){const b=this._extendCameraOptions(x),E=this.transform,M=E.padding,A=E.project(f.LngLat.convert(o)),R=E.project(f.LngLat.convert(u)),O=new f.pointGeometry(A.x,R.y),B=new f.pointGeometry(R.x,A.y),j=-f.degToRad(g),q=A.rotate(j),H=R.rotate(j),$=O.rotate(j),ne=B.rotate(j),X=new f.pointGeometry(Math.max(q.x,H.x,$.x,ne.x),Math.max(q.y,H.y,$.y,ne.y)),ee=new f.pointGeometry(Math.min(q.x,H.x,$.x,ne.x),Math.min(q.y,H.y,$.y,ne.y)),te=X.sub(ee),oe=(E.width-((M.left||0)+(M.right||0)+b.padding.left+b.padding.right))/te.x,Q=(E.height-((M.top||0)+(M.bottom||0)+b.padding.top+b.padding.bottom))/te.y;if(Q<0||oe<0)return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(E.scaleZoom(E.scale*Math.min(oe,Q)),b.maxZoom),me="number"==typeof b.offset.x&&"number"==typeof b.offset.y?new f.pointGeometry(b.offset.x,b.offset.y):f.pointGeometry.convert(b.offset),be=new f.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),Se=me.add(be).mult(E.scale/E.zoomScale(ae));return{center:E.unproject(A.add(R).div(2).sub(Se)),zoom:ae,bearing:g}}_cameraForBox(o,u,g,x,b){const E=this._extendCameraOptions(b);g=g||0,x=x||0,o=f.LngLat.convert(o),u=f.LngLat.convert(u);const M=this.transform.clone();M.padding=E.padding;const A=this.getFreeCameraOptions(),R=new f.LngLat(.5*(o.lng+u.lng),.5*(o.lat+u.lat)),O=.5*(g+x);if(M._camera.position[2]<f.mercatorZfromAltitude(O,R.lat))return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(R),M.setFreeCameraOptions(A);const B=f.MercatorCoordinate.fromLngLat(o),j=f.MercatorCoordinate.fromLngLat(u),q=M.pointRayIntersection(M.centerPoint,O),H=[($=M.rayIntersectionCoordinate(q)).x,$.y,$.z];var $;const ne=M.screenPointToMercatorRay(M.centerPoint),X="globe"!==M.projection.name;let ee,te=0;do{const oe=Math.floor(M.zoom),Q=1<<oe,ae=Math.min(Q*B.x,Q*j.x),me=Math.min(Q*B.y,Q*j.y),be=Math.max(Q*B.x,Q*j.x),Se=Math.max(Q*B.y,Q*j.y),Te=new f.Aabb([ae,me,g],[be,Se,x]),Ne=f.Frustum.fromInvProjectionMatrix(M.invProjMatrix,M.worldSize,oe,X);if(2!==Te.intersects(Ne)){ee&&(M._camera.position=f.scaleAndAdd([],M._camera.position,ne.dir,-ee),M._updateStateFromCamera());break}const pe=f.sub([],M._camera.position,H);ee=.5*f.length(pe),M._camera.position=f.scaleAndAdd([],M._camera.position,ne.dir,ee);try{M._updateStateFromCamera()}catch(He){return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++te<10);return{center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch}}fitBounds(o,u,g){return this._fitInternal(this.cameraForBounds(o,u),u,g)}_raycastElevationBox(o,u){const g=this.transform.elevation;if(!g)return;const x=new f.pointGeometry(o.x,u.y),b=new f.pointGeometry(u.x,o.y),E=g.pointCoordinate(o);if(!E)return;const M=g.pointCoordinate(u);if(!M)return;const A=g.pointCoordinate(x);if(!A)return;const R=g.pointCoordinate(b);if(!R)return;const O=new f.MercatorCoordinate(E[0],E[1]).toLngLat(),B=new f.MercatorCoordinate(M[0],M[1]).toLngLat(),j=new f.MercatorCoordinate(A[0],A[1]).toLngLat(),q=new f.MercatorCoordinate(R[0],R[1]).toLngLat(),H=Math.min(O.lng,Math.min(B.lng,Math.min(j.lng,q.lng))),$=Math.min(O.lat,Math.min(B.lat,Math.min(j.lat,q.lat))),ne=Math.max(O.lng,Math.max(B.lng,Math.max(j.lng,q.lng))),X=Math.max(O.lat,Math.max(B.lat,Math.max(j.lat,q.lat))),ee=Math.min(E[3],Math.min(M[3],Math.min(A[3],R[3]))),te=Math.max(E[3],Math.max(M[3],Math.max(A[3],R[3])));return{minLngLat:new f.LngLat(H,$),maxLngLat:new f.LngLat(ne,X),minAltitude:ee,maxAltitude:te}}fitScreenCoordinates(o,u,g,x,b){let E,M,A,R;const O=f.pointGeometry.convert(o),B=f.pointGeometry.convert(u),j=this._raycastElevationBox(O,B);if(j)E=j.minLngLat,M=j.maxLngLat,A=j.minAltitude,R=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(O,B))return this;E=this.transform.pointLocation(O),M=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(f.pointGeometry.convert(o)),this.transform.pointLocation(f.pointGeometry.convert(u)),g,x):this._cameraForBox(E,M,A,R,x),x,b)}_fitInternal(o,u,g){return o?(delete(u=f.extend(o,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(o,u){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,E=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(x=!0,g.zoom=+o.zoom),void 0!==o.center&&(g.center=f.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(b=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(E=!0,g.pitch=+o.pitch),null==o.padding||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new f.Event("movestart",u)).fire(new f.Event("move",u)),x&&this.fire(new f.Event("zoomstart",u)).fire(new f.Event("zoom",u)).fire(new f.Event("zoomend",u)),b&&this.fire(new f.Event("rotatestart",u)).fire(new f.Event("rotate",u)).fire(new f.Event("rotateend",u)),E&&this.fire(new f.Event("pitchstart",u)).fire(new f.Event("pitch",u)).fire(new f.Event("pitchend",u)),this.fire(new f.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.warnOnce(du),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return f.warnOnce(du),this;this.stop();const x=g.zoom,b=g.pitch,E=g.bearing;g.setFreeCameraOptions(o);const M=x!==g.zoom,A=b!==g.pitch,R=E!==g.bearing;return this.fire(new f.Event("movestart",u)).fire(new f.Event("move",u)),M&&this.fire(new f.Event("zoomstart",u)).fire(new f.Event("zoom",u)).fire(new f.Event("zoomend",u)),R&&this.fire(new f.Event("rotatestart",u)).fire(new f.Event("rotate",u)).fire(new f.Event("rotateend",u)),A&&this.fire(new f.Event("pitchstart",u)).fire(new f.Event("pitch",u)).fire(new f.Event("pitchend",u)),this.fire(new f.Event("moveend",u)),this}easeTo(o,u){this._stop(!1,o.easeId),(!1===(o=f.extend({offset:[0,0],duration:500,easing:f.ease},o)).animate||!o.essential&&f.exported.prefersReducedMotion)&&(o.duration=0);const g=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),M=this.getPadding(),A="zoom"in o?+o.zoom:x,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,O="pitch"in o?+o.pitch:E,B="padding"in o?o.padding:g.padding,j=f.pointGeometry.convert(o.offset);let q,H,$;if("globe"===g.projection.name){const Se=f.MercatorCoordinate.fromLngLat(g.center),Te=j.rotate(-g.angle);Se.x+=Te.x/g.worldSize,Se.y+=Te.y/g.worldSize;const Ne=Se.toLngLat(),pe=f.LngLat.convert(o.center||Ne);this._normalizeCenter(pe),q=g.centerPoint.add(Te),H=new f.pointGeometry(Se.x,Se.y).mult(g.worldSize),$=new f.pointGeometry(f.mercatorXfromLng(pe.lng),f.mercatorYfromLat(pe.lat)).mult(g.worldSize).sub(H)}else{q=g.centerPoint.add(j);const Se=g.pointLocation(q),Te=f.LngLat.convert(o.center||Se);this._normalizeCenter(Te),H=g.project(Se),$=g.project(Te).sub(H)}const ne=g.zoomScale(A-x);let X,ee;o.around&&(X=f.LngLat.convert(o.around),ee=g.locationPoint(X));const te=this._zooming||A!==x,oe=this._rotating||b!==R,Q=this._pitching||O!==E,ae=!g.isPaddingEqual(B),me=Se=>Te=>{if(te&&(Se.zoom=f.number(x,A,Te)),oe&&(Se.bearing=f.number(b,R,Te)),Q&&(Se.pitch=f.number(E,O,Te)),ae&&(Se.interpolatePadding(M,B,Te),q=Se.centerPoint.add(j)),X)Se.setLocationAtPoint(X,ee);else{const Ne=Se.zoomScale(Se.zoom-x),pe=A>x?Math.min(2,ne):Math.max(.5,ne),He=Math.pow(pe,1-Te),Ve=Se.unproject(H.add($.mult(Te*He)).mult(Ne));Se.setLocationAtPoint(Se.renderWorldCopies?Ve.wrap():Ve,q)}return o.preloadOnly||this._fireMoveEvents(u),Se};if(o.preloadOnly){const Se=this._emulate(me,o.duration,g);return this._preloadTiles(Se),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=oe,this._pitching=Q,this._padding=ae,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,be),this._ease(me(g),Se=>{g.recenterOnTerrain(),this._afterEase(u,Se)},o),this}_prepareEase(o,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new f.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new f.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new f.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new f.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new f.Event("move",o)),this._zooming&&this.fire(new f.Event("zoom",o)),this._rotating&&this.fire(new f.Event("rotate",o)),this._pitching&&this.fire(new f.Event("pitch",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new f.Event("zoomend",o)),x&&this.fire(new f.Event("rotateend",o)),b&&this.fire(new f.Event("pitchend",o)),this.fire(new f.Event("moveend",o))}flyTo(o,u){if(!o.essential&&f.exported.prefersReducedMotion){const st=f.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,u)}this.stop(),o=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},o);const g=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),M=this.getPadding(),A="zoom"in o?f.clamp(+o.zoom,g.minZoom,g.maxZoom):x,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,O="pitch"in o?+o.pitch:E,B="padding"in o?o.padding:g.padding,j=g.zoomScale(A-x),q=f.pointGeometry.convert(o.offset);let H=g.centerPoint.add(q);const $=g.pointLocation(H),ne=f.LngLat.convert(o.center||$);this._normalizeCenter(ne);const X=g.project($),ee=g.project(ne).sub(X);let te=o.curve;const oe=Math.max(g.width,g.height),Q=oe/j,ae=ee.mag();if("minZoom"in o){const st=f.clamp(Math.min(o.minZoom,x,A),g.minZoom,g.maxZoom),at=oe/g.zoomScale(st-x);te=Math.sqrt(at/ae*2)}const me=te*te;function be(st){const at=(Q*Q-oe*oe+(st?-1:1)*me*me*ae*ae)/(2*(st?Q:oe)*me*ae);return Math.log(Math.sqrt(at*at+1)-at)}function Se(st){return(Math.exp(st)-Math.exp(-st))/2}function Te(st){return(Math.exp(st)+Math.exp(-st))/2}const Ne=be(0);let pe=function(st){return Te(Ne)/Te(Ne+te*st)},He=function(st){return oe*((Te(Ne)*(Se(at=Ne+te*st)/Te(at))-Se(Ne))/me)/ae;var at},Ve=(be(1)-Ne)/te;if(Math.abs(ae)<1e-6||!isFinite(Ve)){if(Math.abs(oe-Q)<1e-6)return this.easeTo(o,u);const st=Q<oe?-1:1;Ve=Math.abs(Math.log(Q/oe))/te,He=function(){return 0},pe=function(at){return Math.exp(st*te*at)}}o.duration="duration"in o?+o.duration:1e3*Ve/("screenSpeed"in o?+o.screenSpeed/te:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const nt=b!==R,Ie=O!==E,it=!g.isPaddingEqual(B),mt=st=>at=>{const _t=at*Ve,At=1/pe(_t);st.zoom=1===at?A:x+st.scaleZoom(At),nt&&(st.bearing=f.number(b,R,at)),Ie&&(st.pitch=f.number(E,O,at)),it&&(st.interpolatePadding(M,B,at),H=st.centerPoint.add(q));const ht=1===at?ne:st.unproject(X.add(ee.mult(He(_t))).mult(At));return st.setLocationAtPoint(st.renderWorldCopies?ht.wrap():ht,H),st._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(u),st};if(o.preloadOnly){const st=this._emulate(mt,o.duration,g);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=nt,this._pitching=Ie,this._padding=it,this._prepareEase(u,!1),this._ease(mt(g),()=>this._afterEase(u),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,u,g){!1===g.animate||0===g.duration?(o(1),u()):(this._easeStart=f.exported.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,u){o=f.wrap(o,-180,180);const g=Math.abs(o-u);return Math.abs(o-360-u)<g&&(o-=360),Math.abs(o+360-u)<g&&(o+=360),o}_normalizeCenter(o){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=o.lng-u.center.lng;o.lng+=g>180?-360:g<-180?360:0}_emulate(o,u,g){const x=Math.ceil(15*u/1e3),b=[],E=o(g.clone());for(let M=0;M<=x;M++){const A=E(M/x);b.push(A.clone())}return b}}class rn{constructor(o={}){this.options=o,f.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const u=this.options&&this.options.compact;return this._map=o,this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Pt("button","mapboxgl-ctrl-attrib-button",this._container),Pt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Pt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,u){const g=this._map._getUIString(`AttributionControl.${u}`);o.setAttribute("aria-label",g),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.config.ACCESS_TOKEN}];if(o){const g=u.reduce((x,b,E)=>(b.value&&(x+=`${b.key}=${b.value}${E<u.length-1?"&":""}`),x),"?");o.href=`${f.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const u=this._map.style._sourceCaches;for(const x in u){const b=u[x];if(b.used){const E=b.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((x,b)=>x.length-b.length),o=o.filter((x,b)=>{for(let E=b+1;E<o.length;E++)if(o[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yh{constructor(){f.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=Pt("div","mapboxgl-ctrl");const u=Pt("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const u in o){const g=o[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class yr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const x of g)if(x.id===o)return void(x.cancelled=!0)}run(o=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function dc(p,o,u){if(p=new f.LngLat(p.lng,p.lat),o){const g=new f.LngLat(p.lng-360,p.lat),x=new f.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-u.center.lng)/360),E=u.locationPoint(p).distSqr(o),M=o.x<0||o.y<0||o.x>u.width||o.y>u.height;u.locationPoint(g).distSqr(o)<E&&(M||Math.abs(g.lng-u.center.lng)<b)?p=g:u.locationPoint(x).distSqr(o)<E&&(M||Math.abs(x.lng-u.center.lng)<b)&&(p=x)}for(;Math.abs(p.lng-u.center.lng)>180;){const g=u.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}const Rs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ri extends f.Evented{constructor(o,u){if(super(),(o instanceof f.window.HTMLElement||u)&&(o=f.extend({element:o},u)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=f.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Pt("div");const x=41,b=27,E=ft("svg",{display:"block",height:x*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${x}`},this._element),M=ft("radialGradient",{id:"shadowGradient"},ft("defs",{},E));ft("stop",{offset:"10%","stop-opacity":.4},M),ft("stop",{offset:"100%","stop-opacity":.05},M),ft("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),ft("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),ft("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),ft("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=f.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const g=this._element.classList;for(const x in Rs)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=f.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const u=o.code,g=o.charCode||o.keyCode;"Space"!==u&&"Enter"!==u&&32!==g&&13!==g||this.togglePopup()}_onMapClick(o){const u=o.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._map;if(!o)return;const u=this._pos;if(!u||u.x<0||u.x>o.transform.width||u.y<0||u.y>o.transform.height)return void this._clearFadeTimer();const g=o.unproject(u);let x=!1;if(o.transform._terrainEnabled()&&o.getTerrain()){const E=o.getFreeCameraOptions();if(E.position){const M=E.position.toLngLat();x=M.distanceTo(g)<.9*M.distanceTo(this._lngLat)}}const b=(1-o._queryFogOpacity(g))*(x?.2:1);this._element.style.opacity=`${b}`,this._popup&&this._popup._setOpacity(`${b}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o)return;const u=this._offset.mult(this._scale),g=this._calculatePitch(),x=this._calculateRotation();this._element.style.transform=`\n            translate(${o.x}px, ${o.y}px) ${Rs[this._anchor]}\n            rotateX(${g}deg) rotateZ(${x}deg)\n            translate(${u.x}px, ${u.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(o){f.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=dc(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===o?this._updateFrameId=f.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!u.getTerrain()&&!u.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=f.pointGeometry.convert(o),this._update(),this}_onMove(o){const u=this._map;if(u){if(!this._isDragging){const g=this._clickTolerance||u._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(o){const u=this._map;u&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos),this._pointerdownPos=o.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const u=this._map;return u&&(o?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class vh{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const u=f.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,u,g){this._start=this.getValue(u),this._end=o,this._startTime=u,this._endTime=u+g}}const xh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},qd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function fc(p){p.parentNode&&p.parentNode.removeChild(p)}const Zd={showCompass:!0,showZoom:!0,visualizePitch:!1};class ul{constructor(o,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new ac({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new Yn({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(o,u){this.mouseRotate.mousedown(o,u),this.mousePitch&&this.mousePitch.mousedown(o,u),pi()}move(o,u){const g=this.map,x=this.mouseRotate.mousemoveWindow(o,u),b=x&&x.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const E=this.mousePitch.mousemoveWindow(o,u),M=E&&E.pitchDelta;M&&g.setPitch(g.getPitch()+M)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){qc(),f.window.removeEventListener("mousemove",this.mousemove),f.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(f.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Ti(this.element,o)),f.window.addEventListener("mousemove",this.mousemove),f.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Ti(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=tn(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=tn(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Pn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let ur,hl=0,Ki=!1;const mo={maxWidth:100,unit:"metric"};function fu(p,o,u){const g=u&&u.maxWidth||100,x=p._containerHeight/2,b=p._containerWidth/2-g/2,E=p.unproject([b,x]),M=p.unproject([b+g,x]),A=E.distanceTo(M);if(u&&"imperial"===u.unit){const R=3.2808*A;R>5280?Ca(o,g,R/5280,p._getUIString("ScaleControl.Miles"),p):Ca(o,g,R,p._getUIString("ScaleControl.Feet"),p)}else u&&"nautical"===u.unit?Ca(o,g,A/1852,p._getUIString("ScaleControl.NauticalMiles"),p):A>=1e3?Ca(o,g,A/1e3,p._getUIString("ScaleControl.Kilometers"),p):Ca(o,g,A,p._getUIString("ScaleControl.Meters"),p)}function Ca(p,o,u,g,x){const b=function(M){const A=Math.pow(10,`${Math.floor(M)}`.length-1);let R=M/A;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(O){const B=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*B)/B}(R),A*R}(u),E=b/u;x._requestDomTask(()=>{p.style.width=o*E+"px",p.innerHTML=`${b}&nbsp;${g}`})}const Yi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},kn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ea(p=new f.pointGeometry(0,0),o="bottom"){if("number"==typeof p){const u=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(o){case"top":return new f.pointGeometry(0,p);case"top-left":return new f.pointGeometry(u,u);case"top-right":return new f.pointGeometry(-u,u);case"bottom":return new f.pointGeometry(0,-p);case"bottom-left":return new f.pointGeometry(u,-u);case"bottom-right":return new f.pointGeometry(-u,-u);case"left":return new f.pointGeometry(p,0);case"right":return new f.pointGeometry(-p,0)}return new f.pointGeometry(0,0)}return p instanceof f.pointGeometry||Array.isArray(p)?f.pointGeometry.convert(p):f.pointGeometry.convert(p[o]||[0,0])}const Os={version:f.version,supported:er,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends je{constructor(p){if(null!=(p=f.extend({},qd,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&f.isSafariWithAntialiasingBug(f.window)&&(p.antialias=!1,f.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new sl(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new yr,this._domRenderTaskQueue=new yr,this._controls=[],this._markers=[],this._mapId=f.uniqueId(),this._locale=f.extend({},xh,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vh(0),this._explicitProjection=null,this._requestManager=new f.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=f.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof f.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&f.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==f.window&&(f.window.addEventListener("online",this._onWindowOnline,!1),f.window.addEventListener("resize",this._onWindowResize,!1),f.window.addEventListener("orientationchange",this._onWindowResize,!1),f.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Hd(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new up("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,f.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new rn({customAttribution:p.customAttribution})),this._logoControl=new yh,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new f.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new f.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(p,o){if(void 0===o&&(o=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=p.onAdd(this);this._controls.push(p);const g=this._controlPositions[o];return-1!==o.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(p);return o>-1&&this._controls.splice(o,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new f.Event("movestart",p)).fire(new f.Event("move",p)),this.fire(new f.Event("resize",p)),o&&this.fire(new f.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(f.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=null==p?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=null==p?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=null==p?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=null==p?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._updateProjection(p)}_updateProjection(p){null===p&&(this._explicitProjection=null);const o=p||this.getProjection(),u=this.transform.setProjection(o);if(p&&(this._explicitProjection=this.transform.getProjection()),u){this.painter.clearBackgroundTiles();for(const g in this.style._sourceCaches)this.style._sourceCaches[g].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(p){return this.transform.locationPoint3D(f.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(f.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,o,u){if("mouseenter"===p||"mouseover"===p){let g=!1;const x=E=>{const M=o.filter(R=>this.getLayer(R)),A=M.length?this.queryRenderedFeatures(E.point,{layers:M}):[];A.length?g||(g=!0,u.call(this,new yi(p,this,E.originalEvent,{features:A}))):g=!1},b=()=>{g=!1};return{layers:new Set(o),listener:u,delegates:{mousemove:x,mouseout:b}}}if("mouseleave"===p||"mouseout"===p){let g=!1;const x=E=>{const M=o.filter(A=>this.getLayer(A));(M.length?this.queryRenderedFeatures(E.point,{layers:M}):[]).length?g=!0:g&&(g=!1,u.call(this,new yi(p,this,E.originalEvent)))},b=E=>{g&&(g=!1,u.call(this,new yi(p,this,E.originalEvent)))};return{layers:new Set(o),listener:u,delegates:{mousemove:x,mouseout:b}}}{const g=x=>{const b=o.filter(M=>this.getLayer(M)),E=b.length?this.queryRenderedFeatures(x.point,{layers:b}):[];E.length&&(x.features=E,u.call(this,x),delete x.features)};return{layers:new Set(o),listener:u,delegates:{[p]:g}}}}on(p,o,u){if(void 0===u)return super.on(p,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(p,o,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(p,o,u){if(void 0===u)return super.once(p,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(p,o,u);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(p,o,u){if(void 0===u)return super.off(p,o);o=new Set(Array.isArray(o)?o:[o]);const g=(b,E)=>{if(b.size!==E.size)return!1;for(const M of b)if(!E.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[p]:void 0;return x&&(b=>{for(let E=0;E<b.length;E++){const M=b[E];if(M.listener===u&&g(M.layers,o)){for(const A in M.delegates)this.off(A,M.delegates[A]);return b.splice(E,1),this}}})(x),this}queryRenderedFeatures(p,o){return this.style?(void 0!==o||void 0===p||p instanceof f.pointGeometry||Array.isArray(p)||(o=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(p,o){return this.style.querySourceFeatures(p,o)}queryTerrainElevation(p,o){const u=this.transform.elevation;return u?(o=f.extend({},{exaggerated:!0},o),u.getAtPoint(f.MercatorCoordinate.fromLngLat(p),null,o.exaggerated)):null}setStyle(p,o){return!1!==(o=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(p,o))}_getUIString(p){const o=this._locale[p];if(null==o)throw new Error(`Missing UI string '${p}'`);return o}_updateStyle(p,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new Hr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Hr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,o){if("string"==typeof p){const u=this._requestManager.normalizeStyleURL(p),g=this._requestManager.transformRequest(u,f.ResourceType.Style);f.getJSON(g,(x,b)=>{x?this.fire(new f.ErrorEvent(x)):b&&this._updateDiff(b,o)})}else"object"==typeof p&&this._updateDiff(p,o)}_updateDiff(p,o){try{this.style.setState(p)&&this._update(!0)}catch(u){f.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(p,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.warnOnce("There is no style added to the map."),!1)}addSource(p,o){return this._lazyInitEmptyStyle(),this.style.addSource(p,o),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const o in p){const u=p[o]._tiles;for(const g in u){const x=u[g];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(p,o,u){this._lazyInitEmptyStyle(),this.style.addSourceType(p,o,u)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,o,{pixelRatio:u=1,sdf:g=!1,stretchX:x,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&o instanceof f.window.ImageBitmap){const{width:M,height:A,data:R}=f.exported.getImageData(o);this.style.addImage(p,{data:new f.RGBAImage({width:M,height:A},R),pixelRatio:u,stretchX:x,stretchY:b,content:E,sdf:g,version:0})}else if(void 0===o.width||void 0===o.height)this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:A}=o,R=o;this.style.addImage(p,{data:new f.RGBAImage({width:M,height:A},new Uint8Array(R.data)),pixelRatio:u,stretchX:x,stretchY:b,content:E,sdf:g,version:0,userImage:R}),R.onAdd&&R.onAdd(this,p)}}updateImage(p,o){const u=this.style.getImage(p);if(!u)return void this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&o instanceof f.window.ImageBitmap?f.exported.getImageData(o):o,{width:x,height:b}=g;void 0!==x&&void 0!==b?x===u.data.width&&b===u.data.height?(u.data.replace(g.data,!(o instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&o instanceof f.window.ImageBitmap)),this.style.updateImage(p,u)):this.fire(new f.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,o){f.getImage(this._requestManager.transformRequest(p,f.ResourceType.Image),(u,g)=>{o(u,g instanceof f.window.HTMLImageElement?f.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(p,o){return this._lazyInitEmptyStyle(),this.style.addLayer(p,o),this._update(!0)}moveLayer(p,o){return this.style.moveLayer(p,o),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,o,u){return this.style.setLayerZoomRange(p,o,u),this._update(!0)}setFilter(p,o,u={}){return this.style.setFilter(p,o,u),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,o,u,g={}){return this.style.setPaintProperty(p,o,u,g),this._update(!0)}getPaintProperty(p,o){return this.style.getPaintProperty(p,o)}setLayoutProperty(p,o,u,g={}){return this.style.setLayoutProperty(p,o,u,g),this._update(!0)}getLayoutProperty(p,o){return this.style.getLayoutProperty(p,o)}setLight(p,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.LngLat.convert(p),this.transform):0}setFeatureState(p,o){return this.style.setFeatureState(p,o),this._update()}removeFeatureState(p,o){return this.style.removeFeatureState(p,o),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let u,g,x,b=this._container;for(;b&&(!g||!x);){const E=f.window.getComputedStyle(b).transform;E&&"none"!==E&&(u=E.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(g=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(x=u[3])),b=b.parentElement}this._containerWidth=g?Math.abs(p/g):p,this._containerHeight=x?Math.abs(o/x):o}_detectMissingCSS(){"rgb(250, 128, 114)"!==f.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=Pt("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Pt("div","mapboxgl-canvas-container",p);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Pt("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Pt("div","mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=Pt("div",`mapboxgl-ctrl-${x}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,o){const u=f.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(p),this._canvas.height=u*Math.ceil(o),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${o}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const o=this._markers.indexOf(p);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const p=f.extend({},er.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);o?(f.storeAuthState(o,!0),this.painter=new lp(o,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),f.exported$1.testSupport(o)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let o;const u=this.painter.context.extTimerQuery,g=f.exported.now();if(this.listens("gpu-timing-frame")&&(o=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;let x=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,O=f.exported.now();this.style.zoomHistory.update(A,O);const B=new f.EvaluationParameters(A,{now:O,fadeDuration:b,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=B.crossFadingFactor();1===j&&j===this._crossFadingFactor||(x=!0,this._crossFadingFactor=j),this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerUpdate()):E=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const A=f.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,o),setTimeout(()=>{const R=u.getQueryObjectEXT(o,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(o),this.fire(new f.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new f.Event("gpu-timing-layer",{layerTimes:R}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(M||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new f.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new f.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,o=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((o||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const g=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const E=Math.abs(g-x);if(E>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(x),u(x);this._averageElevation.easeTo(x,p,300)}else if(E>1e-4)return this._averageElevation.jumpTo(x),u(x)}return!!this._averageElevation.isEasing(p)&&u(this._averageElevation.getValue(p))}_authenticate(){f.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===f.AUTH_ERR_MSG||401===p.status)){const o=this.painter.context.gl;f.storeAuthState(o,!1),this._logoControl instanceof yh&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function x(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const E=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,E),E}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(x(p),o.canvasCopies.map(x),o.timeStamps)}_canvasPixelComparison(p,o,u){let g=u[1]-u[0];const x=p.length/4;for(let b=0;b<o.length;b++){const E=o[b];let M=0;for(let A=0;A<E.length;A+=4)E[A]===p[A]&&E[A+1]===p[A+1]&&E[A+2]===p[A+2]&&E[A+3]===p[A+3]&&(M+=1);g+=(u[b+2]-u[b+1])*(1-M/x)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==f.window&&(f.window.removeEventListener("resize",this._onWindowResize,!1),f.window.removeEventListener("orientationchange",this._onWindowResize,!1),f.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),fc(this._canvasContainer),fc(this._controlContainer),fc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),f.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=f.exported.frame(o=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(o)}))}_preloadTiles(p){const o=this.style?Object.values(this.style._sourceCaches):[];return f.asyncAll(o,(u,g)=>u._preloadTiles(p,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,o){f.setCacheLimits(p,o)}get version(){return f.version}},NavigationControl:class{constructor(p){this.options=f.extend({},Zd,p),this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),Pt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),Pt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:o}):u.resetNorth({},{originalEvent:o}))}),this._compassIcon=Pt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const o=p.getZoom(),u=o===p.getMaxZoom(),g=o===p.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ul(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,o){const u=Pt("button",p,this._container);return u.type="button",u.addEventListener("click",o),u}_setButtonTitle(p,o){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${o}`);p.setAttribute("aria-label",u),p.firstElementChild&&p.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends f.Evented{constructor(p){super(),this.options=f.extend({},Pn,p),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Vd(this._updateMarkerRotation,20)}onAdd(p){var o;return this._map=p,this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==ur?o(ur):void 0!==f.window.navigator.permissions?f.window.navigator.permissions.query({name:"geolocation"}).then(u=>{ur="denied"!==u.state,o(ur)}):(ur=!!f.window.navigator.geolocation,o(ur)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(f.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,hl=0,Ki=!1}_isOutOfMapMaxBounds(p){const o=this._map.getMaxBounds(),u=p.coords;return!!o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",p)),this._finish()}}_updateCamera(p){const o=new f.LngLat(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,g=this._map.getBearing(),x=f.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(u),x,{geolocateSource:!0})}_updateMarker(p){if(p){const o=new f.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._containerHeight/2,o=this._map.unproject([0,p]),u=this._map.unproject([100,p]),g=o.distanceTo(u)/100,x=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&Ki)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Pt("button","mapboxgl-ctrl-geolocate",this._container),Pt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pt("div","mapboxgl-user-location"),this._dotElement.appendChild(Pt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Pt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ri({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Pt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ri({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":hl--,Ki=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),hl++,hl>1?(p={maximumAge:6e5,timeout:0},Ki=!0):(p=this.options.positionOptions,Ki=!1),this._geolocationWatchID=f.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else f.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{f.window.addEventListener("ondeviceorientationabsolute"in f.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==f.window.DeviceMotionEvent&&"function"==typeof f.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&p()}).catch(console.error):p()}_clearWatch(){f.window.navigator.geolocation.clearWatch(this._geolocationWatchID),f.window.removeEventListener("deviceorientation",this._onDeviceOrientation),f.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:rn,ScaleControl:class{constructor(p){this.options=f.extend({},mo,p),f.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){fu(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,fu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof f.window.HTMLElement?this._container=p.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in f.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in f.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,f.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!f.window.document.fullscreenEnabled&&!f.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=Pt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Pt("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),f.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(f.window.document.fullscreenElement||f.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?f.window.document.exitFullscreen?f.window.document.exitFullscreen():f.window.document.webkitCancelFullScreen&&f.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(p){super(),this.options=f.extend(Object.create(Yi),p),f.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=f.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(f.window.document.createTextNode(p))}setHTML(p){const o=f.window.document.createDocumentFragment(),u=f.window.document.createElement("body");let g;for(u.innerHTML=p;g=u.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=Pt("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(p),this.options.closeButton){const u=this._closeButton=Pt("button","mapboxgl-popup-close-button",o);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let o;return this._classList.delete(p)?o=!1:(this._classList.add(p),o=!0),this._updateClassList(),o}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const o=this._map,u=this._container,g=this._pos;if(!o||!u||!g)return"bottom";const x=u.offsetWidth,b=u.offsetHeight,E=g.x<x/2,M=g.x>o.transform.width-x/2;if(g.y+p<b)return E?"top-left":M?"top-right":"top";if(g.y>o.transform.height-b){if(E)return"bottom-left";if(M)return"bottom-right"}return E?"left":M?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),p.className=o.join(" ")}_update(p){const o=this._map,u=this._content;if(!o||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=Pt("div","mapboxgl-popup",o.getContainer()),this._tip=Pt("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=dc(this._lngLat,this._pos,o.transform)),!this._trackPointer||p){const x=this._pos=this._trackPointer&&p?p:o.project(this._lngLat),b=Ea(this.options.offset),E=this._anchor=this._getAnchor(b.y),M=Ea(this.options.offset,E),A=x.add(M).round();o._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Rs[E]} translate(${A.x}px,${A.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(kn);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:Ri,Style:Hr,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.pointGeometry,MercatorCoordinate:f.MercatorCoordinate,FreeCameraOptions:iu,Evented:f.Evented,config:f.config,prewarm:function(){xt().acquire(ut)},clearPrewarmedResources:function(){const p=pt;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(ut),pt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return f.config.ACCESS_TOKEN},set accessToken(p){f.config.ACCESS_TOKEN=p},get baseApiUrl(){return f.config.API_URL},set baseApiUrl(p){f.config.API_URL=p},get workerCount(){return gt.workerCount},set workerCount(p){gt.workerCount=p},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){f.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){f.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:f.exported.setNow,restoreNow:f.exported.restoreNow};return Os}),dn}()}},np=>{np(np.s=620)}]);